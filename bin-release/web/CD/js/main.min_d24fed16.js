function createBitmap(t,e,i,n,s,r,o,a){var h=new egret.Bitmap,l=new AssetAdapter;return l.getAsset(t,function(l){h.texture=RES.getRes(t),h.anchorOffsetX=e>2?e:(e||0)*h.width,h.anchorOffsetY=i>2?i:(i||0)*h.height,h.x=n||0,h.y=s||0,h.scaleX=r||1,h.scaleY=o||1,a&&a(h)},this),h}function setTexture(t,e,i,n,s,r,o){i=i||t.anchorOffsetX/t.width,n=n||t.anchorOffsetY/t.height,t.scaleX=void 0===s?1:s,t.scaleY=void 0===r?1:r;var a=new AssetAdapter;t.texture=null,a.getAsset(e,function(s){t.texture=RES.getRes(e),t.anchorOffsetX=(i||0)*t.width,t.anchorOffsetY=(n||0)*t.height,o&&o()},this)}function getNumberString(t){var e,i;if(0===+t||+t){var n=""+Math.floor(t);if(1e3>t)return n;var s=Math.floor(Math.log(t)/Math.log(10)+1e-6);e=~n.indexOf("e")?+n.split("e")[0]*Math.pow(10,s%3):+n.slice(0,s%3+3)/100,i=s/3>>0}else{if(t=t.split("exp"),+t[1]<3)return Math.round(t[0]*Math.pow(10,t[1]))+"";for(e=t[0]*Math.pow(10,t[1]%3);e>1e3;)e/=1e3,t[1]=+t[1]+3;i=t[1]/3>>0}var r;if(4>i)r=["","K","M","B"][i];else{var o=(i-4)/26>>0,a=o/26>>0,h=(i-4)%26,l="abcdefghijklmnopqrstuvwxyz",c=l.toUpperCase();r=(2>a?l:c)[o%26]+(a%2?c:l)[h]}return e.toFixed(10>e?2:100>e?1:0)+r}function setAvatar(t,e,i,n){if(!e)return t.texture=null,void(n&&n());var s=t.width,r=t.height;if(i=i||(~location.hostname.indexOf("h5.")?"http://s1.wc.weedon.cn:9602/avatar/":"https://gsbxs.hortor.net:9602/avatar/")+e+"/avatar.jpg",avatars[e]){var o=new egret.Texture;o.bitmapData=avatars[e],t.texture=o,t.width=s,t.height=r,n&&n()}else{var a=new egret.ImageLoader;a.crossOrigin="anonymous",a.once(egret.Event.COMPLETE,function(i){var o=new egret.Texture;avatars[e]=o.bitmapData=a.data,t.texture=o,t.width=s,t.height=r,n&&n()},this),a.load(i)}}function setQRCode(t,e,i){var n=t.width,s=t.height,r=(~location.hostname.indexOf("h5game.")?"http://s1.wc.weedon.cn:9602/qrcode/":"https://gsbxs.hortor.net:9602/qrcode/")+e;if(qrcodes[e])t.width=n,t.height=s,i();else{var o=new egret.ImageLoader;o.crossOrigin="anonymous",o.once(egret.Event.COMPLETE,function(e){t.width=n,t.height=s,i()},this),o.load(r)}}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(s,r){function o(t){try{h(n.next(t))}catch(e){r(e)}}function a(t){try{h(n["throw"](t))}catch(e){r(e)}}function h(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(o,a)}h((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(s)throw new TypeError("Generator is already executing.");for(;h;)try{if(s=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,r=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){h.label=i[1];break}if(6===i[0]&&h.label<o[1]){h.label=o[1],o=i;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(i);break}o[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(n){i=[6,n],r=0}finally{s=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var s,r,o,a,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},BuyTiDialog=function(t){function e(e,i){var n=t.call(this)||this;return n.mScreenHeight=e,n.dispatcher=i,n.skinName=BuyTiDialogSkin,n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),setTexture(this.backBtn.tfImg,"wz_fh_png"),new Btn(this.backBtn,function(){e.parent.removeChild(e)}.bind(this)),this.diamondTF.text=(this.dispatcher.get("user","diamondAll")||0)-(this.dispatcher.get("user","diamondCost")||0),this.refreshList(),this.adjustUI()},e.prototype.refreshList=function(){this.list.removeChildren();for(var t=function(t){var i=new eui.Component;i.skinName=BuyTiItemRenderSkin,i.desTF.text="能量 X"+10*(t+1),i.diamondTF.text=t+1,e.list.addChild(i),i.y=150*t,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("click item "+t)},e)},e=this,i=0;8>i;i++)t(i)},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e}(eui.Component);__reflect(BuyTiDialog.prototype,"BuyTiDialog");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var s=RES.getRes(t);s?n(s):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var _wx={_lastCallback:0,_interval:0,_callback:null,startAccelerometer:function(t){window.addEventListener("deviceorientation",this._listener.bind(this),!0),t.success&&t.success()},_listener:function(t){var e=Date.now();e-this._lastCallback<this._interval||(this._lastCallback=e,this._callback&&this._callback({x:+Math.sin(t.gamma/180*Math.PI).toFixed(5),y:t.alpha,z:+Math.sin(-t.beta/180*Math.PI).toFixed(5)}))},onAccelerometerChange:function(t){this._callback=t},setInterval:function(t){this._interval=t},stopAccelerometer:function(){window.removeEventListener("deviceorientation",this._listener.bind(this),!0)}},Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e="1.0.2";RES.getRealURL=function(t){return t+"?v="+e};var i=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",i),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),this.stage.removeChild(t),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var n=new eui.Theme("resource/default.thm.json",t.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){formula.init(RES.getRes("data_json"),RES.getRes("game_config_json"));var t=weedon.config(~location.hostname.indexOf("h5.")?"s1.wc.weedon.cn":~location.hostname.indexOf(".hortor.")?"gsbxs.hortor.net":"192.168.1.196"==location.hostname?"192.168.1.204":location.hostname,9601,"ws",function(){}),e=egret.localStorage.getItem("CM#OPENID");e||(e=Math.random().toString(),egret.localStorage.setItem("CM#OPENID",e)),weedon.getLoginData(function(e,i){var n=this;t.request("user.login",{loginData:i},function(e){if(e)return alert(e.errmsg||"登录失败");t.heartbeat(5e3,function(){}),weedon.initChannelConfig({inviter:t.get("user","_id"),nickname:t.get("user","nickname")},function(e){var i=t.getCache("shareCallback");i&&i(e||0)},function(e){var i=t.getCache("payCallback");i&&i(e||0)});var i=-1==t.get("user","gender");if(i){var s=new SelectDialog(t,function(){n.removeChild(s);var e=new MainScene(t);n.addChild(e)}.bind(n));n.addChild(s)}else{var r=new MainScene(t);n.addChild(r)}}.bind(this))}.bind(this))},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function s(t){e.call(n,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(n,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Animation=function(t){function e(e,i,n,s,r){var o=t.call(this)||this;o.onTop=1,o.debug=!1,o.spd=1,o.slots={},o.sounds={},o.frameEvents={},o.touchEnabled=!1,o.eventCallback=s;var a=new AssetAdapter,h=3;return[e+"_ske_json",e+"_tex_json",e+"_tex_png"].forEach(function(t){a.getAsset(t,function(){if(!--h){var t=new dragonBones.EgretFactory;t.parseDragonBonesData(RES.getRes(e+"_ske_json")),t.parseTextureAtlasData(RES.getRes(e+"_tex_json"),RES.getRes(e+"_tex_png"));var s=this.display=t.buildArmatureDisplay(i||e);this.addChild(s),s.touchEnabled=!1,s.armature.addEventListener(dragonBones.Event.LOOP_COMPLETE,function(){if(this.callback){var t=this.callback;this.callback=null,t()}else n&&n()},this),s.armature.addEventListener(dragonBones.Event.BONE_FRAME_EVENT,this.frameListener,this),s.armature.addEventListener(dragonBones.SoundEvent.SOUND_EVENT,this.soundListener,this),this.animationName&&s.animation.play(this.animationName,this.loop);for(var o in this.slots){var a=s.armature.getSlot(o),l=a.getDisplay();this.slots[o].x=l.x,this.slots[o].y=l.y,a.setDisplay(this.slots[o]),delete this.slots[o]}s.animation.timeScale=this.spd,r&&r(s)}},this)}.bind(o)),o}return __extends(e,t),e.prototype.frameListener=function(t){this.frameEvents[t.frameLabel]?this.frameEvents[t.frameLabel](t):this.eventCallback&&this.eventCallback(t.frameLabel)},e.prototype.soundListener=function(t){if(!MUTE_SE)if(this.sounds[t.frameLabel])this.sounds[t.frameLabel].play(1);else var e=this.sounds[t.frameLabel]=new Sound(1,t.frameLabel.split(".")[0],function(){e.play(1)})},e.prototype.clearListeners=function(){this.display.armature.removeEventListener(dragonBones.Event.BONE_FRAME_EVENT,this.frameListener,this),this.display.armature.removeEventListener(dragonBones.SoundEvent.SOUND_EVENT,this.soundListener,this)},e.prototype.getSlotDisplay=function(t){return this.display?this.display.armature.getSlot(t).getDisplay():null},e.prototype.play=function(t,e,i){this.debug&&console.log(t),this.animationName=t,this.loop=e,this.display&&this.display.animation.play(t,e),this.callback=i||this.callback},e.prototype.setSlot=function(t,e){if(this.display){var i=this.display.armature.getSlot(t).getDisplay();if(!i)return;e.x=i.x,e.y=i.y,e.rotation=i.rotation,this.display.armature.getSlot(t).setDisplay(e)}else this.slots[t]=e},e.prototype.setEvent=function(t,e){this.frameEvents[t]=e},e.prototype.setSpeed=function(t){this.display?this.display.animation.timeScale=t:this.spd=t},e.prototype.hitCheck=function(t,e,i){var n=this.display.globalToLocal(t,e);if(i){var s=this.display.armature.getSlot(i);return s?s.containsPoint(n.x,n.y):!1}return!!this.display.armature.containsPoint(n.x,n.y)},Object.defineProperty(e.prototype,"_factor",{get:function(){return 0},set:function(t){this.x=(1-t)*(1-t)*this.originX+2*t*(1-t)*this.terminalX+t*t*this.targetX,this.y=(1-t)*(1-t)*this.originY+2*t*(1-t)*this.terminalY+t*t*this.targetY},enumerable:!0,configurable:!0}),e.prototype.bezierTo=function(t,e,i,n,s,r){this.originX=this.x,this.originY=this.y,this.terminalX=t,this.terminalY=e,this.targetX=i,this.targetY=n,egret.Tween.get(this).to({_factor:1},s).call(r)},e}(eui.Group);__reflect(Animation.prototype,"Animation");var Btn=function(t){function e(e,i,n){var s=t.call(this)||this;return s.isEnabled=!0,s.canceled=!1,s.noBouncing=!1,s.btnNode=e,s.touchNode=new eui.Group,s.touchNode.touchThrough=!1,e.parent.addChildAt(s.touchNode,e.parent.getChildIndex(e)+1),e.pixelHitTest=!1,s.touchNode.x=e.x,s.touchNode.y=e.y,s.touchNode.width=e.width,s.touchNode.height=e.height,s.touchNode.anchorOffsetX=e.anchorOffsetX,s.touchNode.anchorOffsetY=e.anchorOffsetY,s.callback=i,s.originScaleX=e.scaleX,s.originScaleY=e.scaleY,[s.btnNode,s.touchNode].forEach(function(t){t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegan,this)}.bind(s)),s.showRedDot(n),s}return __extends(e,t),e.prototype.showRedDot=function(t,e){return this.touchNode.visible=this.btnNode.visible,this.touchNode.x=this.btnNode.x,this.touchNode.y=this.btnNode.y,t?void(this.redDot?(this.redDot.visible=!0,e||(this.redDot.x=this.btnNode.x+t[0],this.redDot.y=this.btnNode.y+t[1])):t&&(this.redDot=createBitmap("common_hong_png",.5,.5,0,0,1,1,function(e){e.x=this.btnNode.x+t[0],e.y=this.btnNode.y+t[1],egret.Tween.get(e,{loop:!0}).to({y:this.btnNode.y+t[1]-8.5},200,egret.Ease.sineIn).to({y:this.btnNode.y+t[1]},500,egret.Ease.bounceOut).wait(3e3)}.bind(this)),this.btnNode.parent.addChildAt(this.redDot,this.btnNode.parent.getChildIndex(this.btnNode)+1))):void(this.redDot&&(this.redDot.visible=!1))},e.prototype.setOriginScale=function(t,e){this.originScaleX=t,this.originScaleY=e},e.prototype.touchBegan=function(t){return!this.isEnabled||this.canceled?void(this.canceled=!1):(this.noBouncing?this.callback():(egret.Tween.removeTweens(this.btnNode),this.btnNode.scaleX=this.originScaleX,this.btnNode.scaleY=this.originScaleY,egret.Tween.get(this.btnNode).to({scaleX:.7*this.originScaleX,scaleY:.7*this.originScaleY},100).to({scaleX:1*this.originScaleX,scaleY:1*this.originScaleY},100).call(function(){this.callback()},this)),void t.stopPropagation())},e.prototype.touchMoved=function(t){this.isEnabled&&(this.canceled=!0,egret.Tween.removeTweens(this.btnNode),this.btnNode.scaleX=this.originScaleX,this.btnNode.scaleY=this.originScaleY,t.stopPropagation())},e.prototype.touchEnded=function(t){this.isEnabled&&(!this.canceled&&this.callback(),this.canceled=!1,t.stopPropagation())},e.prototype.setEnabled=function(t,e){this.isEnabled=t,this.btnNode.filters=t||e?[]:[new egret.ColorMatrixFilter([.4,.7,0,0,0,.4,.7,0,0,0,.4,.7,0,0,0,0,0,0,1,0])]},e.prototype.trigger=function(){this.callback()},e}(egret.DisplayObjectContainer);__reflect(Btn.prototype,"Btn");var Dispatcher=function(){function t(t){this._dispatcher=t}return t.prototype.heartbeat=function(t,e){this._dispatcher.heartbeat(t,e)},t.prototype.request=function(t,e,i,n){this._dispatcher.request(t,e,i,n)},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._dispatcher.get.apply(this._dispatcher,t)},t.prototype.getOld=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._dispatcher.getOld.apply(this._dispatcher,t)},t.prototype.getNew=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._dispatcher.getNew.apply(this._dispatcher,t)},t.prototype.safeGetNew=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._dispatcher.safeGetNew.apply(this._dispatcher,t)},t.prototype.setCache=function(t,e){this._dispatcher.setCache(t,e)},t.prototype.getCache=function(t){return this._dispatcher.getCache(t)},t.prototype.clearCache=function(){this._dispatcher.clearCache()},Object.defineProperty(t.prototype,"waitFunc",{set:function(t){this._dispatcher.waitFunc=t},enumerable:!0,configurable:!0}),t.prototype.setOverrideKey=function(t){this._dispatcher.setOverrideKey(t)},t.prototype.setPushCallback=function(t,e){this._dispatcher.setPushCallback(t,e)},t}();__reflect(Dispatcher.prototype,"Dispatcher");var MUTE_SE=!1,Sound=function(){function t(t,e,i,n){this.playing=!1;var s=new egret.Sound;s.load("resource/assets/sound/"+e+(n||".mp3")+"?v="+window.__VERSION),s.addEventListener(egret.Event.COMPLETE,function(){this.sound=s,i(this)},this),this.mode=t}return t.prototype.play=function(t,e){if(!(this.playing||!this.sound||this.mode&&MUTE_SE)){this.playing=!0;var i=this.channel=this.sound.play(0,t||0===t?t:1);i.addEventListener(egret.Event.SOUND_COMPLETE,function(){e&&e(),this.playing=!1},this)}},t.prototype.stop=function(){this.playing&&(this.playing=!1,this.channel&&this.channel.stop())},t}();__reflect(Sound.prototype,"Sound");var avatars={},qrcodes={},User=function(){function t(){this.shooting=!1,this.reloading=!1,this.reloadActing=!1,this.reloadFinishing=!1,this.itemUsing=!1,this.itemUsed=!1,this.canAim=!1,this.aiming=!1,this.aimed=!1,this.touching=!1,this.stateFinishing=!1,this.cursorSpeed=.01,this.cursorMode=0,this.lastFire=0,this.fireInterval=1200}return t}();__reflect(User.prototype,"User");var Opponent=function(){function t(){this.moving=!1,this.moveSpeed=.2,this.restTimeBase=1e3,this.restTimeRand=1e3,this.moveWidth=440,this.waitFinish=0,this.nextX=0,this.waiting=!1}return t}();__reflect(Opponent.prototype,"Opponent");var Duel=function(t){function e(e,i){var n=t.call(this)||this;return n.targetX=0,n.targetY=0,n.mode=0,n.hitEffects=[],n.behitEffects=[],n.nohitEffects=[],n.cdItems=[],n.cdBlanks=[],n.dispatcher=e,n.callback=i,n.skinName=DuelSceneSkin,n.initBattleData(),n}return __extends(e,t),e.prototype.initBattleData=function(){var t=this.dispatcher.get("battle"),e=this.me=new User,i=RES.getRes("data_json"),n=this.dispatcher.get("user","_id");e._id=n;var s=t["gunType"+n],r=i.gunsBaseNumber[s],o=s.split("-"),a=+o[0];e.gunIndex=+o[1],e.gunType=0==a?0:1,e.gunName=["handgun","rifle","shutgun","sniper"][a],e.gender=0,e.bulletType=["s","b","xd","b"][a],e.maxBullets=e.bullets=r[3],e.maxHp=e.hp=t["hpMax"+n];var h=t["propType"+n];if(""==h)e.itemIndex=-1,e.itemGrade=-1;else{var l=h.split("-"),c=+l[0],d=+l[1];e.itemIndex=[1,0,2][c],e.itemGrade=d}e.hits=r[8],e.precision=r[4],e.basePrecision=100,e.baseHitRadius=r[10],e.crosshairIndex=0==a?0:1,e.canAim=1==r[11],0==e.gunIndex&&(e.fireInterval=0);var p=t.uids.split("-"),u=n==p[0]?p[1]:p[0];this.targetUserId=u;var g=this.opponent=new Opponent;g.nickname=t["nickname"+u];var m=t["gunType"+u],f=m.split("-"),v=+f[0];i.gunsBaseNumber[m];g.gunName=["handgun","rifle","shutgun","sniper"][v],g.maxHp=g.hp=t["hpMax"+u],g._id=u,g.gender=t["targetGender"+u]},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=this.me,i=this.opponent;if(console.log(e.itemIndex+"----"+e.itemGrade),-1!=e.itemIndex||-1!=e.itemGrade){var n=this.item=new Animation("item"+e.itemIndex);this.addChild(n),n.play("stand"+e.itemGrade,0),n.x=110,n.y=1276,n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.useItem()},this)}var s=this.gun=new Animation(e.gunName);this.addChild(s),s.play("stand",0),s.x=320,s.y=1386;var r=this.cross=new Animation("crosshair"+e.crosshairIndex);this.addChild(r),r.play("stand",0),r.x=320,r.y=886,r.scaleX=r.scaleY=(e.basePrecision-e.precision)/e.basePrecision,r.touchEnabled=!1;var o=this.target=new Animation("chr"+i.gender);this.enemy.addChild(o),o.play(i.gunName+"_stand_fire",0),o.scaleX=o.scaleY=.3;for(var a=0;12>a;++a)if(e.fireInterval&&1==e.crosshairIndex){var h=this.cdBlanks[a]=new egret.DisplayObject;r.setSlot(""+a,h),this.cdItems.push(createBitmap("se_4_png",.5,.5))}var l=this.enemyFire=new Animation("enimyfire");o.setSlot("p",l),l.visible=!1;var c=this.flour=new Animation("itemhit1");this.addChild(c),c.x=320,c.y=1386,c.visible=!1,this.nickname.text=i.nickname,this.scene.touchEnabled=!0,this.scene.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.touching=!0,e.canAim&&this.aim()},this),this.scene.addEventListener(egret.TouchEvent.TOUCH_END,function(){e.touching=!1,!this.startTime||e.itemUsing||e.reloadFinishing||(e.reloading&&!e.reloadActing?this.reload():this.fire())},this),egret.Tween.get(this.reloadTag,{loop:!0}).to({scaleY:.8},300).to({scaleY:1},200).wait(1e3);var d=this.log=new eui.Label;this.addChild(d),d.size=20,d.textColor=14483456,d.x=20,d.y=1200;for(var p=function(t){["s","xd","b","b"].forEach(function(i){i==e.bulletType?this[i+"qzdc"+t].visible=this[i+"qzd"+t].visible=t<e.bullets:this[i+"qzdc"+t].visible=this[i+"qzd"+t].visible=!1}.bind(u))},u=this,a=0;6>a;++a)p(a);this.targetX=this.field.x,this.targetY=this.scene.y,this.adjustUI(),this.start()},e.prototype.adjustUI=function(){return this.ignoreNextResize?void(this.ignoreNextResize=!1):(this.ignoreNextResize=!0,void(weedon.winSize.width/weedon.winSize.height>.64?(this.stage.setContentSize(640,1e3),this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL,this.y=-193,this.topUI.y=193,this.screenHeight=1e3):(this.stage.setContentSize(640,1386),this.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,this.screenHeight=640/weedon.winSize.width*weedon.winSize.height,this.y=this.screenHeight-1386,this.topUI.y=-this.y)))},e.prototype.clamp=function(t,e,i){return Math.max(e,Math.min(t,i))},e.prototype.duelFinish=function(){this.dispatcher.setPushCallback("battle",null),("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).stopAccelerometer(),this.parent.removeChild(this),this.callback()},e.prototype.start=function(){var t=this.me,e=this.opponent;this.dispatcher.setPushCallback("battle",this.onMessage.bind(this)),("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).startAccelerometer({success:function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).onAccelerometerChange(function(e){e.z>0&&!t.reloading&&!t.shooting?this.startReload():e.z<-.3&&t.reloading&&!t.reloadFinishing&&this.stopReload(),t.cursorMode?this.targetX=this.field.anchorOffsetX-2020*this.clamp(e.x,-.17,.17)*(e.z>0?-1:1):this.targetX=this.field.anchorOffsetX+2020*this.clamp(e.x,-.17,.17)*(e.z>0?-1:1),this.targetY=-450-1280*this.clamp(e.z,-.75,-.25)}.bind(this)),this.startTime=weedon.time,e.nextX=(640-e.moveWidth)/2+e.moveWidth*Math.random()>>0,egret.startTick(this.update,this)}.bind(this)})},e.prototype.startReload=function(){var t=this.me;t.aiming||(t.reloadFinishing=!1,t.reloading=t.reloadActing=!0,this.cross.visible=!1,this.gun.play(t.maxBullets>1?"reload"+t.bullets:"reload",1,function(){t.reloadActing=!1}.bind(this)))},e.prototype.reload=function(){var t=this.me;t.bullets==t.maxBullets||t.reloadActing||t.reloadFinishing||(t.reloadActing=!0,this.gun.play(t.maxBullets>1?"reload"+t.bullets+"_load":"reload_load",1,function(){t.reloadActing=!1}.bind(this)),this[t.bulletType+"qzd"+t.bullets].visible=!0,t.bullets+=1,this.reloadTag.visible=!1)},e.prototype.stopReload=function(){var t=this.me;t.reloadFinishing||"sniper"==t.gunName&&t.reloadActing||(t.reloadFinishing=!0,this.gun.play(t.maxBullets>1?"reload"+t.bullets+"_over":"reload_over",1,function(){this.gun.play("stand",0),t.reloading=t.reloadFinishing=t.reloadActing=!1,this.cross.visible=!0,t.touching&&t.canAim&&this.aim()}.bind(this)))},e.prototype.aim=function(){var t=this.me;if(!(t.reloading||t.reloadActing||t.reloadFinishing||!t.canAim||t.aiming||t.aimed||t.bullets<1||weedon.time-t.lastFire<t.fireInterval)){t.aiming=!0,this.cross.scaleX=this.cross.scaleY=1,this.cross.play("sniper",1,function(){t.aimed=!0,this.cross.play("sniperhold",0)}.bind(this));var e=this.cross.localToGlobal(0,0),i=this.field.globalToLocal(e.x,e.y);this.field.anchorOffsetX=i.x,this.field.anchorOffsetY=i.y,this.field.x=this.targetX=this.field.x+i.x,this.field.y=100+i.y,this.field.scaleX=this.field.scaleY=this.sky.scaleX=this.sky.scaleY=1.5}},e.prototype.fire=function(){var t=this.me,e=this.opponent;if(!(t.shooting||t.reloadFinishing||t.reloading||weedon.time-t.lastFire<t.fireInterval)){if(t.bullets>0){t.shooting=!0,t.lastFire=weedon.time,t.bullets-=1,this[t.bulletType+"qzd"+t.bullets].visible=!1,this.reloadTag.visible=!t.bullets;for(var i=[],n=function(e){var n=s.localToGlobal(s.cross.x,s.cross.y);n.x+=t.aiming?0:(1-2*Math.random())*s.cross.scaleX*t.baseHitRadius,n.y+=t.aiming?0:(1-2*Math.random())*s.cross.scaleY*t.baseHitRadius;for(var r=(s.target.globalToLocal(n.x,n.y),s.field.globalToLocal(n.x,n.y)),o=-1,a=0;8>a;++a){var h=["headhit","bodyhit","leghit0","leghit1","leghit2","leghit3","leghit4","leghit5"][a];if(s.target.hitCheck(n.x,n.y,h)){o=a;break}}i.push(o);var l;if(~o){for(var a=0;a<s.hitEffects.length;++a)if(!s.hitEffects[a].visible){l=s.hitEffects[a];break}l||(l=new Animation("se_hit"),s.field.addChild(l),l.scaleX=l.scaleY=.6,s.hitEffects.push(l)),l.visible=!0,l.x=r.x,l.y=r.y,l.play("hit",1,function(){l.visible=!1})}else{for(var a=0;a<s.nohitEffects.length;++a)if(!s.nohitEffects[a].visible){l=s.nohitEffects[a];break}l||(l=new Animation("se_nohit"),s.field.addChild(l),l.scaleX=l.scaleY=.6,s.nohitEffects.push(l)),l.visible=!0,l.x=r.x,l.y=r.y,l.play("hit",1,function(){l.visible=!1})}},s=this,r=0;r<t.hits;++r)n(r);for(var o=-1,r=0;r<i.length;++r)~i[r]&&(o=~o?Math.min(o,i[r]):i[r]);~o&&(e.waiting=!0,this.target.play(0==o?e.gunName+"_headhit":1==o?e.gunName+"_bodyhit":e.gunName+"_leghit",1,function(){e.waiting=!1,this.startTime&&this.target.play(e.waitFinish>weedon.time||e.nextX==this.enemy.x?e.gunName+"_stand_fire":e.nextX>this.enemy.x?e.gunName+"_right":e.gunName+"_left",0)}.bind(this))),this.dispatcher.request("user.battle",{action:0,hitIndexes:i,aiming:+t.aiming},function(){e.hp=this.dispatcher.get("battle","hp"+e._id),this.updateHp()}.bind(this)),this.gun.play("fire",1,function(){t.shooting=t.aiming=t.aimed=t.reloading=t.reloadActing=t.reloadFinishing=!1}.bind(this)),this.cross.scaleX=this.cross.scaleY=(t.basePrecision-t.precision)/t.basePrecision,this.cross.play("fire",1,function(){this.cross.play("stand",0)}.bind(this))}else t.aiming&&(this.cross.play("stand",0),t.aiming=t.aimed=!1);this.field.scaleX=this.field.scaleY=this.sky.scaleX=this.sky.scaleY=1,this.field.x-=this.field.anchorOffsetX,this.targetX=this.field.x,this.field.anchorOffsetX=0,this.field.anchorOffsetY=0,this.field.y=100}},e.prototype.useItem=function(){var t=this.me,e=this.opponent;t.itemUsed||(t.itemUsed=t.itemUsing=!0,this.dispatcher.request("user.battle",{action:1},function(i){if(i)return void console.info(i);switch(t.itemIndex){case 0:case 1:var n=this.localToGlobal(this.item.x,this.item.y),s=this.field.globalToLocal(n.x,n.y),r=new Animation("item"+t.itemIndex);this.field.addChild(r),r.x=s.x,r.y=s.y,r.play("fly"+t.itemGrade,0),r.bezierTo(r.x+(this.enemy.x-r.x)/2,this.enemy.y-300,this.enemy.x,this.enemy.y,800,function(){if(r.scaleX=r.scaleY=1,r.play("boom"+t.itemGrade,1,function(){t.itemUsing=!1,r.parent.removeChild(r)}.bind(this)),-1!=t.itemIndex){this.target.play(e.gunName+"_leghit",1),e.hp=this.dispatcher.get("battle","hp"+e._id),this.updateHp();var i=this.dispatcher.get("battle","propUsed"+t._id);i&&this.item&&this.item.parent.removeChild(this.item)}}.bind(this)),egret.Tween.get(r).to({scaleX:.1,scaleY:.1},800);break;case 2:this.item&&this.item.play("use"+t.itemGrade,1,function(){t.itemUsing=this.item.visible=!1}.bind(this)),this.me.hp=this.dispatcher.get("battle","hp"+t._id),this.updateHp()}}.bind(this)))},e.prototype.onMessage=function(){var t=this.dispatcher.get("battle");console.log(this.dispatcher.get("battle"));var e=this.me,i=this.opponent;switch(e.hp=t["hp"+e._id],i.hp=t["hp"+i._id],t.action){case 0:this.hit(t.hitIndex);break;case 1:this.itemHit(t.itemIndex,t.itemGrade)}},e.prototype.hit=function(t){var e=this.me;if(this.enemyFire.visible=!0,this.enemyFire.play("hit",1,function(){this.enemyFire.visible=!1}.bind(this)),~t){this.item&&this.item.visible&&!e.itemUsing&&this.item.play("hurt"+e.itemGrade,1,function(){this.item&&this.item.play("stand"+e.itemGrade)}.bind(this)),e.shooting||e.reloading||e.reloadActing||e.reloadFinishing||this.gun.play("hurt",1,function(){this.gun.play("stand",0)}.bind(this));for(var i,n=0;n<this.behitEffects.length;++n)if(!this.behitEffects[n].visible){i=this.behitEffects[n];break}if(i||(i=new Animation("beenhit"),this.addChild(i),this.behitEffects.push(i)),i.visible=!0,i.x=40+600*Math.random(),i.y=this.cross.y-200+400*Math.random(),i.play("hit",1,function(){i.visible=!1}),this.updateHp(),e.shooting)return;0==e.gunType?this.cross.play(["headhit","bodyhit","bodyhit"][t],1,function(){this.cross.play("stand",0)}.bind(this)):e.canAim&&e.aiming?this.cross.play("sniper"+["headhit","bodyhit","bodyhit"][t],1,function(){this.cross.play("sniperhold",0)}.bind(this)):this.cross.play(["headhit","bodyhit","bodyhit"][t],1,function(){this.cross.play("stand",0)}.bind(this))}},e.prototype.itemHit=function(t,e){var i=this.me;switch(console.log("受到道具效果"),this.me.hp=this.dispatcher.get("battle","hp"+i._id),console.log(i.hp),this.updateHp(),t){case 0:var n=new Animation("itemhit"+t);this.addChild(n),n.x=320,n.y=1386,n.play("boom"+e,1,function(){n.visible=!1}.bind(this)),i.shooting||(i.canAim&&i.aiming?this.cross.play("sniperbodyhit",1,function(){this.cross.play("sniperhold",0)}.bind(this)):this.cross.play("bodyhit",1,function(){this.cross.play("stand",0)}.bind(this))),this.item&&this.item.visible&&!i.itemUsing&&this.item.play("hurt"+e,1,function(){this.item&&this.item.play("stand"+e,0)}.bind(this)),i.shooting||i.reloading||i.reloadActing||i.reloadFinishing||this.gun.play("hurt",1,function(){this.gun.play("stand",0)}.bind(this));break;case 1:i.state=e,i.stateFinish=weedon.time+6e3;break;case 2:}},e.prototype.updateHp=function(){var t=this.me,e=this.opponent;this.hpTag.text=Math.max(t.hp,0)+"/"+t.maxHp,this.hpBar.mask=new egret.Rectangle(0,0,550*Math.max(t.hp,0)/t.maxHp,25),this.enemyHpBar.mask=new egret.Rectangle(0,0,170*Math.max(0,e.hp)/e.maxHp,12),(t.hp<=0||e.hp<=0)&&(this.duelFinish(),this.target.play(t.hp<=0?"lol":e.gunName+"_die",t.hp<=0?0:1))},e.prototype.update=function(){var t=this.me,e=this.opponent,i=weedon.time,n=i-this.startTime;if(this.startTime=i,this.field.x+=t.cursorSpeed*n*(this.targetX-this.field.x),this.scene.y+=t.cursorSpeed*n*(this.targetY-this.scene.y),t.fireInterval&&1==t.crosshairIndex)for(var s=i-t.lastFire,r=0;12>r;++r)this.cross.setSlot(""+r,s/t.fireInterval*12>r+1?this.cdBlanks[r]:this.cdItems[r]);return t.stateFinish>i?this.flour.visible||(this.flour.visible=!0,this.flour.play("boom"+t.state,1,function(){this.flour.play("stand"+t.state,0)}.bind(this))):this.flour.visible&&!t.stateFinishing&&(t.stateFinishing=!0,this.flour.play("over"+t.state,1,function(){this.flour.visible=t.stateFinishing=!1}.bind(this))),e.waiting||i<e.waitFinish||!this.startTime?!0:(e.nextX>this.enemy.x?(e.moving||(e.moving=!0,this.target.play(e.gunName+"_right",0)),this.enemy.x+=Math.min(e.moveSpeed*n,e.nextX-this.enemy.x)):(e.moving||(e.moving=!0,this.target.play(e.gunName+"_left",0)),this.enemy.x-=Math.min(e.moveSpeed*n,this.enemy.x-e.nextX)),this.enemy.x==e.nextX&&(e.moving=!1,this.target.play(e.gunName+"_stand_fire",0),e.waitFinish=i+e.restTimeBase+(Math.random()*e.restTimeRand>>0),e.nextX=(640-e.moveWidth)/2+e.moveWidth*Math.random()>>0),!0)},e}(eui.Component);__reflect(Duel.prototype,"Duel");var BattleEndDialog=function(t){function e(e,i,n){var s=t.call(this)||this;return s.mScreenHeight=e,s.skinName=BattleEndDialogSkin,s.dispatcher=i,s.closeCallBack=n,s}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this);var i=this.dispatcher.get("user");console.log("---BattleEndDialog--"),console.log(this.dispatcher.get("itemsGot"));var n=this.dispatcher.get("itemsGot");setTexture(this.leftBtn.tfImg,"wz_fhcz_png"),new Btn(this.leftBtn,function(){e.parent.removeChild(e)}.bind(this)),setTexture(this.rightBtn.tfImg,"wz_fxzj_png"),new Btn(this.rightBtn,function(){}.bind(this)),this.rewardTF.textFlow=[{text:"经验：",style:{size:24,textColor:7093780}},{text:(n.exper||0)+"     ",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}},{text:"精通：",style:{size:24,textColor:7093780}},{text:(n.gunExper||0)+"     ",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}},{text:"金币：",style:{size:24,textColor:7093780}},{text:(n.gold||"")+"     ",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}}],setTexture(this.img_result,"zd_tz_"+(n.exper?"ying":"shu")+"_png");
var s=this.dispatcher.get("battle"),r=s.uids.split("-"),o=s["battleParams"+i._id].split("-"),a=s["battleParams"+(r[0]==i._id?r[1]:r[0])].split("-"),h=formula.getRankInfo(i.rankLv),l=s["nickname"+(r[0]==i._id?r[1]:r[0])];this.desTF1.textFlow=[{text:h.name+"\n",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}},{text:"射击：  ",style:{size:24,textColor:7093780}},{text:o[0]+"\n",style:{size:24,textColor:12154151}},{text:"命中：  ",style:{size:24,textColor:7093780}},{text:o[1]+"\n",style:{size:24,textColor:12154151}},{text:"爆头：  ",style:{size:24,textColor:7093780}},{text:o[2],style:{size:24,textColor:12154151}}];formula.getRankInfo(i.rankLv);this.desTF2.textFlow=[{text:l+"\n",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}},{text:"射击：  ",style:{size:24,textColor:7093780}},{text:a[0]+"\n",style:{size:24,textColor:12154151}},{text:"命中：  ",style:{size:24,textColor:7093780}},{text:a[1]+"\n",style:{size:24,textColor:12154151}},{text:"爆头：  ",style:{size:24,textColor:7093780}},{text:a[2],style:{size:24,textColor:12154151}}];var c=formula.getULevel(n.experOld),d=formula.getULevel(n.experNew);this.lvTF.text="lv."+d,d>c&&setInterval(function(){this.parent.removeChild(this),this.closeCallBack()}.bind(this),3e3)},e}(eui.Component);__reflect(BattleEndDialog.prototype,"BattleEndDialog");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var ChargeDialog=function(t){function e(e){var i=t.call(this)||this;return i.mScreenHeight=e,i.skinName=ChargeDialogSkin,i}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),setTexture(this.backBtn.tfImg,"wz_fh_png"),new Btn(this.backBtn,function(){e.parent.removeChild(e)}.bind(this)),this.refreshList(),this.adjustUI()},e.prototype.refreshList=function(){this.list.removeChildren();for(var t=0;6>t;t++){var e=new eui.Component;e.skinName=ChargeItemRenderSkin,e.desTF.text="钻石 X"+100*(t+1),setTexture(e.costImg,"cz_je_"+t+"_png"),this.list.addChild(e),e.y=150*t}},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e}(eui.Component);__reflect(ChargeDialog.prototype,"ChargeDialog");var LvupDialog=function(t){function e(e,i){var n=t.call(this)||this;return n.mScreenHeight=e,n.skinName=LvupDialogSkin,n.dispatcher=i,n.data_json=RES.getRes("data_json"),n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),setTexture(this.okBtn.tfImg,"js_qd_png"),new Btn(this.okBtn,function(){e.parent.removeChild(e)}.bind(this)),this.adjustUI();var i=(this.dispatcher.get("user"),this.dispatcher.get("itemsGot"));this.hpTF.visible=null!=i.hpLimitBonus,this.hpTF.visible&&(this.hpTF.text="HP上限增加："+i.hpLimitBonus),this.hpTF0.visible=null!=i.strengeBonus,this.hpTF0.visible&&(this.hpTF0.text="体力上限增加："+i.strengeBonus),this.hpTF1.visible=null!=i.strengeLimitBonus,this.hpTF1.visible&&(this.hpTF1.text="体力增加："+i.strengeLimitBonus);var n=[],s=i.gunUnLocked;if(s)for(var r=0;r<s.length;r++)n.push({index:0,num:s[r]});var o=i.propUnLocked;if(o)for(var r=0;r<o.length;r++)n.push({index:1,num:o[r]});this.groupLocked.removeChildren();for(var r=0;r<n.length;r++){var a=(n[r],n.num),h=n.index,l=new UnLockItem,c=a.split("-");0==h?(setTexture(l.img_prop,"weapon_s_"+ +c[0]+"_"+ +c[1]+"_png"),l.label_prop.text=this.data_json.gunsBaseNumber[a][0]):1==h&&(setTexture(l.img_prop,"prop_s_"+ +c[0]+"_"+ +c[1]+"_png"),l.label_prop.text=this.data_json.propsBaseNumber[a][0]),this.groupLocked.addChild(l),l.y=0,l.x=20+r%2*l.width+10}},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight},e}(eui.Component);__reflect(LvupDialog.prototype,"LvupDialog");var UnLockItem=function(t){function e(){var e=t.call(this)||this;return e.skinName=propUnLockItem,e}return __extends(e,t),e}(eui.Component);__reflect(UnLockItem.prototype,"UnLockItem");var MainScene=function(t){function e(e){var i=t.call(this)||this;return i.ignoreNextResize=!1,i.standArray=["handgun_stand","rifle_stand","shutgun_stand","sniper_stand"],i.mLastGetTiTime=weedon.time+36e5,i.mIsShowPropBool=!1,i.mIsShowWeaponBool=!1,i.dispatcher=e,i.skinName=MainSceneSkin,i.dispatcher.setOverrideKey("itemsGot"),i}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.mDataJson=RES.getRes("data_json"),this.mGameConfigJson=RES.getRes("game_config_json"),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.resetPropOrWeaponScroll,this),this.clickImg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.resetPropOrWeaponScroll();var t=new SettingDialog(e.screenHeight,e.dispatcher);e.dialogGrp.addChild(t)},this),new Btn(this.chargeBtn,function(){e.resetPropOrWeaponScroll();var t=new ChargeDialog(e.screenHeight);e.dialogGrp.addChild(t)}),new Btn(this.buyTiBtn,function(){e.resetPropOrWeaponScroll();var t=new BuyTiDialog(e.screenHeight,e.dispatcher);e.dialogGrp.addChild(t)}),setTexture(this.leftBtn.tfImg,"wz_pwz_png"),new Btn(this.leftBtn,function(){e.resetPropOrWeaponScroll();var t=new QualifyingScene(e.screenHeight,e.dispatcher,function(t){if(1==t){var e=new Duel(this.dispatcher,function(t){return-1==t?void this.dispatcher.request("user.leave",{},function(){}.bind(this)):void this.showBattleRet()}.bind(this));this.duelGrp.addChild(e)}}.bind(e));e.dialogGrp.addChild(t)}),setTexture(this.rightBtn.tfImg,"wz_hypp_png"),new Btn(this.rightBtn,function(){e.resetPropOrWeaponScroll();var t=new MatchingScene(e.screenHeight,e.dispatcher);e.dialogGrp.addChild(t)});var i=(this.standArray,this.dispatcher.get("user","gender")),n=this.dispatcher.get("user","cap")-1e4;i=-1==i?1:i;var s=this.target=new Animation("chr"+i);s.setSlot("hat",createBitmap("zs_maozi_b0"+n+"_png",.5,.5,0,0,.8,.8)),this.personGrp.addChild(s),s.x=330,s.y=190,s.scaleX=s.scaleY=.8,setTexture(this.propBtn.tfImg,"wz_dj_png"),new Btn(this.propBtn,function(){e.mIsShowWeaponBool&&(e.weaponScroll.visible=e.mIsShowWeaponBool=!1),e.mIsShowPropBool=!e.mIsShowPropBool,e.propScroll.visible=e.mIsShowPropBool,e.mIsShowPropBool&&e.showPropScroll()}),setTexture(this.weaponBtn.tfImg,"wz_wq_png"),new Btn(this.weaponBtn,function(){e.mIsShowPropBool&&(e.propScroll.visible=e.mIsShowPropBool=!1),e.mIsShowWeaponBool=!e.mIsShowWeaponBool,e.weaponScroll.visible=e.mIsShowWeaponBool,e.mIsShowWeaponBool&&e.showWeaponScroll()}),setTexture(this.tabBtn1.tfImg,"wz_ck_png"),new Btn(this.tabBtn1,function(){e.resetPropOrWeaponScroll(),e.currentPage=new HouseScene(e.dispatcher,function(){this.currentPage.parent.removeChild(this.currentPage),this.refreshData()}.bind(e),e.screenHeight),e.stage.addChild(e.currentPage)}),setTexture(this.tabBtn2.tfImg,"wz_phb_png"),new Btn(this.tabBtn2,function(){e.resetPropOrWeaponScroll();var t=new RankDialog(e.screenHeight,e.dispatcher);e.dialogGrp.addChild(t)}),setAvatar(this.headImg,this.dispatcher.get("user","avatar")||0,this.dispatcher.get("user","avatarUrl")||""),this.nameTF.text=this.dispatcher.get("user","nickname"),this.mLastGetTiTime=0==this.dispatcher.get("user","lastGetStrenge")?weedon.time:this.dispatcher.get("user","lastGetStrenge"),this.checkTiLi(),this.refreshData(),this.startAccelerometer(),this.stage.addEventListener(egret.Event.RESIZE,this.adjustUI,this),this.adjustUI(),egret.startTick(this.update,this)},e.prototype.adjustUI=function(){return this.ignoreNextResize?void(this.ignoreNextResize=!1):(this.ignoreNextResize=!0,weedon.winSize.width/weedon.winSize.height>.64?(this.stage.setContentSize(640,1e3),this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL,this.screenHeight=1e3,this.y=-193,this.topUI.y=-this.y,this.bottomUI.y=this.screenHeight+193-100):(this.stage.setContentSize(640,1386),this.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,this.screenHeight=640/weedon.winSize.width*weedon.winSize.height,this.y=-(1386-this.screenHeight)/2,this.topUI.y=-this.y,this.bottomUI.y=this.screenHeight-this.y-100),this.bgImg.height=this.bg.height=this.screenHeight,void(this.duelGrp.y=-this.y))},e.prototype.update=function(){this.checkTiLi()},e.prototype.refreshData=function(){this.lvTF.text="Lv."+formula.getULevel(this.dispatcher.get("user","experience")||0),this.coinTF.text=(this.dispatcher.get("user","goldAll")||0)-(this.dispatcher.get("user","goldCost")||0),this.diamondTF.text=(this.dispatcher.get("user","diamondAll")||0)-(this.dispatcher.get("user","diamondCost")||0);var t=this.dispatcher.get("user","strenge")||0,e=this.dispatcher.get("user","strengeLimit")||this.mGameConfigJson.userConfig.strengeMax;this.prgMc.value=t/e*100,this.prgTF.text=t+"/"+e;var i=formula.getRankInfo(this.dispatcher.get("user","rankLv"));setTexture(this.dwImg,"sy_duanwei_0"+i.index+"_png",null,null,.3,.3),this.showWuPinInfo()},e.prototype.checkTiLi=function(){var t=this;weedon.time-this.dispatcher.get("user","lastGetStrenge")>=1e3*this.mGameConfigJson.userConfig.strengeInteval&&this.dispatcher.request("propHs.getStrenge",{},function(e){return e?void console.log(e):(t.mLastGetTiTime=weedon.time,void t.refreshData())}.bind(this)),this.prgCd.text=DateUtils.getDateInfoByType((this.mLastGetTiTime+1e3*this.mGameConfigJson.userConfig.strengeInteval-weedon.time)/1e3/60,1)},e.prototype.showWuPinInfo=function(t){void 0===t&&(t="all"),("prop"==t||"all"==t)&&(this.mCurrentPropIndex=this.dispatcher.get("user","propIndex"),""!=this.dispatcher.get("user","propIndex")?(setTexture(this.propBtn.iconImg,"prop_s_"+this.mCurrentPropIndex.replace("-","_")+"_png"),this.propBtn.noneTF.visible=!1):(this.propBtn.iconImg.texture="",this.propBtn.noneTF.visible=!0)),("weapon"==t||"all"==t)&&(this.mCurrentWeaponIndex=this.dispatcher.get("user","gunIndex"),this.target.play(this.standArray[this.mCurrentWeaponIndex.substr(0,1)],0),""!=this.dispatcher.get("user","gunIndex")?(setTexture(this.weaponBtn.iconImg,"weapon_s_"+this.mCurrentWeaponIndex.replace("-","_")+"_png"),this.weaponBtn.noneTF.visible=!1):(this.weaponBtn.iconImg.texture="",this.weaponBtn.noneTF.visible=!0))},e.prototype.showPropScroll=function(){var t=this,e=this.dispatcher.get("user","propHs"),i=0,n=106;this.propList.removeChildren();for(var s=0;s<=e.length;s++)if(0==s){var r=new eui.Component;r.skinName=MainPropListRenderSkin,r.dqImg.visible=!1,setTexture(r.bgImg,"ck_wupin_kong_png"),r.nameTF.text=r.numTF.text="",this.propList.addChild(r),r.x=i%3*n,r.y=Math.floor(i/3)*n,r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return""==t.mCurrentPropIndex?void(t.propScroll.visible=t.mIsShowPropBool=!1):void t.dispatcher.request("propHs.changeProps",{mode:1},function(e){return e?void console.log(e):(t.showWuPinInfo("prop"),void(t.propScroll.visible=t.mIsShowPropBool=!1))}.bind(t))},this),i++}else for(var o=e[s-1],a=function(e){if(o[e]>0){var r=s-1+"-"+e,a=new eui.Component;a.skinName=MainPropListRenderSkin,setTexture(a.bgImg,h.mCurrentPropIndex==r?"ck_wupin_dangqian_png":"ck_wupin_putong_png"),setTexture(a.iconImg,"prop_s_"+(s-1)+"_"+e+"_png"),a.dqImg.visible=h.mCurrentPropIndex==r,h.propList.addChild(a),a.x=i%3*n,a.y=Math.floor(i/3)*n,a.nameTF.text=h.mDataJson.propsBaseNumber[r][0],a.numTF.text=o[e],a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return t.mCurrentPropIndex==r?void(t.propScroll.visible=t.mIsShowPropBool=!1):void t.dispatcher.request("propHs.changeProps",{mode:0,propIndex:r},function(e){return e?void console.log(e):(t.showWuPinInfo("prop"),void(t.propScroll.visible=t.mIsShowPropBool=!1))}.bind(t))},h),i++}},h=this,l=0;l<o.length;l++)a(l);this.propScroll.width=3>=i?i*n:3*n,this.propScroll.height=i>9?3.5*n:9>=i?n*Math.ceil((i-.5)/3):3*n,this.propScroll.horizontalCenter=-145,this.propScroll.bottom=6},e.prototype.showWeaponScroll=function(){var t=this,e=this.dispatcher.get("user","gunHs")||[],i=0,n=106;this.weaponList.removeChildren();for(var s=0;s<e.length;s++)for(var r=e[s],o=function(e){if(r[e]>=0){var o=s+"-"+e,h=new eui.Component;h.skinName=MainPropListRenderSkin,setTexture(h.bgImg,a.mCurrentWeaponIndex==o?"ck_wupin_dangqian_png":"ck_wupin_putong_png"),setTexture(h.iconImg,"weapon_s_"+s+"_"+e+"_png"),h.dqImg.visible=a.mCurrentWeaponIndex==o,a.weaponList.addChild(h),h.x=i%3*n,h.y=Math.floor(i/3)*n,h.nameTF.text=a.mDataJson.gunsBaseNumber[o][0],h.numTF.text="",h.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return t.mCurrentWeaponIndex==o?void(t.weaponScroll.visible=t.mIsShowWeaponBool=!1):void t.dispatcher.request("propHs.changeGun",{gunIndex:o},function(e){return e?void console.log(e):(t.showWuPinInfo("weapon"),void(t.weaponScroll.visible=t.mIsShowWeaponBool=!1))}.bind(t))},a),i++}},a=this,h=0;h<r.length;h++)o(h);this.weaponScroll.width=3>=i?i*n:3*n,this.weaponScroll.height=i>9?3.5*n:9>=i?n*Math.ceil((i-.5)/3):3*n,this.weaponScroll.horizontalCenter=144,this.weaponScroll.bottom=6},e.prototype.startAccelerometer=function(){var t=this;("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).startAccelerometer({success:function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).onAccelerometerChange(function(e){var i="undefined"==typeof GameGlobal?e.x:e.y;t.grassImg.x=26+10*i,t.carImg.x=-10+100*i,t.grassImg0.x=493+100*i}.bind(t))}.bind(this)})},e.prototype.showBattleRet=function(){var t=new BattleEndDialog(this.screenHeight,this.dispatcher,function(){var t=new LvupDialog(this.screenHeight,this.dispatcher);this.dialogGrp.addChild(t)}.bind(this));this.dialogGrp.addChild(t),this.startAccelerometer(),this.refreshData()},e.prototype.resetPropOrWeaponScroll=function(){this.propScroll.visible=this.mIsShowPropBool=this.weaponScroll.visible=this.mIsShowWeaponBool=!1},e}(eui.Component);__reflect(MainScene.prototype,"MainScene");var DateUtils=function(){function t(){}return t.getDateInfoByType=function(t,e){var i=this.formatReaminTime(t);return 1==e?this.formatNumber(i.min)+":"+this.formatNumber(i.second):void 0},t.formatReaminTime=function(t){t=Math.max(0,t);var e=Math.floor(t/1440);t-=1440*e;var i=Math.floor(t/60);t-=60*i;var n=Math.floor(t);t-=n;var s=Math.floor(60*t);return{day:e,hour:i,min:n,second:s}},t.formatNumber=function(t){return 10>t?"0"+t:t},t}();__reflect(DateUtils.prototype,"DateUtils");var ActionUtils=function(){function t(){}return t.runTFAction=function(t,e){t.text="";var i=0,n=e.length;egret.Tween.get(this,{loop:!0}).to({},200).call(function(){t.textFlow=[{text:e.substring(0,i),style:{size:30}},{text:e.substring(i,i+1),style:{size:40}},{text:e.substring(i+1),style:{size:30}}],i=i>=n-3?0:i+2})},t.runBtnAction=function(t){egret.Tween.get(t).to({scaleX:.7,scaleY:.7},100).to({scaleX:1,scaleY:1},100)},t}();__reflect(ActionUtils.prototype,"ActionUtils");var MatchUtils=function(){function t(){}return t.getRegularSixSidedPolygonObject=function(t,e,i,n){return void 0===n&&(n=[null,0,0,0,0,0,0]),{O:new egret.Point(t,e),A:new egret.Point(t,e-i),AA:new egret.Point(t,e-i*n[1]),B:new egret.Point(t+i*Math.sin(Math.PI/3),e-i/2),BB:new egret.Point(t+i*Math.sin(Math.PI/3)*n[2],e-i/2*n[2]),C:new egret.Point(t+i*Math.sin(Math.PI/3),e+i/2),CC:new egret.Point(t+i*Math.sin(Math.PI/3)*n[3],e+i/2*n[3]),D:new egret.Point(t,e+i),DD:new egret.Point(t,e+i*n[4]),E:new egret.Point(t-i*Math.sin(Math.PI/3),e+i/2),EE:new egret.Point(t-i*Math.sin(Math.PI/3)*n[5],e+i/2*n[5]),F:new egret.Point(t-i*Math.sin(Math.PI/3),e-i/2),FF:new egret.Point(t-i*Math.sin(Math.PI/3)*n[6],e-i/2*n[6])}},t}();__reflect(MatchUtils.prototype,"MatchUtils");var MatchingScene=function(t){function e(e,i,n){void 0===n&&(n=1);var s=t.call(this)||this;return s.mScreenHeight=e,s.dispatcher=i,s.mMode=n,s.skinName=MatchingSceneSkin,s}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),setTexture(this.backBtn.tfImg,"wz_fh_png"),new Btn(this.backBtn,function(){e.parent.removeChild(e)}.bind(this)),1==this.mMode?(this.mType=1,this.leftBtn.visible=this.rightBtn.visible=!0,this.middleBtn.visible=!1,setTexture(this.leftBtn.tfImg,"zd_fqtz_png"),setTexture(this.rightBtn.tfImg,"zd_yqhy_png")):2==this.mMode&&(this.leftBtn.visible=this.rightBtn.visible=!1,this.middleBtn.visible=!0,setTexture(this.middleBtn.tfImg,"zd_fqtz_png")),new Btn(this.leftBtn,function(){e.parent.removeChild(e),console.log("即将放弃挑战")}.bind(this)),new Btn(this.rightBtn,function(){1==e.mType?(e.mType=2,setTexture(e.rightBtn.tfImg,"zd_ksdj_png"),console.log("即将邀请好友")):2==e.mType&&(console.log("即将开始比赛"),navigator.vibrate&&navigator.vibrate([500]))}.bind(this)),new Btn(this.middleBtn,function(){e.parent.removeChild(e),console.log("即将放弃挑战")}.bind(this)),this.leftMc.nameTF.text=this.dispatcher.get("user","nickname"),this.leftMc.lvTF.text="Lv."+formula.getULevel(this.dispatcher.get("user","experience")||0),this.leftMc.x=-500,this.rightMc.x=752,this.vs.visible=!1,egret.Tween.get(this.leftMc).to({x:0},500),egret.Tween.get(this.rightMc).wait(500).to({x:252},500).wait(500).call(function(){e.vs.visible=!0},this),this.adjustUI()},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e}(eui.Component);__reflect(MatchingScene.prototype,"MatchingScene");var QualifyingScene=function(t){function e(e,i,n){var s=t.call(this)||this;return s.battleStart=0,s.matching=!1,s.mScreenHeight=e,s.skinName=QualifyingSceneSkin,s.dispatcher=i,s.callback=n,s}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),setTexture(this.backBtn.tfImg,"wz_fh_png"),new Btn(this.backBtn,function(){e.parent.removeChild(e),e.callback(-1)}.bind(this));var i=new Animation("se_tip");this.grp1.addChild(i),i.play("play",0),i.x=230,i.y=320,this.desTF1.textFlow=[{text:"如何排位？\n",style:{size:30,textColor:7093780}},{text:"将手机",style:{size:24,textColor:12154151}},{text:"[向下防置]",style:{size:30,textColor:7093780}},{text:"开始匹配对手。\n",style:{size:24,textColor:12154151}},{text:"提示音",style:{size:24,textColor:12154151}},{text:"[响起和震动]",style:{size:30,textColor:7093780}},{text:"匹配完成，开始战斗！",style:{size:24,textColor:12154151}}],this.tweenImg.rotation=0,egret.Tween.get(this.tweenImg,{loop:!0}).to({rotation:360},2500).call(function(){e.tweenImg.rotation=0}),this.adjustUI(),ActionUtils.runTFAction(this.desTF2,"正 在 寻 找 对 手 . . "),this.grp1.visible=!0,this.grp2.visible=!1,this.dispatcher.setPushCallback("join",this.joinOk.bind(this)),("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).startAccelerometer({success:function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).onAccelerometerChange(function(t){var e="undefined"==typeof GameGlobal?t.z:t.y;!this.motionStart&&e>=.5&&(this.motionStart=weedon.time,this.grp1.visible=!1,this.grp2.visible=!0),this.motionStart&&.5>e&&(this.motionStart=0,this.matching?this.dispatcher.request("user.leave",{},function(){this.matching=!1,this.grp2.visible=!1,this.grp1.visible=!0}.bind(this)):(this.grp2.visible=!1,this.grp1.visible=!0))}.bind(this)),egret.startTick(this.update,this)}.bind(this)})},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e.prototype.update=function(){return this.battleStart||this.motionStart?(!this.matching&&weedon.time-this.motionStart>3e3&&(this.matching=!0,this.dispatcher.request("user.join",{},function(){this.dispatcher.get("battle","ready")&&this.joinOk()}.bind(this))),this.battleStart&&weedon.time>=this.battleStart&&(egret.stopTick(this.update,this),this.parent.removeChild(this),this.callback(1)),!0):void 0},e.prototype.joinOk=function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).stopAccelerometer(),this.battleStart=this.dispatcher.get("battle","startTime")},e}(eui.Component);__reflect(QualifyingScene.prototype,"QualifyingScene");var RankDialog=function(t){function e(e,i){var n=t.call(this)||this;return n.mCurrentTab=1,n.mScreenHeight=e,n.dispatcher=i,n.skinName=RankDialogSkin,n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),setTexture(this.backBtn.tfImg,"wz_fh_png"),new Btn(this.backBtn,function(){e.parent.removeChild(e)}.bind(this)),new Btn(this.tabBtn1,function(){1!=e.mCurrentTab&&(e.mCurrentTab=1,e.refreshList())}.bind(this)),new Btn(this.tabBtn2,function(){2!=e.mCurrentTab&&(e.mCurrentTab=2,e.refreshList())}.bind(this)),this.tabBtn1.tabTF.text="好 友 排 名",this.tabBtn2.tabTF.text="世 界 排 名",this.refreshList(),this.adjustUI()},e.prototype.refreshList=function(){var t=this;this.tabBtn1.tabTF.textColor=1==this.mCurrentTab?7093780:12154151,this.tabBtn2.tabTF.textColor=2==this.mCurrentTab?7093780:12154151,this.dispatcher.request("user.getRankList",{},function(e){if(e)return void console.log(e);var i=t.dispatcher.get("result");console.log(i);var n=t.dispatcher.get("rankMe");t.updateList(i.sort(function(t,e){return t.rank-e.rank})),t.desTF.text=null!=n?"当前我的世界排名"+(999==n?999:n+1):"未上榜"}.bind(this))},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e.prototype.updateList=function(t){this.scroll.stopAnimation(),this.list.removeChildren();for(var e=0;e<t.length;e++){var i=new eui.Component;i.skinName=RankItemRenderSkin,i.rankTF.text=t[e].rank+1;var n=formula.getRankInfo(t[e].user.rankLv);i.dwTF.text=n.name,i.starTF.text=n.starNum,setTexture(i.dwImg,"sy_duanwei_0"+n.index+"_png"),i.nameTF.text=t[e].user.nickname,i.lvTF.text="Lv."+formula.getULevel(t[e].user.experience),setAvatar(i.headImg,t[e].user.avater),this.list.addChild(i),i.y=120*e}this.scroll.viewport.scrollV=0,this.scroll.viewport.validateNow()},e}(eui.Component);__reflect(RankDialog.prototype,"RankDialog");var SelectDialog=function(t){function e(e,i){var n=t.call(this)||this;return n.mCurrentGenderIndex=0,n.mCurrentCapIndex=0,n.gender_scale=.5,n.dispatcher=e,n.mCb=i,n.skinName=SelectDialogSkin,n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),setTexture(this.okBtn.tfImg,"js_qd_png"),new Btn(this.okBtn,function(){e.dispatcher.request("user.init",{gender:e.mCurrentGenderIndex,cap:e.mCurrentCapIndex},function(t){return t?void console.log(t):void(e.mCb&&e.mCb())}.bind(e))}.bind(this));var i=this.gender_1=new Animation("chr0");this.addChild(i),i.play("handgun_stand",0),i.x=this.gender1Img.x,i.y=this.gender1Img.y-30,i.scaleX=i.scaleY=this.gender_scale,i.touchEnabled=!0,i.touchChildren=!0;var n=this.gender_2=new Animation("chr1");this.addChild(n),n.play("handgun_stand",0),n.x=this.gender2Img.x,n.y=this.gender2Img.y-30,n.scaleX=n.scaleY=this.gender_scale,n.touchEnabled=!0,n.touchChildren=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0!=e.mCurrentGenderIndex&&(e.mCurrentGenderIndex=0,e.refreshCapMc())},this),n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1!=e.mCurrentGenderIndex&&(e.mCurrentGenderIndex=1,e.refreshCapMc())},this),this.refreshCapMc(),this.cap1Mc.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0!=e.mCurrentCapIndex&&(e.mCurrentCapIndex=0,e.refreshCapMc())},this),this.cap2Mc.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1!=e.mCurrentCapIndex&&(e.mCurrentCapIndex=1,e.refreshCapMc())},this),this.adjustUI()},e.prototype.adjustUI=function(){if(weedon.winSize.width/weedon.winSize.height>.64)this.stage.setContentSize(640,1e3),this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL,this.y=-193,this.screenHeight=1e3;else{this.stage.setContentSize(640,1386),this.stage.scaleMode=egret.StageScaleMode.NO_BORDER,this.scaleX=this.scaleY=Math.min(.64/(weedon.winSize.width/weedon.winSize.height),1),this.x=640*(1-this.scaleX)/2,this.y=1e3*(1-this.scaleY)/2;var t=this.x?{width:640,height:1e3}:weedon.winSize;this.screenHeight=640*t.height/t.width}this.bg.height=this.screenHeight},e.prototype.refreshCapMc=function(){this.gender1Img.visible=0==this.mCurrentGenderIndex,this.gender2Img.visible=1==this.mCurrentGenderIndex,this.cap1Mc.dqImg.visible=0==this.mCurrentCapIndex,setTexture(this.cap1Mc.bgImg,0==this.mCurrentCapIndex?"ck_wupin_dangqian_png":"ck_wupin_putong_png"),setTexture(this.cap1Mc.iconImg,"zs_maozi_s00_png"),this.cap1Mc.nameTF.text="黑帽子",this.cap1Mc.numTF.text="",this.cap2Mc.dqImg.visible=1==this.mCurrentCapIndex,setTexture(this.cap2Mc.bgImg,1==this.mCurrentCapIndex?"ck_wupin_dangqian_png":"ck_wupin_putong_png"),setTexture(this.cap2Mc.iconImg,"zs_maozi_s01_png"),this.cap2Mc.nameTF.text="白帽子",this.cap2Mc.numTF.text="",this.hatImg_1=createBitmap("zs_maozi_b0"+this.mCurrentCapIndex+"_png",.5,.5,0,0,this.gender_scale,this.gender_scale),this.gender_1.setSlot("hat",this.hatImg_1),this.hatImg_2=createBitmap("zs_maozi_b0"+this.mCurrentCapIndex+"_png",.5,.5,0,0,this.gender_scale,this.gender_scale),this.gender_2.setSlot("hat",this.hatImg_2)},e}(eui.Component);__reflect(SelectDialog.prototype,"SelectDialog");var SettingDialog=function(t){function e(e,i){var n=t.call(this)||this;return n.dispatcher=i,n.skinName=SettingDialogSkin,n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.mDataJson=RES.getRes("data_json"),this.bg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.parent.removeChild(e)},this),this.nameTF.text=this.dispatcher.get("user","nickname")+"\n游戏ID:"+this.dispatcher.get("user","_id"),this.lvTF.text="Lv."+formula.getULevel(this.dispatcher.get("user","experience")||0),this.versionTF.text="版本号：1.0.0",setAvatar(this.headImg,this.dispatcher.get("user","avatar")||0,this.dispatcher.get("user","avatarUrl")||"");var i=formula.getRankInfo(this.dispatcher.get("user","rankLv"));this.pwTF.text=i.name,this.starTF.text=i.starNum,setTexture(this.dwImg,"sy_duanwei_0"+i.index+"_png",null,null,.3,.3),console.log(this.dispatcher.get("user","qualifyDt")),this.shareBtn1.nameTF.text="复 制",this.shareBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ActionUtils.runBtnAction(this.shareBtn1);var t=document.createElement("input");t.setAttribute("readonly",""),t.value=this.dispatcher.get("user","_id").toString(),t.style.opacity="0",t.style.position="absolute",t.style.left="-9999px",t.style.top="-9999px",document.body.appendChild(t),t.focus(),t.select(),t.setSelectionRange(0,t.value.length),t.oncopy=function(t){console.log("您的游戏ID已成功复制到剪贴板")}.bind(this),document.execCommand("Copy"),document.body.removeChild(t)},this),setTexture(this.shareBtn2.tfImg,"wz_fxzj_png"),new Btn(this.shareBtn2,function(){console.log("分享2")}),this.yyMc.nameTF.text="音乐",new Btn(this.yyMc,function(){e.yyMc.okImg.visible=!e.yyMc.okImg.visible}),this.yxMc.nameTF.text="音效",new Btn(this.yxMc,function(){e.yxMc.okImg.visible=!e.yxMc.okImg.visible});var n=this.dispatcher.get("user","qualifyDt"),s=Math.max(n[0],n[1],n[2],n[3]),r=[null,0==n[5]?.01:+n[5].toFixed(4),0==s?1:0==n[0]?.01:n[0]/s,0==s?1:0==n[1]?.01:n[1]/s,0==s?1:0==n[2]?.01:n[2]/s,0==s?1:0==n[3]?.01:n[3]/s,0==n[4]?.01:+n[4].toFixed(4)],o=MatchUtils.getRegularSixSidedPolygonObject(320,730,100,r),a=new egret.Shape,h=["O","A","B","C","D","E","F"];a.graphics.lineStyle(2,11036195),a.graphics.moveTo(o[h[1]].x,o[h[1]].y);for(var l=2;l<h.length;l++)a.graphics.lineTo(o[h[l]].x,o[h[l]].y);a.graphics.lineTo(o[h[1]].x,o[h[1]].y),a.graphics.lineStyle(1,15121785);for(var l=2;l<h.length;l++)a.graphics.lineTo(o[h[0]].x,o[h[0]].y),a.graphics.lineTo(o[h[l]].x,o[h[l]].y);a.graphics.beginFill(13868898),a.graphics.moveTo(o[h[1]+h[1]].x,o[h[1]+h[1]].y);for(var l=2;l<h.length;l++)a.graphics.lineTo(o[h[l]+h[l]].x,o[h[l]+h[l]].y);a.graphics.lineTo(o[h[1]+h[1]].x,o[h[1]+h[1]].y),a.graphics.endFill(),this.addChild(a),this.ATF.textFlow=[{text:"命中率\n[",style:{size:24,textColor:7093780}},{text:(100*n[5]).toFixed(2)+"%",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}},{text:"]",style:{size:24,textColor:7093780}}],this.BTF.textFlow=[{text:"左轮胜场\n",style:{size:24,textColor:7093780}},{text:n[0]+"",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}}],this.CTF.textFlow=[{text:"步枪胜场\n",style:{size:24,textColor:7093780}},{text:n[1]+"",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}}],this.DTF.textFlow=[{text:"散弹胜场\n",style:{size:24,textColor:7093780}},{text:n[2]+"",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}}],this.ETF.textFlow=[{text:"狙击胜场\n",style:{size:24,textColor:7093780}},{text:n[3]+"",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}}],this.FTF.textFlow=[{text:"爆头率\n[",style:{size:24,textColor:7093780}},{text:(100*n[4]).toFixed(2)+"%",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}},{text:"]",style:{size:24,textColor:7093780}}]},e}(eui.Component);__reflect(SettingDialog.prototype,"SettingDialog");var HouseScene=function(t){function e(e,i,n){var s=t.call(this)||this;return s.typeItems=[],s.dispatcher=e,s.skinName=HouseSceneSkin,s.closeCallBack=i,s.screenHeight=n,s.dataJson=RES.getRes("data_json"),s.y=-(1386-n)/2,s}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.typeNames=["武器","道具"],new Btn(this.btnBack,function(){0==e.currentStatus?e.closeCallBack():1==e.currentStatus?e.refreshUi():2==e.currentStatus?e.showPropList():console.log("error")}),this.groupLeft.x=-310,this.groupRight.visible=!1,egret.Tween.get(this.groupLeft).to({x:40},200).to({x:0},50).to({},100,function(){e.groupRight.visible=!0,e.refreshUi(),e.adjustUi()})},e.prototype.adjustUi=function(){this.btnBack.y=43+(1386-this.screenHeight)/2;var t=(1386-this.screenHeight)/4;this.btnBuy1.y=this.btnBuy0.y=804-t,this.labelBuy.y=738-t,this.line_down.y=850-t,this.btnUse.y=947-t,this.unlockLevel.y=947-t,this.diamondTF.y=1184-t,this.diamondImg.y=1176-t,this.coinTF.y=1140-t,this.coinImg.y=1132-t},e.prototype.refreshUi=function(){var t=this;this.currentStatus=0,this.groupHouse.visible=!0,this.groupHouse.removeChildren(),this.groupDetial.visible=!1,this.ck_title.text="仓 库";var e=["wq_sq_s00_png","dj_zhadan_s00_png"];this.typeItems=[];for(var i=0;i<this.typeNames.length;i++){var n=new TypeItem;this.groupHouse.addChild(n),this.typeItems.push(n),n.y=30+i*n.height+20*i,n.x=5,setTexture(n.img_type,e[i],.5,.5,1,1),n.label_type.text=this.typeNames[i],n.currentI=i,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.typeIndex=t.target.currentI,this.showPropList()}.bind(this),this),n.visible=!1}this.typeItems[0].visible=!0,egret.Tween.get(this.typeItems[1]).to({},3e3*i,function(){t.typeItems[1].visible=!0}),this.updateGold()},e.prototype.showPropList=function(){console.log("show proplist:"+this.typeIndex),this.currentStatus=1,this.ck_title.text=0==this.typeIndex?"装 备":"道 具",this.groupHouse.visible=!0,this.groupDetial.visible=!1,this.groupHouse.removeChildren();var t=this.dispatcher.get("user");this.list=new eui.Group,this.scroller=new egret.ScrollView(this.list),this.groupHouse.addChild(this.scroller),this.scroller.y=30,this.scroller.x=5,this.scroller.width=this.list.width=320,this.scroller.height=696;for(var e=(t.gunIndex||"",0==this.typeIndex?t.gunHs||[[0,-1],[-1,-1],[-1,-1],[-1,-1]]:t.propHs||[[0,-1,-1],[-1,-1,-1],[-1,-1,-1]]),i=0,n=0;n<e.length;n++)for(var s=e[n],r=0;r<s.length;r++){var o=new PropItem;o.x=r%3*108,o.y=110*(i+Math.floor(r/3)),this.list.addChild(o);var a;0==this.typeIndex?(a=this.dataJson.gunsBaseNumber[n+"-"+r],setTexture(o.propImg,"weapon_s_"+n+"_"+r+"_png"),o.suoImg.visible=o.suoImgBg.visible=-1==e[n][r],o.iconImg.visible=this.dispatcher.get("user","gunIndex")==n+"-"+r,o.propLabel.text=o.suoImg.visible?this.dataJson.gunUnLockLevel[a[0]]+"级解锁":a[0]):1==this.typeIndex&&(a=this.dataJson.propsBaseNumber[n+"-"+r],setTexture(o.propImg,"prop_s_"+n+"_"+r+"_png"),o.suoImg.visible=o.suoImgBg.visible=-1==e[n][r],o.iconImg.visible=this.dispatcher.get("user","propIndex")==n+"-"+r,o.propLabel.text=o.suoImg.visible?this.dataJson.propUnLockLevel[a[0]]+"级解锁":a[0]);
var h=n+"-"+r;o.currentI=h,o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.showPropDetail(t.target.currentI)}.bind(this),this),r==s.length-1&&(i+=Math.ceil(r/3))}},e.prototype.showPropDetail=function(t){var e=this;if(this.adjustUi(),console.log("show detail :"+t),this.unlockLevel.visible=!1,this.currentStatus=2,this.ck_title.text="详 情",this.groupHouse.visible=!1,this.groupDetial.visible=!0,this.experTitle.visible=this.experValue.visible=0==this.typeIndex,this.btnBuy0.visible=this.btnBuy1.visible=this.labelBuy.visible=!1,0==this.typeIndex){var i=this.dataJson.gunsBaseNumber[t];this.propTitle.text=i[0],this.propDes.text=i[7];var n=["伤害","弹夹","精度","射速"];this.attrGroup.removeChildren();for(var s=0;s<n.length;s++){var r=new AttrItem;this.attrGroup.addChild(r),r.y=(20+r.height)*s,r.label_k.text=n[s],r.label_v.text=i[s+2]+""}var o=this.dispatcher.get("user","gunHs")||[[0,-1],[-1,-1],[-1,-1],[-1,-1]],a=i[1].split("-");setTexture(this.propIcon,"weapon_l_"+ +a[0]+"_"+ +a[1]+"_png");var h=o[+a[0]][+a[1]];this.experValue.visible&&(this.experValue.text=(-1==h?0:h)+""),this.btnUse.visible=-1!=h,this.unlockLevel.visible=!this.btnUse.visible,this.unlockLevel.visible&&(this.unlockLevel.text=this.dataJson.gunUnLockLevel[i[0]]+"级解锁"),new Btn(this.btnUse,function(){e.useProp(0,i[1])}).touchEnabled=this.dispatcher.get("user","gunIndex")!=t}else if(1==this.typeIndex){var i=this.dataJson.propsBaseNumber[t];this.propTitle.text=i[0],this.attrGroup.removeChildren(),this.propDes.text=i[7];var l=this.dispatcher.get("user","propHs")||[[0,-1,-1],[-1,-1,-1],[-1,-1,-1]],c=i[1],a=c.split("-");setTexture(this.propIcon,"prop_l_"+ +a[0]+"_"+ +a[1]+"_png");var d=l[+a[0]][+a[1]];this.btnBuy0.visible=this.btnBuy1.visible=this.labelBuy.visible=-1!=l[+a[0]][+a[1]],this.btnUse.visible=d>0,this.unlockLevel.visible=-1==d,this.unlockLevel.visible&&(this.unlockLevel.text=this.dataJson.propUnLockLevel[i[0]]+"级解锁"),this.btnBuy0.visible&&(setTexture(this.btnBuy0.img_left,"sy_jinbi_png"),this.btnBuy0.label_right.text=i[5]+"",setTexture(this.btnBuy1.img_left,"sy_zuanshi_png"),this.btnBuy1.label_right.text=i[6]+"",new Btn(this.btnBuy0,function(){console.log(c+"---price="+i[5]),c!=e.dispatcher.get("user","propIndex")&&e.dispatcher.request("propHs.buyProp",{mode:0,propIndex:c},function(t){t&&window.alert(t),console.log("success"),this.updateGold()}.bind(e))}),new Btn(this.btnBuy1,function(){console.log(c+"---price="+i[6]),c!=e.dispatcher.get("user","propIndex")&&e.dispatcher.request("propHs.buyProp",{mode:1,propIndex:c},function(t){t&&window.alert(t),console.log("success"),this.updateGold()}.bind(e))})),this.btnUse.visible&&(new Btn(this.btnUse,function(){e.useProp(0,c)}).touchEnabled=this.dispatcher.get("user","propIndex")!=t)}this.btnUse.nameTF.text="装备"},e.prototype.updateGold=function(){var t=this.dispatcher.get("user","goldAll")||0,e=this.dispatcher.get("user","goldCost")||0,i=this.dispatcher.get("user","diamondAll")||0,n=this.dispatcher.get("user","diamondCost")||0;this.coinTF.text=t-e+"",this.diamondTF.text=i-n+""},e.prototype.useProp=function(t,e){var i=this;0==this.typeIndex?this.dispatcher.request("propHs.changeGun",{gunIndex:e},function(t){t&&window.alert(t),i.dispatcher.get("user"),console.log("success")}):1==this.typeIndex&&this.dispatcher.request("propHs.changeProps",{mode:0,propIndex:e},function(t){t&&window.alert(t),i.dispatcher.get("user"),console.log("success")})},e}(eui.Component);__reflect(HouseScene.prototype,"HouseScene");var TypeItem=function(t){function e(){var e=t.call(this)||this;return e.skinName=CKBtnMulu,e}return __extends(e,t),e}(eui.Button);__reflect(TypeItem.prototype,"TypeItem");var PropItem=function(t){function e(){var e=t.call(this)||this;return e.skinName=HouseItem,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.touchEnabled=!0,this.bgImg.touchEnabled=this.iconImg.touchEnabled=this.propImg.touchEnabled=this.propLabel.touchEnabled=this.suoImg.touchEnabled=this.suoImgBg.touchEnabled=!1},e}(eui.Component);__reflect(PropItem.prototype,"PropItem");var AttrItem=function(t){function e(){var e=t.call(this)||this;return e.skinName=GunAttrItem,e}return __extends(e,t),e}(eui.Component);__reflect(AttrItem.prototype,"AttrItem");