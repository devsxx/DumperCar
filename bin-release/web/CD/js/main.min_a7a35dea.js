function createBitmap(t,e,i,s,n,r,o,a){var h=new egret.Bitmap,l=new AssetAdapter;return l.getAsset(t,function(l){h.texture=RES.getRes(t),h.anchorOffsetX=e>2?e:(e||0)*h.width,h.anchorOffsetY=i>2?i:(i||0)*h.height,h.x=s||0,h.y=n||0,h.scaleX=r||1,h.scaleY=o||1,a&&a(h)},this),h}function setTexture(t,e,i,s,n,r,o){i=i||t.anchorOffsetX/t.width,s=s||t.anchorOffsetY/t.height,t.scaleX=void 0===n?1:n,t.scaleY=void 0===r?1:r;var a=new AssetAdapter;t.texture=null,a.getAsset(e,function(n){t.texture=RES.getRes(e),t.anchorOffsetX=(i||0)*t.width,t.anchorOffsetY=(s||0)*t.height,o&&o()},this)}function getNumberString(t){var e,i;if(0===+t||+t){var s=""+Math.floor(t);if(1e3>t)return s;var n=Math.floor(Math.log(t)/Math.log(10)+1e-6);e=~s.indexOf("e")?+s.split("e")[0]*Math.pow(10,n%3):+s.slice(0,n%3+3)/100,i=n/3>>0}else{if(t=t.split("exp"),+t[1]<3)return Math.round(t[0]*Math.pow(10,t[1]))+"";for(e=t[0]*Math.pow(10,t[1]%3);e>1e3;)e/=1e3,t[1]=+t[1]+3;i=t[1]/3>>0}var r;if(4>i)r=["","K","M","B"][i];else{var o=(i-4)/26>>0,a=o/26>>0,h=(i-4)%26,l="abcdefghijklmnopqrstuvwxyz",c=l.toUpperCase();r=(2>a?l:c)[o%26]+(a%2?c:l)[h]}return e.toFixed(10>e?2:100>e?1:0)+r}function setAvatar(t,e,i,s){if(!e)return t.texture=null,void(s&&s());var n=t.width,r=t.height;if(i=i||(~location.hostname.indexOf("h5.")?"http://s1.wc.weedon.cn:9602/avatar/":"https://gsbxs.hortor.net:9602/avatar/")+e+"/avatar.jpg",avatars[e]){var o=new egret.Texture;o.bitmapData=avatars[e],t.texture=o,t.width=n,t.height=r,s&&s()}else{var a=new egret.ImageLoader;a.crossOrigin="anonymous",a.once(egret.Event.COMPLETE,function(i){var o=new egret.Texture;avatars[e]=o.bitmapData=a.data,t.texture=o,t.width=n,t.height=r,s&&s()},this),a.load(i)}}function setQRCode(t,e,i){var s=t.width,n=t.height,r=(~location.hostname.indexOf("h5game.")?"http://s1.wc.weedon.cn:9602/qrcode/":"https://gsbxs.hortor.net:9602/qrcode/")+e;if(qrcodes[e])t.width=s,t.height=n,i();else{var o=new egret.ImageLoader;o.crossOrigin="anonymous",o.once(egret.Event.COMPLETE,function(e){t.width=s,t.height=n,i()},this),o.load(r)}}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))(function(n,r){function o(t){try{h(s.next(t))}catch(e){r(e)}}function a(t){try{h(s["throw"](t))}catch(e){r(e)}}function h(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(o,a)}h((s=s.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return s([t,e])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,r=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){h.label=i[1];break}if(6===i[0]&&h.label<o[1]){h.label=o[1],o=i;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(i);break}o[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,r,o,a,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},BuyTiDialog=function(t){function e(e,i){var s=t.call(this)||this;return s.mScreenHeight=e,s.dispatcher=i,s.skinName=BuyTiDialogSkin,s}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),setTexture(this.backBtn.tfImg,"wz_fh_png"),new Btn(this.backBtn,function(){e.parent.removeChild(e)}.bind(this)),this.diamondTF.text=(this.dispatcher.get("user","diamondAll")||0)-(this.dispatcher.get("user","diamondCost")||0),this.refreshList(),this.adjustUI()},e.prototype.refreshList=function(){this.list.removeChildren(),this.mChargeArr=RES.getRes("avtivity_json").buyTi;for(var t=function(t){var i=new eui.Component;i.skinName=BuyTiItemRenderSkin,setTexture(i.iconImg,"cz_tili_"+(t+1)+"_png"),i.desTF.text="体力 X"+e.mChargeArr[t][0],i.diamondTF.text=e.mChargeArr[t][1],e.list.addChild(i),i.y=150*t,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("click item "+t)},e)},e=this,i=0;i<this.mChargeArr.length;i++)t(i)},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e}(eui.Component);__reflect(BuyTiDialog.prototype,"BuyTiDialog");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function s(s){e.call(i,s,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?s(n):RES.getResAsync(t,s,this)}else RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var _wx;!function(){function t(t){e&&e({x:+Math.sin(t.gamma/180*Math.PI).toFixed(5),y:t.alpha,z:+Math.sin(-t.beta/180*Math.PI).toFixed(5)})}var e=null;_wx={},Object.defineProperties(_wx,{startAccelerometer:{value:function(e){window.addEventListener("deviceorientation",t,!0),e.success&&e.success()}},onAccelerometerChange:{value:function(t){e=t}},stopAccelerometer:{value:function(){window.removeEventListener("deviceorientation",t,!0)}}})}();var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e="1.0.4";RES.getRealURL=function(t){return t+"?v="+e};var i=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",i),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),this.stage.removeChild(t),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var s=new eui.Theme("resource/default.thm.json",t.stage);s.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){formula.init(RES.getRes("data_json"),RES.getRes("game_config_json"));var t=weedon.config(~location.hostname.indexOf("h5.")?"s1.wc.weedon.cn":~location.hostname.indexOf(".hortor.")?"gsbxs.hortor.net":"192.168.1.196"==location.hostname?"192.168.1.204":location.hostname,9601,"ws",function(){}),e=egret.localStorage.getItem("CM#OPENID");e||(e=Math.random().toString(),egret.localStorage.setItem("CM#OPENID",e)),weedon.getLoginData(function(e,i){var s=this;t.request("user.login",{loginData:i},function(e){if(e)return alert(e.errmsg||"登录失败");t.heartbeat(5e3,function(){}),weedon.initChannelConfig({inviter:t.get("user","_id"),nickname:t.get("user","nickname")},function(e){var i=t.getCache("shareCallback");i&&i(e||0)},function(e){var i=t.getCache("payCallback");i&&i(e||0)});var i=-1==t.get("user","gender");if(i){var n=new SelectDialog(t,function(){s.removeChild(n);var e=new MainScene(t);s.addChild(e)}.bind(s));s.addChild(n)}else{var r=new MainScene(t);s.addChild(r)}}.bind(this))}.bind(this))},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,s){function n(t){e.call(s,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(s))}"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(s,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Animation=function(t){function e(e,i,s,n,r){var o=t.call(this)||this;o.onTop=1,o.debug=!1,o.spd=1,o.slots={},o.sounds={},o.frameEvents={},o.touchEnabled=!1,o.eventCallback=n;var a=new AssetAdapter,h=3;return[e+"_ske_json",e+"_tex_json",e+"_tex_png"].forEach(function(t){a.getAsset(t,function(){if(!--h){var t=new dragonBones.EgretFactory;t.parseDragonBonesData(RES.getRes(e+"_ske_json")),t.parseTextureAtlasData(RES.getRes(e+"_tex_json"),RES.getRes(e+"_tex_png"));var n=this.display=t.buildArmatureDisplay(i||e);this.addChild(n),n.touchEnabled=!1,n.armature.addEventListener(dragonBones.Event.LOOP_COMPLETE,function(){if(this.callback){var t=this.callback;this.callback=null,t()}else s&&s()},this),n.armature.addEventListener(dragonBones.Event.BONE_FRAME_EVENT,this.frameListener,this),n.armature.addEventListener(dragonBones.SoundEvent.SOUND_EVENT,this.soundListener,this),this.animationName&&n.animation.play(this.animationName,this.loop);for(var o in this.slots){var a=n.armature.getSlot(o),l=a.getDisplay();this.slots[o].x=l.x,this.slots[o].y=l.y,a.setDisplay(this.slots[o]),delete this.slots[o]}n.animation.timeScale=this.spd,r&&r(n)}},this)}.bind(o)),o}return __extends(e,t),e.prototype.frameListener=function(t){this.frameEvents[t.frameLabel]?this.frameEvents[t.frameLabel](t):this.eventCallback&&this.eventCallback(t.frameLabel)},e.prototype.soundListener=function(t){if(!MUTE_SE)if(this.sounds[t.frameLabel])this.sounds[t.frameLabel].play(1);else var e=this.sounds[t.frameLabel]=new Sound(1,t.frameLabel.split(".")[0],function(){e.play(1)})},e.prototype.clearListeners=function(){this.display.armature.removeEventListener(dragonBones.Event.BONE_FRAME_EVENT,this.frameListener,this),this.display.armature.removeEventListener(dragonBones.SoundEvent.SOUND_EVENT,this.soundListener,this)},e.prototype.getSlotDisplay=function(t){return this.display?this.display.armature.getSlot(t).getDisplay():null},e.prototype.play=function(t,e,i){this.debug&&console.log(t),this.animationName=t,this.loop=e,this.display&&this.display.animation.play(t,e),this.callback=i||this.callback},e.prototype.setSlot=function(t,e){if(this.display){var i=this.display.armature.getSlot(t).getDisplay();if(!i)return;e.x=i.x,e.y=i.y,e.rotation=i.rotation,this.display.armature.getSlot(t).setDisplay(e)}else this.slots[t]=e},e.prototype.setEvent=function(t,e){this.frameEvents[t]=e},e.prototype.setSpeed=function(t){this.display?this.display.animation.timeScale=t:this.spd=t},e.prototype.hitCheck=function(t,e,i){var s=this.display.globalToLocal(t,e);if(i){var n=this.display.armature.getSlot(i);return n?n.containsPoint(s.x,s.y):!1}return!!this.display.armature.containsPoint(s.x,s.y)},Object.defineProperty(e.prototype,"_factor",{get:function(){return 0},set:function(t){this.x=(1-t)*(1-t)*this.originX+2*t*(1-t)*this.terminalX+t*t*this.targetX,this.y=(1-t)*(1-t)*this.originY+2*t*(1-t)*this.terminalY+t*t*this.targetY},enumerable:!0,configurable:!0}),e.prototype.bezierTo=function(t,e,i,s,n,r){this.originX=this.x,this.originY=this.y,this.terminalX=t,this.terminalY=e,this.targetX=i,this.targetY=s,egret.Tween.get(this).to({_factor:1},n).call(r)},e}(eui.Group);__reflect(Animation.prototype,"Animation");var Btn=function(t){function e(e,i,s){var n=t.call(this)||this;return n.isEnabled=!0,n.canceled=!1,n.noBouncing=!1,n.btnNode=e,n.touchNode=new eui.Group,n.touchNode.touchThrough=!1,e.parent.addChildAt(n.touchNode,e.parent.getChildIndex(e)+1),e.pixelHitTest=!1,n.touchNode.x=e.x,n.touchNode.y=e.y,n.touchNode.width=e.width,n.touchNode.height=e.height,n.touchNode.anchorOffsetX=e.anchorOffsetX,n.touchNode.anchorOffsetY=e.anchorOffsetY,n.callback=i,n.originScaleX=e.scaleX,n.originScaleY=e.scaleY,[n.btnNode,n.touchNode].forEach(function(t){t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegan,this)}.bind(n)),n.showRedDot(s),n}return __extends(e,t),e.prototype.showRedDot=function(t,e){return this.touchNode.visible=this.btnNode.visible,this.touchNode.x=this.btnNode.x,this.touchNode.y=this.btnNode.y,t?void(this.redDot?(this.redDot.visible=!0,e||(this.redDot.x=this.btnNode.x+t[0],this.redDot.y=this.btnNode.y+t[1])):t&&(this.redDot=createBitmap("common_hong_png",.5,.5,0,0,1,1,function(e){e.x=this.btnNode.x+t[0],e.y=this.btnNode.y+t[1],egret.Tween.get(e,{loop:!0}).to({y:this.btnNode.y+t[1]-8.5},200,egret.Ease.sineIn).to({y:this.btnNode.y+t[1]},500,egret.Ease.bounceOut).wait(3e3)}.bind(this)),this.btnNode.parent.addChildAt(this.redDot,this.btnNode.parent.getChildIndex(this.btnNode)+1))):void(this.redDot&&(this.redDot.visible=!1))},e.prototype.setOriginScale=function(t,e){this.originScaleX=t,this.originScaleY=e},e.prototype.touchBegan=function(t){return!this.isEnabled||this.canceled?void(this.canceled=!1):(this.noBouncing?this.callback():(egret.Tween.removeTweens(this.btnNode),this.btnNode.scaleX=this.originScaleX,this.btnNode.scaleY=this.originScaleY,egret.Tween.get(this.btnNode).to({scaleX:.7*this.originScaleX,scaleY:.7*this.originScaleY},100).to({scaleX:1*this.originScaleX,scaleY:1*this.originScaleY},100).call(function(){this.callback()},this)),void t.stopPropagation())},e.prototype.touchMoved=function(t){this.isEnabled&&(this.canceled=!0,egret.Tween.removeTweens(this.btnNode),this.btnNode.scaleX=this.originScaleX,this.btnNode.scaleY=this.originScaleY,t.stopPropagation())},e.prototype.touchEnded=function(t){this.isEnabled&&(!this.canceled&&this.callback(),this.canceled=!1,t.stopPropagation())},e.prototype.setEnabled=function(t,e){this.isEnabled=t,this.btnNode.filters=t||e?[]:[new egret.ColorMatrixFilter([.4,.7,0,0,0,.4,.7,0,0,0,.4,.7,0,0,0,0,0,0,1,0])]},e.prototype.trigger=function(){this.callback()},e}(egret.DisplayObjectContainer);__reflect(Btn.prototype,"Btn");var Dispatcher=function(){function t(t){this._dispatcher=t}return t.prototype.heartbeat=function(t,e){this._dispatcher.heartbeat(t,e)},t.prototype.request=function(t,e,i,s){this._dispatcher.request(t,e,i,s)},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._dispatcher.get.apply(this._dispatcher,t)},t.prototype.getOld=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._dispatcher.getOld.apply(this._dispatcher,t)},t.prototype.getNew=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._dispatcher.getNew.apply(this._dispatcher,t)},t.prototype.safeGetNew=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._dispatcher.safeGetNew.apply(this._dispatcher,t)},t.prototype.setCache=function(t,e){this._dispatcher.setCache(t,e)},t.prototype.getCache=function(t){return this._dispatcher.getCache(t)},t.prototype.clearCache=function(){this._dispatcher.clearCache()},Object.defineProperty(t.prototype,"waitFunc",{set:function(t){this._dispatcher.waitFunc=t},enumerable:!0,configurable:!0}),t.prototype.setOverrideKey=function(t){this._dispatcher.setOverrideKey(t)},t.prototype.setPushCallback=function(t,e){this._dispatcher.setPushCallback(t,e)},t}();__reflect(Dispatcher.prototype,"Dispatcher");var HpBar=function(t){function e(e,i,s,n){var r=t.call(this)||this;return r.loadIndex=0,r.imgNames=[],r.bars=[],r.lastUpdate=0,r.imgNames=[e,i,s,n],r.loadImg(),egret.startTick(r.update,r),r}return __extends(e,t),e.prototype.loadImg=function(){this.imgNames[this.loadIndex]&&createBitmap(this.imgNames[this.loadIndex],.5,.5,0,0,1,1,function(t){this.addChild(t),t.visible=this.loadIndex<2,this.loadIndex&&this.bars.push(t),++this.loadIndex,this.loadImg()}.bind(this))},e.prototype.showTag=function(t,e,i,s){this.tag||(this.tag=new egret.TextField,this.addChild(this.tag)),this.tag.text=this.showValue+"/"+this.maxValue,this.tag.size=t,this.tag.textColor=e,i&&(this.tag.stroke=i,this.tag.strokeColor=s),this.tag.anchorOffsetX=this.tag.width/2,this.tag.anchorOffsetY=this.tag.height/2},e.prototype.setMaxValue=function(t){this.maxValue=t,this.currentValue?this.setValue(Math.min(this.maxValue,this.currentValue)):this.currentValue=this.showValue=this.maxValue},e.prototype.setValue=function(t){t<this.showValue?this.bars[2]&&(this.bars[2].visible=!0,this.bars[2].mask=new egret.Rectangle(t/this.maxValue*this.bars[2].width,0,(this.showValue-t)/this.maxValue*this.bars[2].width,this.bars[2].height)):this.bars[1]&&(this.bars[1].visible=!0,this.bars[1].mask=new egret.Rectangle(this.showValue/this.maxValue*this.bars[2].width,0,(t-this.showValue)/this.maxValue*this.bars[2].width,this.bars[2].height)),this.currentValue=Math.max(0,Math.min(t,this.maxValue)),this.bars[0]&&(this.bars[0].mask=new egret.Rectangle(0,0,this.currentValue/this.maxValue*this.bars[0].width,this.bars[0].height)),this.lastUpdate=weedon.time},e.prototype.update=function(){if(this.showValue==this.currentValue)return this.bars[1]&&(this.bars[1].visible=!1),this.bars[2]&&(this.bars[2].visible=!1),!1;var t=weedon.time;return t-this.lastUpdate>0&&(this.showValue<this.currentValue?(this.showValue=Math.min(this.currentValue,this.showValue+.01*(t-this.lastUpdate-0))>>0,this.bars[1]&&(this.bars[1].mask=new egret.Rectangle(this.showValue/this.maxValue*this.bars[2].width,0,(this.currentValue-this.showValue)/this.maxValue*this.bars[2].width,this.bars[2].height))):(this.showValue=Math.max(this.currentValue,this.showValue-.01*(t-this.lastUpdate-0))>>0,this.bars[1]&&(this.bars[2].mask=new egret.Rectangle(this.currentValue/this.maxValue*this.bars[2].width,0,(this.showValue-this.currentValue)/this.maxValue*this.bars[2].width,this.bars[2].height)))),this.tag&&(this.tag.text=this.showValue+"/"+this.maxValue,this.tag.anchorOffsetX=this.tag.width/2,this.tag.anchorOffsetY=this.tag.height/2),!0},e}(egret.DisplayObjectContainer);__reflect(HpBar.prototype,"HpBar");var MUTE_SE=!1,Sound=function(){function t(t,e,i,s){this.playing=!1;var n=new egret.Sound;n.load("resource/assets/sound/"+e+(s||".mp3")+"?v="+window.__VERSION),n.addEventListener(egret.Event.COMPLETE,function(){this.sound=n,i(this)},this),this.mode=t}return t.prototype.play=function(t,e){if(!(this.playing||!this.sound||this.mode&&MUTE_SE)){this.playing=!0;var i=this.channel=this.sound.play(0,t||0===t?t:1);i.addEventListener(egret.Event.SOUND_COMPLETE,function(){e&&e(),this.playing=!1},this)}},t.prototype.stop=function(){this.playing&&(this.playing=!1,this.channel&&this.channel.stop())},t}();__reflect(Sound.prototype,"Sound");var avatars={},qrcodes={},User=function(){function t(){this.shooting=!1,this.reloading=!1,this.reloadActing=!1,this.reloadFinishing=!1,this.itemUsing=!1,this.itemUsed=!1,this.canAim=!1,this.aiming=!1,this.aimed=!1,this.touching=!1,this.stateFinishing=!1,this.cursorSpeed=.01,this.cursorMode=0,this.lastFire=0,this.fireInterval=1200}return t}();__reflect(User.prototype,"User");var Opponent=function(){function t(){this.moving=!1,this.moveSpeed=.2,this.restTimeBase=1e3,this.restTimeRand=1e3,this.moveWidth=440,this.waitFinish=0,this.nextX=0,this.waiting=!1}return t}();__reflect(Opponent.prototype,"Opponent");var Duel=function(t){function e(e,i){var s=t.call(this)||this;return s.targetX=0,s.targetY=0,s.mode=0,s.hitEffects=[],s.behitEffects=[],s.nohitEffects=[],s.cdItems=[],s.cdBlanks=[],s.itemsSound=[],s.isShocking=!1,s.damagaLabelList=[],s.dispatcher=e,s.callback=i,s.skinName=DuelSceneSkin,s.initBattleData(),s}return __extends(e,t),e.prototype.initBattleData=function(){var t=this.dispatcher.get("battle"),e=this.me=new User,i=RES.getRes("data_json"),s=this.dispatcher.get("user","_id");e._id=s;var n=t["gunType"+s],r=i.gunsBaseNumber[n],o=n.split("-"),a=+o[0];e.gunIndex=+o[1],e.gunType=0==a?0:1,e.gunName=["handgun","rifle","shutgun","sniper"][a],e.gender=0,e.bulletType=["s","b","xd","b"][a],e.maxBullets=e.bullets=r[3],e.maxHp=e.hp=t["hpMax"+s];var h=t["propType"+s];if(""==h)e.itemIndex=-1,e.itemGrade=-1;else{var l=h.split("-"),c=+l[0],d=+l[1];e.itemIndex=[1,0,2][c],e.itemGrade=d}e.hits=r[8],e.precision=r[4],e.basePrecision=100,e.baseHitRadius=r[10],e.crosshairIndex=0==a?0:1,e.canAim=1==r[11],e.fireInterval=6e4/r[5];var p=t.uids.split("-"),u=s==p[0]?p[1]:p[0];this.targetUserId=u;var g=this.opponent=new Opponent;g.nickname=t["nickname"+u];var m=t["gunType"+u],f=m.split("-"),v=+f[0];i.gunsBaseNumber[m];g.gunName=["handgun","rifle","shutgun","sniper"][v],g.maxHp=g.hp=t["hpMax"+u],g._id=u,g.gender=t["targetGender"+u],this.soundNoBullet=new Sound(1,e.gunName+"_out",function(){},".mp3");for(var b=0;3>b;b++)this.itemsSound.push(new Sound(1,"item_"+b,function(){},".mp3"))},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=this.me,i=this.opponent;if(console.log(e.itemIndex+"----"+e.itemGrade),-1!=e.itemIndex||-1!=e.itemGrade){var s=this.item=new Animation("item"+e.itemIndex);this.itemLayer.addChild(s),s.play("stand"+e.itemGrade,0),s.x=110,s.y=1276,s.touchEnabled=!0,s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.useItem()},this)}var n=this.gun=new Animation(e.gunName);this.itemLayer.addChild(n),n.play("stand",0),n.x=320,n.y=1386;var r=this.cross=new Animation("crosshair"+e.crosshairIndex);this.itemLayer.addChild(r),r.play("stand",0),r.x=320,r.y=886,r.scaleX=r.scaleY=(e.basePrecision-e.precision)/e.basePrecision,r.touchEnabled=!1;var o=this.target=new Animation("chr"+i.gender);this.enemy.addChild(o),o.play(i.gunName+"_stand_fire",0),o.scaleX=o.scaleY=.3;for(var a=0;12>a;++a)if(e.fireInterval&&1==e.crosshairIndex){var h=this.cdBlanks[a]=new egret.DisplayObject;r.setSlot(""+a,h),this.cdItems.push(createBitmap("se_4_png",.5,.5))}var l=this.enemyFire=new Animation("enimyfire");o.setSlot("p",l),l.visible=!1;var c=this.flour=new Animation("itemhit1");this.itemLayer.addChild(c),c.x=320,c.y=1386,c.visible=!1,this.nickname.text=i.nickname,this.scene.touchEnabled=!0,this.scene.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.touching=!0,e.canAim&&this.aim()},this),this.scene.addEventListener(egret.TouchEvent.TOUCH_END,function(){e.touching&&(e.touching=!1,!this.startTime||e.itemUsing||e.reloadFinishing||(e.reloading&&!e.reloadActing?this.reload():this.fire()))},this),egret.Tween.get(this.reloadTag,{loop:!0}).to({scaleY:.8},300).to({scaleY:1},200).wait(1e3),this.userHpBar=new HpBar("zd_zj_db_png","zd_zj_x_png","zd_zj_jia_png","zd_zj_jian_png"),this.topUI.addChildAt(this.userHpBar,0),this.userHpBar.setMaxValue(e.maxHp),this.userHpBar.showTag(30,16777215),this.userHpBar.y=25,this.userHpBar.x=320,this.enemyHpBar=new HpBar("zd_dr_db_png","zd_dr_xt_png","zd_dr_jia_png","zd_dr_jian_png"),this.enemy.addChildAt(this.enemyHpBar,0),this.enemyHpBar.setMaxValue(i.maxHp),this.enemyHpBar.y=-270;var d=this.log=new eui.Label;this.addChild(d),d.size=20,d.textColor=14483456,d.x=20,d.y=1200;for(var p=function(t){["s","xd","b","b"].forEach(function(i){i==e.bulletType?this[i+"qzdc"+t].visible=this[i+"qzd"+t].visible=t<e.bullets:this[i+"qzdc"+t].visible=this[i+"qzd"+t].visible=!1}.bind(u))},u=this,a=0;6>a;++a)p(a);this.targetX=this.field.x,this.targetY=this.scene.y,this.adjustUI(),this.start()},e.prototype.adjustUI=function(){return this.ignoreNextResize?void(this.ignoreNextResize=!1):(this.ignoreNextResize=!0,void(weedon.winSize.width/weedon.winSize.height>.64?(this.stage.setContentSize(640,1e3),this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL,this.y=-193,this.topUI.y=193,this.screenHeight=1e3):(this.stage.setContentSize(640,1386),this.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,this.screenHeight=640/weedon.winSize.width*weedon.winSize.height,this.y=this.screenHeight-1386,this.topUI.y=-this.y)))},e.prototype.clamp=function(t,e,i){return Math.max(e,Math.min(t,i))},e.prototype.duelFinish=function(){if(this.dispatcher.setPushCallback("battle",null),("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).stopAccelerometer(),this.scene.touchEnabled=!1,egret.stopTick(this.update,this),this.flour&&this.flour.visible&&(this.flour.visible=!1),this.me.hp<=0){var t=500,e=Math.floor(1e3*t/1408/2),i=Math.floor(868*t/1408),s=this.ground.y+1400;this.gun&&this.gun.parent&&this.gun.parent.removeChild(this.gun),this.item&&this.item.parent&&this.item.parent.removeChild(this.item),this.reloadTag.visible&&(this.reloadTag.visible=!1),this.cross.visible&&(this.cross.visible=!1),this.bulletList.visible=!1,this.scene.touchEnabled=!1,egret.Tween.get(this.scene).to({y:1e3},e).call(function(){egret.Tween.get(this.ground).to({y:s},i).call(function(){this.target.scaleX=this.target.scaleY=1,this.enemy.x=0,this.target.x=this.target.globalToLocal(-230,0).x,this.target.y=this.target.y-this.target.height/2,this.target.play(this.me.hp<=0?"lol":this.opponent.gunName+"_die",this.me.hp<=0?0:1,function(){egret.Tween.get(this.target).to({rotation:30},500).wait(1e3).call(function(){this.callback()},this)}.bind(this))},this)},this)}else this.target.play(this.me.hp<=0?"lol":this.opponent.gunName+"_die",this.me.hp<=0?0:1,function(){egret.Tween.get(this).wait(1500).call(function(){this.callback()},this)}.bind(this))},e.prototype.start=function(){var t=this.me,e=this.opponent;this.dispatcher.setPushCallback("battle",this.onMessage.bind(this)),("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).startAccelerometer({success:function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).onAccelerometerChange(function(e){e.z>0&&!t.reloading&&!t.shooting?this.startReload():e.z<-.3&&t.reloading&&!t.reloadFinishing&&this.stopReload(),t.cursorMode?this.targetX=this.field.anchorOffsetX-2020*this.clamp(e.x,-.17,.17)*(e.z>0?-1:1):this.targetX=this.field.anchorOffsetX+2020*this.clamp(e.x,-.17,.17)*(e.z>0?-1:1),this.targetY=50-400*this.clamp(e.z,-1,-0)}.bind(this)),this.startTime=weedon.time,e.nextX=(640-e.moveWidth)/2+e.moveWidth*Math.random()>>0,egret.startTick(this.update,this)}.bind(this)})},e.prototype.startReload=function(){var t=this.me;t.aiming||(t.reloadFinishing=!1,t.reloading=t.reloadActing=!0,this.cross.visible=!1,this.gun.play("rifle"!=t.gunName&&"sniper"!=t.gunName?"reload"+t.bullets:"reload",1,function(){t.reloadActing=!1}.bind(this)))},e.prototype.reload=function(){var t=this.me;t.bullets==t.maxBullets||t.reloadActing||t.reloadFinishing||(t.reloadActing=!0,this.gun.play("rifle"!=t.gunName&&"sniper"!=t.gunName?"reload"+t.bullets+"_load":"reload_load",1,function(){t.reloadActing=!1}.bind(this)),this[t.bulletType+"qzd"+t.bullets].visible=!0,t.bullets+=1,this.reloadTag.visible=!1)},e.prototype.stopReload=function(){var t=this.me;t.reloadFinishing||"sniper"==t.gunName&&t.reloadActing||(t.reloadFinishing=!0,this.gun.play("rifle"!=t.gunName&&"sniper"!=t.gunName?"reload"+t.bullets+"_over":"reload_over",1,function(){this.gun.play("stand",0),t.reloading=t.reloadFinishing=t.reloadActing=!1,this.cross.visible=!0,t.touching&&t.canAim&&this.aim()}.bind(this)))},e.prototype.aim=function(){var t=this.me;if(!(t.reloading||t.reloadActing||t.reloadFinishing||!t.canAim||t.aiming||t.aimed||t.bullets<1||weedon.time-t.lastFire<t.fireInterval)){t.aiming=!0,this.cross.scaleX=this.cross.scaleY=1,this.cross.play("sniper",1,function(){t.aimed=!0,this.cross.play("sniperhold",0)}.bind(this));var e=this.cross.localToGlobal(0,0),i=this.field.globalToLocal(e.x,e.y);this.field.anchorOffsetX=i.x,this.field.anchorOffsetY=i.y,this.field.x=this.targetX=this.field.x+i.x,this.field.y=100+i.y,this.field.scaleX=this.field.scaleY=this.sky.scaleX=this.sky.scaleY=1.5}},e.prototype.fire=function(){var t=this.me,e=this.opponent;if(!(t.shooting||t.reloadFinishing||t.reloading||weedon.time-t.lastFire<t.fireInterval)){if(t.bullets>0){t.shooting=!0,t.lastFire=weedon.time,t.bullets-=1,this[t.bulletType+"qzd"+t.bullets].visible=!1,this.reloadTag.visible=!t.bullets;for(var i=[],s=function(e){var s=n.localToGlobal(n.cross.x,n.cross.y);s.x+=t.aiming?0:(1-2*Math.random())*n.cross.scaleX*t.baseHitRadius,s.y+=t.aiming?0:(1-2*Math.random())*n.cross.scaleY*t.baseHitRadius;for(var r=(n.target.globalToLocal(s.x,s.y),n.field.globalToLocal(s.x,s.y)),o=-1,a=0;8>a;++a){var h=["headhit","bodyhit","leghit0","leghit1","leghit2","leghit3","leghit4","leghit5"][a];if(n.target.hitCheck(s.x,s.y,h)){o=a;break}}i.push(o);var l;if(~o){for(var a=0;a<n.hitEffects.length;++a)if(!n.hitEffects[a].visible){l=n.hitEffects[a];break}l||(l=new Animation("se_hit"),n.field.addChild(l),l.scaleX=l.scaleY=.6,n.hitEffects.push(l)),l.visible=!0,l.x=r.x,l.y=r.y,l.play("hit",1,function(){l.visible=!1})}else{for(var a=0;a<n.nohitEffects.length;++a)if(!n.nohitEffects[a].visible){l=n.nohitEffects[a];break}l||(l=new Animation("se_nohit"),n.field.addChild(l),l.scaleX=l.scaleY=.6,n.nohitEffects.push(l)),l.visible=!0,l.x=r.x,l.y=r.y,l.play("hit",1,function(){l.visible=!1})}},n=this,r=0;r<t.hits;++r)s(r);for(var o=-1,r=0;r<i.length;++r)~i[r]&&(o=~o?Math.min(o,i[r]):i[r]);~o&&(e.waiting=!0,this.target.play(0==o?e.gunName+"_headhit":1==o?e.gunName+"_bodyhit":e.gunName+"_leghit",1,function(){e.waiting=!1,this.startTime&&this.target.play(e.waitFinish>weedon.time||e.nextX==this.enemy.x?e.gunName+"_stand_fire":e.nextX>this.enemy.x?e.gunName+"_right":e.gunName+"_left",0)}.bind(this))),this.oppoOldHp=this.dispatcher.get("battle","hp"+e._id),this.meOldHp=this.dispatcher.get("battle","hp"+this.me._id),this.dispatcher.request("user.battle",{action:0,hitIndexes:i,aiming:+t.aiming},function(){this.opponent.hp=this.dispatcher.get("battle","hp"+e._id),this.updateHp()}.bind(this)),this.gun.play("fire",1,function(){t.shooting=t.aiming=t.aimed=t.reloading=t.reloadActing=t.reloadFinishing=!1}.bind(this)),this.cross.scaleX=this.cross.scaleY=(t.basePrecision-t.precision)/t.basePrecision,this.cross.play("fire",1,function(){this.cross.play("stand",0)}.bind(this))}else t.aiming&&(this.cross.play("stand",0),t.aiming=t.aimed=!1),this.soundNoBullet&&this.soundNoBullet.play(1);this.field.scaleX=this.field.scaleY=this.sky.scaleX=this.sky.scaleY=1,this.field.x-=this.field.anchorOffsetX,this.targetX=this.field.x,this.field.anchorOffsetX=0,this.field.anchorOffsetY=0,this.field.y=100}},e.prototype.useItem=function(){var t=this.me,e=this.opponent;t.itemUsed||(t.itemUsed=t.itemUsing=!0,this.oppoOldHp=e.hp,this.meOldHp=t.hp,this.dispatcher.request("user.battle",{action:1},function(i){if(i)return void console.info(i);switch(this.itemsSound[t.itemIndex]&&this.itemsSound[t.itemIndex].play(1),this.opponent.hp=this.dispatcher.get("battle","hp"+e._id),t.itemIndex){case 0:case 1:var s=this.localToGlobal(this.item.x,this.item.y),n=this.field.globalToLocal(s.x,s.y),r=new Animation("item"+t.itemIndex);this.field.addChild(r),r.x=n.x,r.y=n.y,r.play("fly"+t.itemGrade,0),r.bezierTo(r.x+(this.enemy.x-r.x)/2,this.enemy.y-300,this.enemy.x,this.enemy.y,800,function(){if(r.scaleX=r.scaleY=1,r.play("boom"+t.itemGrade,1,function(){t.itemUsing=!1,r.parent.removeChild(r)}.bind(this)),-1!=t.itemIndex){this.target.play(e.gunName+"_leghit",1),this.updateHp();var i=this.dispatcher.get("battle","propUsed"+t._id);i&&this.item&&this.item.parent.removeChild(this.item)
}}.bind(this)),egret.Tween.get(r).to({scaleX:.1,scaleY:.1},800);break;case 2:this.item&&this.item.play("use"+t.itemGrade,1,function(){t.itemUsing=this.item.visible=!1}.bind(this)),this.me.hp=this.dispatcher.get("battle","hp"+t._id),this.updateHp()}}.bind(this)))},e.prototype.onMessage=function(){var t=this.dispatcher.get("battle");console.log(this.dispatcher.get("battle"));var e=this.me,i=this.opponent;switch(e.hp=t["hp"+e._id],i.hp=t["hp"+i._id],t.action){case 0:this.hit(t.hitIndex);break;case 1:this.itemHit(t.itemIndex,t.itemGrade)}},e.prototype.showShock=function(){if(!this.isShocking){this.isShocking=!0;var t=this.scene.y;egret.Tween.get(this.scene).to({x:50,y:t-5},20).to({x:-50,y:t+5},40).to({x:50,y:t+5},40).to({x:-50,y:t-5},40).to({x:40},40).to({x:-40},40).to({x:30},40).to({x:-30},40).to({x:0},20).call(function(){this.isShocking=!1},this)}},e.prototype.hit=function(t){var e=this.me;if(this.enemyFire.visible=!0,this.enemyFire.play("hit",1,function(){this.enemyFire.visible=!1}.bind(this)),~t){this.item&&this.item.visible&&!e.itemUsing&&this.item.play("hurt"+e.itemGrade,1,function(){this.item&&this.item.play("stand"+e.itemGrade)}.bind(this)),e.shooting||e.reloading||e.reloadActing||e.reloadFinishing||this.gun.play("hurt",1,function(){this.gun.play("stand",0)}.bind(this));for(var i,s=0;s<this.behitEffects.length;++s)if(!this.behitEffects[s].visible){i=this.behitEffects[s];break}if(i||(i=new Animation("beenhit"),this.addChild(i),this.behitEffects.push(i)),i.visible=!0,i.x=40+600*Math.random(),i.y=this.cross.y-200+400*Math.random(),i.play("hit",1,function(){i.visible=!1}),this.opponent.hp=this.dispatcher.get("battle","hp"+this.opponent._id),this.updateHp(),e.shooting)return;0==e.gunType?this.cross.play(["headhit","bodyhit","bodyhit"][t],1,function(){this.cross.play("stand",0)}.bind(this)):e.canAim&&e.aiming?this.cross.play("sniper"+["headhit","bodyhit","bodyhit"][t],1,function(){this.cross.play("sniperhold",0)}.bind(this)):this.cross.play(["headhit","bodyhit","bodyhit"][t],1,function(){this.cross.play("stand",0)}.bind(this))}},e.prototype.itemHit=function(t,e){var i=this.me;switch(console.log("受到道具效果"),this.me.hp=this.dispatcher.get("battle","hp"+i._id),console.log(i.hp),this.updateHp(),t){case 0:var s=new Animation("itemhit"+t);this.addChild(s),s.x=320,s.y=1386,s.play("boom"+e,1,function(){s.visible=!1}.bind(this)),i.shooting||(i.canAim&&i.aiming?this.cross.play("sniperbodyhit",1,function(){this.cross.play("sniperhold",0)}.bind(this)):this.cross.play("bodyhit",1,function(){this.cross.play("stand",0)}.bind(this))),this.item&&this.item.visible&&!i.itemUsing&&this.item.play("hurt"+e,1,function(){this.item&&this.item.play("stand"+e,0)}.bind(this)),i.shooting||i.reloading||i.reloadActing||i.reloadFinishing||this.gun.play("hurt",1,function(){this.gun.play("stand",0)}.bind(this));break;case 1:i.state=e,i.stateFinish=weedon.time+6e3;break;case 2:}},e.prototype.updateHp=function(){var t=this.me,e=this.opponent,i=this.oppoOldHp,s=Math.max(0,e.hp);this.oppoOldHp=s;var n=i-s,r=this.meOldHp,o=t.hp;if(this.meOldHp=o,r>o&&this.showShock(),null!=i&&i!=s){var a=new eui.BitmapLabel;0>n?a.font=RES.getRes("hp_bonus_fnt"):a.font=RES.getRes("dmg_ft_fnt"),this.enemy.addChild(a),this.damagaLabelList.push(a),a.text=0>n?"+"+n:"-"+n,a.y=this.nickname.y+20,a.x=this.nickname.x+20;var h=a.x,l=a.y;a.alpha=0,egret.Tween.get(a).to({alpha:1},200).to({x:h+40,y:l-10},100).to({x:h+60,y:l+20,alpha:0},200).call(function(){var t=this.damagaLabelList.pop();t&&t.parent.removeChild(t)},this)}this.userHpBar.setValue(t.hp),this.enemyHpBar.setValue(e.hp),(t.hp<=0||e.hp<=0)&&(this.isShocking?egret.Tween.get(this.topUI).wait(350).call(function(){this.duelFinish()},this):this.duelFinish())},e.prototype.update=function(){var t=this.me,e=this.opponent,i=weedon.time,s=i-this.startTime;if(this.startTime=i,this.field.x+=t.cursorSpeed*s*(this.targetX-this.field.x),this.scene.y+=t.cursorSpeed*s*(this.targetY-this.scene.y),t.fireInterval&&1==t.crosshairIndex)for(var n=i-t.lastFire,r=0;12>r;++r)this.cross.setSlot(""+r,n/t.fireInterval*12>r+1?this.cdBlanks[r]:this.cdItems[r]);return t.stateFinish>i?this.flour.visible||(this.flour.visible=!0,this.flour.play("boom"+t.state,1,function(){this.flour.play("stand"+t.state,0)}.bind(this))):this.flour.visible&&!t.stateFinishing&&(t.stateFinishing=!0,this.flour.play("over"+t.state,1,function(){this.flour.visible=t.stateFinishing=!1}.bind(this))),e.waiting||i<e.waitFinish||!this.startTime?!0:(e.nextX>this.enemy.x?(e.moving||(e.moving=!0,this.target.play(e.gunName+"_right",0)),this.enemy.x+=Math.min(e.moveSpeed*s,e.nextX-this.enemy.x)):(e.moving||(e.moving=!0,this.target.play(e.gunName+"_left",0)),this.enemy.x-=Math.min(e.moveSpeed*s,this.enemy.x-e.nextX)),this.enemy.x==e.nextX&&(e.moving=!1,this.target.play(e.gunName+"_stand_fire",0),e.waitFinish=i+e.restTimeBase+(Math.random()*e.restTimeRand>>0),e.nextX=(640-e.moveWidth)/2+e.moveWidth*Math.random()>>0),!0)},e}(eui.Component);__reflect(Duel.prototype,"Duel");var BattleEndDialog=function(t){function e(e,i,s){var n=t.call(this)||this;return n.mScreenHeight=e,n.skinName=BattleEndDialogSkin,n.dispatcher=i,n.closeCallBack=s,n}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bg.height=this.mScreenHeight;var e=this.dispatcher.get("user");console.log("---BattleEndDialog--"),console.log(this.dispatcher.get("itemsGot"));var i=this.dispatcher.get("itemsGot")||{};setTexture(this.leftBtn.tfImg,"wz_fhcz_png"),new Btn(this.leftBtn,function(){this.closeCallBack(-1)}.bind(this)),setTexture(this.rightBtn.tfImg,"wz_fxzj_png"),new Btn(this.rightBtn,function(){}.bind(this)),this.rewardTF.textFlow=[{text:"经验：",style:{size:24,textColor:7093780}},{text:(i.exper||0)+"     ",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}},{text:"精通：",style:{size:24,textColor:7093780}},{text:(i.gunExper||0)+"     ",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}},{text:"金币：",style:{size:24,textColor:7093780}},{text:(i.gold||0)+"     ",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}}],this.rewardTF.visible=i.exper>0,setTexture(this.img_result,"zd_tz_"+(i.exper?"ying":"shu")+"_png");var s=this.dispatcher.get("battle"),n=s.uids.split("-"),r=s["battleParams"+e._id].split("-"),o=s["battleParams"+(n[0]==e._id?n[1]:n[0])].split("-");formula.getRankInfo(e.rankLv);ActionUtils.refreshDwMc(this.dwMc1,e.rankLv||0);var a=s["nickname"+(n[0]==e._id?n[1]:n[0])];this.desTF1.textFlow=[{text:"射击：  ",style:{size:24,textColor:7093780}},{text:r[0]+"\n",style:{size:24,textColor:12154151}},{text:"命中：  ",style:{size:24,textColor:7093780}},{text:r[1]+"\n",style:{size:24,textColor:12154151}},{text:"爆头：  ",style:{size:24,textColor:7093780}},{text:r[2],style:{size:24,textColor:12154151}}],ActionUtils.refreshDwMc(this.dwMc2,this.dispatcher.get("battle","rankLv"+(n[0]==e._id?n[1]:n[0]))||0,1),this.desTF2.textFlow=[{text:"      "+a+"\n",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}},{text:"射击：  ",style:{size:24,textColor:7093780}},{text:o[0]+"\n",style:{size:24,textColor:12154151}},{text:"命中：  ",style:{size:24,textColor:7093780}},{text:o[1]+"\n",style:{size:24,textColor:12154151}},{text:"爆头：  ",style:{size:24,textColor:7093780}},{text:o[2],style:{size:24,textColor:12154151}}],this.effImg.visible=i.exper>0;var h=s["exper"+(n[0]==e._id?n[1]:n[0])]||0;this.lvTF.text="lv."+formula.getULevel(h);var l=formula.getULevel(i.experOld),c=formula.getULevel(i.experNew);c>l&&this.closeCallBack(1)},e}(eui.Component);__reflect(BattleEndDialog.prototype,"BattleEndDialog");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var ChargeDialog=function(t){function e(e,i){var s=t.call(this)||this;return s.dispatcher=i,s.mScreenHeight=e,s.skinName=ChargeDialogSkin,s}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),setTexture(this.backBtn.tfImg,"wz_fh_png"),new Btn(this.backBtn,function(){e.parent.removeChild(e)}.bind(this)),this.refreshList(),this.adjustUI()},e.prototype.refreshList=function(){this.mChargeArr=RES.getRes("avtivity_json").charge;for(var t=function(t){var i=new eui.Component;i.skinName=ChargeItemRenderSkin,setTexture(i.iconImg,"cz_dangwei_"+(t+1)+"_png"),i.diamondTF.text="钻石 X"+10*e.mChargeArr[t],setTexture(i.costImg,"cz_je_"+t+"_png"),e.list.addChild(i),i.y=150*t,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("click item "+t)},e)},e=this,i=0;i<this.mChargeArr.length;i++)t(i)},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e}(eui.Component);__reflect(ChargeDialog.prototype,"ChargeDialog");var LvupDialog=function(t){function e(e,i){var s=t.call(this)||this;return s.mScreenHeight=e,s.skinName=LvupDialogSkin,s.dispatcher=i,s.data_json=RES.getRes("data_json"),s}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.lvBF.text=formula.getULevel(this.dispatcher.get("user","experience")||0)+"",setTexture(this.okBtn.tfImg,"js_qd_png"),new Btn(this.okBtn,function(){this.parent&&this.parent.removeChild(this)}.bind(this));var e=(this.dispatcher.get("user"),this.dispatcher.get("itemsGot"));this.hpTF.visible=null!=e.hpLimitBonus,this.hpTF.visible&&(this.hpTF.text="HP上限增加："+e.hpLimitBonus),this.hpTF0.visible=null!=e.strengeBonus,this.hpTF0.visible&&(this.hpTF0.text="体力上限增加："+e.strengeBonus),this.hpTF1.visible=null!=e.strengeLimitBonus,this.hpTF1.visible&&(this.hpTF1.text="体力增加："+e.strengeLimitBonus);var i=[],s=e.gunUnLocked;if(s)for(var n=0;n<s.length;n++)i.push({index:0,num:s[n]});var r=e.propUnLocked;if(r)for(var n=0;n<r.length;n++)i.push({index:1,num:r[n]});this.groupLocked.removeChildren();for(var n=0;n<i.length;n++){var o=(i[n],i.num);if(null!=o&&""!=o){var a=i.index,h=new UnLockItem,l=o.split("-");0==a?(setTexture(h.img_prop,"weapon_s_"+ +l[0]+"_"+ +l[1]+"_png"),h.label_prop.text=this.data_json.gunsBaseNumber[o][0]):1==a&&(setTexture(h.img_prop,"prop_s_"+ +l[0]+"_"+ +l[1]+"_png"),h.label_prop.text=this.data_json.propsBaseNumber[o][0]),this.groupLocked.addChild(h),h.y=0,h.x=20+n%2*h.width+10}}},e}(eui.Component);__reflect(LvupDialog.prototype,"LvupDialog");var UnLockItem=function(t){function e(){var e=t.call(this)||this;return e.skinName=propUnLockItem,e}return __extends(e,t),e}(eui.Component);__reflect(UnLockItem.prototype,"UnLockItem");var MailDialog=function(t){function e(e,i){var s=t.call(this)||this;return s.mScreenHeight=e,s.dispatcher=i,s.skinName=MailDialogSkin,s}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),setTexture(this.backBtn.tfImg,"wz_fh_png"),new Btn(this.backBtn,function(){e.parent.removeChild(e)}.bind(this)),this.refreshList(),this.adjustUI()},e.prototype.refreshList=function(){this.numTF.text="未读邮件：  35/99",this.list.removeChildren();for(var t=function(t){var i=new eui.Component;i.skinName=MailItemRenderSkin;var s=DateUtils.getFormatTime(weedon.time);i.timeTF.text=s.Y+"/"+s.M+"/"+s.D+"   "+s.h+":"+s.m,e.list.addChild(i),i.y=115*t,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("click item "+t)},e)},e=this,i=0;10>i;i++)t(i)},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e}(eui.Component);__reflect(MailDialog.prototype,"MailDialog");var MainScene=function(t){function e(e){var i=t.call(this)||this;return i.ignoreNextResize=!1,i.target_scale=.8,i.standArray=["handgun_stand","rifle_stand","shutgun_stand","sniper_stand"],i.mIsShowPropBool=!1,i.mIsShowWeaponBool=!1,i.dispatcher=e,i.skinName=MainSceneSkin,i.dispatcher.setOverrideKey("itemsGot"),i}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.mDataJson=RES.getRes("data_json"),this.mGameConfigJson=RES.getRes("game_config_json"),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.resetPropOrWeaponScroll,this),this.clickImg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.resetPropOrWeaponScroll();var t=new SettingDialog(e.screenHeight,e.dispatcher);e.dialogGrp.addChild(t)},this),new Btn(this.chargeBtn,function(){e.resetPropOrWeaponScroll();var t=new ChargeDialog(e.screenHeight,e.dispatcher);e.dialogGrp.addChild(t)}),new Btn(this.buyTiBtn,function(){e.resetPropOrWeaponScroll();var t=new BuyTiDialog(e.screenHeight,e.dispatcher);e.dialogGrp.addChild(t)}),setTexture(this.leftBtn.tfImg,"wz_pwz_png"),new Btn(this.leftBtn,function(){e.resetPropOrWeaponScroll();try{var t=new QualifyingScene(e.screenHeight,e.dispatcher,function(t){if(1==t){navigator.vibrate&&navigator.vibrate([500]);try{this.duelBoard=new Duel(this.dispatcher,function(){try{this.showBattleRet()}catch(t){window.alert("show showBattleRet error"),window.alert(t)}}.bind(this)),this.duelGrp.addChild(this.duelBoard)}catch(e){window.alert(e)}}else-1==t&&(this.startAccelerometer(),this.dispatcher.request("user.leave",{},function(){}.bind(this)))}.bind(e));e.dialogGrp.addChild(t)}catch(i){window.alert("QualifyingScene error"),window.alert(i)}}),setTexture(this.rightBtn.tfImg,"wz_hypp_png"),new Btn(this.rightBtn,function(){e.resetPropOrWeaponScroll();var t=new MatchingScene(e.screenHeight,e.dispatcher);e.dialogGrp.addChild(t)});var i=(this.standArray,this.dispatcher.get("user","gender")),s=this.dispatcher.get("user","cap")-1e4;i=-1==i?1:i;var n=this.target=new Animation("chr"+i);n.setSlot("hat",createBitmap("zs_maozi_b0"+s+"_png",.5,.5,0,0,this.target_scale,this.target_scale)),this.personGrp.addChild(n),n.x=330,n.y=190,n.scaleX=n.scaleY=this.target_scale,setTexture(this.propBtn.tfImg,"wz_dj_png"),new Btn(this.propBtn,function(){return e.mIsShowWeaponBool&&(e.weaponScroll.visible=e.mIsShowWeaponBool=!1),e.mIsShowPropBool?void(e.propScroll.visible=e.mIsShowPropBool=!1):(e.mIsShowPropBool=!e.mIsShowPropBool,e.propScroll.visible=e.mIsShowPropBool,void(e.mIsShowPropBool&&e.showPropScroll()))}.bind(this)),setTexture(this.weaponBtn.tfImg,"wz_wq_png"),new Btn(this.weaponBtn,function(){return e.mIsShowPropBool&&(e.propScroll.visible=e.mIsShowPropBool=!1),e.mIsShowWeaponBool?void(e.weaponScroll.visible=e.mIsShowWeaponBool=!1):(e.mIsShowWeaponBool=!e.mIsShowWeaponBool,e.weaponScroll.visible=e.mIsShowWeaponBool,void(e.mIsShowWeaponBool&&e.showWeaponScroll()))}.bind(this)),setTexture(this.tabBtn1.tfImg,"wz_ck_png"),new Btn(this.tabBtn1,function(){e.resetPropOrWeaponScroll(),e.currentPage=new HouseScene(e.dispatcher,function(){this.currentPage.parent.removeChild(this.currentPage),this.refreshData()}.bind(e),e.screenHeight),e.stage.addChild(e.currentPage)}),setTexture(this.tabBtn2.tfImg,"wz_phb_png"),new Btn(this.tabBtn2,function(){e.resetPropOrWeaponScroll();var t=new RankDialog(e.screenHeight,e.dispatcher);e.dialogGrp.addChild(t)}),setTexture(this.tabBtn3.tfImg,"wz_yj_png"),new Btn(this.tabBtn3,function(){e.resetPropOrWeaponScroll();var t=new MailDialog(e.screenHeight,e.dispatcher);e.dialogGrp.addChild(t)}),setAvatar(this.headImg,this.dispatcher.get("user","avatar")||0,this.dispatcher.get("user","avatarUrl")||""),this.nameTF.text=this.dispatcher.get("user","nickname"),this.mLastGetTiTime=0==this.dispatcher.get("user","lastGetStrenge")?weedon.time:this.dispatcher.get("user","lastGetStrenge"),this.mCurrentTiNum=this.dispatcher.get("user","strenge")||0,this.mMaxTiNum=this.dispatcher.get("user","strengeLimit")||this.mGameConfigJson.userConfig.strengeMax,this.refreshData(),this.startAccelerometer(),this.stage.addEventListener(egret.Event.RESIZE,this.adjustUI,this),this.adjustUI(),egret.startTick(this.update,this)},e.prototype.adjustUI=function(){return this.ignoreNextResize?void(this.ignoreNextResize=!1):(this.ignoreNextResize=!0,weedon.winSize.width/weedon.winSize.height>.64?(this.stage.setContentSize(640,1e3),this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL,this.screenHeight=1e3,this.y=-193,this.topUI.y=-this.y,this.bottomUI.y=this.screenHeight+193-100):(this.stage.setContentSize(640,1386),this.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,this.screenHeight=640/weedon.winSize.width*weedon.winSize.height,this.y=-(1386-this.screenHeight)/2,this.topUI.y=-this.y,this.bottomUI.y=this.screenHeight-this.y-100),this.bgImg.height=this.bg.height=this.screenHeight,void(this.duelGrp.y=-this.y))},e.prototype.update=function(){this.checkTiLi()},e.prototype.refreshData=function(){this.lvTF.text="Lv."+formula.getULevel(this.dispatcher.get("user","experience")||0),this.coinTF.text=(this.dispatcher.get("user","goldAll")||0)-(this.dispatcher.get("user","goldCost")||0),this.diamondTF.text=(this.dispatcher.get("user","diamondAll")||0)-(this.dispatcher.get("user","diamondCost")||0),this.prgMc.value=this.mCurrentTiNum/this.mMaxTiNum*100,this.prgTF.text=this.mCurrentTiNum+"/"+this.mMaxTiNum;formula.getRankInfo(this.dispatcher.get("user","rankLv"));ActionUtils.refreshDwMc(this.dwMc,this.dispatcher.get("user","rankLv")||0),this.showWuPinInfo()},e.prototype.checkTiLi=function(){if(this.mCurrentTiNum>=this.mMaxTiNum)return void(this.prgCd.text="");var t=weedon.time-this.mLastGetTiTime,e=1e3*this.mGameConfigJson.userConfig.strengeInteval;t>=e&&(this.mLastGetTiTime=weedon.time,this.mCurrentTiNum++,this.prgMc.value=this.mCurrentTiNum/this.mMaxTiNum*100,this.prgTF.text=this.mCurrentTiNum+"/"+this.mMaxTiNum),this.prgCd.text=DateUtils.getDateInfoByType((e-t)/1e3/60,1)},e.prototype.showWuPinInfo=function(t){void 0===t&&(t="all"),("prop"==t||"all"==t)&&(this.mCurrentPropIndex=this.dispatcher.get("user","propIndex"),""!=this.dispatcher.get("user","propIndex")?(setTexture(this.propBtn.iconImg,"prop_s_"+this.mCurrentPropIndex.replace("-","_")+"_png"),this.propBtn.noneTF.visible=!1):(this.propBtn.iconImg.texture="",this.propBtn.noneTF.visible=!0)),("weapon"==t||"all"==t)&&(this.mCurrentWeaponIndex=this.dispatcher.get("user","gunIndex"),this.target.play(this.standArray[this.mCurrentWeaponIndex.substr(0,1)],0),this.target.setSlot("gun0",createBitmap("weapon_m_"+this.mCurrentWeaponIndex.replace("-","_")+"_png",.5,.5,0,0,this.target_scale,this.target_scale)),""!=this.dispatcher.get("user","gunIndex")?(setTexture(this.weaponBtn.iconImg,"weapon_s_"+this.mCurrentWeaponIndex.replace("-","_")+"_png"),this.weaponBtn.noneTF.visible=!1):(this.weaponBtn.iconImg.texture="",this.weaponBtn.noneTF.visible=!0))},e.prototype.showPropScroll=function(){var t=this,e=this.dispatcher.get("user","propHs"),i=0,s=106;this.propList.removeChildren();for(var n=0;n<=e.length;n++)if(0==n){var r=new eui.Component;r.skinName=MainPropListRenderSkin,r.dqImg.visible=!1,setTexture(r.bgImg,"ck_wupin_kong_png"),r.nameTF.text=r.numTF.text="",this.propList.addChild(r),r.x=i%3*s,r.y=Math.floor(i/3)*s,r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return""==t.mCurrentPropIndex?void(t.propScroll.visible=t.mIsShowPropBool=!1):void t.dispatcher.request("propHs.changeProps",{mode:1},function(e){return e?void console.log(e):(t.showWuPinInfo("prop"),void(t.propScroll.visible=t.mIsShowPropBool=!1))}.bind(t))},this),i++}else for(var o=e[n-1],a=function(e){if(o[e]>0){var r=n-1+"-"+e,a=new eui.Component;a.skinName=MainPropListRenderSkin,setTexture(a.bgImg,h.mCurrentPropIndex==r?"ck_wupin_dangqian_png":"ck_wupin_putong_png"),setTexture(a.iconImg,"prop_s_"+(n-1)+"_"+e+"_png"),a.dqImg.visible=h.mCurrentPropIndex==r,h.propList.addChild(a),a.x=i%3*s,a.y=Math.floor(i/3)*s,a.nameTF.text=h.mDataJson.propsBaseNumber[r][0],a.numTF.text=o[e],a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return t.mCurrentPropIndex==r?void(t.propScroll.visible=t.mIsShowPropBool=!1):void t.dispatcher.request("propHs.changeProps",{mode:0,propIndex:r},function(e){return e?void console.log(e):(t.showWuPinInfo("prop"),void(t.propScroll.visible=t.mIsShowPropBool=!1))}.bind(t))},h),i++}},h=this,l=0;l<o.length;l++)a(l);this.propScroll.width=3>=i?i*s:3*s,this.propScroll.height=i>9?3.5*s:9>=i?s*Math.ceil((i-.5)/3):3*s,this.propScroll.horizontalCenter=-145,this.propScroll.bottom=6},e.prototype.showWeaponScroll=function(){var t=this,e=this.dispatcher.get("user","gunHs")||[],i=0,s=106;this.weaponList.removeChildren();for(var n=0;n<e.length;n++)for(var r=e[n],o=function(e){if(r[e]>=0){var o=n+"-"+e,h=new eui.Component;h.skinName=MainPropListRenderSkin,setTexture(h.bgImg,a.mCurrentWeaponIndex==o?"ck_wupin_dangqian_png":"ck_wupin_putong_png"),setTexture(h.iconImg,"weapon_s_"+n+"_"+e+"_png"),h.dqImg.visible=a.mCurrentWeaponIndex==o,a.weaponList.addChild(h),h.x=i%3*s,h.y=Math.floor(i/3)*s,h.nameTF.text=a.mDataJson.gunsBaseNumber[o][0],h.numTF.text="",h.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return t.mCurrentWeaponIndex==o?void(t.weaponScroll.visible=t.mIsShowWeaponBool=!1):void t.dispatcher.request("propHs.changeGun",{gunIndex:o},function(e){return e?void console.log(e):(t.showWuPinInfo("weapon"),void(t.weaponScroll.visible=t.mIsShowWeaponBool=!1))}.bind(t))},a),i++}},a=this,h=0;h<r.length;h++)o(h);this.weaponScroll.width=3>=i?i*s:3*s,this.weaponScroll.height=i>9?3.5*s:9>=i?s*Math.ceil((i-.5)/3):3*s,this.weaponScroll.horizontalCenter=144,this.weaponScroll.bottom=6},e.prototype.startAccelerometer=function(){var t=this;("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).startAccelerometer({success:function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).onAccelerometerChange(function(e){var i="undefined"==typeof GameGlobal?e.x:e.y;t.grassImg.x=26+10*i,t.carImg.x=-10+100*i,t.grassImg0.x=493+100*i}.bind(t))}.bind(this)})},e.prototype.showBattleRet=function(){try{this.showBattleRetBoard=new BattleEndDialog(this.screenHeight,this.dispatcher,function(t){console.log("mode is :"+t),-1==t?(this.dialogGrp&&this.dialogGrp.removeChildren(),this.duelGrp&&this.duelGrp.removeChildren()):1==t&&(this.upDialog=new LvupDialog(this.screenHeight,this.dispatcher),this.dialogGrp.addChild(this.upDialog))}.bind(this)),this.dialogGrp.addChild(this.showBattleRetBoard)}catch(t){window.alert("showBattleRetBoard"),window.alert(t)}this.startAccelerometer(),this.refreshData()},e.prototype.resetPropOrWeaponScroll=function(){this.propScroll.visible=this.mIsShowPropBool=this.weaponScroll.visible=this.mIsShowWeaponBool=!1},e}(eui.Component);__reflect(MainScene.prototype,"MainScene");var DateUtils=function(){function t(){}return t.getFormatTime=function(t){var e=new Date(t);return{Y:e.getFullYear(),M:this.formatNumber(e.getMonth()+1),D:this.formatNumber(e.getDate()),h:this.formatNumber(e.getHours()),m:this.formatNumber(e.getMinutes()),s:this.formatNumber(e.getSeconds())}},t.getDateInfoByType=function(t,e){var i=this.formatReaminTime(t);return 1==e?this.formatNumber(i.min)+":"+this.formatNumber(i.second):void 0},t.formatReaminTime=function(t){t=Math.max(0,t);var e=Math.floor(t/1440);t-=1440*e;var i=Math.floor(t/60);t-=60*i;var s=Math.floor(t);t-=s;var n=Math.floor(60*t);return{day:e,hour:i,min:s,second:n}},t.formatNumber=function(t){return 10>t?"0"+t:t},t}();__reflect(DateUtils.prototype,"DateUtils");var ActionUtils=function(){function t(){}return t.runTFAction=function(t,e){t.text="";var i=0,s=e.length;egret.Tween.get(this,{loop:!0}).to({},200).call(function(){t.textFlow=[{text:e.substring(0,i),style:{size:30}},{text:e.substring(i,i+1),style:{size:40}},{text:e.substring(i+1),style:{size:30}}],i=i>=s-3?0:i+2})},t.runBtnAction=function(t){egret.Tween.get(t).to({scaleX:.7,scaleY:.7},100).to({scaleX:1,scaleY:1},100)},t.refreshDwMc=function(t,e,i){void 0===i&&(i=0),console.log("星"+e);for(var s=3;5>=s;s++)for(var n=1;s>=n;n++)t["star"+s+"_"+n].visible=!1;var r=formula.getRankInfo(e),o=[3,3,4,5,5,5][r.index],a=r.starNum,h=r.name;if(setTexture(t.bgImg,"sy_duanwei_0"+r.index+"_png"),6==r.index)t.star_bg6.visible=t.star6TF.visible=t.star6Img.visible=1!=i,t.star_bg.visible=!1,t.numBF.text="",t.star6TF.text="x"+a,console.log("img-"+t.star6Img.width+"-tf-"+t.star6TF.width),t.star6Img.x=95-(0+t.star6TF.width)/2,t.star6TF.x=t.star6Img.x+33;else{t.star_bg6.visible=t.star6TF.visible=t.star6Img.visible=!1,t.star_bg.visible=1!=i,t.numBF.text=[["f","ff","fff"],["h","hh","hhh"],["b","bb","bbb","bA"],["d","dd","ddd","dC","C"],["b","bb","bbb","bA","A"],["b","bb","bbb","bA","A"]][r.index][+h.substr(4,1)-1],setTexture(t.star_bg,"sy_duanwei_xing_"+o+"_png");for(var s=0;o>s;s++)t["star"+o+"_"+(s+1)].visible=a>s&&1!=i}},t}();__reflect(ActionUtils.prototype,"ActionUtils");var MatchUtils=function(){function t(){}return t.getRegularSixSidedPolygonObject=function(t,e,i,s){return void 0===s&&(s=[null,0,0,0,0,0,0]),{O:new egret.Point(t,e),A:new egret.Point(t,e-i),AA:new egret.Point(t,e-i*s[1]),B:new egret.Point(t+i*Math.sin(Math.PI/3),e-i/2),BB:new egret.Point(t+i*Math.sin(Math.PI/3)*s[2],e-i/2*s[2]),C:new egret.Point(t+i*Math.sin(Math.PI/3),e+i/2),CC:new egret.Point(t+i*Math.sin(Math.PI/3)*s[3],e+i/2*s[3]),D:new egret.Point(t,e+i),DD:new egret.Point(t,e+i*s[4]),E:new egret.Point(t-i*Math.sin(Math.PI/3),e+i/2),EE:new egret.Point(t-i*Math.sin(Math.PI/3)*s[5],e+i/2*s[5]),F:new egret.Point(t-i*Math.sin(Math.PI/3),e-i/2),FF:new egret.Point(t-i*Math.sin(Math.PI/3)*s[6],e-i/2*s[6])}},t}();__reflect(MatchUtils.prototype,"MatchUtils");var MatchingScene=function(t){function e(e,i,s){void 0===s&&(s=1);var n=t.call(this)||this;return n.mScreenHeight=e,n.dispatcher=i,n.mMode=s,n.skinName=MatchingSceneSkin,n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),setTexture(this.backBtn.tfImg,"wz_fh_png"),new Btn(this.backBtn,function(){e.parent.removeChild(e)}.bind(this)),1==this.mMode?(this.mType=1,this.leftBtn.visible=this.rightBtn.visible=!0,this.middleBtn.visible=!1,setTexture(this.leftBtn.tfImg,"zd_fqtz_png"),setTexture(this.rightBtn.tfImg,"zd_yqhy_png")):2==this.mMode&&(this.leftBtn.visible=this.rightBtn.visible=!1,this.middleBtn.visible=!0,setTexture(this.middleBtn.tfImg,"zd_fqtz_png")),new Btn(this.leftBtn,function(){e.parent.removeChild(e),console.log("即将放弃挑战")}.bind(this)),new Btn(this.rightBtn,function(){1==e.mType?(e.mType=2,setTexture(e.rightBtn.tfImg,"zd_ksdj_png"),console.log("即将邀请好友")):2==e.mType&&(console.log("即将开始比赛"),navigator.vibrate&&navigator.vibrate([500]))}.bind(this)),new Btn(this.middleBtn,function(){e.parent.removeChild(e),console.log("即将放弃挑战")}.bind(this)),this.leftMc.nameTF.text=this.dispatcher.get("user","nickname"),this.leftMc.lvTF.text="Lv."+formula.getULevel(this.dispatcher.get("user","experience")||0),this.leftMc.x=-500,this.rightMc.x=752,this.vs.visible=!1,egret.Tween.get(this.leftMc).to({x:0},500),egret.Tween.get(this.rightMc).wait(500).to({x:252},500).wait(500).call(function(){e.vs.visible=!0},this),this.adjustUI()},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e}(eui.Component);__reflect(MatchingScene.prototype,"MatchingScene");var QualifyingScene=function(t){function e(e,i,s){var n=t.call(this)||this;return n.battleStart=0,n.matching=!1,n.waitingForBattle=!1,n.mScreenHeight=e,n.skinName=QualifyingSceneSkin,n.dispatcher=i,n.callback=s,n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),setTexture(this.backBtn.tfImg,"wz_fh_png"),new Btn(this.backBtn,function(){e.parent.removeChild(e),e.callback(-1)}.bind(this));var i=new Animation("se_tip");this.grp1.addChild(i),i.play("play",0),i.x=230,i.y=320,this.desTF1.textFlow=[{text:"如何排位？\n",style:{size:30,textColor:7093780}},{text:"将手机",style:{size:24,textColor:12154151}},{text:"[倒置]",style:{size:30,textColor:7093780}},{text:"开始匹配对手。\n",style:{size:24,textColor:12154151}},{text:"提示音",style:{size:24,textColor:12154151}},{text:"[响起和震动]",style:{size:30,textColor:7093780}},{text:"匹配完成，开始战斗！",style:{size:24,textColor:12154151}}],this.tweenImg.rotation=0,egret.Tween.get(this.tweenImg,{loop:!0}).to({rotation:360},2500).call(function(){e.tweenImg.rotation=0}),this.adjustUI(),ActionUtils.runTFAction(this.desTF2,"正 在 寻 找 对 手 . . "),this.grp1.visible=!0,this.grp2.visible=!1,this.dispatcher.setPushCallback("join",this.joinOk.bind(this)),("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).startAccelerometer({success:function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).onAccelerometerChange(function(t){var e="undefined"==typeof GameGlobal?t.z:t.y;!this.motionStart&&e>=.5&&(this.motionStart=weedon.time,this.grp1.visible=!1,this.grp2.visible=!0,this.backBtn.visible=!1),this.motionStart&&.5>e&&!this.waitingForBattle&&(this.backBtn.visible=!0,this.motionStart=0,this.matching?this.dispatcher.request("user.leave",{},function(){this.matching=!1,this.grp2.visible=!1,this.grp1.visible=!0}.bind(this)):(this.grp2.visible=!1,this.grp1.visible=!0))}.bind(this)),egret.startTick(this.update,this)}.bind(this)})},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e.prototype.update=function(){return this.battleStart||this.motionStart?(!this.matching&&weedon.time-this.motionStart>3e3&&(this.matching=!0,this.dispatcher.request("user.join",{},function(){this.dispatcher.get("battle","ready")&&this.joinOk()}.bind(this))),this.battleStart&&weedon.time>=this.battleStart&&(egret.stopTick(this.update,this),this.parent.removeChild(this),this.callback(1)),!0):void 0},e.prototype.joinOk=function(){this.waitingForBattle=!0,("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).stopAccelerometer(),this.battleStart=this.dispatcher.get("battle","startTime")},e}(eui.Component);__reflect(QualifyingScene.prototype,"QualifyingScene");var RankDialog=function(t){function e(e,i){var s=t.call(this)||this;return s.mCurrentTab=1,s.mScreenHeight=e,s.dispatcher=i,s.skinName=RankDialogSkin,s}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.mOwnId=this.dispatcher.get("user","_id"),setTexture(this.backBtn.tfImg,"wz_fh_png"),new Btn(this.backBtn,function(){e.parent.removeChild(e)}.bind(this)),new Btn(this.tabBtn1,function(){1!=e.mCurrentTab&&(e.mCurrentTab=1,e.refreshList())}.bind(this)),new Btn(this.tabBtn2,function(){2!=e.mCurrentTab&&(e.mCurrentTab=2,e.refreshList())}.bind(this)),this.tabBtn1.tabTF.text="好 友 排 名",this.tabBtn2.tabTF.text="世 界 排 名",this.refreshList(),this.adjustUI()},e.prototype.refreshList=function(){var t=this;this.tabBtn1.tabTF.textColor=1==this.mCurrentTab?7093780:12154151,this.tabBtn2.tabTF.textColor=2==this.mCurrentTab?7093780:12154151;var e=this.mCurrentTab-1;console.log("请求"+e),this.dispatcher.request("user.getRankList",{mode:e},function(e){if(e)return void console.log(e);var i=t.dispatcher.get("result"),s=t.dispatcher.get("rankMe");t.updateList(i.sort(function(t,e){return t.rank-e.rank})),t.desTF.text=null!=s?"当前我的"+(1==t.mCurrentTab?"好友":"世界")+"排名"+(999==s?999:s+1):"未上榜"}.bind(this))},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e.prototype.updateList=function(t){this.scroll.stopAnimation(),this.list.removeChildren();for(var e=0;e<t.length;e++){var i=new eui.Component;i.skinName=RankItemRenderSkin,i.rankTF.text=t[e].rank+1;var s=formula.getRankInfo(t[e].user.rankLv);i.dwTF.text=s.name,i.starTF.text=s.starNum,ActionUtils.refreshDwMc(i.dwMc,t[e].user.rankLv||0,1),i.nameTF.text=t[e].user.nickname,i.lvTF.text="Lv."+formula.getULevel(t[e].user.experience),setAvatar(i.headImg,t[e].user.avater),t[e].user._id==this.mOwnId?(setTexture(i.bgImg,"ph_db_01_png"),setTexture(i.jbImg,"ph_jb_01_png")):(setTexture(i.bgImg,"ph_db_00_png"),setTexture(i.jbImg,"ph_jb_00_png"));var n=t[e].user.cap-1e4==1?1:0;
setTexture(i.mzImg,"ph_zy_0"+n+"_png"),this.list.addChild(i),i.y=120*e}this.scroll.viewport.scrollV=0,this.scroll.viewport.validateNow()},e}(eui.Component);__reflect(RankDialog.prototype,"RankDialog");var SelectDialog=function(t){function e(e,i){var s=t.call(this)||this;return s.mCurrentGenderIndex=0,s.mCurrentCapIndex=0,s.gender_scale=.5,s.dispatcher=e,s.mCb=i,s.skinName=SelectDialogSkin,s}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),setTexture(this.okBtn.tfImg,"js_qd_png"),new Btn(this.okBtn,function(){e.dispatcher.request("user.init",{gender:e.mCurrentGenderIndex,cap:e.mCurrentCapIndex},function(t){return t?void console.log(t):void(e.mCb&&e.mCb())}.bind(e))}.bind(this));var i=this.gender_1=new Animation("chr0");this.addChild(i),i.play("handgun_stand",0),i.x=this.gender1Img.x,i.y=this.gender1Img.y-30,i.scaleX=i.scaleY=this.gender_scale,i.touchEnabled=!0,i.touchChildren=!0;var s=this.gender_2=new Animation("chr1");this.addChild(s),s.play("handgun_stand",0),s.x=this.gender2Img.x,s.y=this.gender2Img.y-30,s.scaleX=s.scaleY=this.gender_scale,s.touchEnabled=!0,s.touchChildren=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0!=e.mCurrentGenderIndex&&(e.mCurrentGenderIndex=0,e.refreshCapMc())},this),s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1!=e.mCurrentGenderIndex&&(e.mCurrentGenderIndex=1,e.refreshCapMc())},this),this.refreshCapMc(),this.cap1Mc.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0!=e.mCurrentCapIndex&&(e.mCurrentCapIndex=0,e.refreshCapMc())},this),this.cap2Mc.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1!=e.mCurrentCapIndex&&(e.mCurrentCapIndex=1,e.refreshCapMc())},this),this.adjustUI()},e.prototype.adjustUI=function(){if(weedon.winSize.width/weedon.winSize.height>.64)this.stage.setContentSize(640,1e3),this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL,this.y=-193,this.screenHeight=1e3;else{this.stage.setContentSize(640,1386),this.stage.scaleMode=egret.StageScaleMode.NO_BORDER,this.scaleX=this.scaleY=Math.min(.64/(weedon.winSize.width/weedon.winSize.height),1),this.x=640*(1-this.scaleX)/2,this.y=1e3*(1-this.scaleY)/2;var t=this.x?{width:640,height:1e3}:weedon.winSize;this.screenHeight=640*t.height/t.width}this.bg.height=this.screenHeight},e.prototype.refreshCapMc=function(){this.gender1Img.visible=0==this.mCurrentGenderIndex,this.gender2Img.visible=1==this.mCurrentGenderIndex,this.cap1Mc.dqImg.visible=0==this.mCurrentCapIndex,setTexture(this.cap1Mc.bgImg,0==this.mCurrentCapIndex?"ck_wupin_dangqian_png":"ck_wupin_putong_png"),setTexture(this.cap1Mc.iconImg,"zs_maozi_s00_png"),this.cap1Mc.nameTF.text="黑帽子",this.cap1Mc.numTF.text="",this.cap2Mc.dqImg.visible=1==this.mCurrentCapIndex,setTexture(this.cap2Mc.bgImg,1==this.mCurrentCapIndex?"ck_wupin_dangqian_png":"ck_wupin_putong_png"),setTexture(this.cap2Mc.iconImg,"zs_maozi_s01_png"),this.cap2Mc.nameTF.text="白帽子",this.cap2Mc.numTF.text="",this.hatImg_1=createBitmap("zs_maozi_b0"+this.mCurrentCapIndex+"_png",.5,.5,0,0,this.gender_scale,this.gender_scale),this.gender_1.setSlot("hat",this.hatImg_1),this.hatImg_2=createBitmap("zs_maozi_b0"+this.mCurrentCapIndex+"_png",.5,.5,0,0,this.gender_scale,this.gender_scale),this.gender_2.setSlot("hat",this.hatImg_2)},e}(eui.Component);__reflect(SelectDialog.prototype,"SelectDialog");var SettingDialog=function(t){function e(e,i){var s=t.call(this)||this;return s.dispatcher=i,s.skinName=SettingDialogSkin,s}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.mDataJson=RES.getRes("data_json"),this.bg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.parent.removeChild(e)},this),this.nameTF.text=this.dispatcher.get("user","nickname")+"\n游戏ID:"+this.dispatcher.get("user","_id"),this.lvTF.text="Lv."+formula.getULevel(this.dispatcher.get("user","experience")||0),this.versionTF.text="版本号：1.0.0",setAvatar(this.headImg,this.dispatcher.get("user","avatar")||0,this.dispatcher.get("user","avatarUrl")||"");var i=formula.getRankInfo(this.dispatcher.get("user","rankLv"));this.pwTF.text=i.name,this.starTF.text=i.starNum,ActionUtils.refreshDwMc(this.dwMc,this.dispatcher.get("user","rankLv"),1),setTexture(this.shareBtn1.tfImg,"sz_fz_png"),this.shareBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ActionUtils.runBtnAction(this.shareBtn1);var t=document.createElement("input");t.setAttribute("readonly",""),t.value=this.dispatcher.get("user","_id").toString(),t.style.opacity="0",t.style.position="absolute",t.style.left="-9999px",t.style.top="-9999px",document.body.appendChild(t),t.focus(),t.select(),t.setSelectionRange(0,t.value.length),t.oncopy=function(t){console.log("您的游戏ID已成功复制到剪贴板")}.bind(this),document.execCommand("Copy"),document.body.removeChild(t)},this),setTexture(this.shareBtn2.tfImg,"sz_fx_png"),new Btn(this.shareBtn2,function(){console.log("分享2")}),this.yyMc.nameTF.text="音乐",new Btn(this.yyMc,function(){e.yyMc.okImg.visible=!e.yyMc.okImg.visible}),this.yxMc.nameTF.text="音效",new Btn(this.yxMc,function(){e.yxMc.okImg.visible=!e.yxMc.okImg.visible});var s=this.dispatcher.get("user","qualifyDt"),n=Math.max(s[0],s[1],s[2],s[3]),r=[null,0==s[5]?.01:+s[5].toFixed(4),0==n?.98:0==s[0]?.01:s[0]/n,0==n?.98:0==s[1]?.01:s[1]/n,0==n?.98:0==s[2]?.01:s[2]/n,0==n?.98:0==s[3]?.01:s[3]/n,0==s[4]?.01:+s[4].toFixed(4)],o=MatchUtils.getRegularSixSidedPolygonObject(320,730,100,r),a=new egret.Shape,h=["O","A","B","C","D","E","F"];a.graphics.lineStyle(2,11036195),a.graphics.moveTo(o[h[1]].x,o[h[1]].y);for(var l=2;l<h.length;l++)a.graphics.lineTo(o[h[l]].x,o[h[l]].y);a.graphics.lineTo(o[h[1]].x,o[h[1]].y),a.graphics.lineStyle(1,15121785);for(var l=2;l<h.length;l++)a.graphics.lineTo(o[h[0]].x,o[h[0]].y),a.graphics.lineTo(o[h[l]].x,o[h[l]].y);a.graphics.beginFill(13868898),a.graphics.moveTo(o[h[1]+h[1]].x,o[h[1]+h[1]].y);for(var l=2;l<h.length;l++)a.graphics.lineTo(o[h[l]+h[l]].x,o[h[l]+h[l]].y);a.graphics.lineTo(o[h[1]+h[1]].x,o[h[1]+h[1]].y),a.graphics.endFill(),this.addChild(a),this.ATF.textFlow=[{text:"命中率\n[",style:{size:24,textColor:7093780}},{text:(100*s[5]).toFixed(2)+"%",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}},{text:"]",style:{size:24,textColor:7093780}}],this.BTF.textFlow=[{text:"左轮胜场\n",style:{size:24,textColor:7093780}},{text:s[0]+"",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}}],this.CTF.textFlow=[{text:"步枪胜场\n",style:{size:24,textColor:7093780}},{text:s[1]+"",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}}],this.DTF.textFlow=[{text:"散弹胜场\n",style:{size:24,textColor:7093780}},{text:s[2]+"",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}}],this.ETF.textFlow=[{text:"狙击胜场\n",style:{size:24,textColor:7093780}},{text:s[3]+"",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}}],this.FTF.textFlow=[{text:"爆头率\n[",style:{size:24,textColor:7093780}},{text:(100*s[4]).toFixed(2)+"%",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}},{text:"]",style:{size:24,textColor:7093780}}],setTexture(this.mzImg,"zs_maozi_s0"+(this.dispatcher.get("user","cap")-1e4)+"_png");var c=this.getExpInfo();c.isMax?(this.lvPrg.value=100,this.expTF.text="满级"):(this.lvPrg.value=c.curExp/c.totalExp*100,this.expTF.text=c.curExp+"/"+c.totalExp)},e.prototype.getExpInfo=function(){for(var t=this.dispatcher.get("user","experience")||0,e=0,i=0;i<this.mDataJson.lvExpers.length;i++){var s=this.mDataJson.lvExpers[i];if(s>t)return e=i+1,e==this.mDataJson.lvExpers.length?{lv:e,isMax:!0}:{lv:e,isMax:!1,curExp:t-(this.mDataJson.lvExpers[i-1]||0),totalExp:s-(this.mDataJson.lvExpers[i-1]||0)}}},e}(eui.Component);__reflect(SettingDialog.prototype,"SettingDialog");var HouseScene=function(t){function e(e,i,s){var n=t.call(this)||this;return n.typeItems=[],n.target_scale=.6,n.standArray=["handgun_stand","rifle_stand","shutgun_stand","sniper_stand"],n.dispatcher=e,n.skinName=HouseSceneSkin,n.closeCallBack=i,n.screenHeight=s,n.dataJson=RES.getRes("data_json"),n.mMaxShuliandu=RES.getRes("game_config_json").buttleConfig.experGunMax,n.y=-(1386-s)/2,n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.typeNames=["武器","道具"],setTexture(this.btnBack.tfImg,"wz_fh_png"),new Btn(this.btnBack,function(){0==e.currentStatus?e.closeCallBack():1==e.currentStatus?e.refreshUi():2==e.currentStatus?e.showPropList():console.log("error")}),this.groupLeft.x=-310,this.groupRight.visible=!1,egret.Tween.get(this.groupLeft).to({x:40},200).to({x:0},50).wait(100).call(function(){e.groupRight.visible=!0,e.refreshUi(),e.adjustUi(),e.showPerson()}),this.btn_use=new Btn(this.btnUse,function(){this.useProp(this.typeIndex,this.dataBind)}.bind(this)),this.btn_buy0=new Btn(this.btnBuy0,function(){console.log(e.dataBind+"---price="+e.dataDetail[5]);var t=e.dispatcher.get("user","goldAll")-e.dispatcher.get("user","goldCost");return t<e.dataDetail[5]?void console.log("gold not enough"):void e.dispatcher.request("propHs.buyProp",{mode:0,propIndex:e.dataBind},function(t){t&&window.alert(t),console.log("success"),this.showPropDetail(this.dataBind),this.updateGold()}.bind(e))}),this.btn_buy1=new Btn(this.btnBuy1,function(){var t=e.dispatcher.get("user","diamondAll")-e.dispatcher.get("user","diamondCost");return t<e.dataDetail[6]?void console.log("diamond not enough"):void e.dispatcher.request("propHs.buyProp",{mode:1,propIndex:e.dataBind},function(t){t&&window.alert(t),console.log("success"),this.updateGold()}.bind(e))})},e.prototype.adjustUi=function(){this.btnBack.y=43+(1386-this.screenHeight)/2;var t=(1386-this.screenHeight)/4;this.btnBuy1.y=this.btnBuy0.y=804-t,this.labelBuy.y=738-t,this.line_down.y=850-t,this.btnUse.y=947-t,this.unlockLevel.y=947-t,this.diamondTF.y=1184-t,this.diamondImg.y=1176-t,this.coinTF.y=1140-t,this.coinImg.y=1132-t},e.prototype.refreshUi=function(){var t=this;this.currentStatus=0,this.groupHouse.visible=!0,this.groupHouse.removeChildren(),this.groupDetial.visible=!1,this.ck_title.text="仓 库";var e=["wq_sq_s00_png","dj_zhadan_s00_png"];this.typeItems=[];for(var i=0;i<this.typeNames.length;i++){var s=new TypeItem;this.groupHouse.addChild(s),this.typeItems.push(s),s.y=30+i*s.height+20*i,s.x=5,setTexture(s.img_type,e[i],.5,.5,1,1),s.label_type.text=this.typeNames[i],s.currentI=i,s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.typeIndex=t.target.currentI,this.showPropList()}.bind(this),this),s.visible=!1}this.typeItems[0].visible=!0,egret.Tween.get(this.typeItems[1]).to({},3e3*i,function(){t.typeItems[1].visible=!0}),this.updateGold()},e.prototype.showPropList=function(){console.log("show proplist:"+this.typeIndex),this.currentStatus=1,this.ck_title.text=0==this.typeIndex?"装 备":"道 具",this.groupHouse.visible=!0,this.groupDetial.visible=!1,this.groupHouse.removeChildren();var t=this.dispatcher.get("user");this.list=new eui.Group,this.scroller=new egret.ScrollView(this.list),this.groupHouse.addChild(this.scroller),this.scroller.y=30,this.scroller.x=5,this.scroller.width=this.list.width=320,this.scroller.height=696;for(var e=(t.gunIndex||"",0==this.typeIndex?t.gunHs||[[0,-1],[-1,-1],[-1,-1],[-1,-1]]:t.propHs||[[0,-1,-1],[-1,-1,-1],[-1,-1,-1]]),i=0,s=0;s<e.length;s++)for(var n=e[s],r=0;r<n.length;r++){var o=new PropItem;o.x=r%3*108,o.y=110*(i+Math.floor(r/3)),this.list.addChild(o);var a;0==this.typeIndex?(a=this.dataJson.gunsBaseNumber[s+"-"+r],setTexture(o.propImg,"weapon_s_"+s+"_"+r+"_png"),o.suoImg.visible=o.suoImgBg.visible=-1==e[s][r],o.iconImg.visible=this.dispatcher.get("user","gunIndex")==s+"-"+r,setTexture(o.bgImg,this.dispatcher.get("user","gunIndex")==s+"-"+r?"ck_wupin_dangqian_png":"ck_wupin_putong_png"),o.propLabel.text=o.suoImg.visible?this.dataJson.gunUnLockLevel[a[0]]+"级解锁":a[0]):1==this.typeIndex&&(a=this.dataJson.propsBaseNumber[s+"-"+r],setTexture(o.propImg,"prop_s_"+s+"_"+r+"_png"),o.suoImg.visible=o.suoImgBg.visible=-1==e[s][r],o.iconImg.visible=this.dispatcher.get("user","propIndex")==s+"-"+r,setTexture(o.bgImg,this.dispatcher.get("user","propIndex")==s+"-"+r?"ck_wupin_dangqian_png":"ck_wupin_putong_png"),o.propLabel.text=o.suoImg.visible?this.dataJson.propUnLockLevel[a[0]]+"级解锁":a[0]);var h=s+"-"+r;o.currentI=h,o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.showPropDetail(t.target.currentI)}.bind(this),this),r==n.length-1&&(i+=Math.ceil(r/3))}},e.prototype.showPropDetail=function(t){if(console.log("---"),this.adjustUi(),this.refreshPreson(5),this.dataBind=t,console.log("show detail :"+t),this.unlockLevel.visible=!1,this.currentStatus=2,this.ck_title.text="详 情",this.groupHouse.visible=!1,this.groupDetial.visible=!0,this.btnUse.visible=!1,this.experTitle.visible=this.experValue.visible=0==this.typeIndex,this.btnBuy0.visible=this.btnBuy1.visible=this.labelBuy.visible=!1,0==this.typeIndex){var e=this.dataJson.gunsBaseNumber[t];this.dataDetail=e,this.propTitle.text=e[0],this.propDes.text=e[7];var i=["伤害","弹夹","精度","射速"];this.attrGroup.removeChildren();for(var s=0;s<i.length;s++){var n=new AttrItem;this.attrGroup.addChild(n),n.y=(20+n.height)*s,n.label_k.text=i[s],n.label_v.text=e[s+2]+""}var r=this.dispatcher.get("user","gunHs")||[[0,-1],[-1,-1],[-1,-1],[-1,-1]],o=e[1].split("-");setTexture(this.propIcon,"weapon_l_"+ +o[0]+"_"+ +o[1]+"_png");var a=r[+o[0]][+o[1]];this.experValue.visible&&(this.experValue.text=(-1==a?0:a)+"/"+this.mMaxShuliandu),this.btnUse.visible=-1!=a,this.unlockLevel.visible=!this.btnUse.visible,this.unlockLevel.visible&&(this.unlockLevel.text=this.dataJson.gunUnLockLevel[e[0]]+"级解锁"),this.btnUse.touchEnabled=this.dispatcher.get("user","gunIndex")!=t,setTexture(this.btnUse.bgImg,this.dispatcher.get("user","gunIndex")!=t?"ck_anniu_zhuangbei_png":"ck_anniu_yizhuangbei_png"),setTexture(this.btnUse.tfImg,this.dispatcher.get("user","gunIndex")!=t?"wz_zb_png":"wz_yzb_png")}else if(1==this.typeIndex){var e=this.dataJson.propsBaseNumber[t];this.dataBind=t,this.dataDetail=e,this.propTitle.text=e[0],this.attrGroup.removeChildren(),this.propDes.text=e[7];var h=this.dispatcher.get("user","propHs")||[[0,-1,-1],[-1,-1,-1],[-1,-1,-1]],l=e[1],o=l.split("-");setTexture(this.propIcon,"prop_l_"+ +o[0]+"_"+ +o[1]+"_png");var c=h[+o[0]][+o[1]];console.log(c),this.btnBuy0.visible=this.btnBuy1.visible=this.labelBuy.visible=-1!=h[+o[0]][+o[1]],this.btnUse.visible=c>0,this.unlockLevel.visible=-1==c,this.unlockLevel.visible&&(this.unlockLevel.text=this.dataJson.propUnLockLevel[e[0]]+"级解锁"),this.btnBuy0.visible&&(setTexture(this.btnBuy0.img_left,"sy_jinbi_png"),this.btnBuy0.label_right.text=e[5]+"",setTexture(this.btnBuy1.img_left,"sy_zuanshi_png"),this.btnBuy1.label_right.text=e[6]+""),this.btnUse.touchEnabled=this.dispatcher.get("user","propIndex")!=t,setTexture(this.btnUse.bgImg,this.dispatcher.get("user","propIndex")!=t?"ck_anniu_zhuangbei_png":"ck_anniu_yizhuangbei_png"),setTexture(this.btnUse.tfImg,this.dispatcher.get("user","propIndex")!=t?"wz_zb_png":"wz_yzb_png")}},e.prototype.updateGold=function(){var t=this.dispatcher.get("user","goldAll")||0,e=this.dispatcher.get("user","goldCost")||0,i=this.dispatcher.get("user","diamondAll")||0,s=this.dispatcher.get("user","diamondCost")||0;this.coinTF.text=t-e+"",this.diamondTF.text=i-s+""},e.prototype.useProp=function(t,e){0==this.typeIndex?this.dispatcher.request("propHs.changeGun",{gunIndex:e},function(t){t&&window.alert(t);this.dispatcher.get("user");console.log("change gun` success"),this.refreshPreson(4),this.showPropDetail(e)}.bind(this)):1==this.typeIndex&&this.dispatcher.request("propHs.changeProps",{mode:0,propIndex:e},function(t){t&&window.alert(t);this.dispatcher.get("user");console.log("change gun success"),this.showPropDetail(e)}.bind(this))},e.prototype.showPerson=function(){var t=this.dispatcher.get("user","gender"),e=this.dispatcher.get("user","cap")-1e4;t=-1==t?1:t;var i=this.target=new Animation("chr"+t);i.setSlot("hat",createBitmap("zs_maozi_b0"+e+"_png",.5,.5,0,0,this.target_scale,this.target_scale)),this.groupLeft.addChild(i),i.x=this.coinImg.x+80,i.y=this.coinImg.y-100,i.scaleX=i.scaleY=this.target_scale,this.refreshPreson(3)},e.prototype.refreshPreson=function(t){console.log("刷新 换枪 一次,当前 logIndex"+t);var e=this.dispatcher.get("user","gunIndex");this.target.x=this.coinImg.x+80,this.target.y=this.coinImg.y-100,this.target.play(this.standArray[e.substr(0,1)],0),this.target.setSlot("gun0",createBitmap("weapon_m_"+e.replace("-","_")+"_png",.5,.5,0,0,this.target_scale,this.target_scale))},e}(eui.Component);__reflect(HouseScene.prototype,"HouseScene");var TypeItem=function(t){function e(){var e=t.call(this)||this;return e.skinName=CKBtnMulu,e}return __extends(e,t),e}(eui.Button);__reflect(TypeItem.prototype,"TypeItem");var PropItem=function(t){function e(){var e=t.call(this)||this;return e.skinName=HouseItem,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.touchEnabled=!0,this.bgImg.touchEnabled=this.iconImg.touchEnabled=this.propImg.touchEnabled=this.propLabel.touchEnabled=this.suoImg.touchEnabled=this.suoImgBg.touchEnabled=!1},e}(eui.Component);__reflect(PropItem.prototype,"PropItem");var AttrItem=function(t){function e(){var e=t.call(this)||this;return e.skinName=GunAttrItem,e}return __extends(e,t),e}(eui.Component);__reflect(AttrItem.prototype,"AttrItem");