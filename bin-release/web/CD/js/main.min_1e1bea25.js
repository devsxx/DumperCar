function createBitmap(t,e,i,s,n,a,r,h){var o=new egret.Bitmap,l=new AssetAdapter;return l.getAsset(t,function(l){o.texture=RES.getRes(t),o.anchorOffsetX=e>2?e:(e||0)*o.width,o.anchorOffsetY=i>2?i:(i||0)*o.height,o.x=s||0,o.y=n||0,o.scaleX=a||1,o.scaleY=r||1,h&&h(o)},this),o}function setTexture(t,e,i,s,n,a,r){i=i||t.anchorOffsetX/t.width,s=s||t.anchorOffsetY/t.height,t.scaleX=void 0===n?1:n,t.scaleY=void 0===a?1:a;var h=new AssetAdapter;t.texture=null,h.getAsset(e,function(n){t.texture=RES.getRes(e),t.anchorOffsetX=(i||0)*t.width,t.anchorOffsetY=(s||0)*t.height,r&&r()},this)}function getNumberString(t){var e,i;if(0===+t||+t){var s=""+Math.floor(t);if(1e3>t)return s;var n=Math.floor(Math.log(t)/Math.log(10)+1e-6);e=~s.indexOf("e")?+s.split("e")[0]*Math.pow(10,n%3):+s.slice(0,n%3+3)/100,i=n/3>>0}else{if(t=t.split("exp"),+t[1]<3)return Math.round(t[0]*Math.pow(10,t[1]))+"";for(e=t[0]*Math.pow(10,t[1]%3);e>1e3;)e/=1e3,t[1]=+t[1]+3;i=t[1]/3>>0}var a;if(4>i)a=["","K","M","B"][i];else{var r=(i-4)/26>>0,h=r/26>>0,o=(i-4)%26,l="abcdefghijklmnopqrstuvwxyz",d=l.toUpperCase();a=(2>h?l:d)[r%26]+(h%2?d:l)[o]}return e.toFixed(10>e?2:100>e?1:0)+a}function setAvatar(t,e,i,s){if(!e)return t.texture=null,void(s&&s());var n=t.width,a=t.height;if(i=i||("undefined"==typeof GameGlobal&&~location.hostname.indexOf("h5.")?"https://xbwz-gm.hortor.net/avatar/":DEBUG_MODE?"http://192.168.1.63:9602/avatar/":"https://xbwz-gm.hortor.net/avatar/")+e+"/avatar.jpg",avatars[e]){var r=new egret.Texture;r.bitmapData=avatars[e],t.texture=r,t.width=n,t.height=a,s&&s()}else{var h=new egret.ImageLoader;h.crossOrigin="anonymous",h.once(egret.Event.COMPLETE,function(i){var r=new egret.Texture;avatars[e]=r.bitmapData=h.data,t.texture=r,t.width=n,t.height=a,s&&s()},this),h.load(i)}}function setQRCode(t,e,i){var s=t.width,n=t.height,a=("undefined"==typeof GameGlobal&&~location.hostname.indexOf("h5game.")?"http://s1.wc.weedon.cn:9602/qrcode/":"https://gsbxs.hortor.net:9602/qrcode/")+e;if(qrcodes[e])t.width=s,t.height=n,i();else{var r=new egret.ImageLoader;r.crossOrigin="anonymous",r.once(egret.Event.COMPLETE,function(e){t.width=s,t.height=n,i()},this),r.load(a)}}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))(function(n,a){function r(t){try{o(s.next(t))}catch(e){a(e)}}function h(t){try{o(s["throw"](t))}catch(e){a(e)}}function o(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(r,h)}o((s=s.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return s([t,e])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(r=a[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(a,i[1])).done)return r;switch(a=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(r=o.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(s){i=[6,s],a=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,a,r,h,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return h={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h},ChargeDialog=function(t){function e(e,i){var s=t.call(this)||this;return s.dispatcher=i,s.mScreenHeight=e,s.skinName=ChargeDialogSkin,s}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),new Btn(this.backBtn,function(){e.parent.removeChild(e)}.bind(this)),this.refreshList(),this.adjustUI()},e.prototype.refreshList=function(){this.mChargeArr=RES.getRes("activity_json").charge;for(var t=function(t){var i=new eui.Component;i.skinName=ChargeItemRenderSkin,setTexture(i.iconImg,"cz_dangwei_"+(t+1)+"_png"),i.diamondTF.text="钻石 X"+10*e.mChargeArr[t],setTexture(i.costImg,"cz_je_"+t+"_png"),e.list.addChild(i);var s=new Animation("se_shining");i.addChild(s),s.x=96,s.y=69,s.play("stand",0),i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.y=i.height/2+150*t,i.x=i.width/2,new Btn(i,function(){console.log("click item "+t)},null,!0)},e=this,i=0;i<this.mChargeArr.length;i++)t(i)},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e}(eui.Component);__reflect(ChargeDialog.prototype,"ChargeDialog");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function s(s){e.call(i,s,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?s(n):RES.getResAsync(t,s,this)}else RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var _wx;!function(){function t(t){e&&e({x:+Math.sin(t.gamma/180*Math.PI).toFixed(5),y:t.alpha,z:+Math.sin(-t.beta/180*Math.PI).toFixed(5)})}var e=null;_wx={},Object.defineProperties(_wx,{startAccelerometer:{value:function(e){window.addEventListener("deviceorientation",t,!0),e.success&&e.success()}},onAccelerometerChange:{value:function(t){e=t}},stopAccelerometer:{value:function(e){window.removeEventListener("deviceorientation",t,!0),e&&e.complete&&e.complete()}}})}();var DEBUG_MODE=!1,CAN_FRIEND_BATTLE=!0,version="1.0.16",Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.MUTE_SE=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},RES.getRealURL=function(t){return"undefined"!=typeof GameGlobal?(DEBUG_MODE?"http://192.168.1.63:3000/":"https://xbwz-resource.hortor.net/")+t+"?v="+version:t+"?v="+version};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,5,,6]),this.loadingView?[3,3]:[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:i.sent(),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),i.label=3;case 3:return[4,RES.loadGroup(t||"preload",0,this.loadingView)];case 4:return i.sent(),[3,6];case 5:return e=i.sent(),console.error(e),[3,6];case 6:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var s=new eui.Theme("resource/default.thm.json",t.stage);s.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){return formula.init(RES.getRes("data_json"),RES.getRes("game_config_json")),t=weedon.config(DEBUG_MODE?"undefined"!=typeof GameGlobal?"192.168.1.10":"undefined"==typeof location||~location.hostname.indexOf(".h5")?"":location.hostname:"",9601,"ws",function(){},"undefined"!=typeof GameGlobal&&!DEBUG_MODE||"https:"==location.protocol||~location.href.indexOf("h5.")?"wss://xbwz.hortor.net":null),e=egret.localStorage.getItem("CM#OPENID"),e||(e=Math.random().toString(),egret.localStorage.setItem("CM#OPENID",e)),weedon.getLoginData(function(e,i){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(s){return t.request("user.login",{loginData:i},function(i){return __awaiter(e,void 0,void 0,function(){var e,s,n,a,r,h,r,r,o=this;return __generator(this,function(l){switch(l.label){case 0:return i?[2,alert(i.errmsg||"登录失败")]:(e=t.get("user","userSetting")||0,MUTE_SE=0==(2&e),t.heartbeat(5e3,function(){}),weedon.initChannelConfig({inviter:t.get("user","_id"),nickname:t.get("user","nickname"),wxGame:{}},function(e){var i=t.getCache("shareCallback");i&&i(e||0)},function(e){var i=t.getCache("payCallback");i&&i(e||0)}),s=t.get("user","cap"),n=-1===s||void 0===s,a=t.get("info","action"),0!==a?[3,1]:(r=new MainScene(t),this.addChild(r),[3,4]));case 1:return n?[4,this.loadResource("login")]:[3,3];case 2:return l.sent(),h=new SelectScene(t,function(){var e=this;h.parent&&h.parent.removeChild(h);var i=new Duel(t,function(){var i=new MainScene(t);e.addChild(i)}.bind(this));this.addChild(i)}.bind(this)),this.addChild(h),[3,4];case 3:0==(t.get("user","guide")||0)?(r=new Duel(t,function(){var e=new MainScene(t);o.addChild(e)}.bind(this)),this.addChild(r)):(r=new MainScene(t),this.addChild(r)),l.label=4;case 4:return this.stage.removeChild(this.loadingView),[2]}})})}.bind(this)),[2]})})}.bind(this)),[2]})})},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,s){function n(t){e.call(s,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),i.call(s))}"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(s,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var AlertBoard=function(t){function e(){var e=t.call(this)||this;return e.skinName=AlertBoardSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.rect.touchEnabled=!0,this.rect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeSelf,this),this.btnSure.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeSelf,this)},e.prototype.setInfo=function(t){this.labelInfo.text=t},e.prototype.closeSelf=function(){this.visible&&this.parent&&this.parent.removeChild(this)},e}(eui.Component);__reflect(AlertBoard.prototype,"AlertBoard");var Animation=function(t){function e(e,i,s,n,a){var r=t.call(this)||this;r.onTop=1,r.debug=!1,r.multiSound=!1,r.spd=1,r.slots={},r.sounds={},r.frameEvents={},r.playIndexes={},r.touchEnabled=!1,r.eventCallback=n;var h=new AssetAdapter,o=3;return[e+"_ske_json",e+"_tex_json",e+"_tex_png"].forEach(function(t){h.getAsset(t,function(){if(!--o){var t=new dragonBones.EgretFactory;t.parseDragonBonesData(RES.getRes(e+"_ske_json")),t.parseTextureAtlasData(RES.getRes(e+"_tex_json"),RES.getRes(e+"_tex_png"));var n=this.display=t.buildArmatureDisplay(i||e);this.addChild(n),n.touchEnabled=!1,n.armature.eventDispatcher.addDBEventListener(dragonBones.Event.LOOP_COMPLETE,function(){if(this.callback){var t=this.callback;this.callback=null,t()}else s&&s()},this),n.armature.eventDispatcher.addDBEventListener(dragonBones.Event.BONE_FRAME_EVENT,this.frameListener,this),n.armature.eventDispatcher.addDBEventListener(dragonBones.SoundEvent.SOUND_EVENT,this.soundListener,this),this.animationName&&n.animation.play(this.animationName,this.loop);for(var r in this.slots){var h=n.armature.getSlot(r),l=h.getDisplay();this.slots[r].x=l.x,this.slots[r].y=l.y,h.setDisplay(this.slots[r]),delete this.slots[r]}n.animation.timeScale=this.spd,a&&a(n)}},this)}.bind(r)),r}return __extends(e,t),e.prototype.frameListener=function(t){this.frameEvents[t.frameLabel]?this.frameEvents[t.frameLabel](t):this.eventCallback&&this.eventCallback(t.frameLabel)},e.prototype.soundListener=function(t){MUTE_SE||(this.sounds[t.frameLabel]&&!this.multiSound?this.sounds[t.frameLabel].play(1):(this.playIndexes[t.frameLabel]=this.playIndexes[t.frameLabel]||0,this.sounds[t.frameLabel]=new Sound(1,t.frameLabel.split(".")[0]+(this.playIndexes[t.frameLabel]?"_":""),function(t){t.play(1,function(){t.stop()})}),this.playIndexes[t.frameLabel]=1-this.playIndexes[t.frameLabel]))},e.prototype.clearListeners=function(){this.display.armature.eventDispatcher.removeDBEventListener(dragonBones.Event.BONE_FRAME_EVENT,this.frameListener,this),this.display.armature.eventDispatcher.removeDBEventListener(dragonBones.SoundEvent.SOUND_EVENT,this.soundListener,this)},e.prototype.getSlotDisplay=function(t){return this.display?this.display.armature.getSlot(t).getDisplay():null},e.prototype.play=function(t,e,i){this.debug&&console.log(t),this.animationName=t,this.loop=e,this.display&&this.display.animation.play(t,e),this.callback=i||this.callback},e.prototype.setSlot=function(t,e){if(this.display){var i=this.display.armature.getSlot(t).getDisplay();if(!i)return;e.x=i.x,e.y=i.y,e.rotation=i.rotation,this.display.armature.getSlot(t).setDisplay(e)}else this.slots[t]=e},e.prototype.setEvent=function(t,e){this.frameEvents[t]=e},e.prototype.setSpeed=function(t){this.display?this.display.animation.timeScale=t:this.spd=t},e.prototype.hitCheck=function(t,e,i){var s=this.display.globalToLocal(t,e);if(i){var n=this.display.armature.getSlot(i);return n?n.containsPoint(s.x,s.y):!1}return!!this.display.armature.containsPoint(s.x,s.y)},Object.defineProperty(e.prototype,"_factor",{get:function(){return 0},set:function(t){this.x=(1-t)*(1-t)*this.originX+2*t*(1-t)*this.terminalX+t*t*this.targetX,this.y=(1-t)*(1-t)*this.originY+2*t*(1-t)*this.terminalY+t*t*this.targetY},enumerable:!0,configurable:!0}),e.prototype.bezierTo=function(t,e,i,s,n,a){this.originX=this.x,this.originY=this.y,this.terminalX=t,this.terminalY=e,this.targetX=i,this.targetY=s,egret.Tween.get(this).to({_factor:1},n).call(a)},e}(eui.Group);__reflect(Animation.prototype,"Animation");var Btn=function(t){function e(e,i,s,n){var a=t.call(this)||this;return a.isEnabled=!0,a.canceled=!1,a.noBouncing=!1,a.changeSizeOnTap=!1,a.changeSizeOnTap=n||!1,a.btnNode=e,a.touchNode=new eui.Group,a.touchNode.touchThrough=!1,e.parent.addChildAt(a.touchNode,e.parent.getChildIndex(e)+1),e.pixelHitTest=!1,a.touchNode.x=e.x,a.touchNode.y=e.y,a.touchNode.width=e.width,a.touchNode.height=e.height,a.touchNode.anchorOffsetX=e.anchorOffsetX,a.touchNode.anchorOffsetY=e.anchorOffsetY,a.callback=i,a.originScaleX=e.scaleX,a.originScaleY=e.scaleY,[a.btnNode,a.touchNode].forEach(function(t){t.touchEnabled=!0,!this.changeSizeOnTap&&t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegan,this),this.changeSizeOnTap&&t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchBegan,this)}.bind(a)),a.showRedDot(s),a}return __extends(e,t),e.prototype.showRedDot=function(t,e){return this.touchNode.visible=this.btnNode.visible,this.touchNode.x=this.btnNode.x,this.touchNode.y=this.btnNode.y,t?void(this.redDot?(this.redDot.visible=!0,e||(this.redDot.x=this.btnNode.x+t[0],this.redDot.y=this.btnNode.y+t[1])):t&&(this.redDot=createBitmap("common_hong_png",.5,.5,0,0,1,1,function(e){e.x=this.btnNode.x+t[0],e.y=this.btnNode.y+t[1],egret.Tween.get(e,{loop:!0}).to({y:this.btnNode.y+t[1]-8.5},200,egret.Ease.sineIn).to({y:this.btnNode.y+t[1]},500,egret.Ease.bounceOut).wait(3e3)}.bind(this)),this.btnNode.parent.addChildAt(this.redDot,this.btnNode.parent.getChildIndex(this.btnNode)+1))):void(this.redDot&&(this.redDot.visible=!1))},e.prototype.setOriginScale=function(t,e){this.originScaleX=t,this.originScaleY=e},e.prototype.touchBegan=function(t){return!this.isEnabled||this.canceled?void(this.canceled=!1):(this.noBouncing?this.callback():(egret.Tween.removeTweens(this.btnNode),this.btnNode.scaleX=this.originScaleX,this.btnNode.scaleY=this.originScaleY,egret.Tween.get(this.btnNode).to({scaleX:.7*this.originScaleX,scaleY:.7*this.originScaleY},100).to({scaleX:1*this.originScaleX,scaleY:1*this.originScaleY},100).call(function(){this.callback()},this)),void t.stopPropagation())},e.prototype.touchMoved=function(t){this.isEnabled&&(this.canceled=!0,egret.Tween.removeTweens(this.btnNode),this.btnNode.scaleX=this.originScaleX,this.btnNode.scaleY=this.originScaleY,t.stopPropagation())},e.prototype.touchEnded=function(t){this.isEnabled&&(!this.canceled&&this.callback(),this.canceled=!1,t.stopPropagation())},e.prototype.setEnabled=function(t,e){this.isEnabled=t,this.btnNode.filters=t||e?[]:[new egret.ColorMatrixFilter([.4,.7,0,0,0,.4,.7,0,0,0,.4,.7,0,0,0,0,0,0,1,0])]},e.prototype.trigger=function(){this.callback()},e}(egret.DisplayObjectContainer);__reflect(Btn.prototype,"Btn");var Dispatcher=function(){function t(t){this._dispatcher=t}return t.prototype.heartbeat=function(t,e){this._dispatcher.heartbeat(t,e)},t.prototype.request=function(t,e,i,s){this._dispatcher.request(t,e,i,s)},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._dispatcher.get.apply(this._dispatcher,t)},t.prototype.getOld=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._dispatcher.getOld.apply(this._dispatcher,t)},t.prototype.getNew=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._dispatcher.getNew.apply(this._dispatcher,t)},t.prototype.safeGetNew=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._dispatcher.safeGetNew.apply(this._dispatcher,t)},t.prototype.setCache=function(t,e){this._dispatcher.setCache(t,e)},t.prototype.getCache=function(t){return this._dispatcher.getCache(t)},t.prototype.clearCache=function(){this._dispatcher.clearCache()},Object.defineProperty(t.prototype,"waitFunc",{set:function(t){this._dispatcher.waitFunc=t},enumerable:!0,configurable:!0}),t.prototype.setOverrideKey=function(t){this._dispatcher.setOverrideKey(t)},t.prototype.setPushCallback=function(t,e){this._dispatcher.setPushCallback(t,e)},t}();__reflect(Dispatcher.prototype,"Dispatcher");var HpBar=function(t){function e(e,i,s,n){var a=t.call(this)||this;return a.loadIndex=0,a.imgNames=[],a.bars=[],a.lastUpdate=0,a.imgNames=[e,i,s,n],a.loadImg(),egret.startTick(a.update,a),a}return __extends(e,t),e.prototype.loadImg=function(){this.imgNames[this.loadIndex]&&createBitmap(this.imgNames[this.loadIndex],.5,.5,0,0,1,1,function(t){this.addChild(t),t.visible=this.loadIndex<2,this.loadIndex&&this.bars.push(t),++this.loadIndex,this.loadImg()}.bind(this))},e.prototype.showTag=function(t,e,i,s){this.tag||(this.tag=new egret.TextField,this.addChild(this.tag)),this.tag.text=this.showValue+"/"+this.maxValue,this.tag.size=t,this.tag.textColor=e,i&&(this.tag.stroke=i,this.tag.strokeColor=s),this.tag.anchorOffsetX=this.tag.width/2,this.tag.anchorOffsetY=this.tag.height/2},e.prototype.setMaxValue=function(t){this.maxValue=t,this.currentValue?this.setValue(Math.min(this.maxValue,this.currentValue)):this.currentValue=this.showValue=this.maxValue},e.prototype.setValue=function(t){t<this.showValue?this.bars[2]&&(this.bars[2].visible=!0,this.bars[2].mask=new egret.Rectangle(t/this.maxValue*this.bars[2].width,0,(this.showValue-t)/this.maxValue*this.bars[2].width,this.bars[2].height)):this.bars[1]&&(this.bars[1].visible=!0,this.bars[1].mask=new egret.Rectangle(this.showValue/this.maxValue*this.bars[2].width,0,(t-this.showValue)/this.maxValue*this.bars[2].width,this.bars[2].height)),this.currentValue=Math.max(0,Math.min(t,this.maxValue)),this.bars[0]&&(this.bars[0].mask=new egret.Rectangle(0,0,this.currentValue/this.maxValue*this.bars[0].width,this.bars[0].height)),this.lastUpdate=weedon.time},e.prototype.update=function(){if(this.showValue==this.currentValue)return this.bars[1]&&(this.bars[1].visible=!1),this.bars[2]&&(this.bars[2].visible=!1),!1;var t=weedon.time;return t-this.lastUpdate>0&&(this.showValue<this.currentValue?(this.showValue=Math.min(this.currentValue,this.showValue+.01*(t-this.lastUpdate-0))>>0,this.bars[1]&&(this.bars[1].mask=new egret.Rectangle(this.showValue/this.maxValue*this.bars[2].width,0,(this.currentValue-this.showValue)/this.maxValue*this.bars[2].width,this.bars[2].height))):(this.showValue=Math.max(this.currentValue,this.showValue-.01*(t-this.lastUpdate-0))>>0,this.bars[1]&&(this.bars[2].mask=new egret.Rectangle(this.currentValue/this.maxValue*this.bars[2].width,0,(this.showValue-this.currentValue)/this.maxValue*this.bars[2].width,this.bars[2].height)))),this.tag&&(this.tag.text=this.showValue+"/"+this.maxValue,this.tag.anchorOffsetX=this.tag.width/2,this.tag.anchorOffsetY=this.tag.height/2),!0},e}(egret.DisplayObjectContainer);__reflect(HpBar.prototype,"HpBar");var RedPoint=function(t){function e(){var e=t.call(this)||this;return e.skinName=RedPointSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.setNumber=function(t){this.number.text=""+t},e}(eui.Component);__reflect(RedPoint.prototype,"RedPoint");var RemindBoard=function(t){function e(){var e=t.call(this)||this;return e.skinName=RemindSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.rect.touchEnabled=!0,this.rect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeSelf,this),new Btn(this.btnRight,function(){e.closeSelf()}),new Btn(this.btnMiddle,function(){e.sureCallback&&e.sureCallback(),e.closeSelf()}),new Btn(this.btnLeft,function(){e.sureCallback&&e.sureCallback(),e.closeSelf()}),setTexture(this.btnLeft.tfImg,"new_tf_queding_png"),setTexture(this.btnMiddle.tfImg,"new_tf_queding_png"),setTexture(this.btnRight.tfImg,"quxiao_png")},e.prototype.setInfo=function(t,e,i){this.btnMiddle.visible=1==t,this.btnLeft.visible=this.btnRight.visible=!this.btnMiddle.visible,i&&(this.sureCallback=i),this.labelInfo.text=e},e.prototype.closeSelf=function(){this.visible&&this.parent&&this.parent.removeChild(this)},e}(eui.Component);__reflect(RemindBoard.prototype,"RemindBoard");var ShareImage=function(t){function e(e,i){var s=t.call(this)||this;return s.canvas=wx.createCanvas(),s.canvas.width=e,s.canvas.height=i,s.ctx=s.canvas.getContext("2d"),s}return __extends(e,t),e.prototype.addLabel=function(t,e,i,s,n,a,r,h,o,l){this.ctx.font=(e||20)+"px Arial"+(l?" bold":""),this.ctx.fillStyle="#"+("000000"+i.toString(16)).slice(-6);var d=this.ctx.measureText(t).width;this.ctx.fillText(t,s-d*a,n-e*r),h&&(this.ctx.lineWidth=h,this.ctx.strokeStyle="#"+("000000"+o.toString(16)).slice(-6),this.ctx.strokeText(t,s-d*a,n-e*r))},e.prototype.addImage=function(t,e,i,s,n,a,r,h){return __awaiter(this,void 0,void 0,function(){var h;return __generator(this,function(o){return h=this.ctx,[2,new Promise(function(o,l){var d=wx.createImage();d.src=t,d.onload=function(){h.drawImage(d,0,0,d.width,d.height,s-d.width*e*a,n-d.height*i*r,d.width*a,d.height*r),o()}})]})})},e.prototype.saveToFile=function(t){return this.canvas.toTempFilePathSync({x:t.x,y:t.y,width:t.width,height:t.height,destWidth:t.width,destHeight:t.height})},e}(egret.DisplayObjectContainer);__reflect(ShareImage.prototype,"ShareImage");var MUTE_SE=!1,_sounds={},Sound=function(){function t(t,e,i,s){if(this.playing=!1,_sounds[e])this.sound=_sounds[e],i(this);else{var n=new egret.Sound;n.load(("undefined"!=typeof GameGlobal?DEBUG_MODE?"http://192.168.1.63:3000/":"https://xbwz-resource.hortor.net/":"")+"resource/assets/sound/"+e+(s||".mp3")+"?v="+version),n.addEventListener(egret.Event.COMPLETE,function(){this.sound=_sounds[e]=n,i(this)},this),this.mode=t}}return t.prototype.play=function(t,e){if(!(this.playing||!this.sound||this.mode&&MUTE_SE)){this.playing=!0;var i=this.channel=this.sound.play(0,t||0===t?t:1);i.addEventListener(egret.Event.SOUND_COMPLETE,function(){e&&e(),this.playing=!1},this)}},t.prototype.stop=function(){this.playing&&(this.playing=!1,this.channel&&this.channel.stop())},t}();__reflect(Sound.prototype,"Sound");var avatars={},qrcodes={},User=function(){function t(){this.shooting=!1,this.reloading=!1,this.reloadActing=!1,this.reloadFinishing=!1,this.itemUsing=!1,this.itemUsed=!1,this.canAim=!1,this.aiming=!1,this.aimed=!1,this.touching=!1,this.stateFinishing=!1,this.cursorSpeed=.01,this.cursorMode=0,this.lastFire=0,this.fireInterval=1200,this.gunLevelMax=!1}return t}();__reflect(User.prototype,"User");var Opponent=function(){function t(){this.moving=!1,this.moveSpeed=.2,this.restTimeBase=1e3,this.restTimeRand=1e3,this.moveWidth=440,this.waitFinish=0,this.nextX=0,this.waiting=!1,this.lastFire=0,this.itemPower=20,this.itemUsed=!1,this.gunLevelMax=!1}return t}();__reflect(Opponent.prototype,"Opponent");var Duel=function(t){function e(e,i,s){var n=t.call(this)||this;return n.targetX=0,n.targetY=0,n.mode=0,n.hitEffects=[],n.behitEffects=[],n.nohitEffects=[],n.cdItems=[],n.cdBlanks=[],n.guideStep=0,n.aimTargets=0,n.targetStates=[0,0,0],n.waiting=!1,n.itemsSound=[],n.cursorGuideShowed=!1,n.bgMusicPlay=!1,n.duelFinishAniShowing=!1,n.isShocking=!1,n.surviveAniArr=[],n.damagaLabelList=[],n.itemCanUseTime=0,n.dispatcher=e,n.callback=i,n.skinName=DuelSceneSkin,n.isFriendBattle=s,MainSceneConfig.weaponExp=MatchUtils.getCurrentWeaponExp(n.dispatcher),0!=(n.dispatcher.get("user","guide")||0)||s?n.initBattleData():n.initGuideData(),n}return __extends(e,t),e.prototype.initGuideData=function(){var t=this.dispatcher.get("user"),e=this.me=new User;e.gunType=0,e.gunName="handgun",e.gender=t.gender,e.bulletType="s",e.maxBullets=e.bullets=6,e.maxHp=e.hp=100,e.itemIndex=-1,e.itemGrade=-1;var i=RES.getRes("data_json"),s=i.gunsBaseNumber[t.gunIndex];e.hits=s[8],e.precision=s[4],e.basePrecision=100,e.baseHitRadius=s[10],e.crosshairIndex=0,e.canAim=1==s[11],e.fireInterval=6e4/s[5],console.log(this.opponent),this.soundNoBullet=new Sound(1,e.gunName+"_out",function(){},".mp3");for(var n=0;3>n;n++)this.itemsSound.push(new Sound(1,"item_"+n,function(){},".mp3"))},e.prototype.updateGuide=function(){switch(this.guideStep){case 0:this.guideStep=1,this.updateGuide();break;case 1:this.waiting=!0,this.target0.visible=!0,this.target0.scaleX=0,egret.Tween.get(this.target0).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},200).wait(200).call(function(){this.guideStep+=1,this.updateGuide()},this);break;case 2:this.targetStates[0]=1,this.guideDialog.visible=!0,this.guideText.text="如果你想要成为一个真正的牛仔，你必须先要学会开枪！试着去射击站在你面前这个家伙。",this.reloadTag.visible=!0,this.reloadTag.y=400,this.reloadTag.play("shoot",0),this.waiting=!1,this.start();break;case 3:case 6:this.waiting=!0,this.guideDialog.visible=this.reloadTag.visible=!1;break;case 4:this.waiting=!0;for(var t=function(t){e["target"+t].visible=!0,e["target"+t].scaleX=0,egret.Tween.get(e["target"+t]).to({scaleX:1-.1*t},100).to({scaleX:0},100).to({scaleX:1-.1*t},100).to({scaleX:0},100).to({scaleX:1-.1*t},200).wait(200).call(function(){1==t&&(this.guideStep+=1,this.updateGuide())},e)},e=this,i=0;3>i;++i)t(i);break;case 5:this.targetStates[0]=this.targetStates[1]=this.targetStates[2]=1,this.guideDialog.visible=!0,this.guideText.text="感觉如何？试着移动准星，然后干掉这些家伙。",this.waiting=!1;break;case 7:this.waiting=!0,this.target0.visible=!0,this.target0.scaleX=0,egret.Tween.get(this.target0).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},200).wait(200).call(function(){this.waiting=!1,this.guideStep+=1,this.updateGuide()},this);break;case 8:this.targetStates[0]=1,this.guideDialog.visible=!0,this.guideText.text="仔细看，你需要注意一下你的子弹！将子弹射空然后重新填装！",this.bulletList.visible=!0,this.bulletList.y=200,this.reloadTag.play("load",0),this.me.bullets=2;for(var s=function(t){["s","xd","b","b"].forEach(function(e){e==this.me.bulletType?(this[e+"qzdc"+t].visible=t<this.me.maxBullets,this[e+"qzd"+t].visible=t<this.me.bullets):this[e+"qzdc"+t].visible=this[e+"qzd"+t].visible=!1}.bind(n))},n=this,i=0;6>i;++i)s(i);break;case 9:this.waiting=!0,this.target1.visible=!0,this.target1.scaleX=0,egret.Tween.get(this.target1).to({scaleX:.9},100).to({scaleX:0},100).to({scaleX:.9},100).to({scaleX:0},100).to({scaleX:.9},200).wait(200).call(function(){this.targetStates[1]=1,this.waiting=!1},this);break;case 10:this.waiting=!0,this.target2.visible=!0,this.target2.scaleX=0,egret.Tween.get(this.target2).to({scaleX:.8},100).to({scaleX:0},100).to({scaleX:.8},100).to({scaleX:0},100).to({scaleX:.8},200).wait(200).call(function(){this.targetStates[2]=1,this.waiting=!1},this);break;case 11:this.waiting=!0,this.bulletList.visible=!1,this.guideBg.visible=!0,this.guideDialog.visible=!0,this.tapTag.visible=!1,this.tapTag0.visible=!0,this.reloadTag.visible=!1,this.guideDialog.y=this.screenHeight/2-200,this.guideText.text="太棒啦！勇敢的牛仔啊，快去进行一场真正的决斗吧！",("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).stopAccelerometer(),egret.stopTick(this.update,this);break;case 12:this.waiting=!0;var a=new egret.DisplayObjectContainer,r=new egret.Shape;a.addChild(r),r.graphics.beginFill(0,.5),r.graphics.drawRect(0,0,640,1386),r.graphics.endFill();var h=new egret.Shape;a.addChild(h),h.graphics.beginFill(0,1),h.graphics.drawCircle(320,693,50),h.graphics.endFill(),h.blendMode=egret.BlendMode.ERASE;var o=new egret.RenderTexture;o.drawToTexture(a),this.holeCover=new eui.Image(o),this.holeCover.anchorOffsetX=320,this.holeCover.anchorOffsetY=693,this.holeCover.x=this.item.x,this.holeCover.y=this.item.y-this.topUI.y,this.holeCover.scaleX=this.holeCover.scaleY=4,this.guide.addChildAt(this.holeCover,0),egret.Tween.get(this.holeCover).to({scaleX:2,scaleY:2},500).wait(500).call(function(){this.yindaoAni.visible=!0,this.yindaoAni.x=this.holeCover.x,this.yindaoAni.y=this.holeCover.y,this.waiting=!1},this),this.yindaoAni=new Animation("xs_yindaohand"),this.guide.addChild(this.yindaoAni),this.yindaoAni.play("stand",0),this.yindaoAni.visible=!1,this.holeCover.touchEnabled=!0,this.holeCover.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){if(!this.waiting){var e=this.item.x,i=this.item.y-this.topUI.y,s=t.stageX,n=t.stageY,a=Math.sqrt(Math.pow(s-e,2)+Math.pow(n-i,2));50>a&&(this.useItem(),this.guide.visible=!1)}},this)}},e.prototype.initBattleData=function(){var t=this.dispatcher.get("battle"),e=this.me=new User,i=RES.getRes("data_json"),s=this.dispatcher.get("user","_id");e._id=s;var n=t["gunType"+s],a=i.gunsBaseNumber[n],r=n.split("-"),h=+r[0];e.gunIndex=+r[1],e.gunType=0==h?0:1,e.gunName=["handgun","rifle","shutgun","sniper"][h],e.gender=0,e.bulletType=["s","b","xd","b"][h],e.maxBullets=e.bullets=a[3],e.maxHp=e.hp=t["hpMax"+s];var o=t["propType"+s];if(""==o)e.itemIndex=-1,e.itemGrade=-1;else{var l=o.split("-"),d=+l[0],c=+l[1];e.itemIndex=[1,0,2][d],e.itemGrade=c}e.hits=a[8],e.precision=a[4],e.basePrecision=100,e.baseHitRadius=a[10],e.crosshairIndex=0==h?0:1,e.canAim=1==a[11],e.fireInterval=6e4/a[5],e.gunLevelMax=t["gunExper"+s]||!1;var u=t.uids.split("_"),p=s==u[0]?u[1]:u[0],g=this.opponent=new Opponent,m=formula.getRankInfo(t["rank"+s]||0);g.moveSpeed=m.moveSpeed,g.restTimeBase=1e3*m.moveWait,g.restTimeRand=1e3*m.moveWaitRange,g.nickname=t["nickname"+p];var f=t["gunType"+p],v=f.split("-"),b=+v[0],y=i.gunsBaseNumber[f];g.gunName=["handgun","rifle","shutgun","sniper"][b],g.maxHp=g.hp=t["hpMax"+p],g._id=p,g.gender=t["targetGender"+p],g.gunLevelMax=t["gunExper"+p]||!1,g.gunNumber=f;var x=0>p;if(console.info("isAI:"+x),x){g.isAI=!0;var _=t["aiShootIntevalMin"+p],w=t["aiShootIntevalMax"+p],C=Math.random()*(w-_)+_;console.log("randomRate:"+C),g.fireInterval=6e4*C/y[5],console.log("fireInterval:"+g.fireInterval),g.reloadInterval=1e3*y[12];
var T=t["propType"+p]||"";if(""!=T){var I=T.split("-"),d=+I[0],c=+I[1];g.itemIndex=[1,0,2][d],g.itemGrade=c;var S=i.propsBaseNumber[T];1==g.itemIndex?g.itemPower=S[3]:2==g.itemIndex&&(g.itemPower=S[4])}else g.itemIndex=-1,g.itemGrade=-1;var k=RES.getRes("game_config_json").buttleConfig.aiShootWaiting||0;g.lastFire=weedon.time+k,g.maxBullets=g.bullets=y[3]}console.log(this.opponent),this.soundNoBullet=new Sound(1,e.gunName+"_out",function(){},".mp3");for(var B=0;3>B;B++)this.itemsSound.push(new Sound(1,"item_"+B,function(){},".mp3"))},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this);var i=this.dispatcher.get("user","userSetting")||0;this.musicEffectPlay=0!=(2&i),this.bgMusicPlay=0!=(1&i),this.battle_bgm=new Sound(1,"battle_bgm",function(){e.battle_bgm&&e.bgMusicPlay&&e.battle_bgm.play(0)},".mp3");var s=this.me,n=this.opponent,a=this.gun=new Animation(s.gunIndex>0?s.gunName+""+s.gunIndex:s.gunName);if(this.itemLayer.addChild(a),a.multiSound=!0,a.play("stand",0),a.x=320,a.y=1386,this.me.gunLevelMax){var r=new eui.Group,h=new Animation("se_maxlevel");h.x=0,h.y=0,h.play("stand",0),r.addChild(h),this.gun.setSlot("p",r)}var o=this.cross=new Animation("crosshair"+s.crosshairIndex);if(this.itemLayer.addChild(o),o.play("stand",0),o.x=320,o.y=886,o.scaleX=o.scaleY=(s.basePrecision-s.precision)/s.basePrecision,o.touchEnabled=!1,n){var l=this.target=new Animation("chr"+n.gender);this.enemy.addChild(l);var d=+n.gunNumber.split("-")[0],c=+n.gunNumber.split("-")[1];l.setSlot("gun",createBitmap("weapon_m_"+d+"_"+c+"_png",.5,.5,0,0,1,1)),l.play(n.gunName+"_stand_fire",0),l.scaleX=l.scaleY=.3;var u=this.enemyFire=new Animation("enimyfire");if(l.setSlot("p",u),u.visible=!1,this.enemyHpBar=new HpBar("zd_dr_db_png","zd_dr_xt_png","zd_dr_jia_png","zd_dr_jian_png"),this.enemy.addChildAt(this.enemyHpBar,0),this.enemyHpBar.setMaxValue(n.maxHp),this.enemyHpBar.y=-270,this.userHpBar=new HpBar("zd_zj_db_png","zd_zj_x_png","zd_zj_jia_png","zd_zj_jian_png"),this.topUI.addChildAt(this.userHpBar,0),this.userHpBar.setMaxValue(s.maxHp),this.userHpBar.showTag(30,16777215,2,7093780),this.userHpBar.y=30,this.userHpBar.x=320,this.opponent.gunLevelMax){this.aniOppnentMaxLevel=new Animation("se_maxlevel"),this.target.addChild(this.aniOppnentMaxLevel);var p=this.target.getSlotDisplay("gun0");this.aniOppnentMaxLevel.x=p.x,this.aniOppnentMaxLevel.y=p.y,this.aniOppnentMaxLevel.play("stand",0)}}else this.bulletList.visible=!1;for(var g=0;12>g;++g)if(s.fireInterval&&1==s.crosshairIndex){var m=this.cdBlanks[g]=new egret.DisplayObject;o.setSlot(""+g,m),this.cdItems.push(createBitmap("se_4_png",.5,.5))}var f=this.flour=new Animation("itemhit1");if(this.itemLayer.addChild(f),f.x=320,f.y=1386,f.visible=!1,console.log(s.itemIndex+"----"+s.itemGrade),-1!=s.itemIndex||-1!=s.itemGrade){var v=this.item=new Animation("item"+s.itemIndex);this.itemLayer.addChild(v),v.play("stand"+s.itemGrade,0),v.x=110,v.y=1276,v.touchEnabled=!0,v.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){!this.duelFinishAniShowing&&this.useItem()},this)}this.nickname.text=n?n.nickname:"",this.scene.touchEnabled=!0,this.scene.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){this.waiting||(s.touching=!0,s.canAim&&this.aim())},this),this.scene.addEventListener(egret.TouchEvent.TOUCH_END,function(){this.duelFinishAniShowing||s.touching&&!this.waiting&&(s.touching=!1,!this.startTime||s.itemUsing||s.reloadFinishing||(s.reloading&&!s.reloadActing?this.reload():this.fire()))},this),egret.Tween.get(this.tapTag0,{loop:!0}).to({y:184},200).to({y:204},200).wait(1e3),this.guideBg.touchEnabled=!0,this.guideBg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){try{this.dispatcher.request("user.guide",{},function(){this.battle_bgm&&this.battle_bgm.stop(),this.callback()}.bind(this))}catch(t){console.log(t)}},this),this.reloadTag=new Animation("se_yindao"),this.topUI.addChild(this.reloadTag),this.reloadTag.x=320,this.reloadTag.y=100,this.reloadTag.touchEnabled=!1,this.reloadTag.play("load",0),this.reloadTag.visible=!1;for(var b=function(t){["s","xd","b","b"].forEach(function(e){e==s.bulletType?(this[e+"qzdc"+t].visible=t<s.maxBullets,this[e+"qzd"+t].visible=t<s.bullets):this[e+"qzdc"+t].visible=this[e+"qzd"+t].visible=!1}.bind(y))},y=this,g=0;6>g;++g)b(g);this.scene.y=250,this.targetX=this.field.x,this.targetY=this.scene.y,this.adjustUI(),n?this.start():this.updateGuide()},e.prototype.adjustUI=function(){return this.ignoreNextResize?void(this.ignoreNextResize=!1):(this.ignoreNextResize=!0,void(weedon.winSize.width/weedon.winSize.height>.64?(this.stage.setContentSize(640,1e3),this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL,this.y=-193,this.topUI.y=193,this.screenHeight=1e3):(this.stage.setContentSize(640,1386),this.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,this.screenHeight=640/weedon.winSize.width*weedon.winSize.height,this.y=this.screenHeight-1386,this.topUI.y=this.screenHeight>1300?-this.y+50:-this.y)))},e.prototype.clamp=function(t,e,i){return Math.max(e,Math.min(t,i))},e.prototype.duelFinish=function(){var t=this;if(this.field.scaleX=this.field.scaleY=this.sky.scaleX=this.sky.scaleY=1,this.cross&&this.cross.play("stand",0),this.flour&&this.flour.visible&&(this.flour.visible=!1),this.aniOppnentMaxLevel&&this.aniOppnentMaxLevel.parent&&this.aniOppnentMaxLevel.parent.removeChild(this.aniOppnentMaxLevel),this.me.hp<=0){var e=500,i=Math.floor(1e3*e/1408/2),s=Math.floor(868*e/1408),n=this.ground.y+1400;this.gun&&this.gun.parent&&this.gun.parent.removeChild(this.gun),this.item&&this.item.parent&&this.item.parent.removeChild(this.item),this.reloadTag.visible&&(this.reloadTag.visible=!1),this.cross.visible&&(this.cross.visible=!1),this.bulletList.visible=!1,this.scene.touchEnabled=!1,egret.Tween.get(this.scene).to({y:1e3},i).call(function(){egret.Tween.get(this.ground).to({y:n},s).call(function(){this.target.scaleX=this.target.scaleY=1,this.enemy.x=0,this.target.x=this.target.globalToLocal(-230,0).x,this.nickname&&(this.nickname.visible=!1),this.target.y=this.target.y-this.target.height/2,this.target.play(this.me.hp<=0?"lol":this.opponent.gunName+"_die",this.me.hp<=0?0:1,function(){egret.Tween.get(this.target).to({rotation:30},500).wait(1e3).call(function(){this.battle_bgm&&this.battle_bgm.stop(),this.callback()},this)}.bind(this))},this)},this)}else{var a=(this.field,this.target.localToGlobal()),r=320-a.x,h=this.field.localToGlobal().x,o=500*(r/1e3);egret.Tween.get(this.field).to({x:h+r},o).call(function(){t.target.play(t.me.hp<=0?"lol":t.opponent.gunName+"_die",t.me.hp<=0?0:1,function(){egret.Tween.get(this).wait(1500).call(function(){this.battle_bgm&&this.battle_bgm.stop(),this.callback()},this)}.bind(t))})}},e.prototype.start=function(){var t=this.me,e=this.opponent;this.dispatcher.setPushCallback("battle",this.onMessage.bind(this)),("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).stopAccelerometer({complete:function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).startAccelerometer({success:function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).onAccelerometerChange(function(e){("undefined"==typeof GameGlobal?e.z:e.y)>0&&!t.reloading&&!t.shooting?this.startReload():("undefined"==typeof GameGlobal?e.z:e.y)<-.3&&t.reloading&&!t.reloadFinishing&&this.stopReload(),t.cursorMode?this.targetX=this.field.anchorOffsetX-2020*this.clamp(e.x,-.17,.17)*(e.z>0?-1:1)*this.field.scaleX:this.targetX=this.field.anchorOffsetX+2020*this.clamp(e.x,-.17,.17)*(e.z>0?-1:1)*this.field.scaleX,"undefined"==typeof GameGlobal?this.targetY=(50-400*this.clamp(e.z,-1,-0))*this.field.scaleY:this.targetY=(450+400*this.clamp(e.z,-1,-0))*this.field.scaleX}.bind(this)),this.startTime=weedon.time,e&&(e.nextX=(640-e.moveWidth)/2+e.moveWidth*Math.random()>>0),egret.startTick(this.update,this)}.bind(this)})}.bind(this)})},e.prototype.startReload=function(){var t=this.me;t.aiming||!this.opponent&&this.guideStep<8||(t.reloadFinishing=!1,t.reloading=t.reloadActing=!0,this.cross.visible=!1,this.gun.play("rifle"!=t.gunName&&"sniper"!=t.gunName?"reload"+t.bullets:"reload",1,function(){t.reloadActing=!1}.bind(this)))},e.prototype.reload=function(){var t=this.me;t.bullets==t.maxBullets||t.reloadActing||t.reloadFinishing||(t.reloadActing=!0,this.gun.play("rifle"!=t.gunName&&"sniper"!=t.gunName?"reload"+t.bullets+"_load":"reload_load",1,function(){t.reloadActing=!1}.bind(this)),this[t.bulletType+"qzd"+t.bullets].visible=!0,t.bullets+=1,this.reloadTag.visible=!1)},e.prototype.stopReload=function(){var t=this.me;t.reloadFinishing||"sniper"==t.gunName&&t.reloadActing||(t.reloadFinishing=!0,this.gun.play("rifle"!=t.gunName&&"sniper"!=t.gunName?"reload"+t.bullets+"_over":"reload_over",1,function(){this.gun.play("stand",0),t.reloading=t.reloadFinishing=t.reloadActing=!1,this.cross.visible=!0,t.touching&&t.canAim&&this.aim()}.bind(this)))},e.prototype.aim=function(){var t=this.me;if(!(t.reloading||t.reloadActing||t.reloadFinishing||!t.canAim||t.aiming||t.aimed||t.bullets<1||weedon.time-t.lastFire<t.fireInterval)){t.aiming=!0,this.cross.scaleX=this.cross.scaleY=1,this.cross.play("sniper",1,function(){t.aimed=!0,this.cross.play("sniperhold",0)}.bind(this));var e=this.cross.localToGlobal(0,0),i=this.field.globalToLocal(e.x,e.y);this.field.anchorOffsetX=i.x,this.field.anchorOffsetY=i.y,this.field.x=this.targetX=this.field.x+i.x,this.field.y=100+i.y,this.field.scaleX=this.field.scaleY=this.sky.scaleX=this.sky.scaleY=1.5}},e.prototype.fire=function(){var t=this,e=this.me,i=this.opponent;if(!(e.shooting||e.reloadFinishing||e.reloading||weedon.time-e.lastFire<e.fireInterval)){if(e.bullets>0){e.shooting=!0,e.lastFire=weedon.time,(i||this.guideStep>7)&&(e.bullets-=1,this[e.bulletType+"qzd"+e.bullets].visible=!1),this.reloadTag.visible=!e.bullets&&(!!i||this.guideStep<11);for(var s=[],n=function(t){var n=a.localToGlobal(a.cross.x,a.cross.y);n.x+=e.aiming?0:(1-2*Math.random())*a.cross.scaleX*e.baseHitRadius,n.y+=e.aiming?0:(1-2*Math.random())*a.cross.scaleY*e.baseHitRadius;var r=a.field.globalToLocal(n.x,n.y),h=-1;if(i)for(var o=(a.target.globalToLocal(n.x,n.y),0);8>o;++o){var l=["headhit","bodyhit","leghit0","leghit1","leghit2","leghit3","leghit4","leghit5"][o];if(a.target.hitCheck(n.x,n.y,l)){h=o;break}}else for(var o=0;3>o;++o)if(a.targetStates[o]&&a["target"+o].visible&&a["target"+o].hitTestPoint(n.x,n.y)){h=o;break}s.push(h);var d;if(~h){for(var o=0;o<a.hitEffects.length;++o)if(!a.hitEffects[o].visible){d=a.hitEffects[o];break}d||(d=new Animation("se_hit"),a.field.addChild(d),d.scaleX=d.scaleY=.6,a.hitEffects.push(d)),d.visible=!0,d.x=r.x,d.y=r.y,d.play("hit",1,function(){d.visible=!1})}else{for(var o=0;o<a.nohitEffects.length;++o)if(!a.nohitEffects[o].visible){d=a.nohitEffects[o];break}d||(d=new Animation("se_nohit"),a.field.addChild(d),d.scaleX=d.scaleY=.6,a.nohitEffects.push(d)),d.visible=!0,d.x=r.x,d.y=r.y,d.play("hit",1,function(){d.visible=!1})}},a=this,r=0;r<e.hits;++r)n(r);for(var h=-1,r=0;r<s.length;++r)~s[r]&&(h=~h?Math.min(h,s[r]):s[r]);if(~h)if(i)i.waiting=!0,this.target.play(0==h?i.gunName+"_headhit":1==h?i.gunName+"_bodyhit":i.gunName+"_leghit",1,function(){i.waiting=!1,this.startTime&&this.target.play(i.waitFinish>weedon.time||i.nextX==this.enemy.x?i.gunName+"_stand_fire":i.nextX>this.enemy.x?i.gunName+"_right":i.gunName+"_left",0)}.bind(this));else{this.targetStates[h]=0;var o=!1;this.targetStates[0]+this.targetStates[1]+this.targetStates[2]==0&&(this.guideStep<8&&(this.guideStep+=1,this.updateGuide()),o=!0),egret.Tween.get(this["target"+h]).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},100).to({scaleX:0},100).wait(200).call(function(){this["target"+h].visible=!1,o&&(this.guideStep+=1,this.updateGuide())},this)}if(this.dispatcher.get("user","guide")<1&&!~h&&!this.cursorGuideShowed&&!this.isFriendBattle){this.cursorGuideShowed=!0;var l=new GuideTag(this.screenHeight,0,function(){t.parent.removeChild(l)});this.parent.addChild(l)}i&&this.dispatcher.request(this.opponent&&this.opponent.isAI?"aiBattle.battle":this.isFriendBattle?"friendBattle.battle":"user.battle",{action:0,hitIndexes:s,aiming:+e.aiming},function(){this.updateHp()}.bind(this)),this.gun.play("fire",1,function(){e.shooting=e.aiming=e.aimed=e.reloading=e.reloadActing=e.reloadFinishing=!1}.bind(this)),this.cross.scaleX=this.cross.scaleY=(e.basePrecision-e.precision)/e.basePrecision,this.cross.play("fire",1,function(){this.cross.play("stand",0)}.bind(this))}else if(e.aiming&&(this.cross.play("stand",0),e.aiming=e.aimed=!1),this.soundNoBullet&&this.musicEffectPlay&&this.soundNoBullet.play(1),!i){var d=new GuideTag(this.screenHeight,1,function(){t.parent.removeChild(d)});this.parent.addChild(d)}this.field.scaleX=this.field.scaleY=this.sky.scaleX=this.sky.scaleY=1,this.field.x-=this.field.anchorOffsetX,this.targetX=this.field.x,this.field.anchorOffsetX=0,this.field.anchorOffsetY=0,this.field.y=100}},e.prototype.useItem=function(){var t=this.me,e=this.opponent;t.itemUsed||t.shooting||(t.itemUsed=t.itemUsing=!0,this.dispatcher.request(this.opponent&&this.opponent.isAI?"aiBattle.battle":this.isFriendBattle?"friendBattle.battle":"user.battle",{action:1},function(i){if(i)return void console.info(i);switch(this.itemsSound[t.itemIndex]&&this.musicEffectPlay&&this.itemsSound[t.itemIndex].play(1),t.itemIndex){case 0:case 1:var s=this.localToGlobal(this.item.x,this.item.y),n=this.field.globalToLocal(s.x,s.y);this.item.visible=!1;var a=new Animation("item"+t.itemIndex);this.field.addChild(a),a.x=n.x,a.y=n.y,a.play("fly"+t.itemGrade,0),a.bezierTo(a.x+(this.enemy.x-a.x)/2,this.enemy.y-300,this.enemy.x,this.enemy.y,800,function(){if(a.scaleX=a.scaleY=1,a.play("boom"+t.itemGrade,1,function(){t.itemUsing=!1,a.parent&&a.parent.removeChild(a)}.bind(this)),-1!=t.itemIndex){this.target.play(e.gunName+"_leghit",1),this.updateHp();var i=this.dispatcher.get("battle","propUsed"+t._id);if(i&&this.item&&this.item.parent&&this.item.parent.removeChild(this.item),1==t.itemIndex){var s=new Animation("item1_buff");this.target.addChild(s),s.x=0,s.y=0,s.play("stand"+t.itemGrade,0,function(){this.target.removeChild(s)}.bind(this)),this.opponent.isAI&&(e.lastFire+=3e3)}}}.bind(this)),egret.Tween.get(a).to({scaleX:.1,scaleY:.1},800);break;case 2:this.item&&this.item.play("use"+t.itemGrade,1,function(){t.itemUsing=this.item.visible=!1}.bind(this)),this.updateHp()}}.bind(this)))},e.prototype.onMessage=function(){var t=this.dispatcher.get("battle");switch(0!=t.action,t.action){case 0:this.hit(t.hitIndex);break;case 1:this.itemHit(t.itemIndex,t.itemGrade)}},e.prototype.showShock=function(){if(!this.isShocking){this.isShocking=!0;var t=this.scene.y;egret.Tween.get(this.scene).to({x:50,y:t-5},20).to({x:-50,y:t+5},40).to({x:50,y:t+5},40).to({x:-50,y:t-5},40).to({x:40},40).to({x:-40},40).to({x:30},40).to({x:-30},40).to({x:0},20).call(function(){this.isShocking=!1},this)}},e.prototype.hit=function(t){var e=this,i=this.me;if(this.enemyFire.visible=!0,this.enemyFire.play("hit",1,function(){this.enemyFire.visible=!1}.bind(this)),~t){this.item&&this.item.visible&&!i.itemUsing&&this.item.play("hurt"+i.itemGrade,1,function(){this.item&&this.item.play("stand"+i.itemGrade)}.bind(this)),i.shooting||i.reloading||i.reloadActing||i.reloadFinishing||this.gun.play("hurt",1,function(){this.gun.play("stand",0)}.bind(this));for(var s,n=0;n<this.behitEffects.length;++n)if(!this.behitEffects[n].visible){s=this.behitEffects[n];break}if(s||(s=new Animation("beenhit"),this.addChild(s),this.behitEffects.push(s)),s.visible=!0,s.x=40+600*Math.random(),s.y=this.cross.y-200+400*Math.random(),s.play("hit",1,function(){s.visible=!1}),this.updateHp(),i.shooting)return;0==i.gunType?this.cross.play(["headhit","bodyhit","bodyhit"][t],1,function(){this.cross.play("stand",0)}.bind(this)):i.canAim&&i.aiming?this.cross.play("sniper"+["headhit","bodyhit","bodyhit"][t],1,function(){this.cross.play("sniperhold",0)}.bind(this)):this.cross.play(["headhit","bodyhit","bodyhit"][t],1,function(){this.cross.play("stand",0)}.bind(this))}else{var a=new Animation("se_miss");a&&a.parent&&a.parent.removeChild(a),this.stage.addChild(a),this.surviveAniArr.push(a);var r=this.target.getSlotDisplay("gun0"),h=this.target.localToGlobal(r.x,r.y);a.x=h.x,a.y=h.y;var o=this.cross.localToGlobal().x||320;a.rotation=a.x>o?180+Math.floor(180*Math.random()):Math.floor(180*Math.random()),a.play("come",1,function(){var t=e.surviveAniArr.pop();t&&t.parent&&t.parent.removeChild(t)})}},e.prototype.itemHit=function(t,e){var i=this.me;switch(console.log("受到道具效果"),t){case 0:var s=new Animation("itemhit"+t);this.addChild(s),s.x=320,s.y=1386,s.play("boom"+e,1,function(){s.visible=!1}.bind(this)),i.shooting||(i.canAim&&i.aiming?this.cross.play("sniperbodyhit",1,function(){this.cross.play("sniperhold",0)}.bind(this)):this.cross.play("bodyhit",1,function(){this.cross.play("stand",0)}.bind(this))),this.item&&this.item.visible&&!i.itemUsing&&this.item.play("hurt"+e,1,function(){this.item&&this.item.play("stand"+e,0)}.bind(this)),i.shooting||i.reloading||i.reloadActing||i.reloadFinishing||this.gun.play("hurt",1,function(){this.gun.play("stand",0)}.bind(this));break;case 1:i.state=e,i.stateFinish=weedon.time+6e3;break;case 2:this.aniWine||(this.aniWine=new Animation("item2_buff")),this.target.addChild(this.aniWine),this.aniWine.x=0,this.aniWine.y=0,this.aniWine.play("come",1,function(){this.target.removeChild(this.aniWine)}.bind(this))}this.updateHp()},e.prototype.updateHp=function(){if(!this.duelFinishAniShowing){var t=this.opponent.hp,e=this.me.hp;this.opponent.hp=this.dispatcher.get("battle","hp"+this.opponent._id),this.me.hp=this.dispatcher.get("battle","hp"+this.me._id);var i=this.me,s=i.hp,n=e-s,a=this.opponent,r=Math.max(0,a.hp),h=t-r;if(n>0&&this.showShock(),null!=t&&t!=r&&0!=h){var o=new eui.BitmapLabel;0>h?o.font=RES.getRes("hp_bonus_fnt"):o.font=RES.getRes("dmg_ft_fnt"),this.enemy.addChild(o),this.damagaLabelList.push(o),o.text=0>h?"+"+Math.abs(h):"-"+h,o.y=this.nickname.y+20,o.x=this.nickname.x+20;var l=o.x,d=o.y;o.alpha=0,egret.Tween.get(o).to({alpha:1},200).to({x:l+40,y:d-10},100).to({x:l+60,y:d+20,alpha:0},200).call(function(){var t=this.damagaLabelList.pop();t&&t.parent&&t.parent.removeChild(t)},this)}this.userHpBar.setValue(i.hp),this.enemyHpBar.setValue(a.hp),(i.hp<=0||a.hp<=0)&&(this.duelFinishAniShowing=!0,this.dispatcher.setPushCallback("battle",null),("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).stopAccelerometer(),this.scene.touchEnabled=!1,egret.stopTick(this.update,this),egret.Tween.get(this.topUI).wait(350).call(function(){this.duelFinish()},this))}},e.prototype.AIFire=function(){this.dispatcher.request("aiBattle.battle",{action:0,isAI:!0},function(){console.info("shoot back"),this.onMessage(),12==this.guideStep||2!=this.dispatcher.get("user","guide")||this.me.itemUsed||(this.guideStep=12,this.updateGuide())}.bind(this))},e.prototype.AIItem=function(){var t=this.me,e=this.opponent;if(!(e.itemUsed||e.hp<=0)){var i=!1;switch(e.itemIndex){case 0:i=t.hp<=1.1*e.itemPower;break;case 1:i=!0;break;case 2:i=e.maxHp-e.hp>=e.itemPower}if(i){if(0==this.itemCanUseTime&&(this.itemCanUseTime=weedon.time+(1==e.itemIndex?RES.getRes("game_config_json").buttleConfig.aiUseProp0Waiting:RES.getRes("game_config_json").buttleConfig.aiUseProp12Waiting)),weedon.time-this.itemCanUseTime<0)return;e.itemUsed=!0,this.dispatcher.request("aiBattle.battle",{action:1,isAI:!0},function(){this.onMessage()}.bind(this))}}},e.prototype.update=function(){if(!this.duelFinishAniShowing){var t=this.me,e=this.opponent,i=weedon.time,s=i-this.startTime;if(this.startTime=i,this.field.x+=t.cursorSpeed*s*(this.targetX-this.field.x),this.scene.y+=t.cursorSpeed*s*(this.targetY-this.scene.y),e&&e.isAI&&(e.hp>0&&!e.itemUsed&&this.AIItem(),e.hp>0&&e.bullets>0&&i-e.lastFire>e.fireInterval&&(e.lastFire=i,e.bullets--,this.AIFire()),e.hp>0&&e.bullets<1&&i-e.lastFire>e.reloadInterval&&(e.bullets=e.maxBullets,e.lastFire=i)),t.fireInterval&&1==t.crosshairIndex)for(var n=i-t.lastFire,a=0;12>a;++a)this.cross.setSlot(""+a,n/t.fireInterval*12>a+1?this.cdBlanks[a]:this.cdItems[a]);return t.stateFinish>i?this.flour.visible||(this.flour.visible=!0,this.flour.play("boom"+t.state,1,function(){this.flour.play("stand"+t.state,0)}.bind(this))):this.flour.visible&&!t.stateFinishing&&(t.stateFinishing=!0,this.flour.play("over"+t.state,1,function(){this.flour.visible=t.stateFinishing=!1}.bind(this))),!e||e.waiting||i<e.waitFinish||!this.startTime||e.hp<=0?!0:(e.nextX>this.enemy.x?(e.moving||(e.moving=!0,this.target.play(e.gunName+"_right",0)),this.enemy.x+=Math.min(e.moveSpeed*s,e.nextX-this.enemy.x)):(e.moving||(e.moving=!0,this.target.play(e.gunName+"_left",0)),this.enemy.x-=Math.min(e.moveSpeed*s,this.enemy.x-e.nextX)),this.enemy.x==e.nextX&&(e.moving=!1,this.target.play(e.gunName+"_stand_fire",0),e.waitFinish=i+e.restTimeBase+(Math.random()*e.restTimeRand>>0),e.nextX=(640-e.moveWidth)/2+e.moveWidth*Math.random()>>0),!0)}},e}(eui.Component);__reflect(Duel.prototype,"Duel");var BattleEndDialog=function(t){function e(e,i,s,n){var a=t.call(this)||this;return a.mScreenHeight=e,a.skinName=BattleEndDialogSkin,a.dispatcher=i,a.isFriendBattle=n,console.log(s),a.closeCallBack=s,a}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.animationShoot=new Animation("se_shootface"),this.animationShoot.multiSound=!0,this.bg.height=this.mScreenHeight;var i=this.dispatcher.get("user"),s=this.dispatcher.get("itemsGot")||{};this.isWiner=1==this.dispatcher.get("battle")["result"+i._id],new Btn(this.backBtn,function(){this.closeCallBack(0)}.bind(this)),new Btn(this.leftBtn,function(){this.closeCallBack(1)}.bind(this)),console.log("battle end>isFriendBattle?:"+this.isFriendBattle),setTexture(this.leftBtn.tfImg,this.isFriendBattle?"zd_zlyj_png":"wz_fhcz_png"),setTexture(this.rightBtn.tfImg,"wz_fxzj_png"),new Btn(this.rightBtn,function(){e.dispatcher.getCache("share")(2,function(t){return t?(e.dispatcher.getCache("showGroupUsers")(t),void e.dispatcher.getCache("getShareBonus")()):void e.dispatcher.getCache("showAlert")("分享到微信群才能获得奖励")})}.bind(this)),this.rewardTF.textFlow=[{text:"经验：",style:{size:24,textColor:7093780}},{text:(s.exper||0)+"     ",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}},{text:"熟练度：",style:{size:24,textColor:7093780}},{text:(s.gunExper||0)+"     ",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}},{text:"金币：",style:{size:24,textColor:7093780}},{text:(s.gold||0)+"     ",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}}],this.rewardTF.visible=this.isWiner&&!this.isFriendBattle;var n=this.dispatcher.get("battle"),a=n.uids.split("_"),r=n["avatar"+i._id],h=n["avatar"+(a[0]==i._id?a[1]:a[0])];setAvatar(this.avatarTarget,h),setAvatar(this.avatarMe,r),this.showBattleParams(i);var o=formula.getULevel(s.experOld),l=formula.getULevel(s.experNew),d=i.rankLv||0,c=MainSceneConfig.rankLv;formula.getRankInfo(d),formula.getRankInfo(c);this.dwMc1.visible=!1,this.leftBtn.visible=this.rightBtn.visible=this.backBtn.visible=!1,egret.Tween.get(this.avatarMe).wait(500).call(function(){e.showShootAni(e.isWiner,function(){e.showWinLoseTitle(function(){if(e.isFriendBattle)return e.closeCallBack(3,null),void(e.leftBtn.visible=e.rightBtn.visible=e.backBtn.visible=!0);d!=c&&e.closeCallBack(3,null);var t=MatchUtils.getCurrentWeaponExp(e.dispatcher);t>MainSceneConfig.weaponExp&&t==RES.getRes("game_config_json").buttleConfig.experGunMax&&e.showGunMaxAnimation(),l>o&&e.closeCallBack(2,null);var i=e.dispatcher.get("user","duelDailyNum")||0,s=e.dispatcher.get("user","duelBonusStatus")||0;e.isWiner&&i>0&&Math.floor(i-.25)==s&&e.closeCallBack(4,null)})})})},e.prototype.showGunMaxAnimation=function(){var t=new Animation("se_shuliandu");this.addChild(t),t.x=320,t.y=this.mScreenHeight/2,t.play("come",1,function(){})},e.prototype.showBattleParams=function(t){var e=this.dispatcher.get("battle"),i=e.uids.split("_"),s=e["battleParams"+t._id].split("-"),n=e["battleParams"+(i[0]==t._id?i[1]:i[0])].split("-"),a=(formula.getRankInfo(t.rankLv),e["nickname"+(i[0]==t._id?i[1]:i[0])]);this.desTF1.textFlow=[{text:"射击：  ",style:{size:24,textColor:7093780}},{text:s[0]+"\n",style:{size:24,textColor:12154151}},{text:"命中：  ",style:{size:24,textColor:7093780}},{text:s[1]+"\n",style:{size:24,textColor:12154151}},{text:"爆头：  ",style:{size:24,textColor:7093780}},{text:s[2],style:{size:24,textColor:12154151}}],ActionUtils.refreshDwMc(this.dwMc2,this.dispatcher.get("battle","rank"+(i[0]==t._id?i[1]:i[0]))||0,1),this.desTF2.textFlow=[{text:"             "+a+"\n",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}},{text:"射击：  ",style:{size:24,textColor:7093780}},{text:n[0]+"\n",style:{size:24,textColor:12154151}},{text:"命中：  ",style:{size:24,textColor:7093780}},{text:n[1]+"\n",style:{size:24,textColor:12154151}},{text:"爆头：  ",style:{size:24,textColor:7093780}},{text:n[2],style:{size:24,textColor:12154151}}],this.effImg.visible=this.isWiner;var r=e["exper"+(i[0]==t._id?i[1]:i[0])]||0;this.lvTF.text="lv."+formula.getULevel(r)},e.prototype.showRankInfo=function(t,e,i,s,n,a,r){var h=this;if(console.log(t+"======="+e),t>e)if(a.name!=n.name){var o=new Animation("se_duanweishengduan");ActionUtils.refreshDwMc(this.dwMc1,e),this.addChild(o),o.x=488,o.y=580,o.setSlot("p",this.dwMc1),o.play("come",1,function(){console.log(1),ActionUtils.refreshDwMc(h.dwMc1,MainSceneConfig.rankLv),r(i,s)}.bind(this))}else{var l=new Animation("se_duanweishengji"),d=ActionUtils.refreshDwMc(this.dwMc1,e,2);this.dwMc1.addChild(l),l.x=d.x+11.5,l.y=d.y+14,l.play("come",1,function(){ActionUtils.refreshDwMc(h.dwMc1,MainSceneConfig.rankLv),r(i,s)}.bind(this))}else if(e>t)if(a.name!=n.name){ActionUtils.refreshDwMc(this.dwMc1,e);var o=new Animation("se_duanweijiangduan");this.addChild(o),o.x=488,o.y=580,o.setSlot("p",this.dwMc1),o.play("come",1,function(){ActionUtils.refreshDwMc(h.dwMc1,MainSceneConfig.rankLv),r(i,s)}.bind(this))}else{var d=ActionUtils.refreshDwMc(this.dwMc1,t,2),l=new Animation("se_duanweijiangji");this.dwMc1.addChild(l),l.x=d.x+11.5,l.y=d.y+14,l.play("come",1,function(){ActionUtils.refreshDwMc(h.dwMc1,MainSceneConfig.rankLv),r(i,s)}.bind(this))}else t==e&&(ActionUtils.refreshDwMc(this.dwMc1,MainSceneConfig.rankLv),console.log("e"),r(i,s))},e.prototype.checkRankChange=function(t,e,i){t==e&&(ActionUtils.refreshDwMc(this.dwMc1,MainSceneConfig.rankLv),i())},e.prototype.showShootAni=function(t,e){var i=t?this.avatarTarget:this.avatarMe;this.animationShoot&&this.animationShoot.parent&&this.animationShoot.parent.removeChild(this.animationShoot),this.animationShoot&&(this.addChild(this.animationShoot),this.animationShoot.x=i.x,this.animationShoot.y=i.y,this.animationShoot.anchorOffsetX=this.animationShoot.width/2,this.animationShoot.anchorOffsetY=this.animationShoot.height/2,this.animationShoot.multiSound=!0,this.animationShoot.play("come",1,function(){e()}.bind(this)))},e.prototype.showWinLoseTitle=function(t){var e=new Animation("se_winlose");this.addChild(e),e.anchorOffsetY=e.height/2,e.y=390,e.horizontalCenter=0,e.play(this.isWiner?"win":"lose",1,function(){t()})},e}(eui.Component);__reflect(BattleEndDialog.prototype,"BattleEndDialog");var BattleEndRankBoard=function(t){function e(e,i,s){var n=t.call(this)||this;return n.skinName=BattleEndRankSkin,n.dispatcher=e,n.rankOld=i,n.closeCallback=s,n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),setTexture(this.btnLeft.tfImg,"zd_js_jx_png",.5,.5),setTexture(this.btnRight.tfImg,"zd_js_xy_png",.5,.5),new Btn(this.btnLeft,function(){e.closeCallback(-1)}),new Btn(this.btnRight,function(){e.closeCallback(1)});var i=this.dispatcher.get("user","rankLv")||0,s=this.rankOld||0,n=formula.getRankInfo(i),a=formula.getRankInfo(s);if(i>s)if(n.name!=a.name){var r=new Animation("se_duanweishengduan");ActionUtils.refreshDwMc(this.rankIcon,s),this.addChild(r),r.x=488,r.y=580,r.setSlot("p",this.rankIcon),r.play("come",1,function(){console.log(1),ActionUtils.refreshDwMc(e.rankIcon,i)}.bind(this))}else{var h=new Animation("se_duanweishengji"),o=ActionUtils.refreshDwMc(this.rankIcon,s,2);this.rankIcon.addChild(h),h.x=o.x+11.5,h.y=o.y+14,h.play("come",1,function(){ActionUtils.refreshDwMc(e.rankIcon,i)}.bind(this))}else if(s>i)if(n.name!=a.name){ActionUtils.refreshDwMc(this.rankIcon,s);var r=new Animation("se_duanweijiangduan");this.addChild(r),r.x=488,r.y=580,r.setSlot("p",this.rankIcon),r.play("come",1,function(){ActionUtils.refreshDwMc(e.rankIcon,i)}.bind(this))}else{var o=ActionUtils.refreshDwMc(this.rankIcon,s,2),h=new Animation("se_duanweijiangji");this.rankIcon.addChild(h),h.x=o.x+11.5,h.y=o.y+14,h.play("come",1,function(){ActionUtils.refreshDwMc(e.rankIcon,i)}.bind(this))}},e}(eui.Component);__reflect(BattleEndRankBoard.prototype,"BattleEndRankBoard");var SuperShareBoard=function(t){function e(e,i){var s=t.call(this)||this;return s.skinName=BattleEndDialogSkin,s.dispatcher=e,s.closeCallBack=i,s}return __extends(e,t),e}(eui.Component);__reflect(SuperShareBoard.prototype,"SuperShareBoard");var BuyTiDialog=function(t){function e(e,i,s){var n=t.call(this)||this;return n.lastShareTime=0,n.dailyCanGet=0,n.mScreenHeight=e,n.dispatcher=i,n.skinName=BuyTiDialogSkin,n.closeCallback=s,n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.mActivityConfigJson=RES.getRes("activity_json"),this.shareInterval=1e3*RES.getRes("activity_json").share.shareInterval,new Btn(this.backBtn,function(){egret.stopTick(e.update,e),e.closeCallback(),e.parent.removeChild(e)}.bind(this)),this.diamondTF.text=(this.dispatcher.get("user","diamondAll")||0)-(this.dispatcher.get("user","diamondCost")||0),this.refreshList(),this.adjustUI(),egret.startTick(this.update,this)},e.prototype.getTimeString=function(t){var e=Math.floor(t/6e4),i=Math.floor(t%6e4/1e3),s=(e>=10?"":"0")+e,n=(i>=10?"":"0")+i;return s+":"+n},e.prototype.update=function(t){return this.itemTop&&(this.itemTop.labelForFree.text=weedon.time-this.lastShareTime>=this.shareInterval?"分享到微信群免费获取体力"+this.dailyCanGet+"/"+this.mActivityConfigJson.share.dailyShareMax:"距离下次获取体力:"+this.getTimeString(this.shareInterval-(weedon.time-this.lastShareTime))),!0},e.prototype.refreshList=function(){var t=this;this.lastShareTime=this.dispatcher.get("user","lastShare")||0,this.dailyCanGet=this.mActivityConfigJson.share.dailyShareMax-(this.dispatcher.get("user","dailyShareNum")||0),console.log("dailyCanGet:"+this.dailyCanGet),this.list.removeChildren();var e=0;if(this.dispatcher.getCache("getCanGetShareBonus")()){var i=new eui.Component;i.skinName=StrenghForFreeItemSkin,this.list.addChild(i),this.itemTop=i,i.diamondTF.text="X "+this.mActivityConfigJson.share.shareStrenghBonus,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.y=i.height/2,i.x=i.width/2;var s=new Animation("se_boob");i.addChild(s),s.x=434,s.y=73,s.play("stand",0),new Btn(i,function(){console.log("to share"),t.dispatcher.getCache("share")(3,function(e){return e?void t.dispatcher.getCache("getShareBonus")(function(){t.refreshList()}):void t.dispatcher.getCache("showAlert")("分享到微信群才能获得奖励")})},null,!0),e++}this.mChargeArr=RES.getRes("activity_json").buyTi;for(var n=function(i){var s=new eui.Component;s.skinName=BuyTiItemRenderSkin,setTexture(s.iconImg,"cz_tili_"+(i+1)+"_png");var n=new Animation("se_boob");s.addChild(n),n.x=106,n.y=73,n.play("stand",0),s.desTF.text="体力 X"+a.mChargeArr[i][0],s.diamondTF.text=a.mChargeArr[i][1],a.list.addChild(s),s.anchorOffsetX=s.width/2,s.anchorOffsetY=s.height/2,s.x=s.width/2,s.y=150*(i+e)+s.height/2,new Btn(s,function(){var e=t.mChargeArr[i][1],s=(t.dispatcher.get("user","diamondAll")||0)-(t.dispatcher.get("user","diamondCost")||0);return e>s?(console.log("diamond not enough"),void t.dispatcher.getCache("showAlert")("钻石数量不足")):void t.buyStrengh(i)},null,!0)},a=this,r=0;r<this.mChargeArr.length;r++)n(r)
},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e.prototype.buyStrengh=function(t){var e=this,i=this.dispatcher.get("user","strenge")||0;this.dispatcher.request("propHs.buyStrengh",{index:t},function(t){t&&e.dispatcher.getCache("showAlert")(t);var s=e.dispatcher.get("user","strenge")||0;if(s>i){var n="体力+"+(s-i);e.dispatcher.getCache("showRemind")(1,n)}e.diamondTF.text=(e.dispatcher.get("user","diamondAll")||0)-(e.dispatcher.get("user","diamondCost")||0)})},e}(eui.Component);__reflect(BuyTiDialog.prototype,"BuyTiDialog");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.createView,e),e}return __extends(e,t),e.prototype.createView=function(){var t;if(weedon.winSize.width/weedon.winSize.height>.64)this.stage.setContentSize(640,1e3),this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL,this.y=-193,t=1e3;else{this.stage.setContentSize(640,1386),this.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,this.scaleX=this.scaleY=Math.min(.64/(weedon.winSize.width/weedon.winSize.height),1),this.x=640*(1-this.scaleX)/2,this.y=1e3*(1-this.scaleY)/2;var e=this.x?{width:640,height:1e3}:weedon.winSize;t=640*e.height/e.width}var i=createBitmap("login_bg_png");this.addChild(i);var s=createBitmap("logo_png",.5,.5,320,t/4);this.addChild(s);var n=createBitmap("dl_jindutiao_01_png",.5,.5,320,t/5*4.6);this.addChild(n),this.progBar=createBitmap("dl_jindutiao_00_png",.5,.5,320,t/5*4.6-1),this.addChild(this.progBar),this.progText=new egret.TextField,this.addChild(this.progText),this.progText.size=20,this.progText.textColor=16777215,this.progText.stroke=2,this.progText.strokeColor=5387032,this.progText.bold=!0,this.progText.x=320,this.progText.y=t/5*4.6-45;var a=this.loadingTag=new eui.Label;this.addChild(a),a.size=20,a.textColor=16777215,a.stroke=2,a.strokeColor=5387032,a.bold=!0,a.x=320,a.y=t/5*4.6+23,a.text="初次加载时间较长，请耐心等待。",a.anchorOffsetX=a.width/2},e.prototype.onProgress=function(t,e){this.progBar.mask=new egret.Rectangle(0,0,this.progBar.width*t/e,this.progBar.height),this.progText.text="加载中...（"+t+"/"+e+"）",this.progText.anchorOffsetX=this.progText.width/2,this.loadingTag.size=20+Math.random()/100},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var GuideTag=function(t){function e(e,i,s){var n=t.call(this)||this;return n.skinName=QualifyingSceneSkin,n.screenHeight=e,n.mode=i,n.callback=s,n}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bg.height=this.screenHeight,this.y=-(1386-this.screenHeight)/2,this.backBtn.visible=!1,this.tapTag.visible=!0,egret.Tween.get(this.tapTag,{loop:!0}).to({y:420},200).to({y:440},200).wait(1e3);var e=new Animation("se_xinshouyindao");this.grp1.addChild(e),e.play("stand"+this.mode,0),e.x=230,e.y=320,this.mode?this.desTF1.textFlow=[{text:"1.倾斜手机打开枪膛\n",style:{size:30,textColor:7093780}},{text:"2.点击空膛填装子弹",style:{size:30,textColor:7093780}}]:this.desTF1.textFlow=[{text:"如何击中目标？\n",style:{size:30,textColor:7093780}},{text:"通过",style:{size:24,textColor:12154151}},{text:"[翻转手机]",style:{size:30,textColor:7093780}},{text:"来控制准星，\n",style:{size:24,textColor:12154151}},{text:"[点击屏幕]",style:{size:30,textColor:7093780}},{text:"射击对手！",style:{size:24,textColor:12154151}}],this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.callback()},this)},e}(eui.Component);__reflect(GuideTag.prototype,"GuideTag");var LvupDialog=function(t){function e(e,i,s){var n=t.call(this)||this;return n.mScreenHeight=e,n.skinName=LvupDialogSkin,n.dispatcher=i,n.mCallBack=s,n.data_json=RES.getRes("data_json"),n}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.lvBF.text=formula.getULevel(this.dispatcher.get("user","experience")||0)+"",setTexture(this.okBtn.tfImg,"js_qd_png"),new Btn(this.okBtn,function(){this.mCallBack&&this.mCallBack()}.bind(this));var e=(this.dispatcher.get("user"),this.dispatcher.get("itemsGot")||{}),i=[];null!=e.hpLimitBonus&&i.push({text:"HP上限：",style:{size:30,textColor:7093780}},{text:" +"+e.hpLimitBonus+"\n",style:{size:30,textColor:15792497,stroke:2,strokeColor:7840013}}),null!=e.strengeBonus&&i.push({text:"体力：",style:{size:30,textColor:7093780}},{text:" +"+e.strengeBonus+"\n",style:{size:30,textColor:15792497,stroke:2,strokeColor:7840013}}),null!=e.strengeLimitBonus&&i.push({text:"体力上限：",style:{size:30,textColor:7093780}},{text:" +"+e.strengeLimitBonus+"\n",style:{size:30,textColor:15792497,stroke:2,strokeColor:7840013}}),this.hpTF.lineSpacing=20,this.hpTF.textFlow=i,this.hpTF.anchorOffsetY=this.hpTF.height/2;var s=[],n=e.gunUnLocked;if(n)for(var a=0;a<n.length;a++)s.push({index:0,num:n[a]});var r=e.propUnLocked;if(r)for(var a=0;a<r.length;a++)s.push({index:1,num:r[a]});this.jiesuoTF.visible=s.length>0,this.groupLocked.removeChildren();for(var a=0;a<s.length;a++){var h=s[a],o=h.num;if(null!=o&&""!=o){var l=h.index,d=new UnLockItem,c=o.split("-");this.dispatcher.getCache("notifyPropUnlocked")(l,o);var u;if(0==l){setTexture(d.img_prop,"weapon_s_"+ +c[0]+"_"+ +c[1]+"_png",.5,.5);var p=this.data_json.gunsBaseNumber[o][0];u=p.length>4?p.substr(0,2)+"‧‧‧"+p.substr(p.length-2,p.length):p}else if(1==l){setTexture(d.img_prop,"prop_s_"+ +c[0]+"_"+ +c[1]+"_png",.5,.5);var g=this.data_json.propsBaseNumber[o][0];u=g.length>4?g.substr(0,2)+"‧‧‧"+g.substr(g.length-2,g.length):g}d.label_prop.text=u,this.groupLocked.addChild(d),d.y=Math.floor(a/2)*(d.height+10),d.x=21+a%2*d.width+10}}},e}(eui.Component);__reflect(LvupDialog.prototype,"LvupDialog");var UnLockItem=function(t){function e(){var e=t.call(this)||this;return e.skinName=propUnLockItem,e}return __extends(e,t),e}(eui.Component);__reflect(UnLockItem.prototype,"UnLockItem");var MailDetail=function(t){function e(e,i,s){var n=t.call(this)||this;return n.bonusItemList=[],n.skinName=MailDetailSkin,n.dispatcher=i,n.dataJson=RES.getRes("data_json"),n.mailId=e,n.callback=s,n}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.rect.touchEnabled=!0;var e=this.dispatcher.get("mails",this.mailId);this.mail=e,console.log(this.mail);var i=new eui.Group,s=new egret.ScrollView(i);this.board.addChild(s),s.x=0,s.y=0,s.width=i.width=436;var n=new eui.Label;i.addChild(n),n.size=24,n.width=436,n.lineSpacing=5,n.text=e.content,n.textColor=12154151,n.bold=!0,this.title.text=e.title;var a=new eui.Group,r=new egret.ScrollView(a);this.attachment.addChild(r),r.x=0,r.y=0,r.width=436,r.height=106;if(this.middleLine.visible=!1,e.attachment&&e.attachment.length){this.middleLine.visible=!0,s.height=350,this.attachment.visible=!0;for(var h=0,o=0;o<e.attachment.length;o+=3){var l=[e.attachment[o],e.attachment[o+1],e.attachment[o+2]],d=new AttachmentItem(l,this.dataJson);a.addChild(d),d.x=h,h+=111}}else this.middleLine.visible=!1,s.height=470,this.attachment.visible=!1;this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.okBtnClicked.bind(this),this),this.updateBtns(),this.rect.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(this.mail.attachment&&this.mail.attachment.length)this.callback();else{var t=this.okBtn.nameTF.text;"删除"==t?this.callback():this.okBtnClicked()}},this)},e.prototype.okBtnClicked=function(){var t=this.dispatcher.get("user","propHs").slice(),e=this.okBtn.nameTF.text,i="删除"==e?1:0;this.dispatcher.request("mail.check",{target:this.mailId,mode:i},function(e){var s=this;if(e)return void console.log(e);if(1==i)return void this.callback();if((null==this.mail.attachment||0==this.mail.attachment.length)&&!this.mail.expires)return void this.callback();var n=["goldAll","diamondAll"],a=[["面粉","盐","辣椒粉"],["单管炸药","双管炸药","三管炸药"],["啤酒","金酒","威士忌"]],r=[];n.forEach(function(t,e){var i=s.dispatcher.getOld("user",t)||0,n=s.dispatcher.getNew("user",t)||0;n-i>0&&r.push(-1,e,n-i)});for(var h=this.dispatcher.getNew("user","propHs"),o=0;o<a.length;o++)for(var l=a[o],d=0;d<l.length;d++)if(h){var c=h[o][d]>0?h[o][d]-t[o][d]:t[o][d]-h[o][d];c>0&&r.push(o,d,c)}this.dispatcher.getCache("showItems")(r),this.mail=this.dispatcher.get("mails",this.mailId),this.updateBtns()}.bind(this))},e.prototype.updateBtns=function(){var t=this.mail,e="";e=null==t.attachment||t.attachment==[]?t.expires?"删除":"确定":t.expires?"删除":"领取",this.okBtn.nameTF.text=e},e}(eui.Component);__reflect(MailDetail.prototype,"MailDetail");var AttachmentItem=function(t){function e(e,i){var s=t.call(this)||this;return s.skinName=HouseItem,s.itemData=e,s.dataJson=i,s}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.touchEnabled=!0,this.bgImg.touchEnabled=this.iconImg.touchEnabled=this.propImg.touchEnabled=this.propLabel.touchEnabled=this.suoImg.touchEnabled=this.suoImgBg.touchEnabled=!1;var e,i=this.itemData[0],s=this.itemData[1],n=this.itemData[2];setTexture(this.bgImg,"ck_wupin_putong_png"),-1==i?0==s?(setTexture(this.propImg,"dj_jinbi_s00_png"),this.propLabel.text="金币"):1==s&&(setTexture(this.propImg,"dj_zuanshi_s00_png"),this.propLabel.text="钻石"):(e=this.dataJson.propsBaseNumber[i+"-"+s],setTexture(this.propImg,"prop_s_"+i+"_"+s+"_png"),this.propLabel.text=e[0]),this.itemNum.visible=!0,this.itemNum.text=n+""},e}(eui.Component);__reflect(AttachmentItem.prototype,"AttachmentItem");var MailDialog=function(t){function e(e,i,s){var n=t.call(this)||this;return n.mScreenHeight=e,n.dispatcher=i,n.skinName=MailDialogSkin,n.closeCallback=s,n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),new Btn(this.backBtn,function(){e.closeCallback(),e.parent.removeChild(e)}.bind(this)),this.dispatcher.request("mail.list",{},function(t){t&&console.log(t),this.refreshList(),this.adjustUI()}.bind(this))},e.prototype.refreshList=function(){this.list.removeChildren(),this.mails=null;var t=this.dispatcher.get("mails")||{};this.mails=t;for(var e in t)t[e]&&t[e].title||delete t[e];var i=Object.keys(t),s=0,n=!1;i.sort(function(e,i){return t[e].expires-t[i].expires||t[i].create-t[e].create}).forEach(function(e,i){var a=this,r=t[e],h=r.attachment&&r.attachment.length,o=new eui.Component;o.skinName=MailItemRenderSkin,this.list.addChild(o),o.y=115*i+56,o.x=295,o.anchorOffsetX=295,o.anchorOffsetY=56,setTexture(o.bg,r.expires?"ph_db_00_png":"ph_db_01_png"),setTexture(o.icon,h?r.expires?"yx_bao2_png":"yx_bao1_png":r.expires?"yx_xin2_png":"yx_xin1_png",.5,.5),o.nameTF.text=r.title||"";var l=new Date(r.create),d=(l.getHours()>=10?"":"0")+l.getHours(),c=(l.getMinutes()>=10?"":"0")+l.getMinutes(),u=[l.getFullYear(),l.getMonth()+1,l.getDate()].join("/")+" "+[d,c].join(":");o.timeTF.text=r.expires?this.djsTimeString(r.expires-Math.max(r.create,weedon.time))+" 后自动删除":u,o.bindIndex=e,new Btn(o,function(){console.log("click item "+i);a.mails[e];a.topUi.removeChildren(),a.topBoard=new MailDetail(e,a.dispatcher,function(){a.topBoard.parent&&a.topBoard.parent.removeChild(a.topBoard),a.refreshList()}),a.topUi.addChild(a.topBoard)},null,!0),!r.expires&&(s+=1),!r.expires&&h&&(n=!0)}.bind(this)),this.numTF.text="未读邮件：  "+s+"/"+i.length,this.noneTF.visible=0==i.length,this.dispatcher.getCache("setUnReadMailCount")(s)},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e.prototype.djsTimeString=function(t){var e=Math.floor(t/36e5),i=t%36e5,s=Math.floor(i/6e4),n=Math.floor(i%6e4/1e3),a=(e>=10?"":"0")+e,r=(s>=10?"":"0")+s,h=(n>=10?"":"0")+n;return a+":"+r+":"+h},e}(eui.Component);__reflect(MailDialog.prototype,"MailDialog");var MainScene=function(t){function e(e){var i=t.call(this)||this;return i.ignoreNextResize=!1,i.target_scale=.65,i.standArray=["handgun_stand","rifle_stand","shutgun_stand","sniper_stand"],i.mPropItemsShowBool=!1,i.mCurrentPropItemIndex=0,i.mWeaponItemsShowBool=!1,i.propNumberForRed={},i.gunNumberForRed={},i.mIsShowPropBool=!1,i.guideStep=0,i.guideWaiting=!1,i.bonusShowing=!1,i.itemsData=[],i.dispatcher=e,i.skinName=MainSceneSkin,i.dispatcher.setOverrideKey("itemsGot"),i}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this._battleStartMusic=new Sound(1,"battle_start",function(){},".mp3"),this.mDataJson=RES.getRes("data_json"),this.mGameConfigJson=RES.getRes("game_config_json"),this.mActivityConfigJson=RES.getRes("activity_json"),this.clickImg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.resetPropOrWeaponScroll();var t=new SettingDialog(e.screenHeight,e.dispatcher);e.dialogGrp.addChild(t)},this),new Btn(this.chargeBtn,function(){e.showChargeBoard()}),new Btn(this.buyTiBtn,function(){e.showStrengeBoard()}),setTexture(this.leftBtn.tfImg,"new_tf_paiweizhan_png",.5,.5),this.leftBtn.leftBg.visible=!0,this.leftBtn.rightBg.visible=!1,this.leftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.startRankingBattle()},this),setTexture(this.rightBtn.tfImg,"new_tf_haoyouduijue_png",.5,.5),this.rightBtn.tfImg.x=174,this.rightBtn.leftBg.visible=!1,this.rightBtn.rightBg.visible=!0,this.rightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.resetPropOrWeaponScroll(),e.startFriendBattle()},this);var i=(this.standArray,this.dispatcher.get("user","gender")),s=Math.max(this.dispatcher.get("user","cap")-1e4,0);i=-1==i?1:i;var n=this.target=new Animation("chr"+i);n.setSlot("hat",createBitmap("zs_maozi_b0"+s+"_png",.5,.5,0,0,this.target_scale,this.target_scale)),this.personGrp.addChild(n),n.x=330,n.y=170,n.scaleX=n.scaleY=this.target_scale,this.updatePropHs(),this.itemList=new ItemList(this.dispatcher),this.propGrp.addChild(this.itemList),this.itemList.setList(this.mPropItemKeys,1,function(t,i){if(t.replace("_","-")==e.mCurrentPropIndex||-1>i)return void e.itemList.hide();var s=""==t?1:0;e.dispatcher.request("propHs.changeProps",{mode:s,propIndex:t.replace("_","-")},function(t){return t?void console.log(t):(e.showWuPinInfo("prop"),e.itemList.refreshBgImg(),void e.itemList.hide())}.bind(e))}.bind(this),this.mPropItemNums),this.itemList.anchorOffsetX=this.itemList.anchorOffsetY=205,this.itemList.x=this.propMc.x+90-90,this.itemList.y=this.propMc.y+100-101,this.propMc.clickImg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ActionUtils.runBtnAction(e.propMc),e.weaponItemList.isShow&&e.weaponItemList.hide(),e.itemList.isShow?e.itemList.hide():e.itemList.show()},this),this.updateWeaponHs(),this.weaponItemList=new ItemList(this.dispatcher,1),this.propGrp.addChild(this.weaponItemList),this.weaponItemList.setList(this.mWeaponItemKeys,2,function(t,i){return t.replace("_","-")==e.mCurrentWeaponIndex?void e.weaponItemList.hide():void e.dispatcher.request("propHs.changeGun",{gunIndex:t.replace("_","-")},function(t){return t?void console.log(t):(e.showWuPinInfo("weapon"),e.weaponItemList.refreshBgImg(),void e.weaponItemList.hide())}.bind(e))}.bind(this)),this.weaponItemList.anchorOffsetX=this.weaponItemList.anchorOffsetY=205,this.weaponItemList.x=this.weaponMc.x+100-112,this.weaponItemList.y=this.weaponMc.y+100-101,this.weaponMc.clickImg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ActionUtils.runBtnAction(e.weaponMc),e.itemList.isShow&&e.itemList.hide(),e.weaponItemList.isShow?e.weaponItemList.hide():e.weaponItemList.show()},this),setTexture(this.tabBtn1.tfImg,"new_tf_cangku_png"),new Btn(this.tabBtn1,function(){e.resetPropOrWeaponScroll(),e.currentPage=new HouseScene(e.dispatcher,function(t){this.currentPage.parent&&this.currentPage.parent.removeChild(this.currentPage),this.refreshData(),this.updatePropHs(),this.itemList.resetList(this.mPropItemKeys,this.mPropItemNums),this.weaponItemList.refreshBgImg(),this.itemList.refreshBgImg(),1==t&&this.showChargeBoard()}.bind(e),e.screenHeight),e.dialogGrp.addChild(e.currentPage)}),setTexture(this.tabBtn2.tfImg,"new_tf_paihangbang_png"),new Btn(this.tabBtn2,function(){e.resetPropOrWeaponScroll();var t=new RankDialog(e.screenHeight,e.dispatcher);e.dialogGrp.addChild(t)}),setTexture(this.tabBtn3.tfImg,"new_tf_youjian_png"),new Btn(this.tabBtn3,function(){e.resetPropOrWeaponScroll();var t=new MailDialog(e.screenHeight,e.dispatcher,function(){this.refreshData()}.bind(e));e.dialogGrp.addChild(t)}),setAvatar(this.headImg,this.dispatcher.get("user","avatar")||0,this.dispatcher.get("user","avatarUrl")||""),this.nameTF.text=this.dispatcher.get("user","nickname"),this.mLastGetTiTime=0==this.dispatcher.get("user","lastGetStrenge")?weedon.time:this.dispatcher.get("user","lastGetStrenge"),this.mCurrentTiNum=this.dispatcher.get("user","strenge")||0,this.mMaxTiNum=this.dispatcher.get("user","strengeLimit")||this.mGameConfigJson.userConfig.strengeMax,console.log(this.mLastGetTiTime),this.refreshData(),this.startAccelerometer(),this.stage.addEventListener(egret.Event.RESIZE,this.adjustUI,this),this.adjustUI(),this.dispatcher.get("user","guide")<3&&0!=this.dispatcher.get("info","action")&&this.continueGuide(),egret.startTick(this.update,this);var a=this.dispatcher.get("user","userSetting")||0,r=0!=(1&a);if(!formula.getBgMusic())var h=new Sound(0,"bg_game",function(){formula.initBgMusic(h),r&&h.play(0),console.log(h.playing)},".mp3");this.dispatcher.setCache("showItems",this.showItems.bind(this)),this.dispatcher.setCache("showAlert",this.showAlert.bind(this)),this.dispatcher.setCache("showRemind",this.showRemind.bind(this)),this.dispatcher.setCache("notifyPropUnlocked",this.notifyPropUnlocked.bind(this)),this.dispatcher.setCache("notifyPropDetailRead",this.notifyPropDetailRead.bind(this)),this.dispatcher.setCache("getPropUnLocked",function(){return e.propNumberForRed}),this.dispatcher.setCache("getGunUnLocked",function(){return e.gunNumberForRed}),this.dispatcher.setCache("setUnReadMailCount",this.showUnreadMailCount.bind(this)),this.dispatcher.setCache("share",this.share.bind(this)),this.dispatcher.setCache("showCompareBoard",this.showCompareBoard.bind(this)),this.dispatcher.setCache("showGroupUsers",this.showGroupUsers.bind(this)),this.dispatcher.setCache("getShareBonus",this.getShareBonus.bind(this)),this.dispatcher.setCache("getCanGetShareBonus",this.getCanGetShareBonus.bind(this)),CAN_FRIEND_BATTLE=this.dispatcher.get("user","guide")>2;var o=this.dispatcher.get("info","from"),l=this.dispatcher.get("info","action"),d=this.dispatcher.get("info","shareTicket"),c=this.dispatcher.get("user","openId");d?weedon.getShareInfo(c,d,function(t){this.shareAction(l,o,t.openGId)}.bind(this)):this.shareAction(l,o),weedon.onShow(function(t,e){e?weedon.getShareInfo(c,e,function(e){this.shareAction(t.action,t.from,e.openGId)}.bind(this)):this.shareAction(t.action,t.from)}.bind(this)),this.initUnreadMailCount(),new Btn(this.dwMc,function(){var t=new RankInsBoard;e.dialogGrp.addChild(t)})},e.prototype.getCanGetShareBonus=function(){return(this.dispatcher.get("user","dailyShareNum")||0)<this.mActivityConfigJson.share.dailyShareMax},e.prototype.getShareBonus=function(t){var e=this;if((this.dispatcher.get("user","dailyShareNum")||0)>=this.mActivityConfigJson.share.dailyShareMax||(weedon.time-this.dispatcher.get("user","lastShare")||0)<1e3*RES.getRes("activity_json").share.shareInterval)return void console.log("getnot get bonus");var i=this.dispatcher.get("user","strenge")||0;this.dispatcher.request("share.getBonus",{},function(s){s&&console.log(s);var n=e.dispatcher.get("user","strenge")||0;if(n>i){var a="体力+"+(n-i);e.showRemind(1,a)}t&&t()})},e.prototype.initUnreadMailCount=function(){this.dispatcher.request("mail.list",{},function(t){t&&console.log(t);var e=this.dispatcher.get("mails")||{};for(var i in e)e[i]&&e[i].title||delete e[i];var s=Object.keys(e),n=0;s.forEach(function(t,i){var s=e[t];!s.expires&&(n+=1)}.bind(this)),this.showUnreadMailCount(n)}.bind(this))},e.prototype.notifyPropUnlocked=function(t,e){switch(t){case 0:this.gunNumberForRed[e]=1;break;case 1:this.propNumberForRed[e]=1;break;default:return}var i=Object.keys(this.gunNumberForRed).length+Object.keys(this.propNumberForRed).length;this.setHouseRedPoint(i)},e.prototype.notifyPropDetailRead=function(t,e){switch(t){case 0:this.gunNumberForRed[e]&&delete this.gunNumberForRed[e];break;case 1:this.propNumberForRed[e]&&delete this.propNumberForRed[e];break;default:return}var i=Object.keys(this.gunNumberForRed).length+Object.keys(this.propNumberForRed).length;this.setHouseRedPoint(i)},e.prototype.setHouseRedPoint=function(t){this.tabBtn1&&(this.houseRedPoint||(this.houseRedPoint=new RedPoint,this.tabBtn1.addChild(this.houseRedPoint),this.houseRedPoint.visible=!1,this.houseRedPoint.x=10,this.houseRedPoint.y=10,this.houseRedPoint.anchorOffsetX=this.houseRedPoint.anchorOffsetY=20),this.houseRedPoint.visible=t>0,this.houseRedPoint.visible&&this.houseRedPoint.setNumber(t))},e.prototype.showUnreadMailCount=function(t){this.tabBtn3&&(this.mailRedPoint||(this.mailRedPoint=new RedPoint,this.tabBtn3.addChild(this.mailRedPoint),this.mailRedPoint.visible=!1,this.mailRedPoint.x=10,this.mailRedPoint.y=10,this.mailRedPoint.anchorOffsetX=this.mailRedPoint.anchorOffsetY=20),this.mailRedPoint.visible=t>0,this.mailRedPoint.visible&&this.mailRedPoint.setNumber(Math.min(99,t)))},e.prototype.shareAction=function(t,e,i){0==(this.dispatcher.get("user","guide")||0);switch(i&&this.dispatcher.request("user.joinGroup",{openGId:i}),t){case 0:this.joinFriendBattle(e);break;case 1:e?this.showCompareBoard(e):i&&this.showGroupUsers(i);break;case 2:}},e.prototype.showCompareBoard=function(t){this.resetPropOrWeaponScroll(),this.rankCompareBoard?(!this.rankCompareBoard.parent&&this.dialogGrp.addChild(this.rankCompareBoard),this.rankCompareBoard.updateUi(t)):(this.rankCompareBoard=new RankCompareBoard(this.screenHeight,this.dispatcher,t),this.dialogGrp.addChild(this.rankCompareBoard))},e.prototype.showGroupUsers=function(t){this.resetPropOrWeaponScroll(),this.groupRankDialog?(!this.groupRankDialog.parent&&this.dialogGrp.addChild(this.groupRankDialog),this.groupRankDialog.updateUi(t)):(this.groupRankDialog=new GroupRankDialog(this.screenHeight,this.dispatcher,t),this.dialogGrp.addChild(this.groupRankDialog))},e.prototype.share=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,s,n,a,r,h;return __generator(this,function(o){switch(o.label){case 0:switch(i=t){case 0:return[3,1];case 1:return[3,2];case 2:return[3,3];case 3:return[3,8]}return[3,9];case 1:return weedon.share({title:this.dispatcher.get("user","nickname")+"邀请你参加好友对战",imageUrl:"https://xbwz-resource.hortor.net/resource/assets/Share/xbwz_fx_00.jpg",query:"from="+this.dispatcher.get("user","_id")+"&action=0"},function(t,i){t||(i.shareTickets&&weedon.getShareInfo(this.dispatcher.get("user","openId"),i.shareTickets[0],function(t){this.dispatcher.request("user.joinGroup",{openGId:t.openGId})}.bind(this)),e())}.bind(this)),[3,9];case 2:return console.log("排名分享"),weedon.share({title:"西部牛仔只有一个，那就是我"+this.dispatcher.get("user","nickname"),imageUrl:"https://xbwz-resource.hortor.net/resource/assets/Share/xbwz_fx_10.jpg",query:"from="+this.dispatcher.get("user","_id")+"&action=1"},function(t,i){t||(i.shareTickets?weedon.getShareInfo(this.dispatcher.get("user","openId"),i.shareTickets[0],function(t){this.dispatcher.request("user.joinGroup",{openGId:t.openGId}),e(t.openGId)}.bind(this)):e())}.bind(this)),[3,9];case 3:return s=new ShareImage(400,320),n=this.dispatcher.get("battle"),a=this.dispatcher.get("user"),[4,s.addImage("https://xbwz-resource.hortor.net/resource/assets/Share/xbwz_fx_20.jpg",0,0,0,0,1,1,0)];case 4:return o.sent(),[4,s.addImage("https://xbwz-resource.hortor.net/resource/assets/ui/weapon_l_"+a.gunIndex.replace("-","_")+".png",.5,.5,280,110,.8,.8)];case 5:return o.sent(),[4,s.addImage(a.avatarUrl.replace(/\/0$/,"/96"),.5,.5,100,100,1,1,0)];case 6:return o.sent(),[4,s.addImage("https://xbwz-resource.hortor.net/resource/assets/ui/sy_touxiang.png",.5,.5,100,100,1.1,1.1)];case 7:return o.sent(),r=n["battleParams"+a._id].split("-"),s.addLabel(""+r[0],24,16777096,93,290,.5,.5,0,0,!0),s.addLabel(""+r[1],24,16777096,200,290,.5,.5,0,0,!0),s.addLabel(""+r[2],24,16777096,304,290,.5,.5,0,0,!0),h=s.saveToFile(new egret.Rectangle(0,0,400,320)),weedon.share({title:"西部牛仔只有一个，那就是我"+a.nickname,imageUrl:h,query:"from="+a._id+"&action=2"},function(t,i){t||(i.shareTickets?weedon.getShareInfo(this.dispatcher.get("user","openId"),i.shareTickets[0],function(t){this.dispatcher.request("user.joinGroup",{openGId:t.openGId}),e(t.openGId)}.bind(this)):e())}),[3,9];case 8:return weedon.share({title:"你的败因只有一个，那就是与我为敌！",imageUrl:"https://xbwz-resource.hortor.net/resource/assets/Share/xbwz_fx_01.png",query:"from="+this.dispatcher.get("user","_id")+"&action=2"},function(t,i){t||(i.shareTickets?weedon.getShareInfo(this.dispatcher.get("user","openId"),i.shareTickets[0],function(t){this.dispatcher.request("user.joinGroup",{openGId:t.openGId}),e(t.openGId)}.bind(this)):e())}.bind(this)),[3,9];case 9:return[2]}})})},e.prototype.loadResource=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.loadingView||(this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView)),this.loadingView.visible=!0,[4,RES.loadGroup(t,0,this.loadingView)];case 1:return e.sent(),[2]}})})},e.prototype.continueGuide=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,s,n=this;return __generator(this,function(a){switch(a.label){case 0:switch(t=this.dispatcher.get("user","guide"),e=t){case 0:return[3,1];case 1:return[3,5];case 2:return[3,5]}return[3,6];case 1:return~this.dispatcher.get("user","cap")?[3,3]:[4,this.loadResource("login")];case 2:return a.sent(),i=new SelectScene(this.dispatcher,function(){var t=this;i.parent&&i.parent.removeChild(i);var e=new Duel(this.dispatcher,function(){t.continueGuide()}.bind(this));this.addChild(e)}.bind(this)),this.addChild(i),this.loadingView.visible=!1,[3,4];case 3:s=new Duel(this.dispatcher,function(){n.continueGuide()}.bind(this)),this.addChild(s),a.label=4;case 4:return[3,6];case 5:return this.showGuide(),[3,6];case 6:return[2]}})})},e.prototype.startFriendBattle=function(){this.lastFBMode=1,"undefined"==typeof GameGlobal?this.dispatcher.request("friendBattle.prepare",{},function(){var t=new MatchingScene(this.screenHeight,this.dispatcher,this.matchingSceneCallBack.bind(this));this.dialogGrp.addChild(t)}.bind(this)):this.dispatcher.request("friendBattle.info",{},function(){var t=this.dispatcher.get("friendBattle","invitation");if(!t||+t<weedon.time)this.share(2,function(){this.dispatcher.request("friendBattle.prepare",{},function(){var t=new MatchingScene(this.screenHeight,this.dispatcher,this.matchingSceneCallBack.bind(this));this.dialogGrp.addChild(t)}.bind(this))}.bind(this));else{var e=new MatchingScene(this.screenHeight,this.dispatcher,this.matchingSceneCallBack.bind(this));this.dialogGrp.addChild(e)}}.bind(this))},e.prototype.joinFriendBattle=function(t){this.dispatcher.request("friendBattle.join",{from:t},function(t){if(t){var e=new FBInvalidPanel(+(!!~this.dispatcher.get("user","cap")&&this.dispatcher.get("user","guide")>2),t,function(t){switch(e.parent&&e.parent.removeChild(e),t){case 0:this.startFriendBattle();break;case 1:break;case 2:this.continueGuide()}}.bind(this));return void this.dialogGrp.addChild(e)}this.lastFBMode=2;var i=new MatchingScene(this.screenHeight,this.dispatcher,this.matchingSceneCallBack.bind(this),2);this.dialogGrp.addChild(i)}.bind(this))},e.prototype.matchingSceneCallBack=function(t){this.dialogGrp&&this.dialogGrp.removeChildren(),-1==t||1==t&&this.startRankingBattle(!0)},e.prototype.adjustUI=function(){return this.ignoreNextResize?void(this.ignoreNextResize=!1):(this.ignoreNextResize=!0,weedon.winSize.width/weedon.winSize.height>.64?(this.stage.setContentSize(640,1e3),this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL,this.screenHeight=1e3,this.y=-193,this.topUI.y=-this.y,this.bottomUI.y=this.screenHeight+193-100):(this.stage.setContentSize(640,1386),this.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,this.screenHeight=640/weedon.winSize.width*weedon.winSize.height,this.screenHeight>1300?(this.y=-(1500-this.screenHeight)/2,this.topUI.y=-this.y+50,this.bottomUI.y=this.screenHeight-this.y-100,this.dialogGrp.y=50):(this.y=-(1386-this.screenHeight)/2,this.topUI.y=-this.y,this.bottomUI.y=this.screenHeight-this.y-100)),void(this.duelGrp.y=-this.y))},e.prototype.startRankingBattle=function(t){var e=this;if(!t&&(this.dispatcher.get("user","strenge")||0)<1)return void this.showRemind(0,"体力不足。\n是否前往购买体力？",function(){e.showStrengeBoard()});this.guideOld=this.dispatcher.get("user","guide")||0,this.resetPropOrWeaponScroll();var i=new QualifyingScene(this.screenHeight,this.dispatcher,function(e){if(1==e){weedon.vibrate(!0);var i=formula.getBgMusic();i&&i.stop(),this._battleStartMusic&&this._battleStartMusic.play(1);var s=new Duel(this.dispatcher,function(){this.showBattleRet(t),s.parent&&s.parent.removeChild(s),s=null}.bind(this),t);this.duelGrp.addChild(s)}else-1==e&&(this.startAccelerometer(),this.dispatcher.request("user.leave",{},function(){}.bind(this)))}.bind(this),t||!1);this.dialogGrp.addChild(i)},e.prototype.update=function(){this.checkItem(),this.checkTiLi()},e.prototype.refreshData=function(){this.lvTF.text="等级"+formula.getULevel(this.dispatcher.get("user","experience")||0);var t=this.getExpInfo();t.isMax?this.expPrg.value=100:this.expPrg.value=t.curExp/t.totalExp*100,this.coinTF.text=(this.dispatcher.get("user","goldAll")||0)-(this.dispatcher.get("user","goldCost")||0),this.diamondTF.text=(this.dispatcher.get("user","diamondAll")||0)-(this.dispatcher.get("user","diamondCost")||0),this.mCurrentTiNum=this.dispatcher.get("user","strenge")||0,this.prgMc.value=this.mCurrentTiNum/this.mMaxTiNum*100,this.prgTF.text=this.mCurrentTiNum+"/"+this.mMaxTiNum,MainSceneConfig.rankLv=this.dispatcher.get("user","rankLv")||0,ActionUtils.refreshDwMc(this.dwMc,MainSceneConfig.rankLv),this.showWuPinInfo()},e.prototype.checkTiLi=function(){if(this.mCurrentTiNum>=this.mMaxTiNum)return void(this.prgCd.text="");var t=weedon.time-this.mLastGetTiTime,e=1e3*this.mGameConfigJson.userConfig.strengeInteval;t>=e&&(this.mLastGetTiTime=weedon.time,this.mCurrentTiNum++,this.prgMc.value=this.mCurrentTiNum/this.mMaxTiNum*100,this.prgTF.text=this.mCurrentTiNum+"/"+this.mMaxTiNum),this.prgCd.text=DateUtils.getDateInfoByType((e-t)/1e3/60,1)},e.prototype.showWuPinInfo=function(t){if(void 0===t&&(t="all"),("prop"==t||"all"==t)&&(this.mCurrentPropIndex=this.dispatcher.get("user","propIndex"),""!=this.dispatcher.get("user","propIndex")?(this.propMc.noneImg.visible=!1,setTexture(this.propMc.iconImg,"prop_l_"+this.mCurrentPropIndex.replace("-","_")+"_png")):(this.propMc.iconImg.texture=null,this.propMc.noneImg.visible=!0)),"weapon"==t||"all"==t){this.mCurrentWeaponIndex=this.dispatcher.get("user","gunIndex"),this.target.play(this.standArray[this.mCurrentWeaponIndex.substr(0,1)],0);var e=this.dispatcher.get("user","gunHs")||[[0,-1],[-1,-1],[-1,-1],[-1,-1]],i=e[+this.mCurrentWeaponIndex.substr(0,1)][+this.mCurrentWeaponIndex.substr(2,1)],s=new eui.Group;if(s.addChild(createBitmap("weapon_m_"+this.mCurrentWeaponIndex.replace("-","_")+"_png",.5,.5,0,0,1,1)),i==RES.getRes("game_config_json").buttleConfig.experGunMax){var n=new Animation("se_maxlevel");n.x=0,n.y=0,n.play("stand",0),s.addChild(n)}this.target.setSlot("gun0",s),""!=this.dispatcher.get("user","gunIndex")?setTexture(this.weaponMc.iconImg,"weapon_l_"+this.mCurrentWeaponIndex.replace("-","_")+"_png"):this.weaponMc.iconImg.texture=null}},e.prototype.startAccelerometer=function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).stopAccelerometer({complete:function(){var t=this;("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).startAccelerometer({success:function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).onAccelerometerChange(function(e){var i="undefined"==typeof GameGlobal?e.x:e.y;t.grassImg.x=26+30*i,t.carImg.x=-10+16*i,t.bg.x=-30+10*i,t.target.x=330+23*i}.bind(t))}.bind(this)})}.bind(this)})
},e.prototype.showBattleRet=function(t){this.rankOld=MainSceneConfig.rankLv||0,this.showBattleRetBoard=new BattleEndDialog(this.screenHeight,this.dispatcher,function(e,i){var s=this;switch(e){case 0:t?this.dispatcher.request("friendBattle.leave",{},function(){this.finishBattle()}.bind(this)):this.finishBattle();break;case 1:t?this.dispatcher.request("friendBattle.resume",{},function(t){if(t){var e=new FBInvalidPanel(+(!!~this.dispatcher.get("user","cap")&&this.dispatcher.get("user","guide")>2),t,function(t){switch(e.parent&&e.parent.removeChild(e),t){case 0:this.startFriendBattle();break;case 1:break;case 2:this.continueGuide()}}.bind(this));return void this.dialogGrp.addChild(e)}var i=new MatchingScene(this.screenHeight,this.dispatcher,this.matchingSceneCallBack.bind(this),this.lastFBMode);this.dialogGrp.addChild(i)}.bind(this)):this.finishBattle();break;case 2:this.updateWeaponHs(),this.weaponItemList.resetList(this.mWeaponItemKeys),this.upDialog=new LvupDialog(this.screenHeight,this.dispatcher,function(){s.dialogGrp.removeChild(s.upDialog),i&&i()}.bind(this)),this.dialogGrp.addChild(this.upDialog);break;case 3:this.rankUpBoard=new BattleEndRankBoard(this.dispatcher,this.rankOld,function(t){return-1==t?void(s.rankUpBoard.parent&&s.rankUpBoard.parent.removeChild(s.rankUpBoard)):void 0}),this.dialogGrp.addChild(this.rankUpBoard);break;case 4:this.superShareBoard=new SuperShareBoard(this.dispatcher,function(){}),this.dialogGrp.addChild(this.superShareBoard)}}.bind(this),t),this.dialogGrp.addChild(this.showBattleRetBoard),this.startAccelerometer(),this.refreshData()},e.prototype.finishBattle=function(t){var e=this,i=this.dispatcher.get("user","userSetting")||0,s=0!=(1&i),n=formula.getBgMusic();n&&s&&n.play(0),this.dialogGrp&&this.dialogGrp.removeChildren(),this.duelGrp&&this.duelGrp.removeChildren(),this.refreshData(),this.updatePropHs(),this.itemList.resetList(this.mPropItemKeys,this.mPropItemNums),this.weaponItemList.refreshBgImg(),this.itemList.refreshBgImg();var a=this.dispatcher.get("user","guide")||0;if(this.guideOld<3&&3==a&&!t){var r=new NewUserRetBoard(function(){try{e.dialogGrp.removeChild(r),e.guide.visible=!1}catch(t){console.log(t),window.alert(t)}}.bind(this));this.dialogGrp.addChild(r)}},e.prototype.resetPropOrWeaponScroll=function(){this.itemList.isShow&&this.itemList.hide(),this.weaponItemList.isShow&&this.weaponItemList.hide()},e.prototype.getExpInfo=function(){for(var t=this.dispatcher.get("user","experience")||0,e=0,i=0;i<this.mDataJson.lvExpers.length;i++){var s=this.mDataJson.lvExpers[i];if(s>t)return e=i+1,e==this.mDataJson.lvExpers.length?{lv:e,isMax:!0}:{lv:e,isMax:!1,curExp:t-(this.mDataJson.lvExpers[i-1]||0),totalExp:s-(this.mDataJson.lvExpers[i-1]||0)}}return{lv:e,isMax:!0}},e.prototype.updatePropHs=function(){this.mPropItemKeys=[""],this.mPropItemNums=[0];for(var t=this.dispatcher.get("user","propHs"),e=0;e<t.length;e++)for(var i=t[e],s=0;s<i.length;s++)(i[s]>0||i[s]<-1)&&(this.mPropItemKeys.push(e+"_"+s),this.mPropItemNums.push(i[s]))},e.prototype.updateWeaponHs=function(){this.mWeaponItemKeys=[];for(var t=this.dispatcher.get("user","gunHs"),e=0;e<t.length;e++)for(var i=t[e],s=0;s<i.length;s++)i[s]>=0&&this.mWeaponItemKeys.push(e+"_"+s);console.log(this.mWeaponItemKeys)},e.prototype.setOtherBtn=function(t){[this.tabBtn1,this.tabBtn2,this.tabBtn3,this.prgTF,this.prgCd,this.chargeBtn,this.buyTiBtn,this.tImg,this.prgMc,this.dwMc].forEach(function(e){e.visible=t})},e.prototype.showGuide=function(){this.guide.touchEnabled=!0,this.guide.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.guideWaiting||(this.guideStep+=1,this.updateGuide())},this);var t=new egret.DisplayObjectContainer,e=new egret.Shape;t.addChild(e),e.graphics.beginFill(0,.5),e.graphics.drawRect(0,0,640,1386),e.graphics.endFill();var i=new egret.Shape;t.addChild(i),i.graphics.beginFill(0,1),i.graphics.drawCircle(320,693,50),i.graphics.endFill(),i.blendMode=egret.BlendMode.ERASE;var s=new egret.RenderTexture;s.drawToTexture(t),this.holeCover=new eui.Image(s),this.holeCover.anchorOffsetX=320,this.holeCover.anchorOffsetY=693,this.holeCover.x=320,this.holeCover.y=693,this.holeCover.scaleX=this.holeCover.scaleY=4,this.holeCover.visible=!1,this.holeCover.touchEnabled=!1,this.guide.addChildAt(this.holeCover,0),this.yindaoAni=new Animation("xs_yindaohand"),this.guide.addChild(this.yindaoAni),this.yindaoAni.play("stand",0),this.yindaoAni.visible=!1,2==this.dispatcher.get("user","guide")&&(this.guideStep=6),this.guide.visible=!0,this.guideDialog.visible=!1,this.updateGuide()},e.prototype.updateGuide=function(){var t=this;switch(this.guideStep){case 0:this.guideWaiting=!0,this.showHole(605,885,function(){this.guideDialog.visible=!0,this.showText(20,"在决斗前记得要检查自己的枪！"),this.guideWaiting=!1}.bind(this));break;case 1:this.guideWaiting=!0,this.weaponItemList.show(),this.showHole(580,720,function(){this.guideWaiting=!1}.bind(this),500);break;case 2:this.guideWaiting=!0,this.guideDialog.visible=this.holeCover.visible=this.yindaoAni.visible=!1,this.weaponItemList.hide(),egret.Tween.get(this).wait(500).call(function(){this.guideStep+=1,this.updateGuide()},this);break;case 3:this.showHole(45,885,function(){this.guideDialog.visible=!0,this.showText(20,"装备合适的道具可以让你在决斗中取得优势！"),this.guideWaiting=!1}.bind(this));break;case 4:this.guideWaiting=!0,this.itemList.show(),this.showHole(150,765,function(){this.guideWaiting=!1}.bind(this),500);break;case 5:this.guideWaiting=!0,this.guideDialog.visible=this.holeCover.visible=this.yindaoAni.visible=!1,this.dispatcher.request("propHs.changeProps",{mode:0,propIndex:"1-0"},function(e){return e?void console.log(e):(t.showWuPinInfo("prop"),t.itemList.refreshBgImg(),t.itemList.hide(),void egret.Tween.get(t).wait(500).call(function(){this.guideStep+=1,this.updateGuide()},t))}.bind(this));break;case 6:this.guideWaiting=!0,this.showHole(this.bottomUI.x+this.leftBtn.x+this.leftBtn.width/2,this.bottomUI.y+this.leftBtn.y+this.leftBtn.height/2,function(){this.guideDialog.visible=!0,this.showText(20,"在你想要对决时，排位战可以随时为你找到一个对手！"),this.guideWaiting=!1}.bind(this));break;case 7:this.guideDialog.visible=this.holeCover.visible=this.yindaoAni.visible=!1,this.startRankingBattle()}},e.prototype.showText=function(t,e){this.guideDialog.visible=!0,this.guideDialog.y=t,"string"==typeof e?this.guideText.text=e:this.guideText.textFlow=e},e.prototype.showHole=function(t,e,i,s){this.yindaoAni.visible=!1,this.holeCover.visible=!1,egret.Tween.get(this.holeCover).wait(s||0).call(function(){this.holeCover.visible=!0,this.holeCover.x=t,this.holeCover.y=e,this.holeCover.scaleX=this.holeCover.scaleY=4},this).to({scaleX:2,scaleY:2},300).wait(500).call(function(){this.yindaoAni.x=t,this.yindaoAni.y=e,this.yindaoAni.visible=!0,i()},this)},e.prototype.showItems=function(t){this.itemsData=this.itemsData.concat(t),console.log(this.itemsData)},e.prototype.checkItem=function(){if(!this.bonusShowing){var t=this.itemsData.shift();if(void 0!=t){this.bonusShowing=!0;var e=this.itemsData.shift(),i=this.itemsData.shift(),s=new BonusItem;this.itemsShowGrp.addChild(s);var n;if(-1==t)setTexture(s.itemImg,0==e?"sy_jinbi_png":"sy_zuanshi_png",.5,.5),n=this.img_coin;else{setTexture(s.itemImg,"prop_s_"+t+"_"+e+"_png",.5,.5),n=this.tabBtn1}s.itemNum.text=i+"",s.targetX=n.x,s.targetY=n.y,s.x=320,s.y=693,s.anchorOffsetX=s.width/2,s.anchorOffsetY=s.height/2;var a=new Animation("se_getitem");s.addChildAt(a,0),a.x=53,a.y=53,a.play("stand",0),egret.Tween.get(s).wait(1e3).to({x:s.targetX,y:s.targetY},1e3).call(function(){this.itemsShowGrp.removeChild(s),this.bonusShowing=!1}.bind(this),this)}}},e.prototype.showAlert=function(t){this.alertBoard||(this.alertBoard=new AlertBoard),this.alertBoard.parent&&this.alertBoard.parent.removeChild(this.alertBoard),this.alertGroup.addChild(this.alertBoard),this.alertBoard.setInfo(t),this.alertBoard.anchorOffsetX=this.alertBoard.width/2,this.alertBoard.anchorOffsetY=this.alertBoard.height/2,this.alertBoard.x=320,this.alertBoard.y=693},e.prototype.showRemind=function(t,e,i){this.remindBoard||(this.remindBoard=new RemindBoard),this.remindBoard.parent&&this.remindBoard.parent.removeChild(this.remindBoard),this.alertGroup.addChild(this.remindBoard),this.remindBoard.setInfo(t,e,i),this.remindBoard.anchorOffsetX=this.remindBoard.width/2,this.remindBoard.anchorOffsetY=this.remindBoard.height/2,this.remindBoard.x=320,this.remindBoard.y=693},e.prototype.showChargeBoard=function(){this.resetPropOrWeaponScroll();var t=new ChargeDialog(this.screenHeight,this.dispatcher);this.dialogGrp.addChild(t)},e.prototype.showStrengeBoard=function(){var t=this;this.resetPropOrWeaponScroll();var e=new BuyTiDialog(this.screenHeight,this.dispatcher,function(){t.refreshData()});this.dialogGrp.addChild(e)},e}(eui.Component);__reflect(MainScene.prototype,"MainScene");var NewUserRetBoard=function(t){function e(e){var i=t.call(this)||this;return i.skinName=NewUserRetBoardSkin,i.callback=e,i}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),setTexture(this.itemMc.bgImg,"ck_wupin_putong_png"),setTexture(this.itemMc.propImg,"prop_s_1_0_png"),this.itemMc.iconImg.visible=!1,this.itemMc.propLabel.text="单管炸弹",this.itemMc.itemNum.text="5",this.itemMc.propLabel.textColor=12154151,setTexture(this.getBtn.tfImg,"lignqu_png"),new Btn(this.getBtn,function(){ActionUtils.runBtnAction(e.getBtn),e.callback&&e.callback()})},e}(eui.Component);__reflect(NewUserRetBoard.prototype,"NewUserRetBoard");var BonusItem=function(t){function e(){var e=t.call(this)||this;return e.skinName=BonusItemSkin,e}return __extends(e,t),e}(eui.Component);__reflect(BonusItem.prototype,"BonusItem");var DateUtils=function(){function t(){}return t.getFormatTime=function(t){var e=new Date(t);return{Y:e.getFullYear(),M:this.formatNumber(e.getMonth()+1),D:this.formatNumber(e.getDate()),h:this.formatNumber(e.getHours()),m:this.formatNumber(e.getMinutes()),s:this.formatNumber(e.getSeconds())}},t.getDateInfoByType=function(t,e){var i=this.formatReaminTime(t);return 1==e?this.formatNumber(i.min)+":"+this.formatNumber(i.second):void 0},t.formatReaminTime=function(t){t=Math.max(0,t);var e=Math.floor(t/1440);t-=1440*e;var i=Math.floor(t/60);t-=60*i;var s=Math.floor(t);t-=s;var n=Math.floor(60*t);return{day:e,hour:i,min:s,second:n}},t.formatNumber=function(t){return 10>t?"0"+t:t},t}();__reflect(DateUtils.prototype,"DateUtils");var ItemList=function(t){function e(e,i){var s=t.call(this)||this;return s.isEnabled=!1,s.moved=!1,s.isShow=!1,s.currentFirst=0,s.itemOffset=0,s.dispatcher=e,s.mode=i||0,s.skinName=i?MainRotation2Skin:MainRotationComSkin,s.touchEnabled=!0,s.addEventListener(egret.TouchEvent.TOUCH_BEGIN,s._touchBegin,s),s.addEventListener(egret.TouchEvent.TOUCH_MOVE,s._touchMove,s),s.addEventListener(egret.TouchEvent.TOUCH_END,s._touchEnd,s),s.visible=!1,s}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.startPoint=new egret.Point,this.currentPoint=new egret.Point},e.prototype._touchBegin=function(t){this.startRotation=this.itemList.rotation,this.globalToLocal(t.stageX,t.stageY,this.startPoint),this.startAngle=Math.atan((this.startPoint.y-210)/(this.startPoint.x-210))/Math.PI*180,this.startAngle=this.startPoint.x<210?180+this.startAngle:this.startAngle},e.prototype._touchMove=function(t){if(!(this.list.length<6)){this.globalToLocal(t.stageX,t.stageY,this.currentPoint);var e=Math.atan((this.currentPoint.y-210)/(this.currentPoint.x-210))/Math.PI*180;e=this.currentPoint.x<210?180+e:e,this.moved=Math.abs(e-this.startAngle)>1,this.itemList.rotation=this.startRotation+e-this.startAngle;for(var i=0;8>i;++i)this["p"+i].rotation=-this.itemList.rotation;var s;s=this.mode?this.itemList.rotation>=0?Math.floor(this.itemList.rotation/45):7+Math.ceil(this.itemList.rotation/45):this.itemList.rotation>0?7-Math.floor(this.itemList.rotation/45):Math.floor(-this.itemList.rotation/45),this.updateList(s)}},e.prototype._touchEnd=function(t){if(this.moved)return void(this.moved=!1);for(var e=0;8>e;e++)t.target==this["p"+e]&&(this.callback&&this.callback(this.mCurrentDic["p"+e].str,this.mCurrentDic["p"+e].index),console.log("选中p"+e+",index="+this.mCurrentDic["p"+e].str+",num="+this.mCurrentDic["p"+e].index))},e.prototype.show=function(){this.isShow=!0,this.visible=!0,this.isEnabled=!1,this.scaleX=this.scaleY=0,egret.Tween.get(this).to({scaleX:1,scaleY:1},100).call(function(){this.isEnabled=!0},this)},e.prototype.hide=function(){this.isShow=!1,this.isEnabled=!1,this.scaleX=this.scaleY=1,egret.Tween.get(this).to({scaleX:0,scaleY:0},100).call(function(){this.visible=!1},this)},e.prototype.setList=function(t,e,i,s){void 0===s&&(s=[]),this.itemList.rotation=0,this.mCurrentDic={},this.list=t,this.numArr=s,this.updateList(0,!0),this.mType=e,this.callback=i,this.refreshBgImg()},e.prototype.resetList=function(t,e){void 0===e&&(e=[]),this.itemList.rotation=0,this.mCurrentDic={},this.list=t,this.numArr=e,this.currentFirst=0,this.updateList(0,!0),this.refreshBgImg();for(var i=0;8>i;i++)this["p"+i].rotation=0},e.prototype.updateList=function(t,e){if(t!=this.currentFirst||e){this.itemOffset+=t-this.currentFirst==7?-1:t-this.currentFirst==-7?1:t-this.currentFirst,this.itemOffset=this.itemOffset%this.list.length,this.currentFirst=t;for(var i=this.mode?"weapon":"prop",s=0;6>s;++s){var n=this["p"+(t+s)%8],a=this.list[(this.list.length+this.itemOffset+s)%this.list.length],r=0;if(""==a)n.tf.text="",n.numTF.text="",setTexture(n.iconImg,"prop_icon_none_png");else{if(n.tf.text="",this.mode)n.numTF.text="";else{r=this.numArr[(this.list.length+this.itemOffset+s)%this.list.length];var h=r>0?r:-1-r,o=h>99?"99+":h+"";n.numTF.text=o}setTexture(n.iconImg,i+"_s_"+a.replace("-","_")+"_png")}this.mCurrentDic["p"+(t+s)%8]={str:a,index:r}}}if(this.list.length<6)for(var s=0;6>s;++s)this["p"+s].visible=this.list.length>s;this.refreshBgImg()},e.prototype.refreshBgImg=function(){this.mCurrentSelect=0==this.mode?this.dispatcher.get("user","propIndex"):this.dispatcher.get("user","gunIndex");for(var t in this.mCurrentDic)setTexture(this[t].bgImg,this.mCurrentSelect.replace("-","_")==this.mCurrentDic[t].str?"new_menu_select_bg_png":"new_menu_common_bg_png")},e}(eui.Component);__reflect(ItemList.prototype,"ItemList");var ActionUtils=function(){function t(){}return t.runTFAction=function(t,e){t.text="";var i=0,s=e.length;egret.Tween.get(this,{loop:!0}).to({},200).call(function(){t.textFlow=[{text:e.substring(0,i),style:{size:30}},{text:e.substring(i,i+1),style:{size:40}},{text:e.substring(i+1),style:{size:30}}],i=i>=s-3?0:i+2})},t.runBtnAction=function(t){egret.Tween.get(t).to({scaleX:.7,scaleY:.7},100).to({scaleX:1,scaleY:1},100)},t.refreshDwMc=function(t,e,i){void 0===i&&(i=0);for(var s=3;5>=s;s++)for(var n=1;s>=n;n++)t["star"+s+"_"+n].visible=!1;var a=formula.getRankInfo(e),r=[3,3,4,5,5,5][a.index],h=a.starNum,o=a.name;if(setTexture(t.bgImg,"sy_duanwei_0"+a.index+"_png"),6==a.index){if(t.star_bg6.visible=t.star6TF.visible=t.star6Img.visible=t.star6Img2.visible=1!=i,t.star_bg.visible=!1,t.numBF.text="",t.star6TF.text="x"+h,t.star6Img.x=95-(0+t.star6TF.width)/2,t.star6TF.x=t.star6Img.x+33,t.star6Img2.x=t.star6Img.x+5,2==i)return{displayName:t.star6Img2.x,y:t.star6Img2.y,result:"star6Img2"}}else{t.star_bg6.visible=t.star6TF.visible=t.star6Img.visible=t.star6Img2.visible=!1,t.star_bg.visible=1!=i,t.numBF.text=[["f","ff","fff"],["h","hh","hhh"],["b","bb","bbb","bA"],["d","dd","ddd","dC","C"],["b","bb","bbb","bA","A"],["b","bb","bbb","bA","A"]][a.index][+o.substr(4,1)-1],setTexture(t.star_bg,"sy_duanwei_xing_"+r+"_png");for(var s=0;r>s;s++)t["star"+r+"_"+(s+1)].visible=h>s&&1!=i;if(2==i&&h>=0)return{x:t["star"+r+"_"+(h+1)].x,y:t["star"+r+"_"+(h+1)].y};if(3==i&&h>=0)return{x:t["star"+r+"_"+h].x,y:t["star"+r+"_"+h].y}}},t}();__reflect(ActionUtils.prototype,"ActionUtils");var MainSceneConfig=function(){function t(){}return t.weaponExp=0,t}();__reflect(MainSceneConfig.prototype,"MainSceneConfig");var MatchUtils=function(){function t(){}return t.getCurrentWeaponExp=function(t){var e=t.get("user","gunHs")||[[0,-1],[-1,-1],[-1,-1],[-1,-1]],i=t.get("user","gunIndex");return e[+i.substr(0,1)][+i.substr(2,1)]},t.getRegularSixSidedPolygonObject=function(t,e,i,s){return void 0===s&&(s=[null,0,0,0,0,0,0]),{O:new egret.Point(t,e),A:new egret.Point(t,e-i),AA:new egret.Point(t,e-i*s[1]),B:new egret.Point(t+i*Math.sin(Math.PI/3),e-i/2),BB:new egret.Point(t+i*Math.sin(Math.PI/3)*s[2],e-i/2*s[2]),C:new egret.Point(t+i*Math.sin(Math.PI/3),e+i/2),CC:new egret.Point(t+i*Math.sin(Math.PI/3)*s[3],e+i/2*s[3]),D:new egret.Point(t,e+i),DD:new egret.Point(t,e+i*s[4]),E:new egret.Point(t-i*Math.sin(Math.PI/3),e+i/2),EE:new egret.Point(t-i*Math.sin(Math.PI/3)*s[5],e+i/2*s[5]),F:new egret.Point(t-i*Math.sin(Math.PI/3),e-i/2),FF:new egret.Point(t-i*Math.sin(Math.PI/3)*s[6],e-i/2*s[6])}},t.getRegularSixSidedPolygonObjects=function(t,e,i,s){var n={};n.O=new egret.Point(t,e),n.A=new egret.Point(t,e-i),n.B=new egret.Point(t+i*Math.sin(Math.PI/3),e-i/2),n.C=new egret.Point(t+i*Math.sin(Math.PI/3),e+i/2),n.D=new egret.Point(t,e+i),n.E=new egret.Point(t-i*Math.sin(Math.PI/3),e+i/2),n.F=new egret.Point(t-i*Math.sin(Math.PI/3),e-i/2);for(var a=0;a<s.length;a++)n["A"+a]=new egret.Point(t,e-i*s[a][1]),n["B"+a]=new egret.Point(t+i*Math.sin(Math.PI/3)*s[a][2],e-i/2*s[a][2]),n["C"+a]=new egret.Point(t+i*Math.sin(Math.PI/3)*s[a][3],e+i/2*s[a][3]),n["D"+a]=new egret.Point(t,e+i*s[a][4]),n["E"+a]=new egret.Point(t-i*Math.sin(Math.PI/3)*s[a][5],e+i/2*s[a][5]),n["F"+a]=new egret.Point(t-i*Math.sin(Math.PI/3)*s[a][6],e-i/2*s[a][6]);return n},t}();__reflect(MatchUtils.prototype,"MatchUtils");var FBInvalidPanel=function(t){function e(e,i,s){var n=t.call(this)||this;return n.mode=e,n.message=i,n.callback=s,n.skinName=FBInvalidSkin,n}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reasonTag.text=this.message;for(var e=function(t){setTexture(i["btn"+t].tfImg,"zd_"+["fqhydz","cjpws","jryx"][t]+"_png",.5,.5),new Btn(i["btn"+t],function(){this.callback(t)}.bind(i)),i["btn"+t].visible=i.mode?2!==t:2==t},i=this,s=0;3>s;++s)e(s);this.specialTag.text=this.mode?"你可以自己发起一场战斗，或者去参加排位赛模式":"现在就进入游戏，享受愉快的决斗生涯吧",this.adjustUI()},e.prototype.adjustUI=function(){this.bg.height=640/weedon.winSize.width*weedon.winSize.height},e}(eui.Component);__reflect(FBInvalidPanel.prototype,"FBInvalidPanel");var MatchingScene=function(t){function e(e,i,s,n){void 0===n&&(n=1);var a=t.call(this)||this;return a.checker=0,a.mScreenHeight=e,a.dispatcher=i,a.mMode=n,a.skinName=MatchingSceneSkin,a.closeCallback=s,a}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.counterDown.visible=1==this.mMode,new Btn(this.backBtn,function(){e.dispatcher.request("friendBattle.leave",{},function(){console.log("ok"),egret.stopTick(this.update,this),this.closeCallback(0)}.bind(e))}.bind(this)),setTexture(this.leftBtn.tfImg,"new_tf_kaishiduijue_png"),setTexture(this.rightBtn.tfImg,"new_tf_yaoqinghaoyou_png");var i=this.dispatcher.get("friendBattle");switch(console.log(i),this.mMode){case 1:this.leftBtn.visible=!!i.targetId,this.rightBtn.x=i.targetId?455:320;break;case 2:this.leftBtn.visible=this.rightBtn.visible=!1}new Btn(this.rightBtn,function(){"undefined"==typeof GameGlobal?console.log("分享"):weedon.share({title:"你犯的最大的错误，就是与我为敌",imageUrl:"https://xbwz-resource.hortor.net/resource/assets/Share/xbwz_fx_00.png",query:"from="+e.dispatcher.get("user","_id")+"&action=0"},function(t){}.bind(e))}.bind(this)),new Btn(this.leftBtn,function(){e.dispatcher.request("friendBattle.begin",{},function(t){return t?void console.log(t):(egret.stopTick(e.update,e),void e.closeCallback(1))})}.bind(this)),ActionUtils.refreshDwMc(this.leftMc.mc,1==this.mMode?this.dispatcher.get("user","rankLv"):i.targetRank),this.leftMc.nameTF.text=1==this.mMode?this.dispatcher.get("user","nickname"):i.targetNickname,this.leftMc.lvTF.text="Lv."+formula.getULevel(1==this.mMode?this.dispatcher.get("user","experience")||0:i.targetExp),setAvatar(this.leftMc.headImg,1==this.mMode?this.dispatcher.get("user","avatar"):i.targetAvatar),this.rightMc.mc.visible=!1,2==this.mMode||i.targetId?(this.rightMc.nameTF.text=2==this.mMode?this.dispatcher.get("user","nickname"):i.targetNickname,this.rightMc.lvTF.text="Lv."+formula.getULevel(2==this.mMode?this.dispatcher.get("user","experience")||0:i.targetExp),setAvatar(this.rightMc.headImg,2==this.mMode?this.dispatcher.get("user","avatar"):i.targetAvatar),this.rightMc.mc.visible=!0,ActionUtils.refreshDwMc(this.rightMc.mc,2==this.mMode?this.dispatcher.get("user","rankLv"):i.targetRank)):(this.rightMc.nameTF.text="等待对手加入",this.rightMc.lvTF.text="Lv.??",this.rightMc.mc.visible=!1,this.rightMc.headImg.texture=RES.getRes("zd_ppdx_png")),this.leftMc.x=-500,this.rightMc.x=752,this.vs.visible=!1,egret.Tween.get(this.leftMc).to({x:0},500),egret.Tween.get(this.rightMc).wait(500).to({x:252},500).wait(500).call(function(){e.vs.visible=!0},this),this.adjustUI(),this.dispatcher.setPushCallback("friendReady",this.friendReady.bind(this)),this.dispatcher.setPushCallback("join",this.receiveBattleInfo.bind(this)),egret.startTick(this.update,this)},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e.prototype.friendReady=function(){var t=this.dispatcher.get("friendBattle");1==this.mMode?t.targetId?(this.rightMc.nameTF.text=t.targetNickname,this.rightMc.lvTF.text="Lv."+formula.getULevel(t.targetExp),setAvatar(this.rightMc.headImg,t.targetAvatar),this.rightMc.mc.visible=!0,ActionUtils.refreshDwMc(this.rightMc.mc,t.targetRank),this.leftBtn.visible=!0,this.rightBtn.x=485):(this.rightMc.nameTF.text="等待对手加入",this.rightMc.lvTF.text="Lv.??",this.rightMc.headImg.texture=RES.getRes("zd_ppdx_png"),this.leftBtn.visible=!1,this.rightBtn.x=320):t.targetId||(egret.stopTick(this.update,this),this.closeCallback(-1))},e.prototype.receiveBattleInfo=function(){egret.stopTick(this.update,this),this.closeCallback(1)},e.prototype.update=function(){var t=this.dispatcher.get("friendBattle","invitation"),e=(t-weedon.time)/1e3>>0;return weedon.time-this.checker>1e3&&(this.checker=weedon.time,console.log("check")),0>e?(console.log(t),console.log("过期"),weedon.showAlert("对战匹配超出时限"),egret.stopTick(this.update,this),void this.closeCallback(-1)):(this.counterDown.text=("0"+(e/60>>0)).slice(-2)+":"+("0"+e%60).slice(-2),!0)},e}(eui.Component);__reflect(MatchingScene.prototype,"MatchingScene");var QualifyingScene=function(t){function e(e,i,s,n){var a=t.call(this)||this;return a.battleStart=0,a.matching=!1,a.isFriendQualify=!1,a.sendAiRequest=!1,a.mScreenHeight=e,a.skinName=QualifyingSceneSkin,a.dispatcher=i,a.callback=s,a.isFriendQualify=n||!1,a}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.gameConfig=RES.getRes("game_config_json");var i=this.dispatcher.get("user");this.userGuide=i.guide||0,this.userKeepLose=i.keepLose||0,console.log(this.userGuide),new Btn(this.backBtn,function(){e.dispatcher.request("aiBattle.getbattle",{},function(){this.dispatcher.get("battle","ready")&&this.joinOk()}.bind(e))}.bind(this)),(this.dispatcher.get("user","guide")<3||this.isFriendQualify)&&(this.backBtn.visible=!1);var s=new Animation("se_tip");this.grp1.addChild(s),s.play("play",0),s.x=230,s.y=320,this.isFriendQualify?(this.desTF1.textFlow=[{text:"\n",style:{size:30,textColor:7093780}},{text:"将手机",style:{size:24,textColor:12154151}},{text:"[倒置]",style:{size:30,textColor:7093780}},{text:"等待铃响。\n",style:{size:24,textColor:12154151}},{text:"抬起手机将会比对手较晚进入战斗！",style:{size:24,textColor:12154151}}],this.grp2LabelDown.textFlow=[{text:"将手机",style:{size:24,textColor:12154151}},{text:"[倒置]",style:{size:30,textColor:7093780}},{text:"等待铃响。\n",style:{size:24,textColor:12154151}},{text:"抬起手机将会比对手较晚进入战斗！",style:{size:24,textColor:12154151}}]):(this.desTF1.textFlow=[{text:"如何排位？\n",style:{size:30,textColor:7093780}},{text:"将手机",style:{size:24,textColor:12154151}},{text:"[倒置]",style:{size:30,textColor:7093780}},{text:"开始匹配对手。\n",style:{size:24,textColor:12154151}},{text:"提示音",style:{size:24,textColor:12154151}},{text:"[响起和震动]",style:{size:30,textColor:7093780}},{text:"匹配完成，开始战斗！",style:{size:24,textColor:12154151}}],this.grp2LabelDown.text="等待6-10秒\n抬起将会取消战斗"),this.tweenImg.rotation=0,egret.Tween.get(this.tweenImg,{loop:!0}).to({rotation:360},2500).call(function(){e.tweenImg.rotation=0}),this.adjustUI(),ActionUtils.runTFAction(this.desTF2,this.isFriendQualify?"准 备 开 始 战 斗 . .":"正 在 寻 找 对 手 . . "),this.grp1.visible=!0,this.grp2.visible=!1,!this.isFriendQualify&&this.dispatcher.setPushCallback("join",this.joinOk.bind(this)),("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).stopAccelerometer({complete:function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).startAccelerometer({success:function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).onAccelerometerChange(function(t){var e="undefined"==typeof GameGlobal?t.z:t.y;!this.motionStart&&e>=.5&&(this.motionStart=weedon.time,this.grp1.visible=!1,this.grp2.visible=!0,this.backBtn.visible=!1,this.isDown=!0),this.motionStart&&.5>e&&!this.battleStart&&!this.isFriendQualify&&(this.backBtn.visible=!0,this.motionStart=0,this.matching?this.dispatcher.request("user.leave",{},function(){this.matching=!1,this.grp2.visible=!1,this.grp1.visible=!0}.bind(this)):(this.grp2.visible=!1,this.grp1.visible=!0),this.isDown=!1),this.motionStart&&.5>e&&!this.battleStart&&this.isFriendQualify&&(this.backBtn.visible=!1,this.grp2.visible=!1,this.grp1.visible=!0,this.isDown=!1,this.motionStart=0),2==this.dispatcher.get("user","guide")&&(this.backBtn.visible=!1)}.bind(this)),egret.startTick(this.update,this)}.bind(this)})}.bind(this)}),this.isFriendQualify&&this.joinOk()},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e.prototype.update=function(){return this.battleStart||this.motionStart?(!this.matching&&weedon.time-this.motionStart>1e3&&!this.isFriendQualify&&(this.matching=!0,(this.userGuide<3||this.userKeepLose>=this.gameConfig.KLAiCondition)&&!this.sendAiRequest?(this.sendAiRequest=!0,this.dispatcher.request("aiBattle.getbattle",{},function(){this.dispatcher.get("battle","ready")&&this.joinOk()}.bind(this))):this.dispatcher.request("user.join",{},function(){this.dispatcher.get("battle","ready")&&this.joinOk()}.bind(this))),!this.battleStart&&!this.sendAiRequest&&weedon.time-this.motionStart>6e3&&!this.isFriendQualify&&(this.sendAiRequest=!0,this.dispatcher.request("aiBattle.getbattle",{},function(){this.dispatcher.get("battle","ready")&&this.joinOk()}.bind(this))),this.battleStart&&weedon.time>=this.battleStart&&(this.isFriendQualify&&!this.isDown?(this.isDown=!0,this.battleStart+=2e3):(this.isFriendQualify&&("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).stopAccelerometer(),egret.stopTick(this.update,this),this.parent.removeChild(this),this.callback(1))),!0):void 0},e.prototype.joinOk=function(){this.isFriendQualify||("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).stopAccelerometer(),this.battleStart=this.dispatcher.get("battle","startTime")},e}(eui.Component);__reflect(QualifyingScene.prototype,"QualifyingScene");var GroupRankDialog=function(t){function e(e,i,s){var n=t.call(this)||this;return n.mScreenHeight=e,n.dispatcher=i,n.skinName=GroupRankDialogSkin,n.openGid=s,n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.mOwnId=this.dispatcher.get("user","_id"),new Btn(this.backBtn,function(){e.parent.removeChild(e),console.log("remove")}.bind(this)),this.shareNode0.visible=this.shareNode1.visible=this.shareNode2.visible=this.dispatcher.getCache("getCanGetShareBonus")(),new Btn(this.bottomGroup,function(){e.dispatcher.getCache("share")(1,function(t){return t?(e.dispatcher.getCache("showGroupUsers")(t),void e.dispatcher.getCache("getShareBonus")()):void e.dispatcher.getCache("showAlert")("分享到微信群才能获得奖励")})}),this.refreshList(),this.adjustUI()},e.prototype.updateUi=function(t){this.openGid=t,this.refreshList()},e.prototype.refreshList=function(){var t=this;this.scroll.stopAnimation(),this.list.removeChildren(),this.dispatcher.request("user.getGroupUsers",{openGid:this.openGid},function(e){if(e)return void console.log(e);var i=t.dispatcher.getNew("result")||[];t.updateList(i.sort(function(t,e){return t.rank-e.rank}))}.bind(this))},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight;var t=1386-this.mScreenHeight;this.backBtn.y=t/2+50;var e=t>0?t:0;this.scroll.height=this.list.height=682-e/2,this.middleGroup.height=this.middleBg.height=962-e/2,this.middleGroup.y=295+e/4+20,this.bottomGroup.y=1155.5-e/4+20+this.bottomGroup.anchorOffsetY},e.prototype.updateList=function(t){for(var e=0;e<t.length;e++){var i=new eui.Component;i.skinName=RankItemRenderSkin,i.rankTF.text=t[e].rank+1;var s=formula.getRankInfo(t[e].user.rankLv);i.dwTF.text=s.name,i.starTF.text=s.starNum,ActionUtils.refreshDwMc(i.dwMc,t[e].user.rankLv||0,1),i.nameTF.text=t[e].user.nickname,i.lvTF.text="Lv."+formula.getULevel(t[e].user.experience),setAvatar(i.headImg,t[e].user.avatar),t[e].user._id==this.mOwnId?(setTexture(i.bgImg,"ph_db_01_png"),setTexture(i.jbImg,"ph_jb_01_png")):(setTexture(i.bgImg,"ph_db_00_png"),setTexture(i.jbImg,"ph_jb_00_png"));var n=t[e].user.cap-1e4==1?1:0;setTexture(i.mzImg,"ph_zy_0"+n+"_png"),this.list.addChild(i),i.y=120*e,i.x=-200,i.alpha=0,egret.Tween.get(i).wait(100*e).to({alpha:1,x:0},200)}this.scroll.viewport.scrollV=0,this.scroll.viewport.validateNow()},e}(eui.Component);__reflect(GroupRankDialog.prototype,"GroupRankDialog");var PropShareBoard=function(t){function e(e,i){var s=t.call(this)||this;return s.mScreenHeight=e,s.dispatcher=i,s.skinName=PropShareSkin,s}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.mOwnId=this.dispatcher.get("user","_id"),new Btn(this.backBtn,function(){e.parent.removeChild(e)}.bind(this)),new Btn(this.shareToFriend,function(){}),new Btn(this.saveToAlbum,function(){}),setTexture(this.shareToFriend.tfImg,"fx_fxdhy_png",.5,.5),setTexture(this.saveToAlbum.tfImg,"fx_bcdxc_png",.5,.5),this.refreshUi(),this.adjustUI()},e.prototype.refreshUi=function(){var t=this.dispatcher.get("user");setAvatar(this.headImg,t.avatar);var e=this.dispatcher.get("user","qualifyDt"),i=Math.max(e[0],e[1],e[2],e[3]),s=this.dispatcher.get("user","hitHeadNum")||0,n=this.dispatcher.get("user","hitNum")||0,a=this.dispatcher.get("user","shootNum")||0,r=0==a?0:n/a,h=0==a?0:s/a,o=[null,0==r?.4:+r.toFixed(4),0==i?.98:0==e[0]?.4:e[0]/i,0==i?.98:0==e[1]?.4:e[1]/i,0==i?.98:0==e[2]?.4:e[2]/i,0==i?.98:0==e[3]?.4:e[3]/i,0==h?.4:+h.toFixed(4)],l=MatchUtils.getRegularSixSidedPolygonObject(320,131,100,o),d=new egret.Shape,c=["O","A","B","C","D","E","F"];d.graphics.lineStyle(2,11036195),d.graphics.moveTo(l[c[1]].x,l[c[1]].y);for(var u=2;u<c.length;u++)d.graphics.lineTo(l[c[u]].x,l[c[u]].y);d.graphics.lineTo(l[c[1]].x,l[c[1]].y),d.graphics.lineStyle(1,15121785);for(var u=2;u<c.length;u++)d.graphics.lineTo(l[c[0]].x,l[c[0]].y),d.graphics.lineTo(l[c[u]].x,l[c[u]].y);d.graphics.beginFill(13868898),d.graphics.moveTo(l[c[1]+c[1]].x,l[c[1]+c[1]].y);for(var u=2;u<c.length;u++)d.graphics.lineTo(l[c[u]+c[u]].x,l[c[u]+c[u]].y);d.graphics.lineTo(l[c[1]+c[1]].x,l[c[1]+c[1]].y),d.graphics.endFill(),this.mePropGroup.addChild(d),this.ATF.textColor=this.BTF.textColor=this.CTF.textColor=this.DTF.textColor=this.ETF.textColor=this.FTF.textColor=7093780},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight;var t=1386-this.mScreenHeight;this.backBtn.y=t/2+50;var e=t>0?t:0;this.middleGroup.height=this.middleBg.height=962-e/2,this.middleGroup.y=295+e/4+20,this.bottomGroup.y=1e3-e/4+20},e}(eui.Component);__reflect(PropShareBoard.prototype,"PropShareBoard");
var RankCompareBoard=function(t){function e(e,i,s){var n=t.call(this)||this;return n.mScreenHeight=e,n.dispatcher=i,n.skinName=PropCompareSkin,n.targetId=s,n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.mOwnId=this.dispatcher.get("user","_id"),this.updateUi(this.targetId),new Btn(this.backBtn,function(){e.parent.removeChild(e)}.bind(this)),this.shareNode0.visible=this.shareNode1.visible=this.shareNode2.visible=this.dispatcher.getCache("getCanGetShareBonus")(),new Btn(this.bottomGroup,function(){e.dispatcher.getCache("share")(1,function(t){return t?(e.dispatcher.getCache("showGroupUsers")(t),void e.dispatcher.getCache("getShareBonus")()):void e.dispatcher.getCache("showAlert")("分享到微信群才能获得奖励")})}),this.adjustUI()},e.prototype.updateUi=function(t){var e=this;this.targetId=t,this.dispatcher.request("user.getCompareUser",{from:this.targetId},function(t){t&&console.log(t),e.refreshUi()})},e.prototype.getResultArr=function(t){var e=t.qualifyDt,i=Math.max(e[0],e[1],e[2],e[3]),s=t.hitHeadNum,n=t.hitNum,a=t.shootNum,r=0==a?0:n/a,h=0==a?0:s/a,o=[null,0==r?.4:+r.toFixed(4),0==i?.98:0==e[0]?.4:e[0]/i,0==i?.98:0==e[1]?.4:e[1]/i,0==i?.98:0==e[2]?.4:e[2]/i,0==i?.98:0==e[3]?.4:e[3]/i,0==h?.4:+h.toFixed(4)];return o},e.prototype.refreshUi=function(){var t=this.dispatcher.get("fromUser"),e=this.dispatcher.get("user"),i=e.nickname,s=t.nickname,n=e.avatar,a=0,r=formula.getRankInfo(e.rankLv||0).name||"",h=formula.getRankInfo(t.rankLv||0).name||"",o=e.duels||0,l=t.duels||0,d=0==e.duels?0:e.duelWins/e.duels,c=0==t.duels?0:t.duelWins/t.duelWins,u=[];u.push(this.getResultArr(e)),u.push(this.getResultArr(t));var p=[16244137,13275987],g=MatchUtils.getRegularSixSidedPolygonObjects(320,131,100,u),m=new egret.Shape,f=["O","A","B","C","D","E","F"];m.graphics.lineStyle(2,11036195),m.graphics.moveTo(g[f[1]].x,g[f[1]].y);for(var v=2;v<f.length;v++)m.graphics.lineTo(g[f[v]].x,g[f[v]].y);m.graphics.lineTo(g[f[1]].x,g[f[1]].y),m.graphics.lineStyle(1,15121785);for(var b=2;b<f.length;b++)m.graphics.lineTo(g[f[0]].x,g[f[0]].y),m.graphics.lineTo(g[f[b]].x,g[f[b]].y);for(var y=0;y<u.length;y++){m.graphics.beginFill(p[y],y>0?.7:1),m.graphics.moveTo(g[f[1]+y].x,g[f[1]+y].y);for(var x=2;x<f.length;x++)m.graphics.lineTo(g[f[x]+y].x,g[f[x]+y].y);m.graphics.lineTo(g[f[1]+y].x,g[f[1]+y].y),m.graphics.endFill()}this.mePropGroup.addChild(m);var _=this.dispatcher.get("user","qualifyDt");Math.max(_[0],_[1],_[2],_[3]),this.dispatcher.get("user","hitHeadNum")||0,this.dispatcher.get("user","hitNum")||0,this.dispatcher.get("user","shootNum")||0;this.ATF.textColor=this.BTF.textColor=this.CTF.textColor=this.DTF.textColor=this.ETF.textColor=this.FTF.textColor=7093780,this.leftMc.lvTF.visible=this.rightMc.lvTF.visible=this.leftMc.mc.visible=this.rightMc.mc.visible=!1,this.leftMc.nameTF.text=i,this.rightMc.nameTF.text=s,this.leftMc.nameTF.verticalCenter=this.rightMc.nameTF.verticalCenter=0,setAvatar(this.leftMc.headImg,n),setAvatar(this.rightMc.headImg,a),this.compareGroup.removeChildren();for(var w=[["段位",r],["段位",h],["总场次",o],["总场次",l],["胜率",d],["胜率",c]],C=0;6>C;C++){var T=w[C],I=new ComparePropItem;this.compareGroup.addChild(I),I.title.text=T[0],I.value.text=C>=4?(100*T[1]).toFixed(2)+"%":T[1];var S=C,k=Math.floor(S/2),B=S%2;I.y=54*k,I.x=0==B?40:350}},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight;var t=1386-this.mScreenHeight;this.backBtn.y=t/2+50;var e=t>0?t:0;this.middleGroup.height=this.middleBg.height=962-e/2,this.middleGroup.y=295+e/4+20,this.bottomGroup.y=1155.5-e/4+20},e}(eui.Component);__reflect(RankCompareBoard.prototype,"RankCompareBoard");var ComparePropItem=function(t){function e(){var e=t.call(this)||this;return e.skinName=ComparePropItemSkin,e}return __extends(e,t),e}(eui.Component);__reflect(ComparePropItem.prototype,"ComparePropItem");var RankDialog=function(t){function e(e,i){var s=t.call(this)||this;return s.mCurrentTab=1,s.mScreenHeight=e,s.dispatcher=i,s.skinName=RankDialogSkin,s}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.mOwnId=this.dispatcher.get("user","_id"),new Btn(this.backBtn,function(){e.parent.removeChild(e)}.bind(this)),new Btn(this.tabBtn1,function(){1!=e.mCurrentTab&&(e.mCurrentTab=1,e.refreshList())}.bind(this)),new Btn(this.tabBtn2,function(){2!=e.mCurrentTab&&(e.mCurrentTab=2,e.refreshList())}.bind(this)),this.tabBtn1.tabTF.text="好 友 排 行",this.tabBtn2.tabTF.text="世 界 排 行",this.shareNode0.visible=this.shareNode1.visible=this.shareNode2.visible=this.dispatcher.getCache("getCanGetShareBonus")(),new Btn(this.bottomGroup,function(){e.dispatcher.getCache("share")(1,function(t){return t?void e.dispatcher.getCache("showGroupUsers")(t):void e.dispatcher.getCache("showAlert")("分享到微信群才能获得奖励")})}),this.refreshList(),this.adjustUI()},e.prototype.refreshList=function(){var t=this;1==this.mCurrentTab?(this.tabBtn1.diImg.visible=!0,this.tabBtn2.diImg.visible=!1):2==this.mCurrentTab&&(this.tabBtn1.diImg.visible=!1,this.tabBtn2.diImg.visible=!0),this.tabBtn1.tabTF.textColor=1==this.mCurrentTab?16640967:13019265,this.tabBtn2.tabTF.textColor=2==this.mCurrentTab?16640967:13019265;var e=this.mCurrentTab-1;this.scroll.stopAnimation(),this.list.removeChildren(),this.dispatcher.request("user.getRankList",{mode:e},function(i){if(i)return void console.log(i);if(0==e){var s=[],n=0,a=t.dispatcher.getNew("fsRank")||[];a.sort(function(t,e){return e.rankLv!=t.rankLv?e.rankLv-t.rankLv:e.experience!=t.experience?e.experience-t.experience:t._id-e._id}).forEach(function(e,i){s.push({user:e,rank:i}),e._id==t.mOwnId&&(n=i)});var r=n||0;t.updateList(s),t.desTF.text="当前我的好友排名:"+(n+1)}else{var h=t.dispatcher.getNew("result")||[],r=t.dispatcher.get("rankMe");t.updateList(h.sort(function(t,e){return t.rank-e.rank})),t.desTF.text="当前我的世界排名:"+(999==r?999:r+1)}}.bind(this))},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight;var t=1386-this.mScreenHeight;this.backBtn.y=t/2+50;var e=t>0?t:0;this.scroll.height=this.list.height=682-e/3,this.middleGroup.height=this.middleBg.height=850-e/3,this.topGroup.y=127+e/6,this.middleGroup.y=295+e/6,this.bottomGroup.y=1061-e/6+this.bottomGroup.anchorOffsetY},e.prototype.updateList=function(t){for(var e=0;e<t.length;e++){var i=new eui.Component;i.skinName=RankItemRenderSkin,i.rankTF.text=t[e].rank+1;var s=formula.getRankInfo(t[e].user.rankLv);i.dwTF.text=s.name,i.starTF.text=s.starNum,ActionUtils.refreshDwMc(i.dwMc,t[e].user.rankLv||0,1),i.nameTF.text=t[e].user.nickname,i.lvTF.text="Lv."+formula.getULevel(t[e].user.experience),setAvatar(i.headImg,t[e].user.avatar),t[e].user._id==this.mOwnId?(setTexture(i.bgImg,"ph_db_01_png"),setTexture(i.jbImg,"ph_jb_01_png")):(setTexture(i.bgImg,"ph_db_00_png"),setTexture(i.jbImg,"ph_jb_00_png"));var n=t[e].user.cap-1e4==1?1:0;setTexture(i.mzImg,"ph_zy_0"+n+"_png"),this.list.addChild(i),i.y=120*e,i.x=-200,i.alpha=0,egret.Tween.get(i).wait(100*e).to({alpha:1,x:0},200)}this.scroll.viewport.scrollV=0,this.scroll.viewport.validateNow()},e}(eui.Component);__reflect(RankDialog.prototype,"RankDialog");var RankInsBoard=function(t){function e(){var e=t.call(this)||this;return e.infos=["见习青铜、英勇白银均有3个小段位；","精准黄金有4个小段位；","冷酷白金、孤单英雄、枪王之王均有5个小段位；","进入不朽传奇的玩家将会根据星级进行全服排名；"],e.ranks=[[0,12],[24,44],[74,104],[234]],e.skinName=RankInstructionSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.title.text="段位说明",this.info0.text="段位分为：见习青铜、应用白银、精准黄金、冷酷铂金、孤单英雄、枪王之王、不朽传奇。";for(var e=0;4>e;e++){this["rankIns"+e].text=this.infos[e],this["rankIns"+e].textColor=16775624;for(var i=0;2>i;i++)this["rankIcon"+e+"_"+i]&&ActionUtils.refreshDwMc(this["rankIcon"+e+"_"+i],this.ranks[e][i])}this.rect.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.closeSelf()},this)},e.prototype.closeSelf=function(){this.parent&&this.parent.removeChild(this)},e}(eui.Component);__reflect(RankInsBoard.prototype,"RankInsBoard");var RankIcon=function(t){function e(e){var i=t.call(this)||this;return i.rankLv=e,i}return __extends(e,t),e.prototype.childrenCreatd=function(){t.prototype.childrenCreated.call(this),this.skinName=DuanWeiComponentSkin,ActionUtils.refreshDwMc(this,this.rankLv)},e}(eui.Component);__reflect(RankIcon.prototype,"RankIcon");var SelectDialog=function(t){function e(e,i){var s=t.call(this)||this;return s.ignoreNextResize=!1,s.mCurrentGenderIndex=0,s.mCurrentCapIndex=0,s.gender_scale=.5,s.dispatcher=e,s.mCb=i,s.skinName=SelectDialogSkin,s}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),setTexture(this.okBtn.tfImg,"js_qd_png"),new Btn(this.okBtn,function(){e.dispatcher.request("user.init",{gender:e.mCurrentGenderIndex,cap:e.mCurrentCapIndex},function(t){return t?void console.log(t):void(e.mCb&&e.mCb())}.bind(e))}.bind(this));var i=this.gender_1=new Animation("chr0");this.addChild(i),i.play("handgun_stand",0),i.x=this.gender1Img.x,i.y=this.gender1Img.y-30,i.scaleX=i.scaleY=this.gender_scale,i.touchEnabled=!0,i.touchChildren=!0;var s=this.gender_2=new Animation("chr1");this.addChild(s),s.play("handgun_stand",0),egret.Tween.get(s).wait(10).call(function(){s.play("handgun_stand_d",0)},this),s.x=this.gender2Img.x,s.y=this.gender2Img.y-30,s.scaleX=s.scaleY=this.gender_scale-.2,s.touchEnabled=!0,s.touchChildren=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0!=e.mCurrentGenderIndex&&(e.mCurrentGenderIndex=0,i.play("handgun_stand",0),s.play("handgun_stand_d",0),i.scaleX=i.scaleY=e.gender_scale,s.scaleX=s.scaleY=e.gender_scale-.2,e.refreshCapMc())},this),s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1!=e.mCurrentGenderIndex&&(e.mCurrentGenderIndex=1,i.play("handgun_stand_d",0),s.play("handgun_stand",0),i.scaleX=i.scaleY=e.gender_scale-.2,s.scaleX=s.scaleY=e.gender_scale,e.refreshCapMc())},this),this.refreshCapMc(),this.cap1Mc.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0!=e.mCurrentCapIndex&&(e.mCurrentCapIndex=0,e.refreshCapMc())},this),this.cap2Mc.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1!=e.mCurrentCapIndex&&(e.mCurrentCapIndex=1,e.refreshCapMc())},this),this.adjustUI()},e.prototype.adjustUI=function(){weedon.winSize.width/weedon.winSize.height>.64?(this.stage.setContentSize(640,1e3),this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL,this.y=-193,this.screenHeight=1e3):(this.stage.setContentSize(640,1386),this.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,this.screenHeight=640*weedon.winSize.height/weedon.winSize.width,this.screenHeight>1300?this.y=-(1500-this.screenHeight)/2:this.y=-(1386-this.screenHeight)/2),this.bg.height=this.screenHeight},e.prototype.refreshCapMc=function(){this.gender1Img.visible=this.gender2Img.visible=!1,this.cap1Mc.dqImg.visible=0==this.mCurrentCapIndex,setTexture(this.cap1Mc.bgImg,0==this.mCurrentCapIndex?"ck_wupin_dangqian_png":"ck_wupin_putong_png"),setTexture(this.cap1Mc.iconImg,"zs_maozi_s00_png"),this.cap1Mc.nameTF.text="黑帽子",this.cap1Mc.numTF.text="",this.cap2Mc.dqImg.visible=1==this.mCurrentCapIndex,setTexture(this.cap2Mc.bgImg,1==this.mCurrentCapIndex?"ck_wupin_dangqian_png":"ck_wupin_putong_png"),setTexture(this.cap2Mc.iconImg,"zs_maozi_s01_png"),this.cap2Mc.nameTF.text="白帽子",this.cap2Mc.numTF.text="",this.hatImg_1=createBitmap("zs_maozi_b0"+this.mCurrentCapIndex+"_png",.5,.5,0,0,this.gender_scale,this.gender_scale),this.gender_1.setSlot("hat",this.hatImg_1),this.hatImg_2=createBitmap("zs_maozi_b0"+this.mCurrentCapIndex+"_png",.5,.5,0,0,this.gender_scale,this.gender_scale),this.gender_2.setSlot("hat",this.hatImg_2)},e}(eui.Component);__reflect(SelectDialog.prototype,"SelectDialog");var SelectScene=function(t){function e(e,i){var s=t.call(this)||this;s.currentIndex=0;var n=320/weedon.winSize.width*weedon.winSize.height,a=new Animation("opening");s.addChild(a),a.x=320,a.y=n;var r=new Animation("openning_train");return s.addChild(r),r.x=320,r.y=n,r.visible=!1,a.play("play",1,function(){a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var e=a.localToGlobal(t.localX,t.localY).x<320?0:1;this.currentIndex!=e&&(this.currentIndex=e,a.play(e?"select_r":"select_l",1))},this);var t=new CommonBtn;this.addChild(t),t.anchorOffsetX=123,t.anchorOffsetY=38,t.x=320,t.y=11*n/6,setTexture(t.tfImg,"new_tf_queding_png",.5,.5),new Btn(t,function(){e.request("user.init",{cap:this.currentIndex},function(){a.visible=t.visible=!1,r.visible=!0,r.play("come_"+(this.currentIndex?"w":"b"),1,function(){i()}.bind(this))}.bind(this))}.bind(this))}.bind(s)),s}return __extends(e,t),e}(eui.Component);__reflect(SelectScene.prototype,"SelectScene");var CommonBtn=function(t){function e(){var e=t.call(this)||this;return e.skinName=CommonMBtnSkin,e}return __extends(e,t),e}(eui.Component);__reflect(CommonBtn.prototype,"CommonBtn");var SettingDialog=function(t){function e(e,i){var s=t.call(this)||this;return s.mScreenHeight=e,s.dispatcher=i,s.skinName=SettingDialogSkin,s}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.mDataJson=RES.getRes("data_json"),this.bg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.parent.removeChild(e)},this),this.nameTF.text=this.dispatcher.get("user","nickname")+"\n游戏ID:"+this.dispatcher.get("user","_id"),this.lvTF.text="Lv."+formula.getULevel(this.dispatcher.get("user","experience")||0),this.versionTF.text="版本号：1.0.0",setAvatar(this.headImg,this.dispatcher.get("user","avatar")||0,this.dispatcher.get("user","avatarUrl")||"");var i=formula.getRankInfo(this.dispatcher.get("user","rankLv"));this.pwTF.text=i.name,this.starTF.text=i.starNum,ActionUtils.refreshDwMc(this.dwMc,MainSceneConfig.rankLv,1),setTexture(this.shareBtn1.tfImg,"new_tf_fuzhi_png"),this.shareBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ActionUtils.runBtnAction(this.shareBtn1);var t=document.createElement("input");t.setAttribute("readonly",""),t.value=this.dispatcher.get("user","_id").toString(),t.style.opacity="0",t.style.position="absolute",t.style.left="-9999px",t.style.top="-9999px",document.body.appendChild(t),t.focus(),t.select(),t.setSelectionRange(0,t.value.length),t.oncopy=function(t){console.log("您的游戏ID已成功复制到剪贴板")}.bind(this),document.execCommand("Copy"),document.body.removeChild(t)},this),setTexture(this.shareBtn2.tfImg,"new_tf_fenxiang_png"),this.shareBtn2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.dispatcher.getCache("share")(1,function(t){return t?void e.dispatcher.getCache("showGroupUsers")(t):void e.dispatcher.getCache("showAlert")("分享到微信群才能获得奖励")})},this),this.yyMc.nameTF.text="音乐",new Btn(this.yyMc,function(){e.updateUserSetting(0)}),this.yxMc.nameTF.text="音效",new Btn(this.yxMc,function(){e.updateUserSetting(1)}),this.updateMusicBtns();var s=this.dispatcher.get("user","qualifyDt"),n=Math.max(s[0],s[1],s[2],s[3]),a=this.dispatcher.get("user","hitHeadNum")||0,r=this.dispatcher.get("user","hitNum")||0,h=this.dispatcher.get("user","shootNum")||0,o=0==h?0:r/h,l=0==h?0:a/h,d=[null,0==o?.4:+o.toFixed(4),0==n?.98:0==s[0]?.4:s[0]/n,0==n?.98:0==s[1]?.4:s[1]/n,0==n?.98:0==s[2]?.4:s[2]/n,0==n?.98:0==s[3]?.4:s[3]/n,0==l?.4:+l.toFixed(4)],c=MatchUtils.getRegularSixSidedPolygonObject(320,730,100,d),u=new egret.Shape,p=["O","A","B","C","D","E","F"];u.graphics.lineStyle(2,11036195),u.graphics.moveTo(c[p[1]].x,c[p[1]].y);for(var g=2;g<p.length;g++)u.graphics.lineTo(c[p[g]].x,c[p[g]].y);u.graphics.lineTo(c[p[1]].x,c[p[1]].y),u.graphics.lineStyle(1,15121785);for(var g=2;g<p.length;g++)u.graphics.lineTo(c[p[0]].x,c[p[0]].y),u.graphics.lineTo(c[p[g]].x,c[p[g]].y);u.graphics.beginFill(13868898),u.graphics.moveTo(c[p[1]+p[1]].x,c[p[1]+p[1]].y);for(var g=2;g<p.length;g++)u.graphics.lineTo(c[p[g]+p[g]].x,c[p[g]+p[g]].y);u.graphics.lineTo(c[p[1]+p[1]].x,c[p[1]+p[1]].y),u.graphics.endFill(),this.addChild(u),this.ATF.textColor=this.BTF.textColor=this.CTF.textColor=this.DTF.textColor=this.ETF.textColor=this.FTF.textColor=7093780,setTexture(this.mzImg,"zs_maozi_s0"+(this.dispatcher.get("user","cap")-1e4)+"_png");var m=this.getExpInfo();m.isMax?(this.lvPrg.value=100,this.expTF.text="满级"):(this.lvPrg.value=m.curExp/m.totalExp*100,this.expTF.text=m.curExp+"/"+m.totalExp)},e.prototype.getExpInfo=function(){for(var t=this.dispatcher.get("user","experience")||0,e=0,i=0;i<this.mDataJson.lvExpers.length;i++){var s=this.mDataJson.lvExpers[i];if(s>t)return e=i+1,e==this.mDataJson.lvExpers.length?{lv:e,isMax:!0}:{lv:e,isMax:!1,curExp:t-(this.mDataJson.lvExpers[i-1]||0),totalExp:s-(this.mDataJson.lvExpers[i-1]||0)}}},e.prototype.updateUserSetting=function(t){var e=this;this.dispatcher.request("user.setting",{mode:t},function(t){return t?void console.log(t):void e.updateMusicBtns()})},e.prototype.updateMusicBtns=function(){var t=this.dispatcher.get("user","userSetting")||0,e=0!=(1&t),i=0!=(2&t);this.yyMc.okImg.visible=e;var s=formula.getBgMusic();s&&(e?!s.playing&&s.play(0):s.playing&&s.stop()),this.yxMc.okImg.visible=i,MUTE_SE=!i},e}(eui.Component);__reflect(SettingDialog.prototype,"SettingDialog");var HouseScene=function(t){function e(e,i,s){var n=t.call(this)||this;return n.typeItems=[],n.detailNumber=-1,n.addedLabelList=[],n.target_scale=.6,n.standArray=["handgun_stand","rifle_stand","shutgun_stand","sniper_stand"],n.dispatcher=e,n.skinName=HouseSceneSkin,n.closeCallBack=i,n.screenHeight=s,n.dataJson=RES.getRes("data_json"),n.mMaxShuliandu=RES.getRes("game_config_json").buttleConfig.experGunMax,n.mJunPer=RES.getRes("game_config_json").damageBonus.gunDamageBonus[3],n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.aniMaxLevel=new Animation("se_maxlevel"),this.typeNames=["武器","道具"],new Btn(this.btnBack,function(){0==e.currentStatus?e.closeCallBack():1==e.currentStatus?e.refreshUi():2==e.currentStatus?e.showPropList():console.log("error")}),this.groupLeft.x=-310,this.groupRight.visible=!1,egret.Tween.get(this.groupLeft).to({x:40},200).to({x:0},50).wait(100).call(function(){e.groupRight.visible=!0,e.refreshUi(),e.adjustUi(),e.showPerson()}),this.btn_use=new Btn(this.btnUse,function(){this.useProp(this.typeIndex,this.dataBind)}.bind(this)),this.btn_buy0=new Btn(this.btnBuy0,function(){if(e.detailNumber>=99)return void console.log("item max num ,can not buy");var t=e.dispatcher.get("user","goldAll")-e.dispatcher.get("user","goldCost");if(t<e.dataDetail[5]){console.log("gold not enough");var i,s=e.dispatcher.get("user","diamondAll")-e.dispatcher.get("user","diamondCost"),n=s>=e.dataDetail[6];return n?i="金币不足。\n是否消耗"+e.dataDetail[6]+"钻石购买"+e.dataDetail[0]+"？":(console.log("diamond not enough"),i="金币不足。\n参加排位战可获得金币！"),void e.dispatcher.getCache("showRemind")(0,i,function(){n&&e.buyProp(1)})}e.buyProp(0)}),this.btn_buy1=new Btn(this.btnBuy1,function(){if(e.detailNumber>=99)return void console.log("item max num ,can not buy");var t=e.dispatcher.get("user","diamondAll")-e.dispatcher.get("user","diamondCost");if(t<e.dataDetail[6]){console.log("diamond not enough");var i="钻石不足。\n是否前往充值";return void e.dispatcher.getCache("showRemind")(0,i,function(){e.closeCallBack(1)})}e.buyProp(1)})},e.prototype.buyProp=function(t){this.dispatcher.request("propHs.buyProp",{mode:t,propIndex:this.dataBind},function(t){t&&console.log(t),this.showPropDetail(this.dataBind),this.updateGold()}.bind(this))},e.prototype.adjustUi=function(){this.btnBack.y=43+(1386-this.screenHeight)/2;var t=(1386-this.screenHeight)/4;this.btnBuy1.y=this.btnBuy0.y=804-t,this.labelBuy.y=738-t,this.line_down.y=850-t,this.btnUse.y=947-t,this.unlockLevel.y=947-t,this.diamondTF.y=1184-t,this.diamondImg.y=1176-t,this.coinTF.y=1140-t,this.coinImg.y=1132-t,this.labelNumLeft.y=this.labelNum.y=this.labelBuy.y-50},e.prototype.refreshUi=function(){var t=this;this.currentStatus=0,this.groupHouse.visible=!0,this.groupHouse.removeChildren(),this.groupDetial.visible=!1,this.ck_title.text="仓 库";var e=["ck_wuqi_png","ck_daoju_png"];this.typeItems=[];for(var i=0;i<this.typeNames.length;i++){var s=new TypeItem;this.groupHouse.addChild(s),this.typeItems.push(s),s.redPoint||(s.redPoint=new RedPoint,s.addChild(s.redPoint),s.redPoint.x=s.redPoint.y=10,s.redPoint.anchorOffsetX=s.redPoint.anchorOffsetY=20,s.redPoint.visible=!1);var n=0==i?this.dispatcher.getCache("getGunUnLocked")():this.dispatcher.getCache("getPropUnLocked")(),a=Object.keys(n).length;s.redPoint.visible=a>0,s.redPoint.visible&&s.redPoint.setNumber(a),s.y=30+i*s.height+20*i,s.x=5,setTexture(s.img_type,e[i],.5,.5,1,1),s.label_type.text=this.typeNames[i],s.currentI=i,s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.typeIndex=t.target.currentI,this.showPropList()}.bind(this),this),s.visible=!1}this.typeItems[0].visible=!0,egret.Tween.get(this.typeItems[1]).to({},3e3*i,function(){t.typeItems[1].visible=!0}),this.updateGold()},e.prototype.showPropList=function(){console.log("show proplist:"+this.typeIndex),this.currentStatus=1,this.ck_title.text=0==this.typeIndex?"武 器":"道 具",this.groupHouse.visible=!0,this.groupDetial.visible=!1,this.groupHouse.removeChildren();var t=this.dispatcher.get("user");this.list=new eui.Group,this.scroller=new egret.ScrollView(this.list),this.groupHouse.addChild(this.scroller),this.scroller.y=30,this.scroller.x=5,this.scroller.width=this.list.width=320,this.scroller.height=696;for(var e=(t.gunIndex||"",0==this.typeIndex?t.gunHs||[[0,-1],[-1,-1],[-1,-1],[-1,-1]]:t.propHs||[[0,-1,-1],[-1,-1,-1],[-1,-1,-1]]),i=0,s=0==this.typeIndex?this.dispatcher.getCache("getGunUnLocked")():this.dispatcher.getCache("getPropUnLocked")(),n=0;n<e.length;n++)for(var a=e[n],r=0;r<a.length;r++){var h=new PropItem;h.x=r%3*108,h.y=110*(i+Math.floor(r/3))+20,this.list.addChild(h),s.hasOwnProperty(n+"-"+r)&&h.startJump();var o;if(0==this.typeIndex){o=this.dataJson.gunsBaseNumber[n+"-"+r],setTexture(h.propImg,"weapon_s_"+n+"_"+r+"_png"),h.suoImg.visible=h.suoImgBg.visible=-1==e[n][r],h.iconImg.visible=this.dispatcher.get("user","gunIndex")==n+"-"+r,setTexture(h.bgImg,this.dispatcher.get("user","gunIndex")==n+"-"+r?"ck_wupin_dangqian_png":"ck_wupin_putong_png");var l=o[0].length>4?o[0].substr(0,2)+"‧‧‧"+o[0].substr(o[0].length-2,o[0].length):o[0];h.propLabel.text=h.suoImg.visible?this.dataJson.gunUnLockLevel[o[0]]+"级解锁":l,h.propLabel.textColor=h.suoImg.visible?16777215:h.iconImg.visible?7093780:12154151,h.itemNum.visible=!1}else if(1==this.typeIndex){o=this.dataJson.propsBaseNumber[n+"-"+r],setTexture(h.propImg,"prop_s_"+n+"_"+r+"_png"),h.suoImg.visible=h.suoImgBg.visible=e[n][r]<0,h.iconImg.visible=this.dispatcher.get("user","propIndex")==n+"-"+r,setTexture(h.bgImg,this.dispatcher.get("user","propIndex")==n+"-"+r?"ck_wupin_dangqian_png":"ck_wupin_putong_png");var l=o[0].length>4?o[0].substr(0,2)+"‧‧‧"+o[0].substr(o[0].length-2,o[0].length):o[0];h.propLabel.text=h.suoImg.visible?this.dataJson.propUnLockLevel[o[0]]+"级解锁":l,h.propLabel.textColor=h.suoImg.visible?16777215:h.iconImg.visible?7093780:12154151,h.itemNum.visible=!0;var d=-1-a[r];h.itemNum.text=a[r]>=0?a[r]>99?"99+":a[r]:0==d?"":d>99?"99+":d}h.bgImg.visible=!h.suoImg.visible,h.propImg.alpha=h.suoImg.visible?.7:1;var c=n+"-"+r;h.currentI=c,h.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.detailNumber=-1,this.showPropDetail(t.target.currentI)},this),r==a.length-1&&(i+=Math.ceil(r/3))}},e.prototype.showPropDetail=function(t){if(this.adjustUi(),this.refreshPreson(5),this.dataBind=t,this.dispatcher.getCache("notifyPropDetailRead")(this.typeIndex,t),this.unlockLevel.visible=!1,this.currentStatus=2,this.ck_title.text="详 情",this.groupHouse.visible=!1,this.groupDetial.visible=!0,this.labelNumLeft.visible=this.labelNum.visible=this.btnUse.visible=!1,this.experTitle.visible=this.experValue.visible=0==this.typeIndex,this.btnBuy0.visible=this.btnBuy1.visible=this.labelBuy.visible=!1,this.aniMaxLevel&&this.aniMaxLevel.parent&&this.aniMaxLevel.parent.removeChild(this.aniMaxLevel),0==this.typeIndex){var e=this.dataJson.gunsBaseNumber[t];this.dataDetail=e,this.propTitle.text=e[0],this.propDes.text=e[7];var i=["伤害","弹夹","精度","射速"],s=e[1].split("-");this.attrGroup.removeChildren();for(var n=0;n<i.length;n++){var a=new AttrItem;this.attrGroup.addChild(a),a.y=(20+a.height)*n,a.label_k.text=i[n],a.label_k.bold=!0,3==n?a.label_v.text=e[n+2]+"/分钟":0==n&&3==s[0]?(a.label_v.text=e[n+2]+"  [       "+(this.mJunPer*+e[n+2]).toFixed(0)+"]",a.zxImg.visible=!0):a.label_v.text=e[n+2]+"",a.label_v.bold=!0}var r=this.dispatcher.get("user","gunHs")||[[0,-1],[-1,-1],[-1,-1],[-1,-1]];setTexture(this.propIcon,"weapon_l_"+ +s[0]+"_"+ +s[1]+"_png",.5,.5);var h=r[+s[0]][+s[1]];this.experValue.visible&&(this.experValue.text=h>=this.mMaxShuliandu?"大师级":(-1==h?0:h)+"/"+this.mMaxShuliandu),h>=this.mMaxShuliandu&&(console.log("detail max level"),this.groupDetial.addChild(this.aniMaxLevel),this.aniMaxLevel.x=165,this.aniMaxLevel.y=270,this.aniMaxLevel.play("stand",0)),this.btnUse.visible=-1!=h,this.unlockLevel.visible=!this.btnUse.visible,this.unlockLevel.visible&&(this.unlockLevel.text=this.dataJson.gunUnLockLevel[e[0]]+"级解锁"),this.btnUse.touchEnabled=this.dispatcher.get("user","gunIndex")!=t,setTexture(this.btnUse.bgImg,this.dispatcher.get("user","gunIndex")!=t?"ck_anniu_zhuangbei_png":"ck_anniu_yizhuangbei_png"),setTexture(this.btnUse.tfImg,this.dispatcher.get("user","gunIndex")!=t?"wz_zb_png":"wz_yzb_png")}else if(1==this.typeIndex){var e=this.dataJson.propsBaseNumber[t];this.dataBind=t,this.dataDetail=e,this.propTitle.text=e[0],this.attrGroup.removeChildren(),this.propDes.text=e[7];var o=this.dispatcher.get("user","propHs")||[[0,-1,-1],[-1,-1,-1],[-1,-1,-1]],l=e[1],s=l.split("-");setTexture(this.propIcon,"prop_l_"+ +s[0]+"_"+ +s[1]+"_png",.5,.5);var d=o[+s[0]][+s[1]];if(this.btnBuy0.visible=this.btnBuy1.visible=this.labelBuy.visible=o[+s[0]][+s[1]]>=0,this.labelNumLeft.visible=this.labelNum.visible=this.btnUse.visible=d>0,this.unlockLevel.visible=0>d,this.unlockLevel.visible&&(this.unlockLevel.text=this.dataJson.propUnLockLevel[e[0]]+"级解锁"),this.btnBuy0.visible&&(setTexture(this.btnBuy0.img_left,"sy_jinbi_png"),this.btnBuy0.label_right.text=e[5]+"",setTexture(this.btnBuy1.img_left,"sy_zuanshi_png"),this.btnBuy1.label_right.text=e[6]+""),this.btnUse.touchEnabled=this.dispatcher.get("user","propIndex")!=t,setTexture(this.btnUse.bgImg,this.dispatcher.get("user","propIndex")!=t?"ck_anniu_zhuangbei_png":"ck_anniu_yizhuangbei_png"),setTexture(this.btnUse.tfImg,this.dispatcher.get("user","propIndex")!=t?"wz_zb_png":"wz_yzb_png"),this.labelNum.text=(d>99?"99+":d)+"",this.detailNumber>=0&&d>this.detailNumber){var c=d-this.detailNumber;console.log("addedNum:"+c),c>0&&this.showAddedNumber(c)}this.detailNumber=d}this.propIcon.width,this.propIcon.height;egret.Tween.removeTweens(this.propIcon),egret.Tween.get(this.propIcon,{loop:!0}).to({scaleX:1.05,scaleY:1.05},900).to({scaleX:1,scaleY:1},900)},e.prototype.showAddedNumber=function(t){var e=new eui.Label;e.textColor=12153638,e.size=this.labelNum.size,this.groupDetial.addChild(e),this.addedLabelList.push(e),e.text="+"+t,e.x=this.labelNum.x+this.labelNum.width+20,e.y=this.labelNum.y,console.log(e);var i=e.x,s=e.y;e.alpha=0,egret.Tween.get(e).to({alpha:1},200).to({x:i+40,y:s-10},100).to({x:i+60,y:s+20,alpha:0},200).call(function(){var t=this.addedLabelList.pop();t&&t.parent.removeChild(t)},this)},e.prototype.updateGold=function(){var t=this.dispatcher.get("user","goldAll")||0,e=this.dispatcher.get("user","goldCost")||0,i=this.dispatcher.get("user","diamondAll")||0,s=this.dispatcher.get("user","diamondCost")||0;this.coinTF.text=t-e+"",this.diamondTF.text=i-s+""},e.prototype.useProp=function(t,e){if(0==this.typeIndex){if(e==this.dispatcher.get("user","gunIndex"))return;this.dispatcher.request("propHs.changeGun",{gunIndex:e},function(t){t&&console.log(t);this.dispatcher.get("user");console.log("change gun` success"),this.refreshPreson(4),this.showPropDetail(e)}.bind(this))}else if(1==this.typeIndex){if(e==this.dispatcher.get("user","propIndex"))return;this.dispatcher.request("propHs.changeProps",{mode:0,propIndex:e},function(t){t&&console.log(t);this.dispatcher.get("user");console.log("change gun success"),this.showPropDetail(e)}.bind(this))}},e.prototype.showPerson=function(){var t=this.dispatcher.get("user","gender"),e=this.dispatcher.get("user","cap")-1e4;t=-1==t?1:t;var i=this.target=new Animation("chr"+t);i.setSlot("hat",createBitmap("zs_maozi_b0"+e+"_png",.5,.5,0,0,this.target_scale,this.target_scale)),this.groupLeft.addChild(i),i.x=this.coinImg.x+80,i.y=this.coinImg.y-100,i.scaleX=i.scaleY=this.target_scale,this.refreshPreson(3)},e.prototype.refreshPreson=function(t){console.log("刷新 换枪 一次,当前 logIndex"+t);var e=this.dispatcher.get("user","gunIndex");this.target.x=this.coinImg.x+80,this.target.y=this.coinImg.y-100,this.target.play(this.standArray[e.substr(0,1)],0);var i=this.dispatcher.get("user","gunHs")||[[0,-1],[-1,-1],[-1,-1],[-1,-1]],s=i[+e.substr(0,1)][+e.substr(2,1)],n=new eui.Group;if(n.addChild(createBitmap("weapon_m_"+e.replace("-","_")+"_png",.5,.5,0,0,1,1)),s==RES.getRes("game_config_json").buttleConfig.experGunMax){var a=new Animation("se_maxlevel");a.x=0,a.y=0,a.play("stand",0),n.addChild(a)}this.target.setSlot("gun0",n)},e}(eui.Component);__reflect(HouseScene.prototype,"HouseScene");var TypeItem=function(t){function e(){var e=t.call(this)||this;return e.skinName=CKBtnMulu,e}return __extends(e,t),e}(eui.Button);__reflect(TypeItem.prototype,"TypeItem");var PropItem=function(t){function e(){var e=t.call(this)||this;return e.skinName=HouseItem,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.touchEnabled=!0,this.bgImg.touchEnabled=this.iconImg.touchEnabled=this.propImg.touchEnabled=this.propLabel.touchEnabled=this.suoImg.touchEnabled=this.suoImgBg.touchEnabled=this.itemNum.touchEnabled=!1},e.prototype.startJump=function(){createBitmap("ck_new_png",.5,.5,0,0,1,1,function(t){this.addChild(t),t.x=106-t.width/2,t.y=10,egret.Tween.get(t,{loop:!0}).to({y:t.y-8.5},200,egret.Ease.sineIn).to({y:t.y},500,egret.Ease.bounceOut).wait(3e3)}.bind(this))},e}(eui.Component);__reflect(PropItem.prototype,"PropItem");var AttrItem=function(t){function e(){var e=t.call(this)||this;return e.skinName=GunAttrItem,e}return __extends(e,t),e}(eui.Component);__reflect(AttrItem.prototype,"AttrItem");