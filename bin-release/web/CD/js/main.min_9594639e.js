function createBitmap(t,e,i,n,s,a,r,o){var h=new egret.Bitmap,l=new AssetAdapter;return l.getAsset(t,function(l){h.texture=RES.getRes(t),h.anchorOffsetX=e>2?e:(e||0)*h.width,h.anchorOffsetY=i>2?i:(i||0)*h.height,h.x=n||0,h.y=s||0,h.scaleX=a||1,h.scaleY=r||1,o&&o(h)},this),h}function setTexture(t,e,i,n,s,a,r){i=i||t.anchorOffsetX/t.width,n=n||t.anchorOffsetY/t.height,t.scaleX=void 0===s?1:s,t.scaleY=void 0===a?1:a;var o=new AssetAdapter;t.texture=null,o.getAsset(e,function(s){t.texture=RES.getRes(e),t.anchorOffsetX=(i||0)*t.width,t.anchorOffsetY=(n||0)*t.height,r&&r()},this)}function getNumberString(t){var e,i;if(0===+t||+t){var n=""+Math.floor(t);if(1e3>t)return n;var s=Math.floor(Math.log(t)/Math.log(10)+1e-6);e=~n.indexOf("e")?+n.split("e")[0]*Math.pow(10,s%3):+n.slice(0,s%3+3)/100,i=s/3>>0}else{if(t=t.split("exp"),+t[1]<3)return Math.round(t[0]*Math.pow(10,t[1]))+"";for(e=t[0]*Math.pow(10,t[1]%3);e>1e3;)e/=1e3,t[1]=+t[1]+3;i=t[1]/3>>0}var a;if(4>i)a=["","K","M","B"][i];else{var r=(i-4)/26>>0,o=r/26>>0,h=(i-4)%26,l="abcdefghijklmnopqrstuvwxyz",c=l.toUpperCase();a=(2>o?l:c)[r%26]+(o%2?c:l)[h]}return e.toFixed(10>e?2:100>e?1:0)+a}function setAvatar(t,e,i,n){if(!e)return t.texture=null,void(n&&n());var s=t.width,a=t.height;if(i=i||(~location.hostname.indexOf("h5.")?"http://s1.wc.weedon.cn:9602/avatar/":"https://gsbxs.hortor.net:9602/avatar/")+e+"/avatar.jpg",avatars[e]){var r=new egret.Texture;r.bitmapData=avatars[e],t.texture=r,t.width=s,t.height=a,n&&n()}else{var o=new egret.ImageLoader;o.crossOrigin="anonymous",o.once(egret.Event.COMPLETE,function(i){var r=new egret.Texture;avatars[e]=r.bitmapData=o.data,t.texture=r,t.width=s,t.height=a,n&&n()},this),o.load(i)}}function setQRCode(t,e,i){var n=t.width,s=t.height,a=(~location.hostname.indexOf("h5game.")?"http://s1.wc.weedon.cn:9602/qrcode/":"https://gsbxs.hortor.net:9602/qrcode/")+e;if(qrcodes[e])t.width=n,t.height=s,i();else{var r=new egret.ImageLoader;r.crossOrigin="anonymous",r.once(egret.Event.COMPLETE,function(e){t.width=n,t.height=s,i()},this),r.load(a)}}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(s,a){function r(t){try{h(n.next(t))}catch(e){a(e)}}function o(t){try{h(n["throw"](t))}catch(e){a(e)}}function h(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(r,o)}h((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(s)throw new TypeError("Generator is already executing.");for(;h;)try{if(s=1,a&&(r=a[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(a,i[1])).done)return r;switch(a=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,a=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(r=h.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){h.label=i[1];break}if(6===i[0]&&h.label<r[1]){h.label=r[1],r=i;break}if(r&&h.label<r[2]){h.label=r[2],h.ops.push(i);break}r[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(n){i=[6,n],a=0}finally{s=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var s,a,r,o,h={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var s=RES.getRes(t);s?n(s):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var _wx={_lastCallback:0,_interval:0,_callback:null,startAccelerometer:function(t){window.addEventListener("deviceorientation",this._listener.bind(this),!0),t.success&&t.success()},_listener:function(t){var e=Date.now();e-this._lastCallback<this._interval||(this._lastCallback=e,this._callback&&this._callback({x:+(t.gamma/90).toFixed(5),y:+(t.alpha/180-1).toFixed(5),z:+(t.beta/90-1).toFixed(5)}))},onAccelerometerChange:function(t){this._callback=t},setInterval:function(t){this._interval=t},stopAccelerometer:function(){window.removeEventListener("deviceorientation",this._listener.bind(this),!0)}},Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e="1.0.0";RES.getRealURL=function(t){return t+"?v="+e};var i=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",i),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),this.stage.removeChild(t),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var n=new eui.Theme("resource/default.thm.json",t.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){var t=weedon.config(~location.hostname.indexOf("h5.")?"s1.wc.weedon.cn":~location.hostname.indexOf(".hortor.")?"gsbxs.hortor.net":location.hostname,9601,"ws",function(){}),e=egret.localStorage.getItem("CM#OPENID");e||(e=Math.random().toString(),egret.localStorage.setItem("CM#OPENID",e)),weedon.getLoginData(function(e,i){var n=this;t.request("user.login",{loginData:i},function(e){if(e)return alert(e.errmsg||"登录失败");weedon.initChannelConfig({inviter:t.get("user","_id"),nickname:t.get("user","nickname")},function(e){var i=t.getCache("shareCallback");i&&i(e||0)},function(e){var i=t.getCache("payCallback");i&&i(e||0)});var i=new DuelScene(t);n.addChild(i)}.bind(this))}.bind(this))},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function s(t){e.call(n,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),i.call(n))}"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(n,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Animation=function(t){function e(e,i,n,s,a){var r=t.call(this)||this;r.onTop=1,r.debug=!1,r.spd=1,r.slots={},r.sounds={},r.frameEvents={},r.touchEnabled=!1,r.eventCallback=s;var o=new AssetAdapter,h=3;return[e+"_ske_json",e+"_tex_json",e+"_tex_png"].forEach(function(t){o.getAsset(t,function(){if(!--h){var t=new dragonBones.EgretFactory;t.parseDragonBonesData(RES.getRes(e+"_ske_json")),t.parseTextureAtlasData(RES.getRes(e+"_tex_json"),RES.getRes(e+"_tex_png"));var s=this.display=t.buildArmatureDisplay(i||e);this.addChild(s),s.touchEnabled=!1,s.armature.addEventListener(dragonBones.Event.LOOP_COMPLETE,function(){if(this.callback){var t=this.callback;this.callback=null,t()}else n&&n()},this),s.armature.addEventListener(dragonBones.Event.BONE_FRAME_EVENT,this.frameListener,this),s.armature.addEventListener(dragonBones.SoundEvent.SOUND_EVENT,this.soundListener,this),this.animationName&&s.animation.play(this.animationName,this.loop);for(var r in this.slots){var o=s.armature.getSlot(r),l=o.getDisplay();this.slots[r].x=l.x,this.slots[r].y=l.y,o.setDisplay(this.slots[r]),delete this.slots[r]}s.animation.timeScale=this.spd,a&&a(s)}},this)}.bind(r)),r}return __extends(e,t),e.prototype.frameListener=function(t){this.frameEvents[t.frameLabel]?this.frameEvents[t.frameLabel](t):this.eventCallback&&this.eventCallback(t.frameLabel)},e.prototype.soundListener=function(t){if(!MUTE_SE)if(this.sounds[t.frameLabel])this.sounds[t.frameLabel].play(1);else var e=this.sounds[t.frameLabel]=new Sound(1,t.frameLabel.split(".")[0],function(){e.play(1)})},e.prototype.clearListeners=function(){this.display.armature.removeEventListener(dragonBones.Event.BONE_FRAME_EVENT,this.frameListener,this),this.display.armature.removeEventListener(dragonBones.SoundEvent.SOUND_EVENT,this.soundListener,this)},e.prototype.getSlotDisplay=function(t){return this.display?this.display.armature.getSlot(t).getDisplay():null},e.prototype.play=function(t,e,i){this.debug&&console.log(t),this.animationName=t,this.loop=e,this.display&&this.display.animation.play(t,e),this.callback=i||this.callback},e.prototype.setSlot=function(t,e){if(this.display){var i=this.display.armature.getSlot(t).getDisplay();e.x=i.x,e.y=i.y,this.display&&this.display.armature.getSlot(t).setDisplay(e)}else this.slots[t]=e},e.prototype.setEvent=function(t,e){this.frameEvents[t]=e},e.prototype.setSpeed=function(t){this.display?this.display.animation.timeScale=t:this.spd=t},e.prototype.hitCheck=function(t,e,i){var n=this.display.globalToLocal(t,e);if(i){var s=this.display.armature.getSlot(i);return s?s.containsPoint(n.x,n.y):!1}return!!this.display.armature.containsPoint(n.x,n.y)},e}(eui.Group);__reflect(Animation.prototype,"Animation");var Dispatcher=function(){function t(t){this._dispatcher=t}return t.prototype.heartbeat=function(t,e){this._dispatcher.heartbeat(t,e)},t.prototype.request=function(t,e,i,n){this._dispatcher.request(t,e,i,n)},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._dispatcher.get.apply(this._dispatcher,t)},t.prototype.getOld=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._dispatcher.getOld.apply(this._dispatcher,t)},t.prototype.getNew=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._dispatcher.getNew.apply(this._dispatcher,t)},t.prototype.safeGetNew=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._dispatcher.safeGetNew.apply(this._dispatcher,t)},t.prototype.setCache=function(t,e){this._dispatcher.setCache(t,e)},t.prototype.getCache=function(t){return this._dispatcher.getCache(t)},t.prototype.clearCache=function(){this._dispatcher.clearCache()},Object.defineProperty(t.prototype,"waitFunc",{set:function(t){this._dispatcher.waitFunc=t},enumerable:!0,configurable:!0}),t.prototype.setOverrideKey=function(t){this._dispatcher.setOverrideKey(t)},t.prototype.setPushCallback=function(t,e){this._dispatcher.setPushCallback(t,e)},t}();__reflect(Dispatcher.prototype,"Dispatcher");var MUTE_SE=!1,Sound=function(){function t(t,e,i,n){this.playing=!1;var s=new egret.Sound;s.load("resource/assets/sound/"+e+(n||".mp3")+"?v="+window.__VERSION),s.addEventListener(egret.Event.COMPLETE,function(){this.sound=s,i(this)},this),this.mode=t}return t.prototype.play=function(t,e){if(!(this.playing||!this.sound||this.mode&&MUTE_SE)){this.playing=!0;var i=this.channel=this.sound.play(0,t||0===t?t:1);i.addEventListener(egret.Event.SOUND_COMPLETE,function(){e&&e(),this.playing=!1},this)}},t.prototype.stop=function(){this.playing&&(this.playing=!1,this.channel&&this.channel.stop())},t}();__reflect(Sound.prototype,"Sound");var avatars={},qrcodes={},DuelScene=function(t){function e(e){var i=t.call(this)||this;return i.targetX=0,i.targetY=0,i.finished=!1,i.shooting=!1,i.hit=!1,i.reloading=!1,i.bullets=6,i.nextX=0,i.waitFinish=0,i.enemyMoving=!1,i.hitEffects=[],i.behitEffects=[],i.enemyLevel=1,i.enemyMaxHp=100,i.enemyCurrentHp=100,i.maxHp=100,i.currentHp=100,i.enemyNextShoot=0,i.totalDamage=0,i.totalShoot=0,i.totalHit=0,i.headHit=0,i.duelStarted=!1,i.dispatcher=e,i.skinName=DuelSceneSkin,e.heartbeat(5e3,function(){}),i}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=this.gun=new Animation("gun0");this.addChild(e),e.play("stand",0),e.x=320,e.y=1386;var i=this.cross=new Animation("Crosshair");this.addChild(i),i.play("stand",0),i.x=320,i.y=686;var n=this.target=new Animation("chr");this.enemy.addChild(n),n.play("stand",0),n.scaleX=n.scaleY=.3;var s=this.enemyFire=new Animation("enimyfire");n.setSlot("p",s),s.visible=!1;var a=this.log=new eui.Label;this.addChild(a),a.x=20,a.y=1200,a.size=24,a.textColor=16711680,this.scene.touchEnabled=!0,this.scene.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.fire()},this),this.adjustUI(),this.showRanking()},e.prototype.adjustUI=function(){return this.ignoreNextResize?void(this.ignoreNextResize=!1):(this.ignoreNextResize=!0,void(weedon.winSize.width/weedon.winSize.height>.64?(this.stage.setContentSize(640,1e3),this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL,this.y=-193,this.topUI.y=193,this.screenHeight=1e3):(this.stage.setContentSize(640,1386),this.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,this.screenHeight=640/weedon.winSize.width*weedon.winSize.height,this.y=this.screenHeight-1386,this.topUI.y=-this.y)))},e.prototype.quit=function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).stopAccelerometer(),egret.stopTick(this.update,this)},e.prototype.clamp=function(t,e,i){return Math.max(e,Math.min(t,i))},e.prototype.start=function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).startAccelerometer({success:function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).onAccelerometerChange(function(t){this.log.text=JSON.stringify(t),this.targetX=1374*this.clamp(t.x,-.25,.25)*(t.z>0?-1:1),this.targetY=400+640*this.clamp(t.z,-1,-.2)}.bind(this)),this.startTime=Date.now(),this.enemyNextShoot=this.startTime+1e4,this.totalShoot=this.totalHit=this.headHit=this.totalDamage=0,this.currentHp=this.maxHp=this.enemyCurrentHp=this.enemyMaxHp=100,this.enemyLevel=1,this.level.text="Lv.1",this.updateHp(),this.nextX=640*Math.random()>>0,egret.startTick(this.update,this)}.bind(this)})},e.prototype.showRanking=function(){this.dispatcher.request(this.mode?"user.dueler":"user.list",{},function(t){var e=new RankingList(this.dispatcher,this.totalShoot,this.totalHit,this.headHit,function(t){this.mode=t,t?this.multi():this.start()}.bind(this),this.mode);this.addChild(e),e.x=40,e.y=(this.screenHeight-900)/2-this.y}.bind(this))},e.prototype.multi=function(){this.startTime=0,this.dispatcher.setPushCallback("battle",this.battlePush.bind(this)),this.dispatcher.request("user.join",{},function(){var t=this.dispatcher.get("battle","ready");if(t)this.initDuel();else{var e=this.waitingPanel=new InfoBoard;this.addChild(e),e.x=40,e.y=(this.screenHeight-480)/2-this.y,e.tag.text="正在匹配对手",e.btn.text="取消",e.btn.touchEnabled=!0,e.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.dispatcher.request("user.leave",{},function(){this.removeChild(e),this.waitingPanel=null,this.showRanking()}.bind(this))},this)}}.bind(this))},e.prototype.initDuel=function(){var t=this.dispatcher.get("battle");this.startTime=t.ready,this.waitingPanel&&this.removeChild(this.waitingPanel),this.waitingPanel=null,this.bullets=6;var e=t.key.split("_"),i=this.dispatcher.get("user","_id");this.opponent=i==e[0]?+e[1]:+e[0],this.maxHp=this.currentHp=+t["hp_"+i],this.enemyCurrentHp=this.enemyMaxHp=+t["hp_"+this.opponent],this.nickname.visible=!0,this.nickname.text=t["nickname_"+this.opponent],this.updateHp(),egret.startTick(this.update,this)},e.prototype.duel=function(){this.duelStarted=!0,this.counter.visible=!1,("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).startAccelerometer({success:function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).onAccelerometerChange(function(t){this.log.text=JSON.stringify(t),this.targetX=2020*this.clamp(t.x,-.17,.17)*(t.z>0?-1:1),this.targetY=400+640*this.clamp(t.z,-1,-.2)}.bind(this)),this.startTime=Date.now(),this.nextX=640*Math.random()>>0}.bind(this)})},e.prototype.battlePush=function(){if(this.startTime){var t=this.dispatcher.get("battle","hit");this.enemyFire.visible=!0,this.enemyFire.play("hit",1,function(){this.enemyFire.visible=!1}.bind(this)),t&&this.behit(),this.currentHp=+this.dispatcher.get("battle","hp_"+this.dispatcher.get("user","_id")),this.updateHp(),this.currentHp<=0&&this.duelResult(!1)}else this.initDuel()},e.prototype.duelResult=function(t){this.startTime=0,this.duelStarted=!1,this.quit(),this.target.play("stand",0);var e=new InfoBoard;this.addChild(e),e.x=40,e.y=(this.screenHeight-480)/2-this.y,e.tag.text=t?"你赢了":"你输了",e.btn.text="确定",e.btn.touchEnabled=!0,e.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.removeChild(e),this.showRanking()},this)},e.prototype.fire=function(){this.shooting||this.reloading||(this.shooting=!0,++this.totalShoot,this.check(),this.gun.play("fire",1,function(){this.shooting=!1,this.bullets-=1,this.bullets<=0?(this.reloading=!0,this.cross.visible=!1,this.gun.play("reload",1,function(){this.bullets=6,this.reloading=!1,this.cross.visible=!0}.bind(this))):this.gun.play("stand",0)}.bind(this)),this.cross.play("fire",1,function(){this.cross.play("stand",0)}.bind(this)))},e.prototype.check=function(){for(var t=this.localToGlobal(this.cross.x,this.cross.y),e=this.target.globalToLocal(t.x,t.y),i=-1,n=0;10>n;++n){var s=["headhit","leghit0","leghit1","leghit2","leghit3","leghit4","leghit5","bodyhit0","bodyhit1","bodyhit2"][n];if(this.target.hitCheck(t.x,t.y,s)){i=n;break}}if(~i){++this.totalHit,this.hit=!0,this.target.play(i?"hit":"headhit",1,function(){this.hit=!1,this.target.play(this.waitFinish>Date.now||this.nextX==this.enemy.x?"stand":this.nextX>this.enemy.x?"right":"left",0)}.bind(this));for(var a,n=0;n<this.hitEffects.length;++n)if(!this.hitEffects[n].visible){a=this.hitEffects[n];break}if(a||(a=new Animation("se_hit"),this.target.addChild(a),this.hitEffects.push(a)),a.visible=!0,a.x=e.x,a.y=e.y,a.play("hit",1,function(){a.visible=!1}),!i&&++this.headHit,!this.mode){var r=i?10:30;this.totalDamage+=r,this.enemyCurrentHp-=r,this.enemyCurrentHp<=0?(this.enemyLevel+=1,this.enemyCurrentHp=this.enemyMaxHp=100+10*Math.pow(2,this.enemyLevel),this.level.text="Lv."+this.enemyLevel,this.enemyNextShoot=Date.now()+1e3*Math.max(11-this.enemyLevel,3)):this.enemyNextShoot+=i?1e3:3e3}this.updateHp()}else this.enemyNextShoot-=1e3;this.mode&&this.dispatcher.request("user.battle",{hit:~i?i?1:2:0},function(){this.enemyCurrentHp=this.dispatcher.get("battle","hp_"+this.opponent),this.updateHp(),+this.enemyCurrentHp<=0&&this.duelResult(!0)}.bind(this))},e.prototype.behit=function(){for(var t,e=0;e<this.behitEffects.length;++e)if(!this.behitEffects[e].visible){t=this.behitEffects[e];break}t||(t=new Animation("beenhit"),this.addChild(t),this.behitEffects.push(t)),t.visible=!0,t.x=40+600*Math.random(),t.y=this.cross.y-200+400*Math.random(),t.play("hit",1,function(){t.visible=!1})},e.prototype.updateHp=function(){this.hpTag.text=this.currentHp+"/"+this.maxHp,this.hpBar.mask=new egret.Rectangle(0,0,this.hpBar.width*this.currentHp/this.maxHp,this.hpBar.height),this.enemyHpBar.mask=new egret.Rectangle(0,0,this.enemyHpBar.width*this.enemyCurrentHp/this.enemyMaxHp,this.enemyHpBar.height)},e.prototype.update=function(){var t=Date.now();if(this.mode&&this.startTime&&t<this.startTime)return this.counter.visible=!0,void(this.counter.text=((this.startTime-t)/1e3>>0).toString());this.mode&&!this.duelStarted&&this.duel();var e=t-this.startTime;return this.startTime=t,this.field.x+=.01*e*(this.targetX-this.field.x),this.scene.y+=.01*e*(this.targetY-this.scene.y),!this.mode&&this.enemyNextShoot<t&&(this.enemyFire.visible=!0,this.enemyFire.play("hit",1,function(){this.enemyFire.visible=!1}.bind(this)),this.behit(),this.currentHp-=9+this.enemyLevel,this.enemyNextShoot=t+1e3*Math.max(11-this.enemyLevel,3),this.updateHp(),this.currentHp<=0)?(this.quit(),void this.dispatcher.request("user.progress",{totalDamage:this.totalDamage,totalShoots:this.totalShoot,totalHits:this.totalHit,headHits:this.headHit},function(){this.showRanking()}.bind(this))):(!this.mode&&(this.counter.text=((this.enemyNextShoot-t)/1e3>>0).toString()),this.hit||t<this.waitFinish?!0:(this.nextX>this.enemy.x?(this.enemyMoving||(this.enemyMoving=!0,this.target.play("right",0)),this.enemy.x+=Math.min((.2+.05*this.enemyLevel-.05)*e,this.nextX-this.enemy.x)):(this.enemyMoving||(this.enemyMoving=!0,this.target.play("left",0)),this.enemy.x-=Math.min((.2+.05*this.enemyLevel-.05)*e,this.enemy.x-this.nextX)),this.enemy.x==this.nextX&&(this.enemyMoving=!1,this.target.play("stand",0),this.waitFinish=t+1e3+(1e3*Math.random()>>0),this.nextX=640*Math.random()>>0),!0))},e}(eui.Component);__reflect(DuelScene.prototype,"DuelScene");var RankingList=function(t){function e(e,i,n,s,a,r){var o=t.call(this)||this;return o.skinName=RankingListSkin,o.dispatcher=e,o.totalShoot=i,o.totalHit=n,o.headHit=s,o.callback=a,o.rankMode=r||0,o}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btnStart.touchEnabled=!0,this.btnStart.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.parent.removeChild(this),this.callback(0)},this),this.btnMulti.touchEnabled=!0,this.btnMulti.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.parent.removeChild(this),this.callback(1)},this),[this.trainRanking,this.duelRanking].forEach(function(t,e){t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e!=this.rankMode&&(this.rankMode=e,this.dispatcher.request(e?"user.dueler":"user.list",{},function(){this.updateMode()}.bind(this)))},this)}.bind(this));var e=this.list=new eui.Group,i=this.scroller=new egret.ScrollView(e);this.addChild(i),i.x=15,i.y=200,i.width=e.width=530,i.height=600,this.updateMode()},e.prototype.updateMode=function(){switch(this.list.removeChildren(),this.scroller.scrollTop=0,this.rankMode){case 0:this.tagTraining.visible=!0,this.tagDuel.visible=!1,this.totalShootLabel.text=this.totalShoot.toString(),this.totalHitLabel.text=this.totalHit.toString(),this.headHitLabel.text=this.headHit.toString();var t=this.dispatcher.get("users")||[];t.sort(function(t,e){return e.bestDamage-t.bestDamage}).forEach(function(t,e){var i=new RankingItem;this.list.addChild(i),i.x=5,i.y=5+105*e,setAvatar(i.avatar,t.avatar),i.tagTraining.visible=!0,i.tagDuel.visible=!1,i.nickname.text=t.nickname,i.totalShootLabel.text=t.totalShoots,i.totalHitLabel.text=t.totalHits,i.headHitLabel.text=t.headHits}.bind(this));break;case 1:this.tagTraining.visible=!1,this.tagDuel.visible=!0;var e=this.dispatcher.get("user");this.totalShootLabel.text=e.duels.toString(),this.totalHitLabel.text=e.duelWins.toString(),this.headHitLabel.text=(e.duels-e.duelWins).toString(),t=this.dispatcher.get("dueler")||[],t.sort(function(t,e){return 2*(e.duelWins||0)-e.duels-(2*(t.duelWins||0)-t.duels)}).forEach(function(t,e){var i=new RankingItem;this.list.addChild(i),i.x=5,i.y=5+105*e,setAvatar(i.avatar,t.avatar),i.tagTraining.visible=!1,i.tagDuel.visible=!0,i.nickname.text=t.nickname,i.totalShootLabel.text=t.duels,i.totalHitLabel.text=t.duelWins||0,i.headHitLabel.text=(t.duels-(t.duelWins||0)).toString()}.bind(this))}},e}(eui.Component);__reflect(RankingList.prototype,"RankingList");var RankingItem=function(t){function e(){var e=t.call(this)||this;return e.skinName=RankingItemSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(eui.Component);__reflect(RankingItem.prototype,"RankingItem");var InfoBoard=function(t){function e(){var e=t.call(this)||this;return e.skinName=InfoBoardSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(eui.Component);__reflect(InfoBoard.prototype,"InfoBoard");