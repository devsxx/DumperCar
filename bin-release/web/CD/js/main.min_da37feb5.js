function createBitmap(t,e,i,s,n,a,r,o){var h=new egret.Bitmap,l=new AssetAdapter;return l.getAsset(t,function(l){h.texture=RES.getRes(t),h.anchorOffsetX=e>2?e:(e||0)*h.width,h.anchorOffsetY=i>2?i:(i||0)*h.height,h.x=s||0,h.y=n||0,h.scaleX=a||1,h.scaleY=r||1,o&&o(h)},this),h}function setTexture(t,e,i,s,n,a,r){i=i||t.anchorOffsetX/t.width,s=s||t.anchorOffsetY/t.height,t.scaleX=void 0===n?1:n,t.scaleY=void 0===a?1:a;var o=new AssetAdapter;t.texture=null,o.getAsset(e,function(n){t.texture=RES.getRes(e),t.anchorOffsetX=(i||0)*t.width,t.anchorOffsetY=(s||0)*t.height,r&&r()},this)}function getNumberString(t){var e,i;if(0===+t||+t){var s=""+Math.floor(t);if(1e3>t)return s;var n=Math.floor(Math.log(t)/Math.log(10)+1e-6);e=~s.indexOf("e")?+s.split("e")[0]*Math.pow(10,n%3):+s.slice(0,n%3+3)/100,i=n/3>>0}else{if(t=t.split("exp"),+t[1]<3)return Math.round(t[0]*Math.pow(10,t[1]))+"";for(e=t[0]*Math.pow(10,t[1]%3);e>1e3;)e/=1e3,t[1]=+t[1]+3;i=t[1]/3>>0}var a;if(4>i)a=["","K","M","B"][i];else{var r=(i-4)/26>>0,o=r/26>>0,h=(i-4)%26,l="abcdefghijklmnopqrstuvwxyz",c=l.toUpperCase();a=(2>o?l:c)[r%26]+(o%2?c:l)[h]}return e.toFixed(10>e?2:100>e?1:0)+a}function setAvatar(t,e,i,s){if(!e)return t.texture=null,void(s&&s());var n=t.width,a=t.height;if(i=i||(~location.hostname.indexOf("h5.")?"http://s1.wc.weedon.cn:9602/avatar/":"https://gsbxs.hortor.net:9602/avatar/")+e+"/avatar.jpg",avatars[e]){var r=new egret.Texture;r.bitmapData=avatars[e],t.texture=r,t.width=n,t.height=a,s&&s()}else{var o=new egret.ImageLoader;o.crossOrigin="anonymous",o.once(egret.Event.COMPLETE,function(i){var r=new egret.Texture;avatars[e]=r.bitmapData=o.data,t.texture=r,t.width=n,t.height=a,s&&s()},this),o.load(i)}}function setQRCode(t,e,i){var s=t.width,n=t.height,a=(~location.hostname.indexOf("h5game.")?"http://s1.wc.weedon.cn:9602/qrcode/":"https://gsbxs.hortor.net:9602/qrcode/")+e;if(qrcodes[e])t.width=s,t.height=n,i();else{var r=new egret.ImageLoader;r.crossOrigin="anonymous",r.once(egret.Event.COMPLETE,function(e){t.width=s,t.height=n,i()},this),r.load(a)}}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))(function(n,a){function r(t){try{h(s.next(t))}catch(e){a(e)}}function o(t){try{h(s["throw"](t))}catch(e){a(e)}}function h(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(r,o)}h((s=s.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return s([t,e])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,a&&(r=a[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(a,i[1])).done)return r;switch(a=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,a=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(r=h.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){h.label=i[1];break}if(6===i[0]&&h.label<r[1]){h.label=r[1],r=i;break}if(r&&h.label<r[2]){h.label=r[2],h.ops.push(i);break}r[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(s){i=[6,s],a=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,a,r,o,h={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},ChargeDialog=function(t){function e(e,i){var s=t.call(this)||this;return s.dispatcher=i,s.mScreenHeight=e,s.skinName=ChargeDialogSkin,s}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),new Btn(this.backBtn,function(){e.parent.removeChild(e)}.bind(this)),this.refreshList(),this.adjustUI()},e.prototype.refreshList=function(){this.mChargeArr=RES.getRes("avtivity_json").charge;for(var t=function(t){var i=new eui.Component;i.skinName=ChargeItemRenderSkin,setTexture(i.iconImg,"cz_dangwei_"+(t+1)+"_png"),i.diamondTF.text="钻石 X"+10*e.mChargeArr[t],setTexture(i.costImg,"cz_je_"+t+"_png"),e.list.addChild(i),i.y=150*t,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("click item "+t)},e)},e=this,i=0;i<this.mChargeArr.length;i++)t(i)},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e}(eui.Component);__reflect(ChargeDialog.prototype,"ChargeDialog");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function s(s){e.call(i,s,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?s(n):RES.getResAsync(t,s,this)}else RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var _wx;!function(){function t(t){e&&e({x:+Math.sin(t.gamma/180*Math.PI).toFixed(5),y:t.alpha,z:+Math.sin(-t.beta/180*Math.PI).toFixed(5)})}var e=null;_wx={},Object.defineProperties(_wx,{startAccelerometer:{value:function(e){window.addEventListener("deviceorientation",t,!0),e.success&&e.success()}},onAccelerometerChange:{value:function(t){e=t}},stopAccelerometer:{value:function(){window.removeEventListener("deviceorientation",t,!0)}}})}();var version="1.0.5",Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},RES.getRealURL=function(t){return"https://xbwz-resource.hortor.net/"+t+"?v="+version};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),t=this.loadingView=new LoadingUI,this.stage.addChild(t),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var s=new eui.Theme("resource/default.thm.json",t.stage);s.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){formula.init(RES.getRes("data_json"),RES.getRes("game_config_json"));var t=weedon.config("undefined"!=typeof GameGlobal?"192.168.1.63":~location.hostname.indexOf("h5.")?"s1.wc.weedon.cn":~location.hostname.indexOf(".hortor.")?"gsbxs.hortor.net":"192.168.1.196"==location.hostname?"192.168.1.204":location.hostname,9601,"ws",function(){},"wss://xbwz.hortor.net"),e=egret.localStorage.getItem("CM#OPENID");e||(e=Math.random().toString(),egret.localStorage.setItem("CM#OPENID",e)),weedon.getLoginData(function(e,i){var s=this;t.request("user.login",{loginData:i},function(e){if(e)return alert(e.errmsg||"登录失败");t.heartbeat(5e3,function(){}),weedon.initChannelConfig({inviter:t.get("user","_id"),nickname:t.get("user","nickname")},function(e){var i=t.getCache("shareCallback");i&&i(e||0)},function(e){var i=t.getCache("payCallback");i&&i(e||0)});var i=-1==t.get("user","gender");if(i){var n=new SelectDialog(t,function(){s.removeChild(n);var e=new Duel(t,function(){var e=new MainScene(t);s.addChild(e)});s.addChild(e)}.bind(s));s.addChild(n)}else{var a=new MainScene(t);s.addChild(a)}s.stage.removeChild(s.loadingView)}.bind(this))}.bind(this))},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,s){function n(t){e.call(s,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),i.call(s))}"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(s,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Animation=function(t){function e(e,i,s,n,a){var r=t.call(this)||this;r.onTop=1,r.debug=!1,r.multiSound=!1,r.spd=1,r.slots={},r.sounds={},r.frameEvents={},r.touchEnabled=!1,r.eventCallback=n;var o=new AssetAdapter,h=3;return[e+"_ske_json",e+"_tex_json",e+"_tex_png"].forEach(function(t){o.getAsset(t,function(){if(!--h){var t=new dragonBones.EgretFactory;t.parseDragonBonesData(RES.getRes(e+"_ske_json")),t.parseTextureAtlasData(RES.getRes(e+"_tex_json"),RES.getRes(e+"_tex_png"));var n=this.display=t.buildArmatureDisplay(i||e);this.addChild(n),n.touchEnabled=!1,n.armature.eventDispatcher.addDBEventListener(dragonBones.Event.LOOP_COMPLETE,function(){if(this.callback){var t=this.callback;this.callback=null,t()}else s&&s()},this),n.armature.eventDispatcher.addDBEventListener(dragonBones.Event.BONE_FRAME_EVENT,this.frameListener,this),n.armature.eventDispatcher.addDBEventListener(dragonBones.SoundEvent.SOUND_EVENT,this.soundListener,this),this.animationName&&n.animation.play(this.animationName,this.loop);for(var r in this.slots){var o=n.armature.getSlot(r),l=o.getDisplay();this.slots[r].x=l.x,this.slots[r].y=l.y,o.setDisplay(this.slots[r]),delete this.slots[r]}n.animation.timeScale=this.spd,a&&a(n)}},this)}.bind(r)),r}return __extends(e,t),e.prototype.frameListener=function(t){this.frameEvents[t.frameLabel]?this.frameEvents[t.frameLabel](t):this.eventCallback&&this.eventCallback(t.frameLabel)},e.prototype.soundListener=function(t){MUTE_SE||(this.sounds[t.frameLabel]&&!this.multiSound?this.sounds[t.frameLabel].play(1):this.sounds[t.frameLabel]=new Sound(1,t.frameLabel.split(".")[0],function(t){t.play(1,function(){t.stop()})}))},e.prototype.clearListeners=function(){this.display.armature.eventDispatcher.removeDBEventListener(dragonBones.Event.BONE_FRAME_EVENT,this.frameListener,this),this.display.armature.eventDispatcher.removeDBEventListener(dragonBones.SoundEvent.SOUND_EVENT,this.soundListener,this)},e.prototype.getSlotDisplay=function(t){return this.display?this.display.armature.getSlot(t).getDisplay():null},e.prototype.play=function(t,e,i){this.debug&&console.log(t),this.animationName=t,this.loop=e,this.display&&this.display.animation.play(t,e),this.callback=i||this.callback},e.prototype.setSlot=function(t,e){if(this.display){var i=this.display.armature.getSlot(t).getDisplay();if(!i)return;e.x=i.x,e.y=i.y,e.rotation=i.rotation,this.display.armature.getSlot(t).setDisplay(e)}else this.slots[t]=e},e.prototype.setEvent=function(t,e){this.frameEvents[t]=e},e.prototype.setSpeed=function(t){this.display?this.display.animation.timeScale=t:this.spd=t},e.prototype.hitCheck=function(t,e,i){var s=this.display.globalToLocal(t,e);if(i){var n=this.display.armature.getSlot(i);return n?n.containsPoint(s.x,s.y):!1}return!!this.display.armature.containsPoint(s.x,s.y)},Object.defineProperty(e.prototype,"_factor",{get:function(){return 0},set:function(t){this.x=(1-t)*(1-t)*this.originX+2*t*(1-t)*this.terminalX+t*t*this.targetX,this.y=(1-t)*(1-t)*this.originY+2*t*(1-t)*this.terminalY+t*t*this.targetY},enumerable:!0,configurable:!0}),e.prototype.bezierTo=function(t,e,i,s,n,a){this.originX=this.x,this.originY=this.y,this.terminalX=t,this.terminalY=e,this.targetX=i,this.targetY=s,egret.Tween.get(this).to({_factor:1},n).call(a)},e}(eui.Group);__reflect(Animation.prototype,"Animation");var Btn=function(t){function e(e,i,s){var n=t.call(this)||this;return n.isEnabled=!0,n.canceled=!1,n.noBouncing=!1,n.btnNode=e,n.touchNode=new eui.Group,n.touchNode.touchThrough=!1,e.parent.addChildAt(n.touchNode,e.parent.getChildIndex(e)+1),e.pixelHitTest=!1,n.touchNode.x=e.x,n.touchNode.y=e.y,n.touchNode.width=e.width,n.touchNode.height=e.height,n.touchNode.anchorOffsetX=e.anchorOffsetX,n.touchNode.anchorOffsetY=e.anchorOffsetY,n.callback=i,n.originScaleX=e.scaleX,n.originScaleY=e.scaleY,[n.btnNode,n.touchNode].forEach(function(t){t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegan,this)}.bind(n)),n.showRedDot(s),n}return __extends(e,t),e.prototype.showRedDot=function(t,e){return this.touchNode.visible=this.btnNode.visible,this.touchNode.x=this.btnNode.x,this.touchNode.y=this.btnNode.y,t?void(this.redDot?(this.redDot.visible=!0,e||(this.redDot.x=this.btnNode.x+t[0],this.redDot.y=this.btnNode.y+t[1])):t&&(this.redDot=createBitmap("common_hong_png",.5,.5,0,0,1,1,function(e){e.x=this.btnNode.x+t[0],e.y=this.btnNode.y+t[1],egret.Tween.get(e,{loop:!0}).to({y:this.btnNode.y+t[1]-8.5},200,egret.Ease.sineIn).to({y:this.btnNode.y+t[1]},500,egret.Ease.bounceOut).wait(3e3)}.bind(this)),this.btnNode.parent.addChildAt(this.redDot,this.btnNode.parent.getChildIndex(this.btnNode)+1))):void(this.redDot&&(this.redDot.visible=!1))},e.prototype.setOriginScale=function(t,e){this.originScaleX=t,this.originScaleY=e},e.prototype.touchBegan=function(t){return!this.isEnabled||this.canceled?void(this.canceled=!1):(this.noBouncing?this.callback():(egret.Tween.removeTweens(this.btnNode),this.btnNode.scaleX=this.originScaleX,this.btnNode.scaleY=this.originScaleY,egret.Tween.get(this.btnNode).to({scaleX:.7*this.originScaleX,scaleY:.7*this.originScaleY},100).to({scaleX:1*this.originScaleX,scaleY:1*this.originScaleY},100).call(function(){this.callback()},this)),void t.stopPropagation())},e.prototype.touchMoved=function(t){this.isEnabled&&(this.canceled=!0,egret.Tween.removeTweens(this.btnNode),this.btnNode.scaleX=this.originScaleX,this.btnNode.scaleY=this.originScaleY,t.stopPropagation())},e.prototype.touchEnded=function(t){this.isEnabled&&(!this.canceled&&this.callback(),this.canceled=!1,t.stopPropagation())},e.prototype.setEnabled=function(t,e){this.isEnabled=t,this.btnNode.filters=t||e?[]:[new egret.ColorMatrixFilter([.4,.7,0,0,0,.4,.7,0,0,0,.4,.7,0,0,0,0,0,0,1,0])]},e.prototype.trigger=function(){this.callback()},e}(egret.DisplayObjectContainer);__reflect(Btn.prototype,"Btn");var Dispatcher=function(){function t(t){this._dispatcher=t}return t.prototype.heartbeat=function(t,e){this._dispatcher.heartbeat(t,e)},t.prototype.request=function(t,e,i,s){this._dispatcher.request(t,e,i,s)},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._dispatcher.get.apply(this._dispatcher,t)},t.prototype.getOld=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._dispatcher.getOld.apply(this._dispatcher,t)},t.prototype.getNew=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._dispatcher.getNew.apply(this._dispatcher,t)},t.prototype.safeGetNew=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._dispatcher.safeGetNew.apply(this._dispatcher,t)},t.prototype.setCache=function(t,e){this._dispatcher.setCache(t,e)},t.prototype.getCache=function(t){return this._dispatcher.getCache(t)},t.prototype.clearCache=function(){this._dispatcher.clearCache()},Object.defineProperty(t.prototype,"waitFunc",{set:function(t){this._dispatcher.waitFunc=t},enumerable:!0,configurable:!0}),t.prototype.setOverrideKey=function(t){this._dispatcher.setOverrideKey(t)},t.prototype.setPushCallback=function(t,e){this._dispatcher.setPushCallback(t,e)},t}();__reflect(Dispatcher.prototype,"Dispatcher");var HpBar=function(t){function e(e,i,s,n){var a=t.call(this)||this;return a.loadIndex=0,a.imgNames=[],a.bars=[],a.lastUpdate=0,a.imgNames=[e,i,s,n],a.loadImg(),egret.startTick(a.update,a),a}return __extends(e,t),e.prototype.loadImg=function(){this.imgNames[this.loadIndex]&&createBitmap(this.imgNames[this.loadIndex],.5,.5,0,0,1,1,function(t){this.addChild(t),t.visible=this.loadIndex<2,this.loadIndex&&this.bars.push(t),++this.loadIndex,this.loadImg()}.bind(this))},e.prototype.showTag=function(t,e,i,s){this.tag||(this.tag=new egret.TextField,this.addChild(this.tag)),this.tag.text=this.showValue+"/"+this.maxValue,this.tag.size=t,this.tag.textColor=e,i&&(this.tag.stroke=i,this.tag.strokeColor=s),this.tag.anchorOffsetX=this.tag.width/2,this.tag.anchorOffsetY=this.tag.height/2},e.prototype.setMaxValue=function(t){this.maxValue=t,this.currentValue?this.setValue(Math.min(this.maxValue,this.currentValue)):this.currentValue=this.showValue=this.maxValue},e.prototype.setValue=function(t){t<this.showValue?this.bars[2]&&(this.bars[2].visible=!0,this.bars[2].mask=new egret.Rectangle(t/this.maxValue*this.bars[2].width,0,(this.showValue-t)/this.maxValue*this.bars[2].width,this.bars[2].height)):this.bars[1]&&(this.bars[1].visible=!0,this.bars[1].mask=new egret.Rectangle(this.showValue/this.maxValue*this.bars[2].width,0,(t-this.showValue)/this.maxValue*this.bars[2].width,this.bars[2].height)),this.currentValue=Math.max(0,Math.min(t,this.maxValue)),this.bars[0]&&(this.bars[0].mask=new egret.Rectangle(0,0,this.currentValue/this.maxValue*this.bars[0].width,this.bars[0].height)),this.lastUpdate=weedon.time},e.prototype.update=function(){if(this.showValue==this.currentValue)return this.bars[1]&&(this.bars[1].visible=!1),this.bars[2]&&(this.bars[2].visible=!1),!1;var t=weedon.time;return t-this.lastUpdate>0&&(this.showValue<this.currentValue?(this.showValue=Math.min(this.currentValue,this.showValue+.01*(t-this.lastUpdate-0))>>0,this.bars[1]&&(this.bars[1].mask=new egret.Rectangle(this.showValue/this.maxValue*this.bars[2].width,0,(this.currentValue-this.showValue)/this.maxValue*this.bars[2].width,this.bars[2].height))):(this.showValue=Math.max(this.currentValue,this.showValue-.01*(t-this.lastUpdate-0))>>0,this.bars[1]&&(this.bars[2].mask=new egret.Rectangle(this.currentValue/this.maxValue*this.bars[2].width,0,(this.showValue-this.currentValue)/this.maxValue*this.bars[2].width,this.bars[2].height)))),this.tag&&(this.tag.text=this.showValue+"/"+this.maxValue,this.tag.anchorOffsetX=this.tag.width/2,this.tag.anchorOffsetY=this.tag.height/2),!0},e}(egret.DisplayObjectContainer);__reflect(HpBar.prototype,"HpBar");var MUTE_SE=!1,_sounds={},Sound=function(){function t(t,e,i,s){if(this.playing=!1,_sounds[e])this.sound=_sounds[e],i(this);else{var n=new egret.Sound;n.load("resource/assets/sound/"+e+(s||".mp3")+"?v="+version),n.addEventListener(egret.Event.COMPLETE,function(){this.sound=_sounds[e]=n,i(this)},this),this.mode=t}}return t.prototype.play=function(t,e){if(!(this.playing||!this.sound||this.mode&&MUTE_SE)){this.playing=!0;var i=this.channel=this.sound.play(0,t||0===t?t:1);i.addEventListener(egret.Event.SOUND_COMPLETE,function(){e&&e(),this.playing=!1},this)}},t.prototype.stop=function(){this.playing&&(this.playing=!1,this.channel&&this.channel.stop())},t}();__reflect(Sound.prototype,"Sound");var avatars={},qrcodes={},User=function(){function t(){this.shooting=!1,this.reloading=!1,this.reloadActing=!1,this.reloadFinishing=!1,this.itemUsing=!1,this.itemUsed=!1,this.canAim=!1,this.aiming=!1,this.aimed=!1,this.touching=!1,this.stateFinishing=!1,this.cursorSpeed=.01,this.cursorMode=0,this.lastFire=0,this.fireInterval=1200}return t}();__reflect(User.prototype,"User");var Opponent=function(){function t(){this.moving=!1,this.moveSpeed=.2,this.restTimeBase=1e3,this.restTimeRand=1e3,this.moveWidth=440,this.waitFinish=0,this.nextX=0,this.waiting=!1,this.lastFire=0,this.itemPower=20,this.itemUsed=!1}return t}();__reflect(Opponent.prototype,"Opponent");var Duel=function(t){function e(e,i){var s=t.call(this)||this;return s.targetX=0,s.targetY=0,s.mode=0,s.hitEffects=[],s.behitEffects=[],s.nohitEffects=[],s.cdItems=[],s.cdBlanks=[],s.guideStep=0,s.aimTargets=0,s.targetStates=[0,0,0],s.waiting=!1,s.itemsSound=[],s.isShocking=!1,s.damagaLabelList=[],s.dispatcher=e,s.callback=i,s.skinName=DuelSceneSkin,MainSceneConfig.weaponExp=MatchUtils.getCurrentWeaponExp(s.dispatcher),0==(s.dispatcher.get("user","guide")||0)?s.initGuideData():s.initBattleData(),s}return __extends(e,t),e.prototype.initGuideData=function(){var t=this.dispatcher.get("user"),e=this.me=new User;e.gunType=0,e.gunName="handgun",e.gender=t.gender,e.bulletType="s",e.maxBullets=e.bullets=6,e.maxHp=e.hp=100,e.itemIndex=-1,e.itemGrade=-1;var i=RES.getRes("data_json"),s=i.gunsBaseNumber[t.gunIndex];e.hits=s[8],e.precision=s[4],e.basePrecision=100,e.baseHitRadius=s[10],e.crosshairIndex=0,e.canAim=1==s[11],e.fireInterval=6e4/s[5]},e.prototype.updateGuide=function(){var t=this;switch(this.guideStep){case 0:var e=new GuideTag(this.screenHeight,0,function(){t.parent.removeChild(e),t.guideStep+=1,t.updateGuide()});this.parent.addChild(e);break;case 1:this.waiting=!0,this.target0.visible=!0,this.target0.scaleX=0,egret.Tween.get(this.target0).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},200).wait(200).call(function(){this.guideStep+=1,this.updateGuide()},this);break;case 2:this.targetStates[0]=1,this.guideDialog.visible=!0,this.guideText.text="如果你想要成为一个真正的牛仔，你必须先要学会开枪！试着去射击站在你面前这个家伙。",this.reloadTag.visible=!0,this.reloadTag.y=400,this.reloadTag.play("shoot",0),this.waiting=!1,this.start();break;case 3:case 6:case 9:case 12:this.waiting=!0,this.guideDialog.visible=this.reloadTag.visible=!1;break;case 4:this.waiting=!0;for(var i=function(t){s["target"+t].visible=!0,s["target"+t].scaleX=0,egret.Tween.get(s["target"+t]).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},200).wait(200).call(function(){1==t&&(this.guideStep+=1,this.updateGuide())},s)},s=this,n=1;3>n;++n)i(n);break;case 5:this.targetStates[1]=this.targetStates[2]=1,this.guideDialog.visible=!0,this.guideText.text="干得漂亮！再来两次！",this.waiting=!1;break;case 7:this.waiting=!0;for(var a=function(t){r["target"+t].visible=!0,r["target"+t].scaleX=0,egret.Tween.get(r["target"+t]).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},200).wait(200).call(function(){1==t&&(this.guideStep+=1,this.updateGuide())},r)},r=this,n=0;3>n;++n)a(n);break;case 8:this.targetStates[0]=this.targetStates[1]=this.targetStates[2]=1,this.guideDialog.visible=!0,this.guideText.text="感觉如何？试着移动准星，然后干掉这些家伙。",this.waiting=!1;break;case 10:this.waiting=!0;for(var o=function(t){h["target"+t].visible=!0,h["target"+t].scaleX=0,egret.Tween.get(h["target"+t]).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},200).wait(200).call(function(){1==t&&(this.guideStep+=1,this.updateGuide())},h)},h=this,n=0;3>n;++n)o(n);break;case 11:this.targetStates[0]=this.targetStates[1]=this.targetStates[2]=1,this.guideDialog.visible=!0,this.guideText.text="再射3次测试下你的瞄准技术！",this.waiting=!1;break;case 13:this.waiting=!0,this.target0.visible=!0,this.target0.scaleX=0,egret.Tween.get(this.target0).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},200).wait(200).call(function(){this.waiting=!1,this.guideStep+=1,this.updateGuide()},this);break;case 14:this.targetStates[0]=1,this.guideDialog.visible=!0,this.guideText.text="仔细看，你需要注意一下你的子弹！将子弹射空然后重新填装！",this.bulletList.visible=!0,this.bulletList.y=200,this.reloadTag.play("load",0),this.me.bullets=2;for(var l=function(t){["s","xd","b","b"].forEach(function(e){e==this.me.bulletType?(this[e+"qzdc"+t].visible=t<this.me.maxBullets,this[e+"qzd"+t].visible=t<this.me.bullets):this[e+"qzdc"+t].visible=this[e+"qzd"+t].visible=!1}.bind(c))},c=this,n=0;6>n;++n)l(n);break;case 15:this.waiting=!0,this.target1.visible=!0,this.target1.scaleX=0,egret.Tween.get(this.target1).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},200).wait(200).call(function(){this.targetStates[1]=1,this.waiting=!1},this);break;case 16:this.waiting=!0,this.target2.visible=!0,this.target2.scaleX=0,egret.Tween.get(this.target2).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},200).wait(200).call(function(){this.targetStates[2]=1,this.waiting=!1},this);break;case 17:this.waiting=!0,this.bulletList.visible=!1,this.guideBg.visible=!0,this.guideDialog.visible=!0,this.guideText.text="太棒啦！勇敢的牛仔啊，快去进行一场真正的决斗吧！",("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).stopAccelerometer(),egret.stopTick(this.update,this);break;case 18:this.waiting=!0;var d=new egret.DisplayObjectContainer,u=new egret.Shape;d.addChild(u),u.graphics.beginFill(0,.5),u.graphics.drawRect(0,0,640,1386),u.graphics.endFill();var p=new egret.Shape;d.addChild(p),p.graphics.beginFill(0,1),p.graphics.drawCircle(320,693,50),p.graphics.endFill(),p.blendMode=egret.BlendMode.ERASE;var g=new egret.RenderTexture;g.drawToTexture(d),this.holeCover=new eui.Image(g),this.holeCover.anchorOffsetX=320,this.holeCover.anchorOffsetY=693,this.holeCover.x=this.item.x,this.holeCover.y=this.item.y-this.topUI.y,this.holeCover.scaleX=this.holeCover.scaleY=4,this.guide.addChildAt(this.holeCover,0),egret.Tween.get(this.holeCover).to({scaleX:2,scaleY:2},500).wait(500).call(function(){this.yindaoAni.visible=!0,this.yindaoAni.x=this.holeCover.x,this.yindaoAni.y=this.holeCover.y,this.waiting=!1},this),this.yindaoAni=new Animation("xs_yindaohand"),this.guide.addChild(this.yindaoAni),this.yindaoAni.play("stand",0),this.yindaoAni.visible=!1,this.holeCover.touchEnabled=!0,this.holeCover.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){if(!this.waiting){var e=this.item.x,i=this.item.y-this.topUI.y,s=t.stageX,n=t.stageY,a=Math.sqrt(Math.pow(s-e,2)+Math.pow(n-i,2));50>a&&(this.useItem(),this.guide.visible=!1)}},this)}},e.prototype.initBattleData=function(){var t=this.dispatcher.get("battle"),e=this.me=new User,i=RES.getRes("data_json"),s=this.dispatcher.get("user","_id");e._id=s;var n=t["gunType"+s],a=i.gunsBaseNumber[n],r=n.split("-"),o=+r[0];e.gunIndex=+r[1],e.gunType=0==o?0:1,e.gunName=["handgun","rifle","shutgun","sniper"][o],e.gender=0,e.bulletType=["s","b","xd","b"][o],e.maxBullets=e.bullets=a[3],e.maxHp=e.hp=t["hpMax"+s];var h=t["propType"+s];if(""==h)e.itemIndex=-1,e.itemGrade=-1;else{var l=h.split("-"),c=+l[0],d=+l[1];e.itemIndex=[1,0,2][c],e.itemGrade=d}e.hits=a[8],e.precision=a[4],e.basePrecision=100,e.baseHitRadius=a[10],e.crosshairIndex=0==o?0:1,e.canAim=1==a[11],e.fireInterval=6e4/a[5];var u=t.uids.split("_"),p=s==u[0]?u[1]:u[0],g=this.opponent=new Opponent;g.nickname=t["nickname"+p];var m=t["gunType"+p],f=m.split("-"),v=+f[0],b=i.gunsBaseNumber[m];g.gunName=["handgun","rifle","shutgun","sniper"][v],g.maxHp=g.hp=t["hpMax"+p],g._id=p,g.gender=t["targetGender"+p];var y=0>p;if(console.info("isAI:"+y),y){g.isAI=!0;var x=t["aiShootIntevalMin"+p],_=t["aiShootIntevalMax"+p],w=Math.random()*(_-x)+x;console.log("randomRate:"+w),g.fireInterval=6e4*w/b[5],console.log("fireInterval:"+g.fireInterval),g.reloadInterval=1e3*b[12];var C=t["propType"+p]||"";if(""!=C){var T=C.split("-"),c=+T[0],d=+T[1];g.itemIndex=[1,0,2][c],g.itemGrade=d;var I=i.propsBaseNumber[C];1==T?g.itemPower=I[3]:2==T&&(g.itemPower=I[4])}else g.itemIndex=-1,g.itemGrade=-1;g.lastFire=0,g.maxBullets=g.bullets=b[3]}console.info(this.opponent),this.soundNoBullet=new Sound(1,e.gunName+"_out",function(){},".mp3");for(var S=0;3>S;S++)this.itemsSound.push(new Sound(1,"item_"+S,function(){},".mp3"))},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=this.me,i=this.opponent;if(console.log(e.itemIndex+"----"+e.itemGrade),-1!=e.itemIndex||-1!=e.itemGrade){var s=this.item=new Animation("item"+e.itemIndex);this.itemLayer.addChild(s),s.play("stand"+e.itemGrade,0),s.x=110,s.y=1276,s.touchEnabled=!0,s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.useItem()},this)}var n=this.gun=new Animation(e.gunName);this.itemLayer.addChild(n),n.multiSound=!0,n.play("stand",0),n.x=320,n.y=1386;var a=this.cross=new Animation("crosshair"+e.crosshairIndex);if(this.itemLayer.addChild(a),a.play("stand",0),a.x=320,a.y=886,a.scaleX=a.scaleY=(e.basePrecision-e.precision)/e.basePrecision,a.touchEnabled=!1,i){var r=this.target=new Animation("chr"+i.gender);this.enemy.addChild(r),r.play(i.gunName+"_stand_fire",0),r.scaleX=r.scaleY=.3;var o=this.enemyFire=new Animation("enimyfire");r.setSlot("p",o),o.visible=!1,this.enemyHpBar=new HpBar("zd_dr_db_png","zd_dr_xt_png","zd_dr_jia_png","zd_dr_jian_png"),this.enemy.addChildAt(this.enemyHpBar,0),this.enemyHpBar.setMaxValue(i.maxHp),this.enemyHpBar.y=-270,this.userHpBar=new HpBar("zd_zj_db_png","zd_zj_x_png","zd_zj_jia_png","zd_zj_jian_png"),this.topUI.addChildAt(this.userHpBar,0),this.userHpBar.setMaxValue(e.maxHp),this.userHpBar.showTag(30,16777215),this.userHpBar.y=25,this.userHpBar.x=320}else this.bulletList.visible=!1;for(var h=0;12>h;++h)if(e.fireInterval&&1==e.crosshairIndex){var l=this.cdBlanks[h]=new egret.DisplayObject;a.setSlot(""+h,l),this.cdItems.push(createBitmap("se_4_png",.5,.5))}var c=this.flour=new Animation("itemhit1");this.itemLayer.addChild(c),c.x=320,c.y=1386,c.visible=!1,this.nickname.text=i?i.nickname:"",this.scene.touchEnabled=!0,this.scene.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){this.waiting||(e.touching=!0,e.canAim&&this.aim())},this),this.scene.addEventListener(egret.TouchEvent.TOUCH_END,function(){e.touching&&!this.waiting&&(e.touching=!1,!this.startTime||e.itemUsing||e.reloadFinishing||(e.reloading&&!e.reloadActing?this.reload():this.fire()))},this),this.guideBg.touchEnabled=!0,this.guideBg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){try{this.dispatcher.request("user.guide",{},function(){this.callback()}.bind(this))}catch(t){console.log(t)}},this),this.reloadTag=new Animation("se_yindao"),this.topUI.addChild(this.reloadTag),this.reloadTag.x=320,this.reloadTag.y=100,this.reloadTag.touchEnabled=!1,this.reloadTag.play("load",0),this.reloadTag.visible=!1;for(var d=function(t){["s","xd","b","b"].forEach(function(i){i==e.bulletType?(this[i+"qzdc"+t].visible=t<e.maxBullets,this[i+"qzd"+t].visible=t<e.bullets):this[i+"qzdc"+t].visible=this[i+"qzd"+t].visible=!1}.bind(u))},u=this,h=0;6>h;++h)d(h);this.scene.y=250,this.targetX=this.field.x,this.targetY=this.scene.y,this.adjustUI(),i?this.start():this.updateGuide()},e.prototype.adjustUI=function(){return this.ignoreNextResize?void(this.ignoreNextResize=!1):(this.ignoreNextResize=!0,void(weedon.winSize.width/weedon.winSize.height>.64?(this.stage.setContentSize(640,1e3),this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL,this.y=-193,this.topUI.y=193,this.screenHeight=1e3):(this.stage.setContentSize(640,1386),this.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,this.screenHeight=640/weedon.winSize.width*weedon.winSize.height,this.y=this.screenHeight-1386,this.topUI.y=-this.y)))},e.prototype.clamp=function(t,e,i){return Math.max(e,Math.min(t,i))},e.prototype.duelFinish=function(){if(this.dispatcher.setPushCallback("battle",null),("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).stopAccelerometer(),this.scene.touchEnabled=!1,egret.stopTick(this.update,this),this.flour&&this.flour.visible&&(this.flour.visible=!1),this.me.hp<=0){var t=500,e=Math.floor(1e3*t/1408/2),i=Math.floor(868*t/1408),s=this.ground.y+1400;this.gun&&this.gun.parent&&this.gun.parent.removeChild(this.gun),this.item&&this.item.parent&&this.item.parent.removeChild(this.item),this.reloadTag.visible&&(this.reloadTag.visible=!1),this.cross.visible&&(this.cross.visible=!1),this.bulletList.visible=!1,this.scene.touchEnabled=!1,egret.Tween.get(this.scene).to({y:1e3},e).call(function(){egret.Tween.get(this.ground).to({y:s},i).call(function(){this.target.scaleX=this.target.scaleY=1,this.enemy.x=0,this.target.x=this.target.globalToLocal(-230,0).x,this.target.y=this.target.y-this.target.height/2,this.target.play(this.me.hp<=0?"lol":this.opponent.gunName+"_die",this.me.hp<=0?0:1,function(){egret.Tween.get(this.target).to({rotation:30},500).wait(1e3).call(function(){this.callback()
},this)}.bind(this))},this)},this)}else this.target.play(this.me.hp<=0?"lol":this.opponent.gunName+"_die",this.me.hp<=0?0:1,function(){egret.Tween.get(this).wait(1500).call(function(){this.callback()},this)}.bind(this))},e.prototype.start=function(){var t=this.me,e=this.opponent;this.dispatcher.setPushCallback("battle",this.onMessage.bind(this)),("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).startAccelerometer({success:function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).onAccelerometerChange(function(e){e.z>0&&!t.reloading&&!t.shooting?this.startReload():e.z<-.3&&t.reloading&&!t.reloadFinishing&&this.stopReload(),t.cursorMode?this.targetX=this.field.anchorOffsetX-2020*this.clamp(e.x,-.17,.17)*(e.z>0?-1:1):this.targetX=this.field.anchorOffsetX+2020*this.clamp(e.x,-.17,.17)*(e.z>0?-1:1),"undefined"==typeof GameGlobal?this.targetY=50-400*this.clamp(e.z,-1,-0):this.targetY=450+400*this.clamp(e.z,-1,-0)}.bind(this)),this.startTime=weedon.time,e&&(e.nextX=(640-e.moveWidth)/2+e.moveWidth*Math.random()>>0),egret.startTick(this.update,this)}.bind(this)})},e.prototype.startReload=function(){var t=this.me;t.aiming||!this.opponent&&this.guideStep<14||(t.reloadFinishing=!1,t.reloading=t.reloadActing=!0,this.cross.visible=!1,this.gun.play("rifle"!=t.gunName&&"sniper"!=t.gunName?"reload"+t.bullets:"reload",1,function(){t.reloadActing=!1}.bind(this)))},e.prototype.reload=function(){var t=this.me;t.bullets==t.maxBullets||t.reloadActing||t.reloadFinishing||(t.reloadActing=!0,this.gun.play("rifle"!=t.gunName&&"sniper"!=t.gunName?"reload"+t.bullets+"_load":"reload_load",1,function(){t.reloadActing=!1}.bind(this)),this[t.bulletType+"qzd"+t.bullets].visible=!0,t.bullets+=1,this.reloadTag.visible=!1)},e.prototype.stopReload=function(){var t=this.me;t.reloadFinishing||"sniper"==t.gunName&&t.reloadActing||(t.reloadFinishing=!0,this.gun.play("rifle"!=t.gunName&&"sniper"!=t.gunName?"reload"+t.bullets+"_over":"reload_over",1,function(){this.gun.play("stand",0),t.reloading=t.reloadFinishing=t.reloadActing=!1,this.cross.visible=!0,t.touching&&t.canAim&&this.aim()}.bind(this)))},e.prototype.aim=function(){var t=this.me;if(!(t.reloading||t.reloadActing||t.reloadFinishing||!t.canAim||t.aiming||t.aimed||t.bullets<1||weedon.time-t.lastFire<t.fireInterval)){t.aiming=!0,this.cross.scaleX=this.cross.scaleY=1,this.cross.play("sniper",1,function(){t.aimed=!0,this.cross.play("sniperhold",0)}.bind(this));var e=this.cross.localToGlobal(0,0),i=this.field.globalToLocal(e.x,e.y);this.field.anchorOffsetX=i.x,this.field.anchorOffsetY=i.y,this.field.x=this.targetX=this.field.x+i.x,this.field.y=100+i.y,this.field.scaleX=this.field.scaleY=this.sky.scaleX=this.sky.scaleY=1.5}},e.prototype.fire=function(){var t=this,e=this.me,i=this.opponent;if(!(e.shooting||e.reloadFinishing||e.reloading||weedon.time-e.lastFire<e.fireInterval)){if(e.bullets>0){e.shooting=!0,e.lastFire=weedon.time,(i||this.guideStep>13)&&(e.bullets-=1,this[e.bulletType+"qzd"+e.bullets].visible=!1),this.reloadTag.visible=!e.bullets&&(!!i||this.guideStep<16);for(var s=[],n=function(t){var n=a.localToGlobal(a.cross.x,a.cross.y);n.x+=e.aiming?0:(1-2*Math.random())*a.cross.scaleX*e.baseHitRadius,n.y+=e.aiming?0:(1-2*Math.random())*a.cross.scaleY*e.baseHitRadius;var r=a.field.globalToLocal(n.x,n.y),o=-1;if(i)for(var h=(a.target.globalToLocal(n.x,n.y),0);8>h;++h){var l=["headhit","bodyhit","leghit0","leghit1","leghit2","leghit3","leghit4","leghit5"][h];if(a.target.hitCheck(n.x,n.y,l)){o=h;break}}else for(var h=0;3>h;++h)if(a.targetStates[h]&&a["target"+h].visible&&a["target"+h].hitTestPoint(n.x,n.y)){o=h;break}s.push(o);var c;if(~o){for(var h=0;h<a.hitEffects.length;++h)if(!a.hitEffects[h].visible){c=a.hitEffects[h];break}c||(c=new Animation("se_hit"),a.field.addChild(c),c.scaleX=c.scaleY=.6,a.hitEffects.push(c)),c.visible=!0,c.x=r.x,c.y=r.y,c.play("hit",1,function(){c.visible=!1})}else{for(var h=0;h<a.nohitEffects.length;++h)if(!a.nohitEffects[h].visible){c=a.nohitEffects[h];break}c||(c=new Animation("se_nohit"),a.field.addChild(c),c.scaleX=c.scaleY=.6,a.nohitEffects.push(c)),c.visible=!0,c.x=r.x,c.y=r.y,c.play("hit",1,function(){c.visible=!1})}},a=this,r=0;r<e.hits;++r)n(r);for(var o=-1,r=0;r<s.length;++r)~s[r]&&(o=~o?Math.min(o,s[r]):s[r]);if(~o)if(i)i.waiting=!0,this.target.play(0==o?i.gunName+"_headhit":1==o?i.gunName+"_bodyhit":i.gunName+"_leghit",1,function(){i.waiting=!1,this.startTime&&this.target.play(i.waitFinish>weedon.time||i.nextX==this.enemy.x?i.gunName+"_stand_fire":i.nextX>this.enemy.x?i.gunName+"_right":i.gunName+"_left",0)}.bind(this));else{this.targetStates[o]=0;var h=!1;this.targetStates[0]+this.targetStates[1]+this.targetStates[2]==0&&(this.guideStep<14&&(this.guideStep+=1,this.updateGuide()),h=!0),egret.Tween.get(this["target"+o]).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},100).to({scaleX:0},100).to({scaleX:1},100).to({scaleX:0},100).wait(200).call(function(){this["target"+o].visible=!1,h&&(this.guideStep+=1,this.updateGuide())},this)}i&&this.dispatcher.request(this.opponent&&this.opponent.isAI?"aiBattle.battle":"user.battle",{action:0,hitIndexes:s,aiming:+e.aiming},function(){this.updateHp()}.bind(this)),this.gun.play("fire",1,function(){e.shooting=e.aiming=e.aimed=e.reloading=e.reloadActing=e.reloadFinishing=!1}.bind(this)),this.cross.scaleX=this.cross.scaleY=(e.basePrecision-e.precision)/e.basePrecision,this.cross.play("fire",1,function(){this.cross.play("stand",0)}.bind(this))}else if(e.aiming&&(this.cross.play("stand",0),e.aiming=e.aimed=!1),this.soundNoBullet&&this.soundNoBullet.play(1),!i){var l=new GuideTag(this.screenHeight,1,function(){t.parent.removeChild(l)});this.parent.addChild(l)}this.field.scaleX=this.field.scaleY=this.sky.scaleX=this.sky.scaleY=1,this.field.x-=this.field.anchorOffsetX,this.targetX=this.field.x,this.field.anchorOffsetX=0,this.field.anchorOffsetY=0,this.field.y=100}},e.prototype.useItem=function(){var t=this.me,e=this.opponent;t.itemUsed||(t.itemUsed=t.itemUsing=!0,this.dispatcher.request(this.opponent&&this.opponent.isAI?"aiBattle.battle":"user.battle",{action:1},function(i){if(i)return void console.info(i);switch(this.itemsSound[t.itemIndex]&&this.itemsSound[t.itemIndex].play(1),t.itemIndex){case 0:case 1:var s=this.localToGlobal(this.item.x,this.item.y),n=this.field.globalToLocal(s.x,s.y),a=new Animation("item"+t.itemIndex);this.field.addChild(a),a.x=n.x,a.y=n.y,a.play("fly"+t.itemGrade,0),a.bezierTo(a.x+(this.enemy.x-a.x)/2,this.enemy.y-300,this.enemy.x,this.enemy.y,800,function(){if(a.scaleX=a.scaleY=1,a.play("boom"+t.itemGrade,1,function(){t.itemUsing=!1,a.parent.removeChild(a)}.bind(this)),-1!=t.itemIndex){this.target.play(e.gunName+"_leghit",1),this.updateHp();var i=this.dispatcher.get("battle","propUsed"+t._id);i&&this.item&&this.item.parent.removeChild(this.item)}}.bind(this)),egret.Tween.get(a).to({scaleX:.1,scaleY:.1},800);break;case 2:this.item&&this.item.play("use"+t.itemGrade,1,function(){t.itemUsing=this.item.visible=!1}.bind(this)),this.updateHp()}}.bind(this)))},e.prototype.onMessage=function(){var t=this.dispatcher.get("battle");switch(0!=t.action,t.action){case 0:this.hit(t.hitIndex);break;case 1:this.itemHit(t.itemIndex,t.itemGrade)}},e.prototype.showShock=function(){if(!this.isShocking){this.isShocking=!0;var t=this.scene.y;egret.Tween.get(this.scene).to({x:50,y:t-5},20).to({x:-50,y:t+5},40).to({x:50,y:t+5},40).to({x:-50,y:t-5},40).to({x:40},40).to({x:-40},40).to({x:30},40).to({x:-30},40).to({x:0},20).call(function(){this.isShocking=!1},this)}},e.prototype.hit=function(t){var e=this.me;if(this.enemyFire.visible=!0,this.enemyFire.play("hit",1,function(){this.enemyFire.visible=!1}.bind(this)),~t){this.item&&this.item.visible&&!e.itemUsing&&this.item.play("hurt"+e.itemGrade,1,function(){this.item&&this.item.play("stand"+e.itemGrade)}.bind(this)),e.shooting||e.reloading||e.reloadActing||e.reloadFinishing||this.gun.play("hurt",1,function(){this.gun.play("stand",0)}.bind(this));for(var i,s=0;s<this.behitEffects.length;++s)if(!this.behitEffects[s].visible){i=this.behitEffects[s];break}if(i||(i=new Animation("beenhit"),this.addChild(i),this.behitEffects.push(i)),i.visible=!0,i.x=40+600*Math.random(),i.y=this.cross.y-200+400*Math.random(),i.play("hit",1,function(){i.visible=!1}),this.updateHp(),e.shooting)return;0==e.gunType?this.cross.play(["headhit","bodyhit","bodyhit"][t],1,function(){this.cross.play("stand",0)}.bind(this)):e.canAim&&e.aiming?this.cross.play("sniper"+["headhit","bodyhit","bodyhit"][t],1,function(){this.cross.play("sniperhold",0)}.bind(this)):this.cross.play(["headhit","bodyhit","bodyhit"][t],1,function(){this.cross.play("stand",0)}.bind(this))}},e.prototype.itemHit=function(t,e){var i=this.me;switch(console.log("受到道具效果"),t){case 0:var s=new Animation("itemhit"+t);this.addChild(s),s.x=320,s.y=1386,s.play("boom"+e,1,function(){s.visible=!1}.bind(this)),i.shooting||(i.canAim&&i.aiming?this.cross.play("sniperbodyhit",1,function(){this.cross.play("sniperhold",0)}.bind(this)):this.cross.play("bodyhit",1,function(){this.cross.play("stand",0)}.bind(this))),this.item&&this.item.visible&&!i.itemUsing&&this.item.play("hurt"+e,1,function(){this.item&&this.item.play("stand"+e,0)}.bind(this)),i.shooting||i.reloading||i.reloadActing||i.reloadFinishing||this.gun.play("hurt",1,function(){this.gun.play("stand",0)}.bind(this));break;case 1:i.state=e,i.stateFinish=weedon.time+6e3;break;case 2:}this.updateHp()},e.prototype.updateHp=function(){var t=this.opponent.hp,e=this.me.hp;this.opponent.hp=this.dispatcher.get("battle","hp"+this.opponent._id),this.me.hp=this.dispatcher.get("battle","hp"+this.me._id);var i=this.me,s=i.hp,n=e-s,a=this.opponent,r=Math.max(0,a.hp),o=t-r;if(n>0&&this.showShock(),null!=t&&t!=r){var h=new eui.BitmapLabel;0>o?h.font=RES.getRes("hp_bonus_fnt"):h.font=RES.getRes("dmg_ft_fnt"),this.enemy.addChild(h),this.damagaLabelList.push(h),h.text=0>o?"+"+o:"-"+o,h.y=this.nickname.y+20,h.x=this.nickname.x+20;var l=h.x,c=h.y;h.alpha=0,egret.Tween.get(h).to({alpha:1},200).to({x:l+40,y:c-10},100).to({x:l+60,y:c+20,alpha:0},200).call(function(){var t=this.damagaLabelList.pop();t&&t.parent.removeChild(t)},this)}this.userHpBar.setValue(i.hp),this.enemyHpBar.setValue(a.hp),(i.hp<=0||a.hp<=0)&&egret.Tween.get(this.topUI).wait(350).call(function(){this.duelFinish()},this)},e.prototype.AIFire=function(){this.dispatcher.request("aiBattle.battle",{action:0,isAI:!0},function(){console.info("shoot back"),this.onMessage(),18!=this.guideStep&&(this.guideStep=18,this.updateGuide())}.bind(this))},e.prototype.AIItem=function(){var t=this.me,e=this.opponent;if(!e.itemUsed){var i=!1;switch(e.itemIndex){case 0:i=t.hp<=e.itemPower;break;case 1:i=!0;break;case 2:i=e.maxHp-e.hp>=e.itemPower}i&&(e.itemUsed=!0,this.dispatcher.request("aiBattle.battle",{action:1,isAI:!0},function(){this.onMessage()}.bind(this)))}},e.prototype.update=function(){var t=this.me,e=this.opponent,i=weedon.time,s=i-this.startTime;if(this.startTime=i,this.field.x+=t.cursorSpeed*s*(this.targetX-this.field.x),this.scene.y+=t.cursorSpeed*s*(this.targetY-this.scene.y),e&&e.isAI&&(e.hp>0&&!e.itemUsed&&this.AIItem(),e.hp>0&&e.bullets>0&&i-e.lastFire>e.fireInterval&&(e.lastFire=i,e.bullets--,this.AIFire()),e.hp>0&&e.bullets<1&&i-e.lastFire>e.reloadInterval&&(e.bullets=e.maxBullets,e.lastFire=i)),t.fireInterval&&1==t.crosshairIndex)for(var n=i-t.lastFire,a=0;12>a;++a)this.cross.setSlot(""+a,n/t.fireInterval*12>a+1?this.cdBlanks[a]:this.cdItems[a]);return t.stateFinish>i?this.flour.visible||(this.flour.visible=!0,this.flour.play("boom"+t.state,1,function(){this.flour.play("stand"+t.state,0)}.bind(this))):this.flour.visible&&!t.stateFinishing&&(t.stateFinishing=!0,this.flour.play("over"+t.state,1,function(){this.flour.visible=t.stateFinishing=!1}.bind(this))),!e||e.waiting||i<e.waitFinish||!this.startTime?!0:(e.nextX>this.enemy.x?(e.moving||(e.moving=!0,this.target.play(e.gunName+"_right",0)),this.enemy.x+=Math.min(e.moveSpeed*s,e.nextX-this.enemy.x)):(e.moving||(e.moving=!0,this.target.play(e.gunName+"_left",0)),this.enemy.x-=Math.min(e.moveSpeed*s,this.enemy.x-e.nextX)),this.enemy.x==e.nextX&&(e.moving=!1,this.target.play(e.gunName+"_stand_fire",0),e.waitFinish=i+e.restTimeBase+(Math.random()*e.restTimeRand>>0),e.nextX=(640-e.moveWidth)/2+e.moveWidth*Math.random()>>0),!0)},e}(eui.Component);__reflect(Duel.prototype,"Duel");var BattleEndDialog=function(t){function e(e,i,s){var n=t.call(this)||this;return n.mScreenHeight=e,n.skinName=BattleEndDialogSkin,n.dispatcher=i,n.closeCallBack=s,n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.bg.height=this.mScreenHeight;var i=this.dispatcher.get("user");console.log("---BattleEndDialog--"),console.log(this.dispatcher.get("itemsGot"));var s=this.dispatcher.get("itemsGot")||{};setTexture(this.leftBtn.tfImg,"wz_fhcz_png"),new Btn(this.leftBtn,function(){this.closeCallBack(-1)}.bind(this)),setTexture(this.rightBtn.tfImg,"wz_fxzj_png"),new Btn(this.rightBtn,function(){}.bind(this)),this.rewardTF.textFlow=[{text:"经验：",style:{size:24,textColor:7093780}},{text:(s.exper||0)+"     ",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}},{text:"熟练度：",style:{size:24,textColor:7093780}},{text:(s.gunExper||0)+"     ",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}},{text:"金币：",style:{size:24,textColor:7093780}},{text:(s.gold||0)+"     ",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}}],this.rewardTF.visible=s.exper>0,setTexture(this.img_result,"zd_tz_"+(s.exper?"ying":"shu")+"_png");var n=this.dispatcher.get("battle"),a=n.uids.split("_"),r=n["battleParams"+i._id].split("-"),o=n["battleParams"+(a[0]==i._id?a[1]:a[0])].split("-"),h=(formula.getRankInfo(i.rankLv),n["nickname"+(a[0]==i._id?a[1]:a[0])]);this.desTF1.textFlow=[{text:"射击：  ",style:{size:24,textColor:7093780}},{text:r[0]+"\n",style:{size:24,textColor:12154151}},{text:"命中：  ",style:{size:24,textColor:7093780}},{text:r[1]+"\n",style:{size:24,textColor:12154151}},{text:"爆头：  ",style:{size:24,textColor:7093780}},{text:r[2],style:{size:24,textColor:12154151}}],ActionUtils.refreshDwMc(this.dwMc2,this.dispatcher.get("battle","rankLv"+(a[0]==i._id?a[1]:a[0]))||0,1),this.desTF2.textFlow=[{text:"      "+h+"\n",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}},{text:"射击：  ",style:{size:24,textColor:7093780}},{text:o[0]+"\n",style:{size:24,textColor:12154151}},{text:"命中：  ",style:{size:24,textColor:7093780}},{text:o[1]+"\n",style:{size:24,textColor:12154151}},{text:"爆头：  ",style:{size:24,textColor:7093780}},{text:o[2],style:{size:24,textColor:12154151}}],this.effImg.visible=s.exper>0;var l=n["exper"+(a[0]==i._id?a[1]:a[0])]||0;this.lvTF.text="lv."+formula.getULevel(l);var c=formula.getULevel(s.experOld),d=formula.getULevel(s.experNew),u=formula.getRankInfo(i.rankLv),p=formula.getRankInfo(MainSceneConfig.rankLv);if(i.rankLv>MainSceneConfig.rankLv)if(u.name!=p.name){var g=new Animation("se_duanweishengduan"),m=new Sound(1,"se_shengduan",function(){},".mp3");ActionUtils.refreshDwMc(this.dwMc1,MainSceneConfig.rankLv),this.addChild(g),g.x=488,g.y=550,g.setSlot("p",this.dwMc1),m.play(1),g.play("come",1,function(){ActionUtils.refreshDwMc(e.dwMc1,i.rankLv),e.chechIsLvup(d>c)}.bind(this))}else{var f=new Animation("se_duanweishengji"),m=new Sound(1,"se_shengji",function(){},".mp3"),v=ActionUtils.refreshDwMc(this.dwMc1,MainSceneConfig.rankLv,2);this.dwMc1.addChild(f),f.x=v.x+11.5,f.y=v.y+14,m.play(1),f.play("come",1,function(){ActionUtils.refreshDwMc(e.dwMc1,i.rankLv),e.chechIsLvup(d>c)}.bind(this))}else if(i.rankLv<MainSceneConfig.rankLv)if(u.name!=p.name){ActionUtils.refreshDwMc(this.dwMc1,MainSceneConfig.rankLv);var g=new Animation("se_duanweijiangduan");this.addChild(g),g.x=488,g.y=550,g.setSlot("p",this.dwMc1);var m=new Sound(1,"se_diaoduan",function(){},".mp3");m.play(1),g.play("come",1,function(){ActionUtils.refreshDwMc(e.dwMc1,i.rankLv),e.chechIsLvup(d>c)}.bind(this))}else{var v=ActionUtils.refreshDwMc(this.dwMc1,i.rankLv,2),f=new Animation("se_duanweijiangji");this.dwMc1.addChild(f),f.x=v.x+11.5,f.y=v.y+14;var m=new Sound(1,"se_jiangji",function(){},".mp3");m.play(1),f.play("come",1,function(){e.chechIsLvup(d>c)}.bind(this))}else i.rankLv==MainSceneConfig.rankLv&&(ActionUtils.refreshDwMc(this.dwMc1,i.rankLv),d>c&&this.closeCallBack(1))},e.prototype.chechIsLvup=function(t){var e=this;if(t)this.closeCallBack(1,function(){var t=MatchUtils.getCurrentWeaponExp(e.dispatcher);if(t>MainSceneConfig.weaponExp&&t==RES.getRes("game_config_json").buttleConfig.experGunMax){var i=new Animation("se_shuliandu");e.addChild(i),i.x=320,i.y=e.mScreenHeight/2;var s=new Sound(1,"se_shuliandu",function(){},".mp3");s.play(1),i.play("come",1)}}.bind(this));else{var i=MatchUtils.getCurrentWeaponExp(this.dispatcher);if(i>MainSceneConfig.weaponExp&&i==RES.getRes("game_config_json").buttleConfig.experGunMax){var s=new Animation("se_shuliandu");this.addChild(s),s.x=320,s.y=this.mScreenHeight/2;var n=new Sound(1,"se_shuliandu",function(){},".mp3");n.play(1),s.play("come",1)}}},e}(eui.Component);__reflect(BattleEndDialog.prototype,"BattleEndDialog");var BuyTiDialog=function(t){function e(e,i){var s=t.call(this)||this;return s.mScreenHeight=e,s.dispatcher=i,s.skinName=BuyTiDialogSkin,s}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),new Btn(this.backBtn,function(){e.parent.removeChild(e)}.bind(this)),this.diamondTF.text=(this.dispatcher.get("user","diamondAll")||0)-(this.dispatcher.get("user","diamondCost")||0),this.refreshList(),this.adjustUI()},e.prototype.refreshList=function(){this.list.removeChildren(),this.mChargeArr=RES.getRes("avtivity_json").buyTi;for(var t=function(t){var i=new eui.Component;i.skinName=BuyTiItemRenderSkin,setTexture(i.iconImg,"cz_tili_"+(t+1)+"_png"),i.desTF.text="体力 X"+e.mChargeArr[t][0],i.diamondTF.text=e.mChargeArr[t][1],e.list.addChild(i),i.y=150*t,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("click item "+t)},e)},e=this,i=0;i<this.mChargeArr.length;i++)t(i)},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e}(eui.Component);__reflect(BuyTiDialog.prototype,"BuyTiDialog");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.createView,e),e}return __extends(e,t),e.prototype.createView=function(){var t;if(weedon.winSize.width/weedon.winSize.height>.64)this.stage.setContentSize(640,1e3),this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL,this.y=-193,t=1e3;else{this.stage.setContentSize(640,1386),this.stage.scaleMode=egret.StageScaleMode.NO_BORDER,this.scaleX=this.scaleY=Math.min(.64/(weedon.winSize.width/weedon.winSize.height),1),this.x=640*(1-this.scaleX)/2,this.y=1e3*(1-this.scaleY)/2;var e=this.x?{width:640,height:1e3}:weedon.winSize;t=640*e.height/e.width}var i=createBitmap("login_bg_png");this.addChild(i);var s=createBitmap("logo_png",.5,.5,320,380-(t-1e3)/2);this.addChild(s);var n=createBitmap("dl_jindutiao_01_png",.5,.5,320,1050+(t-1e3)/2);this.addChild(n),this.progBar=createBitmap("dl_jindutiao_00_png",.5,.5,320,1049+(t-1e3)/2),this.addChild(this.progBar),this.progText=new egret.TextField,this.addChild(this.progText),this.progText.size=20,this.progText.textColor=747947,this.progText.x=320,this.progText.y=1005+(t-1e3)/2;var a=this.loadingTag=new eui.Label;this.addChild(a),a.size=20,a.textColor=747947,a.x=320,a.y=1073+(t-1e3)/2,a.text="初次加载时间较长，请耐心等待。",a.anchorOffsetX=a.width/2},e.prototype.onProgress=function(t,e){this.progBar.mask=new egret.Rectangle(0,0,this.progBar.width*t/e,this.progBar.height),this.progText.text="加载中...（"+t+"/"+e+"）",this.progText.anchorOffsetX=this.progText.width/2,this.loadingTag.size=20+Math.random()/100},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var GuideTag=function(t){function e(e,i,s){var n=t.call(this)||this;return n.skinName=QualifyingSceneSkin,n.screenHeight=e,n.mode=i,n.callback=s,n}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bg.height=this.screenHeight,this.y=-(1386-this.screenHeight)/2,this.backBtn.visible=!1,this.tapTag.visible=!0;var e=new Animation("se_xinshouyindao");this.grp1.addChild(e),e.play("stand"+this.mode,0),e.x=230,e.y=320,this.mode?this.desTF1.textFlow=[{text:"1.倾斜手机打开枪膛\n",style:{size:30,textColor:7093780}},{text:"2.点击空膛填装子弹",style:{size:24,textColor:12154151}}]:this.desTF1.textFlow=[{text:"如何击中目标？\n",style:{size:30,textColor:7093780}},{text:"通过",style:{size:24,textColor:12154151}},{text:"[翻转手机]",style:{size:30,textColor:7093780}},{text:"来控制准星，\n",style:{size:24,textColor:12154151}},{text:"[点击屏幕]",style:{size:30,textColor:7093780}},{text:"射击对手！",style:{size:24,textColor:12154151}}],this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.callback()},this)},e}(eui.Component);__reflect(GuideTag.prototype,"GuideTag");var LvupDialog=function(t){function e(e,i,s){var n=t.call(this)||this;return n.mScreenHeight=e,n.skinName=LvupDialogSkin,n.dispatcher=i,n.mCallBack=s,n.data_json=RES.getRes("data_json"),n}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.lvBF.text=formula.getULevel(this.dispatcher.get("user","experience")||0)+"",setTexture(this.okBtn.tfImg,"js_qd_png"),new Btn(this.okBtn,function(){this.mCallBack&&this.mCallBack()}.bind(this));var e=(this.dispatcher.get("user"),this.dispatcher.get("itemsGot")||{});this.hpTF.visible=null!=e.hpLimitBonus,this.hpTF.visible&&(this.hpTF.text="HP上限增加："+e.hpLimitBonus),this.hpTF0.visible=null!=e.strengeBonus,this.hpTF0.visible&&(this.hpTF0.text="体力上限增加："+e.strengeBonus),this.hpTF1.visible=null!=e.strengeLimitBonus,this.hpTF1.visible&&(this.hpTF1.text="体力增加："+e.strengeLimitBonus);var i=[],s=e.gunUnLocked;if(s)for(var n=0;n<s.length;n++)i.push({index:0,num:s[n]});var a=e.propUnLocked;if(a)for(var n=0;n<a.length;n++)i.push({index:1,num:a[n]});this.groupLocked.removeChildren();for(var n=0;n<i.length;n++){var r=i[n],o=r.num;if(null!=o&&""!=o){var h=r.index,l=new UnLockItem,c=o.split("-");0==h?(setTexture(l.img_prop,"weapon_s_"+ +c[0]+"_"+ +c[1]+"_png"),l.label_prop.text=this.data_json.gunsBaseNumber[o][0]):1==h&&(setTexture(l.img_prop,"prop_s_"+ +c[0]+"_"+ +c[1]+"_png"),l.label_prop.text=this.data_json.propsBaseNumber[o][0]),this.groupLocked.addChild(l),l.y=Math.floor(n/2)*(l.height+10),l.x=21+n%2*l.width+10}}},e}(eui.Component);__reflect(LvupDialog.prototype,"LvupDialog");var UnLockItem=function(t){function e(){var e=t.call(this)||this;return e.skinName=propUnLockItem,e}return __extends(e,t),e}(eui.Component);__reflect(UnLockItem.prototype,"UnLockItem");var MailDetail=function(t){function e(e,i,s){var n=t.call(this)||this;return n.skinName=MailDetailSkin,n.dispatcher=i,n.dataJson=RES.getRes("data_json"),n.mailId=e,n.callback=s,n}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=this.dispatcher.get("mails",this.mailId);this.mail=e;var i=new eui.Group,s=new egret.ScrollView(i);this.board.addChild(s),s.x=0,s.y=0,s.width=i.width=436;var n=new eui.Label;i.addChild(n),n.size=24,n.width=436,n.lineSpacing=5,n.text=e.content,this.title.text=e.title;var a=new eui.Group,r=new egret.ScrollView(a);this.attachment.addChild(r),r.x=0,r.y=0,r.width=436,r.height=106;if(e.attachment&&e.attachment.length){s.height=350,this.attachment.visible=!0;for(var o=0,h=0;h<e.attachment.length;h+=3){var l=[e.attachment[h],e.attachment[h+1],e.attachment[h+2]],c=new AttachmentItem(l,this.dataJson);a.addChild(c),c.x=o,o+=111}}else s.height=470,this.attachment.visible=!1;this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this.okBtn.nameTF.text,e="删除"==t?1:0;this.dispatcher.request("mail.check",{target:this.mailId,mode:e},function(t){return 1==e?(this.callback(),void this.parent.removeChild(this)):(this.dispatcher.get("user"),this.mail=this.dispatcher.get("mails",this.mailId),void this.updateBtns())}.bind(this))},this),this.updateBtns()},e.prototype.updateBtns=function(){var t=this.mail;this.okBtn.nameTF.text=null==t.attachment||t.attachment==[]?"确定":t.expires?"删除":"领取"},e}(eui.Component);__reflect(MailDetail.prototype,"MailDetail");var AttachmentItem=function(t){function e(e,i){var s=t.call(this)||this;return s.skinName=HouseItem,s.itemData=e,s.dataJson=i,s}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.touchEnabled=!0,this.bgImg.touchEnabled=this.iconImg.touchEnabled=this.propImg.touchEnabled=this.propLabel.touchEnabled=this.suoImg.touchEnabled=this.suoImgBg.touchEnabled=!1;var e,i=this.itemData[0],s=this.itemData[1],n=this.itemData[2];setTexture(this.bgImg,"ck_wupin_putong_png"),-1==i?0==s?(setTexture(this.propImg,"dj_jinbi_s00_png"),this.propLabel.text="金币"):1==s&&(setTexture(this.propImg,"dj_zuanshi_s00_png"),this.propLabel.text="钻石"):(e=this.dataJson.propsBaseNumber[i+"-"+s],setTexture(this.propImg,"prop_s_"+i+"_"+s+"_png"),this.propLabel.text=e[0]),this.itemNum.visible=!0,this.itemNum.text=n+"+"},e}(eui.Component);__reflect(AttachmentItem.prototype,"AttachmentItem");var MailDialog=function(t){function e(e,i,s){var n=t.call(this)||this;return n.mScreenHeight=e,n.dispatcher=i,n.skinName=MailDialogSkin,n.closeCallback=s,n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),new Btn(this.backBtn,function(){e.closeCallback(),e.parent.removeChild(e)}.bind(this)),this.dispatcher.request("mail.list",{},function(t){t&&console.log(t),this.refreshList(),this.adjustUI()}.bind(this))},e.prototype.refreshList=function(){this.list.removeChildren();var t=this.dispatcher.get("mails")||{};this.mails=t;for(var e in t)t[e]&&t[e].title||delete t[e];var i=Object.keys(t),s=0,n=!1;i.sort(function(e,i){return t[e].expires-t[i].expires||t[i].create-t[e].create}).forEach(function(e,i){var a=t[e],r=a.attachment&&a.attachment.length,o=new eui.Component;o.skinName=MailItemRenderSkin,this.list.addChild(o),o.y=115*i,setTexture(o.bg,a.expires?"ph_db_00_png":"ph_db_01_png"),setTexture(o.icon,r?a.expires?"yj_wupin_open_png":"yj_wupin_png":a.expires?"yj_putong_open_png":"yj_putong_png",.5,.5),o.nameTF.text=a.title||"";var h=new Date(a.create),l=[h.getFullYear(),h.getMonth()+1,h.getDate()].join("/");o.timeTF.text=a.expires?this.djsTimeString(a.expires-a.create)+" 后自动删除":l,o.bindIndex=e,o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){console.log("click item "+i);this.mails[e];this.topUi.removeChildren(),this.topBoard=new MailDetail(e,this.dispatcher,function(){this.refreshList()}.bind(this)),this.topUi.addChild(this.topBoard)}.bind(this),this),!a.expires&&(s+=1),!a.expires&&r&&(n=!0)}.bind(this)),this.numTF.text="未读邮件：  "+s+"/"+i.length},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e.prototype.djsTimeString=function(t){var e=Math.floor(t/36e5),i=e%36e5,s=Math.floor(i/6e4),n=Math.floor(i%1e3);return e+":"+s+":"+n},e}(eui.Component);__reflect(MailDialog.prototype,"MailDialog");var MainScene=function(t){function e(e){var i=t.call(this)||this;return i.ignoreNextResize=!1,i.target_scale=.65,i.standArray=["handgun_stand","rifle_stand","shutgun_stand","sniper_stand"],i.mPropItemsShowBool=!1,i.mCurrentPropItemIndex=0,i.mWeaponItemsShowBool=!1,i.mIsShowPropBool=!1,i.guideStep=0,i.guideWaiting=!1,i.dispatcher=e,i.skinName=MainSceneSkin,i.dispatcher.setOverrideKey("itemsGot"),i}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.mDataJson=RES.getRes("data_json"),this.mGameConfigJson=RES.getRes("game_config_json"),this.clickImg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.resetPropOrWeaponScroll();var t=new SettingDialog(e.screenHeight,e.dispatcher);e.dialogGrp.addChild(t)},this),new Btn(this.chargeBtn,function(){e.resetPropOrWeaponScroll();var t=new ChargeDialog(e.screenHeight,e.dispatcher);e.dialogGrp.addChild(t)}),new Btn(this.buyTiBtn,function(){e.resetPropOrWeaponScroll();var t=new BuyTiDialog(e.screenHeight,e.dispatcher);e.dialogGrp.addChild(t)}),setTexture(this.leftBtn.tfImg,"new_tf_paiweizhan_png"),this.leftBtn.leftBg.visible=!0,this.leftBtn.rightBg.visible=!1,this.leftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.startRankingBattle()},this),setTexture(this.rightBtn.tfImg,"new_tf_haoyouduijue_png"),this.rightBtn.leftBg.visible=!1,this.rightBtn.rightBg.visible=!0,this.rightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.resetPropOrWeaponScroll();var t=new MatchingScene(e.screenHeight,e.dispatcher);e.dialogGrp.addChild(t)},this);var i=(this.standArray,this.dispatcher.get("user","gender")),s=this.dispatcher.get("user","cap")-1e4;i=-1==i?1:i;var n=this.target=new Animation("chr"+i);if(n.setSlot("hat",createBitmap("zs_maozi_b0"+s+"_png",.5,.5,0,0,this.target_scale,this.target_scale)),this.personGrp.addChild(n),n.x=330,n.y=170,n.scaleX=n.scaleY=this.target_scale,this.updatePropHs(),this.itemList=new ItemList(this.dispatcher),this.propGrp.addChild(this.itemList),this.itemList.setList(this.mPropItemKeys,1,function(t,i){if(t.replace("_","-")==e.mCurrentPropIndex||-1>i)return void e.itemList.hide();var s=""==t?1:0;e.dispatcher.request("propHs.changeProps",{mode:s,propIndex:t.replace("_","-")},function(t){return t?void console.log(t):(e.showWuPinInfo("prop"),e.itemList.refreshBgImg(),void e.itemList.hide())}.bind(e))}.bind(this),this.mPropItemNums),this.itemList.anchorOffsetX=this.itemList.anchorOffsetY=205,this.itemList.x=this.propMc.x+90-90,this.itemList.y=this.propMc.y+100-101,this.propMc.clickImg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ActionUtils.runBtnAction(e.propMc),e.weaponItemList.isShow&&e.weaponItemList.hide(),e.itemList.isShow?e.itemList.hide():e.itemList.show()},this),this.updateWeaponHs(),this.weaponItemList=new ItemList(this.dispatcher,1),this.propGrp.addChild(this.weaponItemList),this.weaponItemList.setList(this.mWeaponItemKeys,2,function(t,i){return t.replace("_","-")==e.mCurrentWeaponIndex?void e.weaponItemList.hide():void e.dispatcher.request("propHs.changeGun",{gunIndex:t.replace("_","-")},function(t){return t?void console.log(t):(e.showWuPinInfo("weapon"),e.weaponItemList.refreshBgImg(),void e.weaponItemList.hide())}.bind(e))}.bind(this)),this.weaponItemList.anchorOffsetX=this.weaponItemList.anchorOffsetY=205,this.weaponItemList.x=this.weaponMc.x+100-112,this.weaponItemList.y=this.weaponMc.y+100-101,this.weaponMc.clickImg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ActionUtils.runBtnAction(e.weaponMc),e.itemList.isShow&&e.itemList.hide(),e.weaponItemList.isShow?e.weaponItemList.hide():e.weaponItemList.show()},this),setTexture(this.tabBtn1.tfImg,"new_tf_cangku_png"),new Btn(this.tabBtn1,function(){e.resetPropOrWeaponScroll(),e.currentPage=new HouseScene(e.dispatcher,function(){this.currentPage.parent.removeChild(this.currentPage),this.refreshData(),this.updatePropHs(),this.itemList.resetList(this.mPropItemKeys,this.mPropItemNums),this.weaponItemList.refreshBgImg(),this.itemList.refreshBgImg()}.bind(e),e.screenHeight),e.stage.addChild(e.currentPage)}),setTexture(this.tabBtn2.tfImg,"new_tf_paihangbang_png"),new Btn(this.tabBtn2,function(){e.resetPropOrWeaponScroll();var t=new RankDialog(e.screenHeight,e.dispatcher);e.dialogGrp.addChild(t)}),setTexture(this.tabBtn3.tfImg,"new_tf_youjian_png"),new Btn(this.tabBtn3,function(){e.resetPropOrWeaponScroll();var t=new MailDialog(e.screenHeight,e.dispatcher,function(){this.refreshData()}.bind(e));e.dialogGrp.addChild(t)}),setAvatar(this.headImg,this.dispatcher.get("user","avatar")||0,this.dispatcher.get("user","avatarUrl")||""),this.nameTF.text=this.dispatcher.get("user","nickname"),this.mLastGetTiTime=0==this.dispatcher.get("user","lastGetStrenge")?weedon.time:this.dispatcher.get("user","lastGetStrenge"),this.mCurrentTiNum=this.dispatcher.get("user","strenge")||0,this.mMaxTiNum=this.dispatcher.get("user","strengeLimit")||this.mGameConfigJson.userConfig.strengeMax,this.refreshData(),this.startAccelerometer(),this.dispatcher.get("user","guide")<3&&this.showGuide(),this.stage.addEventListener(egret.Event.RESIZE,this.adjustUI,this),this.adjustUI(),egret.startTick(this.update,this),!formula.getBgMusic())var a=new Sound(0,"bg_game",function(){formula.initBgMusic(a),a.play(0),console.log(a.playing)
},".mp3")},e.prototype.adjustUI=function(){return this.ignoreNextResize?void(this.ignoreNextResize=!1):(this.ignoreNextResize=!0,weedon.winSize.width/weedon.winSize.height>.64?(this.stage.setContentSize(640,1e3),this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL,this.screenHeight=1e3,this.y=-193,this.topUI.y=-this.y,this.bottomUI.y=this.screenHeight+193-100):(this.stage.setContentSize(640,1386),this.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,this.screenHeight=640/weedon.winSize.width*weedon.winSize.height,this.y=-(1386-this.screenHeight)/2,this.topUI.y=-this.y,this.bottomUI.y=this.screenHeight-this.y-100),void(this.duelGrp.y=-this.y))},e.prototype.startRankingBattle=function(){this.resetPropOrWeaponScroll();try{var t=new QualifyingScene(this.screenHeight,this.dispatcher,function(t){if(1==t){navigator.vibrate&&navigator.vibrate([500]);try{var e=formula.getBgMusic();e&&e.stop(),this.duelBoard=new Duel(this.dispatcher,function(){var t=this,e=formula.getBgMusic();e&&e.stop();var i=this.dispatcher.get("user","guide")||0;if(3>=i){this.duelGrp.removeChild(this.duelBoard);var s=new NewUserRetBoard(function(){try{t.updatePropHs(),t.itemList.resetList(t.mPropItemKeys,t.mPropItemNums),t.dialogGrp.removeChild(s),t.guide.visible=!1}catch(e){window.alert(e)}}.bind(this));return void this.dialogGrp.addChild(s)}try{this.showBattleRet()}catch(n){console.log(n)}}.bind(this)),this.duelGrp.addChild(this.duelBoard)}catch(i){console.log(i)}}else-1==t&&(this.startAccelerometer(),this.dispatcher.request("user.leave",{},function(){}.bind(this)))}.bind(this));this.dialogGrp.addChild(t)}catch(e){console.log(e)}},e.prototype.update=function(){this.checkTiLi()},e.prototype.refreshData=function(){this.lvTF.text="等级："+formula.getULevel(this.dispatcher.get("user","experience")||0);var t=this.getExpInfo();t.isMax?this.expPrg.value=100:this.expPrg.value=t.curExp/t.totalExp*100,this.coinTF.text=(this.dispatcher.get("user","goldAll")||0)-(this.dispatcher.get("user","goldCost")||0),this.diamondTF.text=(this.dispatcher.get("user","diamondAll")||0)-(this.dispatcher.get("user","diamondCost")||0),this.prgMc.value=this.mCurrentTiNum/this.mMaxTiNum*100,this.prgTF.text=this.mCurrentTiNum+"/"+this.mMaxTiNum,MainSceneConfig.rankLv=this.dispatcher.get("user","rankLv")||0,ActionUtils.refreshDwMc(this.dwMc,MainSceneConfig.rankLv),this.showWuPinInfo()},e.prototype.checkTiLi=function(){if(this.mCurrentTiNum>=this.mMaxTiNum)return void(this.prgCd.text="");var t=weedon.time-this.mLastGetTiTime,e=1e3*this.mGameConfigJson.userConfig.strengeInteval;t>=e&&(this.mLastGetTiTime=weedon.time,this.mCurrentTiNum++,this.prgMc.value=this.mCurrentTiNum/this.mMaxTiNum*100,this.prgTF.text=this.mCurrentTiNum+"/"+this.mMaxTiNum),this.prgCd.text=DateUtils.getDateInfoByType((e-t)/1e3/60,1)},e.prototype.showWuPinInfo=function(t){if(void 0===t&&(t="all"),("prop"==t||"all"==t)&&(this.mCurrentPropIndex=this.dispatcher.get("user","propIndex"),""!=this.dispatcher.get("user","propIndex")?setTexture(this.propMc.iconImg,"prop_l_"+this.mCurrentPropIndex.replace("-","_")+"_png"):this.propMc.iconImg.texture=null),"weapon"==t||"all"==t){this.mCurrentWeaponIndex=this.dispatcher.get("user","gunIndex"),this.target.play(this.standArray[this.mCurrentWeaponIndex.substr(0,1)],0);var e=this.dispatcher.get("user","gunHs")||[[0,-1],[-1,-1],[-1,-1],[-1,-1]],i=e[+this.mCurrentWeaponIndex.substr(0,1)][+this.mCurrentWeaponIndex.substr(2,1)],s=new eui.Group;if(s.addChild(createBitmap("weapon_m_"+this.mCurrentWeaponIndex.replace("-","_")+"_png",.5,.5,0,0,1,1)),i==RES.getRes("game_config_json").buttleConfig.experGunMax){var n=new Animation("se_maxlevel");n.x=0,n.y=0,n.play("stand",0),s.addChild(n)}this.target.setSlot("gun0",s),""!=this.dispatcher.get("user","gunIndex")?setTexture(this.weaponMc.iconImg,"weapon_l_"+this.mCurrentWeaponIndex.replace("-","_")+"_png"):this.weaponMc.iconImg.texture=null}},e.prototype.startAccelerometer=function(){var t=this;("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).startAccelerometer({success:function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).onAccelerometerChange(function(e){var i="undefined"==typeof GameGlobal?e.x:e.y;t.grassImg.x=26+30*i,t.carImg.x=-10+16*i,t.bg.x=-30+10*i,t.target.x=330+23*i}.bind(t))}.bind(this)})},e.prototype.showBattleRet=function(){try{this.showBattleRetBoard=new BattleEndDialog(this.screenHeight,this.dispatcher,function(t,e){var i=this;console.log("mode is :"+t),-1==t?(this.dialogGrp&&this.dialogGrp.removeChildren(),this.duelGrp&&this.duelGrp.removeChildren(),this.refreshData(),this.updatePropHs(),this.itemList.resetList(this.mPropItemKeys,this.mPropItemNums),this.weaponItemList.refreshBgImg(),this.itemList.refreshBgImg()):1==t&&(this.upDialog=new LvupDialog(this.screenHeight,this.dispatcher,function(){i.dialogGrp.removeChild(i.upDialog),e&&e()}.bind(this)),this.dialogGrp.addChild(this.upDialog))}.bind(this)),this.dialogGrp.addChild(this.showBattleRetBoard)}catch(t){console.log(t)}this.startAccelerometer(),this.refreshData()},e.prototype.resetPropOrWeaponScroll=function(){this.itemList.isShow&&this.itemList.hide(),this.weaponItemList.isShow&&this.weaponItemList.hide()},e.prototype.getExpInfo=function(){for(var t=this.dispatcher.get("user","experience")||0,e=0,i=0;i<this.mDataJson.lvExpers.length;i++){var s=this.mDataJson.lvExpers[i];if(s>t)return e=i+1,e==this.mDataJson.lvExpers.length?{lv:e,isMax:!0}:{lv:e,isMax:!1,curExp:t-(this.mDataJson.lvExpers[i-1]||0),totalExp:s-(this.mDataJson.lvExpers[i-1]||0)}}},e.prototype.updatePropHs=function(){this.mPropItemKeys=[""],this.mPropItemNums=[0];for(var t=this.dispatcher.get("user","propHs"),e=0;e<t.length;e++)for(var i=t[e],s=0;s<i.length;s++)(i[s]>0||i[s]<-1)&&(this.mPropItemKeys.push(e+"_"+s),this.mPropItemNums.push(i[s]))},e.prototype.updateWeaponHs=function(){this.mWeaponItemKeys=[];for(var t=this.dispatcher.get("user","gunHs"),e=0;e<t.length;e++)for(var i=t[e],s=0;s<i.length;s++)i[s]>=0&&this.mWeaponItemKeys.push(e+"_"+s);console.log(this.mWeaponItemKeys)},e.prototype.setOtherBtn=function(t){[this.tabBtn1,this.tabBtn2,this.tabBtn3,this.tiImg,this.prgTF,this.prgCd,this.chargeBtn,this.buyTiBtn,this.tImg,this.prgMc,this.dwMc].forEach(function(e){e.visible=t})},e.prototype.showGuide=function(){this.guide.touchEnabled=!0,this.guide.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.guideWaiting||(this.guideStep+=1,this.updateGuide())},this);var t=new egret.DisplayObjectContainer,e=new egret.Shape;t.addChild(e),e.graphics.beginFill(0,.5),e.graphics.drawRect(0,0,640,1386),e.graphics.endFill();var i=new egret.Shape;t.addChild(i),i.graphics.beginFill(0,1),i.graphics.drawCircle(320,693,50),i.graphics.endFill(),i.blendMode=egret.BlendMode.ERASE;var s=new egret.RenderTexture;s.drawToTexture(t),this.holeCover=new eui.Image(s),this.holeCover.anchorOffsetX=320,this.holeCover.anchorOffsetY=693,this.holeCover.x=320,this.holeCover.y=693,this.holeCover.scaleX=this.holeCover.scaleY=4,this.holeCover.visible=!1,this.holeCover.touchEnabled=!1,this.guide.addChildAt(this.holeCover,0),this.yindaoAni=new Animation("xs_yindaohand"),this.guide.addChild(this.yindaoAni),this.yindaoAni.play("stand",0),this.yindaoAni.visible=!1,2==this.dispatcher.get("user","guide")&&(this.guideStep=6),this.guide.visible=!0,this.guideDialog.visible=!1,this.updateGuide()},e.prototype.updateGuide=function(){var t=this;switch(this.guideStep){case 0:this.guideWaiting=!0,this.showHole(605,885,function(){this.guideDialog.visible=!0,this.showText(20,"在决斗前记得要检查自己的枪！"),this.guideWaiting=!1}.bind(this));break;case 1:this.guideWaiting=!0,this.weaponItemList.show(),this.showHole(580,720,function(){this.guideWaiting=!1}.bind(this),500);break;case 2:this.guideWaiting=!0,this.guideDialog.visible=this.holeCover.visible=this.yindaoAni.visible=!1,this.weaponItemList.hide(),egret.Tween.get(this).wait(500).call(function(){this.guideStep+=1,this.updateGuide()},this);break;case 3:this.showHole(45,885,function(){this.guideDialog.visible=!0,this.showText(20,"装备合适的道具可以让你在决斗中取得优势！"),this.guideWaiting=!1}.bind(this));break;case 4:this.guideWaiting=!0,this.itemList.show(),this.showHole(150,765,function(){this.guideWaiting=!1}.bind(this),500);break;case 5:this.guideWaiting=!0,this.guideDialog.visible=this.holeCover.visible=this.yindaoAni.visible=!1,this.dispatcher.request("propHs.changeProps",{mode:0,propIndex:"1-0"},function(e){return e?void console.log(e):(t.showWuPinInfo("prop"),t.itemList.refreshBgImg(),t.itemList.hide(),void egret.Tween.get(t).wait(500).call(function(){this.guideStep+=1,this.updateGuide()},t))}.bind(this));break;case 6:this.guideWaiting=!0,this.showHole(this.bottomUI.x+this.leftBtn.x+this.leftBtn.width/2,this.bottomUI.y+this.leftBtn.y+this.leftBtn.height/2,function(){this.guideDialog.visible=!0,this.showText(20,"在你想要对决时，排位战可以随时为你找到一个对手！"),this.guideWaiting=!1}.bind(this));break;case 7:this.guideDialog.visible=this.holeCover.visible=this.yindaoAni.visible=!1,this.startRankingBattle()}},e.prototype.showText=function(t,e){this.guideDialog.visible=!0,this.guideDialog.y=t,"string"==typeof e?this.guideText.text=e:this.guideText.textFlow=e},e.prototype.showHole=function(t,e,i,s){this.yindaoAni.visible=!1,this.holeCover.visible=!1,egret.Tween.get(this.holeCover).wait(s||0).call(function(){this.holeCover.visible=!0,this.holeCover.x=t,this.holeCover.y=e,this.holeCover.scaleX=this.holeCover.scaleY=4},this).to({scaleX:2,scaleY:2},300).wait(500).call(function(){this.yindaoAni.x=t,this.yindaoAni.y=e,this.yindaoAni.visible=!0,i()},this)},e}(eui.Component);__reflect(MainScene.prototype,"MainScene");var NewUserRetBoard=function(t){function e(e){var i=t.call(this)||this;return i.skinName=NewUserRetBoardSkin,i.callback=e,i}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),setTexture(this.itemMc.bgImg,"ck_wupin_putong_png"),setTexture(this.itemMc.propImg,"prop_s_1_0_png"),this.itemMc.iconImg.visible=!1,this.itemMc.propLabel.text="单管炸弹",this.itemMc.itemNum.text="5",setTexture(this.getBtn.tfImg,"lignqu_png"),this.getBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ActionUtils.runBtnAction(e.getBtn),console.log("get item"),e.callback&&e.callback()},this)},e}(eui.Component);__reflect(NewUserRetBoard.prototype,"NewUserRetBoard");var DateUtils=function(){function t(){}return t.getFormatTime=function(t){var e=new Date(t);return{Y:e.getFullYear(),M:this.formatNumber(e.getMonth()+1),D:this.formatNumber(e.getDate()),h:this.formatNumber(e.getHours()),m:this.formatNumber(e.getMinutes()),s:this.formatNumber(e.getSeconds())}},t.getDateInfoByType=function(t,e){var i=this.formatReaminTime(t);return 1==e?this.formatNumber(i.min)+":"+this.formatNumber(i.second):void 0},t.formatReaminTime=function(t){t=Math.max(0,t);var e=Math.floor(t/1440);t-=1440*e;var i=Math.floor(t/60);t-=60*i;var s=Math.floor(t);t-=s;var n=Math.floor(60*t);return{day:e,hour:i,min:s,second:n}},t.formatNumber=function(t){return 10>t?"0"+t:t},t}();__reflect(DateUtils.prototype,"DateUtils");var ItemList=function(t){function e(e,i){var s=t.call(this)||this;return s.isEnabled=!1,s.moved=!1,s.isShow=!1,s.currentFirst=0,s.itemOffset=0,s.dispatcher=e,s.mode=i||0,s.skinName=i?MainRotation2Skin:MainRotationComSkin,s.touchEnabled=!0,s.addEventListener(egret.TouchEvent.TOUCH_BEGIN,s._touchBegin,s),s.addEventListener(egret.TouchEvent.TOUCH_MOVE,s._touchMove,s),s.addEventListener(egret.TouchEvent.TOUCH_END,s._touchEnd,s),s.visible=!1,s}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.startPoint=new egret.Point,this.currentPoint=new egret.Point},e.prototype._touchBegin=function(t){this.startRotation=this.itemList.rotation,this.globalToLocal(t.stageX,t.stageY,this.startPoint),this.startAngle=Math.atan((this.startPoint.y-210)/(this.startPoint.x-210))/Math.PI*180,this.startAngle=this.startPoint.x<210?180+this.startAngle:this.startAngle},e.prototype._touchMove=function(t){if(!(this.list.length<6)){this.globalToLocal(t.stageX,t.stageY,this.currentPoint);var e=Math.atan((this.currentPoint.y-210)/(this.currentPoint.x-210))/Math.PI*180;e=this.currentPoint.x<210?180+e:e,this.moved=Math.abs(e-this.startAngle)>1,this.itemList.rotation=this.startRotation+e-this.startAngle;for(var i=0;8>i;++i)this["p"+i].rotation=-this.itemList.rotation;var s;s=this.mode?this.itemList.rotation>=0?Math.floor(this.itemList.rotation/45):7+Math.ceil(this.itemList.rotation/45):this.itemList.rotation>0?7-Math.floor(this.itemList.rotation/45):Math.floor(-this.itemList.rotation/45),this.updateList(s)}},e.prototype._touchEnd=function(t){if(this.moved)return void(this.moved=!1);for(var e=0;8>e;e++)t.target==this["p"+e]&&(this.callback&&this.callback(this.mCurrentDic["p"+e].str,this.mCurrentDic["p"+e].index),console.log("选中p"+e+",index="+this.mCurrentDic["p"+e].str+",num="+this.mCurrentDic["p"+e].index))},e.prototype.show=function(){this.isShow=!0,this.visible=!0,this.isEnabled=!1,this.scaleX=this.scaleY=0,egret.Tween.get(this).to({scaleX:1,scaleY:1},100).call(function(){this.isEnabled=!0},this)},e.prototype.hide=function(){this.isShow=!1,this.isEnabled=!1,this.scaleX=this.scaleY=1,egret.Tween.get(this).to({scaleX:0,scaleY:0},100).call(function(){this.visible=!1},this)},e.prototype.setList=function(t,e,i,s){void 0===s&&(s=[]),this.itemList.rotation=0,this.mCurrentDic={},this.list=t,this.numArr=s,this.updateList(0,!0),this.mType=e,this.callback=i,this.refreshBgImg()},e.prototype.resetList=function(t,e){void 0===e&&(e=[]),this.itemList.rotation=0,this.mCurrentDic={},this.list=t,this.numArr=e,this.updateList(0,!0),this.refreshBgImg();for(var i=0;8>i;i++)this["p"+i].rotation=0},e.prototype.updateList=function(t,e){if(t!=this.currentFirst||e){this.itemOffset+=t-this.currentFirst==7?-1:t-this.currentFirst==-7?1:t-this.currentFirst,this.itemOffset=this.itemOffset%this.list.length,this.currentFirst=t;for(var i=this.mode?"weapon":"prop",s=0;6>s;++s){var n=this["p"+(t+s)%8],a=this.list[(this.list.length+this.itemOffset+s)%this.list.length],r=0;""==a?(n.tf.text="空",n.numTF.text="",n.iconImg.texture=null):(n.tf.text="",this.mode?n.numTF.text="":(r=this.numArr[(this.list.length+this.itemOffset+s)%this.list.length],n.numTF.text=r>0?r:-1-r),setTexture(n.iconImg,i+"_s_"+a.replace("-","_")+"_png")),setTexture(n.bgImg,a==this.mCurrentSelect?"new_menu_select_bg_png":"new_menu_common_bg_png"),this.mCurrentDic["p"+(t+s)%8]={str:a,index:r}}}if(this.list.length<6)for(var s=this.list.length;6>s;++s)this["p"+s].visible=!1;this.refreshBgImg()},e.prototype.refreshBgImg=function(){this.mCurrentSelect=0==this.mode?this.dispatcher.get("user","propIndex"):this.dispatcher.get("user","gunIndex");for(var t in this.mCurrentDic)setTexture(this[t].bgImg,this.mCurrentSelect.replace("-","_")==this.mCurrentDic[t].str?"new_menu_select_bg_png":"new_menu_common_bg_png")},e}(eui.Component);__reflect(ItemList.prototype,"ItemList");var ActionUtils=function(){function t(){}return t.runTFAction=function(t,e){t.text="";var i=0,s=e.length;egret.Tween.get(this,{loop:!0}).to({},200).call(function(){t.textFlow=[{text:e.substring(0,i),style:{size:30}},{text:e.substring(i,i+1),style:{size:40}},{text:e.substring(i+1),style:{size:30}}],i=i>=s-3?0:i+2})},t.runBtnAction=function(t){egret.Tween.get(t).to({scaleX:.7,scaleY:.7},100).to({scaleX:1,scaleY:1},100)},t.refreshDwMc=function(t,e,i){void 0===i&&(i=0);for(var s=3;5>=s;s++)for(var n=1;s>=n;n++)t["star"+s+"_"+n].visible=!1;var a=formula.getRankInfo(e),r=[3,3,4,5,5,5][a.index],o=a.starNum,h=a.name;if(setTexture(t.bgImg,"sy_duanwei_0"+a.index+"_png"),6==a.index){if(t.star_bg6.visible=t.star6TF.visible=t.star6Img.visible=t.star6Img2.visible=1!=i,t.star_bg.visible=!1,t.numBF.text="",t.star6TF.text="x"+o,t.star6Img.x=95-(0+t.star6TF.width)/2,t.star6TF.x=t.star6Img.x+33,t.star6Img2.x=t.star6Img.x+5,2==i)return{displayName:t.star6Img2.x,y:t.star6Img2.y,result:"star6Img2"}}else{t.star_bg6.visible=t.star6TF.visible=t.star6Img.visible=t.star6Img2.visible=!1,t.star_bg.visible=1!=i,t.numBF.text=[["f","ff","fff"],["h","hh","hhh"],["b","bb","bbb","bA"],["d","dd","ddd","dC","C"],["b","bb","bbb","bA","A"],["b","bb","bbb","bA","A"]][a.index][+h.substr(4,1)-1],setTexture(t.star_bg,"sy_duanwei_xing_"+r+"_png");for(var s=0;r>s;s++)t["star"+r+"_"+(s+1)].visible=o>s&&1!=i;if(2==i&&o>=0)return{x:t["star"+r+"_"+(o+1)].x,y:t["star"+r+"_"+(o+1)].y};if(3==i&&o>=0)return{x:t["star"+r+"_"+o].x,y:t["star"+r+"_"+o].y}}},t}();__reflect(ActionUtils.prototype,"ActionUtils");var MainSceneConfig=function(){function t(){}return t.weaponExp=0,t}();__reflect(MainSceneConfig.prototype,"MainSceneConfig");var MatchUtils=function(){function t(){}return t.getCurrentWeaponExp=function(t){var e=t.get("user","gunHs")||[[0,-1],[-1,-1],[-1,-1],[-1,-1]],i=t.get("user","gunIndex");return e[+i.substr(0,1)][+i.substr(2,1)]},t.getRegularSixSidedPolygonObject=function(t,e,i,s){return void 0===s&&(s=[null,0,0,0,0,0,0]),{O:new egret.Point(t,e),A:new egret.Point(t,e-i),AA:new egret.Point(t,e-i*s[1]),B:new egret.Point(t+i*Math.sin(Math.PI/3),e-i/2),BB:new egret.Point(t+i*Math.sin(Math.PI/3)*s[2],e-i/2*s[2]),C:new egret.Point(t+i*Math.sin(Math.PI/3),e+i/2),CC:new egret.Point(t+i*Math.sin(Math.PI/3)*s[3],e+i/2*s[3]),D:new egret.Point(t,e+i),DD:new egret.Point(t,e+i*s[4]),E:new egret.Point(t-i*Math.sin(Math.PI/3),e+i/2),EE:new egret.Point(t-i*Math.sin(Math.PI/3)*s[5],e+i/2*s[5]),F:new egret.Point(t-i*Math.sin(Math.PI/3),e-i/2),FF:new egret.Point(t-i*Math.sin(Math.PI/3)*s[6],e-i/2*s[6])}},t}();__reflect(MatchUtils.prototype,"MatchUtils");var MatchingScene=function(t){function e(e,i,s){void 0===s&&(s=1);var n=t.call(this)||this;return n.mScreenHeight=e,n.dispatcher=i,n.mMode=s,n.skinName=MatchingSceneSkin,n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),new Btn(this.backBtn,function(){e.parent.removeChild(e)}.bind(this)),1==this.mMode?(this.mType=1,this.leftBtn.visible=this.rightBtn.visible=!0,this.middleBtn.visible=!1,setTexture(this.leftBtn.tfImg,"new_tf_fangqitiaozhan_png"),setTexture(this.rightBtn.tfImg,"new_tf_yaoqinghaoyou_png")):2==this.mMode&&(this.leftBtn.visible=this.rightBtn.visible=!1,this.middleBtn.visible=!0,setTexture(this.middleBtn.tfImg,"new_tf_fangqitiaozhan_png")),new Btn(this.leftBtn,function(){e.parent.removeChild(e),console.log("即将放弃挑战")}.bind(this)),new Btn(this.rightBtn,function(){1==e.mType?(e.mType=2,setTexture(e.rightBtn.tfImg,"new_tf_kaishiduijue_png"),console.log("即将邀请好友")):2==e.mType&&(console.log("即将开始比赛"),navigator.vibrate&&navigator.vibrate([500]))}.bind(this)),new Btn(this.middleBtn,function(){e.parent.removeChild(e),console.log("即将放弃挑战")}.bind(this)),this.leftMc.nameTF.text=this.dispatcher.get("user","nickname"),this.leftMc.lvTF.text="Lv."+formula.getULevel(this.dispatcher.get("user","experience")||0),this.leftMc.x=-500,this.rightMc.x=752,this.vs.visible=!1,egret.Tween.get(this.leftMc).to({x:0},500),egret.Tween.get(this.rightMc).wait(500).to({x:252},500).wait(500).call(function(){e.vs.visible=!0},this),this.adjustUI()},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e}(eui.Component);__reflect(MatchingScene.prototype,"MatchingScene");var QualifyingScene=function(t){function e(e,i,s){var n=t.call(this)||this;return n.battleStart=0,n.matching=!1,n.sendAiRequest=!1,n.mScreenHeight=e,n.skinName=QualifyingSceneSkin,n.dispatcher=i,n.callback=s,n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this);var i=this.dispatcher.get("user");this.userGuide=i.guide||0,this.userKeepLose=i.keepLose||0,console.log(this.userGuide),new Btn(this.backBtn,function(){e.parent.removeChild(e),e.callback(-1)}.bind(this)),this.dispatcher.get("user","guide")<3&&(this.backBtn.visible=!1);var s=new Animation("se_tip");this.grp1.addChild(s),s.play("play",0),s.x=230,s.y=320,this.desTF1.textFlow=[{text:"如何排位？\n",style:{size:30,textColor:7093780}},{text:"将手机",style:{size:24,textColor:12154151}},{text:"[倒置]",style:{size:30,textColor:7093780}},{text:"开始匹配对手。\n",style:{size:24,textColor:12154151}},{text:"提示音",style:{size:24,textColor:12154151}},{text:"[响起和震动]",style:{size:30,textColor:7093780}},{text:"匹配完成，开始战斗！",style:{size:24,textColor:12154151}}],this.tweenImg.rotation=0,egret.Tween.get(this.tweenImg,{loop:!0}).to({rotation:360},2500).call(function(){e.tweenImg.rotation=0}),this.adjustUI(),ActionUtils.runTFAction(this.desTF2,"正 在 寻 找 对 手 . . "),this.grp1.visible=!0,this.grp2.visible=!1,this.dispatcher.setPushCallback("join",this.joinOk.bind(this)),("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).startAccelerometer({success:function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).onAccelerometerChange(function(t){var e="undefined"==typeof GameGlobal?t.z:t.y;!this.motionStart&&e>=.5&&(this.motionStart=weedon.time,this.grp1.visible=!1,this.grp2.visible=!0,this.backBtn.visible=!1),this.motionStart&&.5>e&&!this.battleStart&&(this.backBtn.visible=!0,this.motionStart=0,this.matching?this.dispatcher.request("user.leave",{},function(){this.matching=!1,this.grp2.visible=!1,this.grp1.visible=!0}.bind(this)):(this.grp2.visible=!1,this.grp1.visible=!0)),2==this.dispatcher.get("user","guide")&&(this.backBtn.visible=!1)}.bind(this)),egret.startTick(this.update,this)}.bind(this)})},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e.prototype.update=function(){return this.battleStart||this.motionStart?(!this.matching&&weedon.time-this.motionStart>3e3&&(this.matching=!0,this.userGuide<3||this.userKeepLose>=4?this.dispatcher.request("aiBattle.getbattle",{},function(){this.dispatcher.get("battle","ready")&&this.joinOk()}.bind(this)):this.dispatcher.request("user.join",{},function(){this.dispatcher.get("battle","ready")&&this.joinOk()}.bind(this))),!this.sendAiRequest&&weedon.time-this.motionStart>6e3&&(this.sendAiRequest=!0,this.dispatcher.request("aiBattle.getbattle",{},function(){this.dispatcher.get("battle","ready")&&this.joinOk()}.bind(this))),this.battleStart&&weedon.time>=this.battleStart&&(egret.stopTick(this.update,this),this.parent.removeChild(this),this.callback(1)),!0):void 0},e.prototype.joinOk=function(){("undefined"!=typeof HORTOR_AGENT?HORTOR_AGENT:"undefined"==typeof GameGlobal?_wx:wx).stopAccelerometer(),this.battleStart=this.dispatcher.get("battle","startTime")},e}(eui.Component);__reflect(QualifyingScene.prototype,"QualifyingScene");var RankDialog=function(t){function e(e,i){var s=t.call(this)||this;return s.mCurrentTab=1,s.mScreenHeight=e,s.dispatcher=i,s.skinName=RankDialogSkin,s}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.mOwnId=this.dispatcher.get("user","_id"),new Btn(this.backBtn,function(){e.parent.removeChild(e)}.bind(this)),new Btn(this.tabBtn1,function(){1!=e.mCurrentTab&&(e.mCurrentTab=1,e.refreshList())}.bind(this)),new Btn(this.tabBtn2,function(){2!=e.mCurrentTab&&(e.mCurrentTab=2,e.refreshList())}.bind(this)),this.tabBtn1.tabTF.text="好 友 排 名",this.tabBtn2.tabTF.text="世 界 排 名",this.refreshList(),this.adjustUI()},e.prototype.refreshList=function(){var t=this;this.tabBtn1.tabTF.textColor=1==this.mCurrentTab?7093780:12154151,this.tabBtn2.tabTF.textColor=2==this.mCurrentTab?7093780:12154151;var e=this.mCurrentTab-1;this.dispatcher.request("user.getRankList",{mode:e},function(e){if(e)return void console.log(e);var i=t.dispatcher.getNew("result"),s=1==t.mCurrentTab?1:t.dispatcher.get("rankMe");t.updateList(i.sort(function(t,e){return t.rank-e.rank})),1==t.mCurrentTab?t.desTF.text="当前我的好友排名:1":t.desTF.text="当前我的世界排名"+(999==s?999:s+1)}.bind(this))},e.prototype.adjustUI=function(){this.bg.height=this.mScreenHeight,this.backBtn.y=(1386-this.mScreenHeight)/2+50},e.prototype.updateList=function(t){this.scroll.stopAnimation(),this.list.removeChildren();for(var e=0;e<t.length;e++){var i=new eui.Component;i.skinName=RankItemRenderSkin,i.rankTF.text=1==this.mCurrentTab?1:t[e].rank+1;var s=formula.getRankInfo(t[e].user.rankLv);i.dwTF.text=s.name,i.starTF.text=s.starNum,ActionUtils.refreshDwMc(i.dwMc,t[e].user.rankLv||0,1),i.nameTF.text=t[e].user.nickname,i.lvTF.text="Lv."+formula.getULevel(t[e].user.experience),setAvatar(i.headImg,t[e].user.avater),t[e].user._id==this.mOwnId?(setTexture(i.bgImg,"ph_db_01_png"),setTexture(i.jbImg,"ph_jb_01_png")):(setTexture(i.bgImg,"ph_db_00_png"),setTexture(i.jbImg,"ph_jb_00_png"));var n=t[e].user.cap-1e4==1?1:0;setTexture(i.mzImg,"ph_zy_0"+n+"_png"),this.list.addChild(i),i.y=120*e}this.scroll.viewport.scrollV=0,this.scroll.viewport.validateNow()},e}(eui.Component);__reflect(RankDialog.prototype,"RankDialog");var SelectDialog=function(t){function e(e,i){var s=t.call(this)||this;return s.mCurrentGenderIndex=0,s.mCurrentCapIndex=0,s.gender_scale=.5,s.dispatcher=e,s.mCb=i,s.skinName=SelectDialogSkin,s}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),setTexture(this.okBtn.tfImg,"js_qd_png"),new Btn(this.okBtn,function(){e.dispatcher.request("user.init",{gender:e.mCurrentGenderIndex,cap:e.mCurrentCapIndex},function(t){return t?void console.log(t):void(e.mCb&&e.mCb())}.bind(e))}.bind(this));var i=this.gender_1=new Animation("chr0");this.addChild(i),i.play("handgun_stand",0),i.x=this.gender1Img.x,i.y=this.gender1Img.y-30,i.scaleX=i.scaleY=this.gender_scale,i.touchEnabled=!0,i.touchChildren=!0;var s=this.gender_2=new Animation("chr1");this.addChild(s),s.play("handgun_stand",0),s.x=this.gender2Img.x,s.y=this.gender2Img.y-30,s.scaleX=s.scaleY=this.gender_scale,s.touchEnabled=!0,s.touchChildren=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0!=e.mCurrentGenderIndex&&(e.mCurrentGenderIndex=0,e.refreshCapMc())},this),s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1!=e.mCurrentGenderIndex&&(e.mCurrentGenderIndex=1,e.refreshCapMc())},this),this.refreshCapMc(),this.cap1Mc.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0!=e.mCurrentCapIndex&&(e.mCurrentCapIndex=0,e.refreshCapMc())},this),this.cap2Mc.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1!=e.mCurrentCapIndex&&(e.mCurrentCapIndex=1,e.refreshCapMc())},this),this.adjustUI()},e.prototype.adjustUI=function(){if(weedon.winSize.width/weedon.winSize.height>.64)this.stage.setContentSize(640,1e3),this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL,this.y=-193,this.screenHeight=1e3;else{this.stage.setContentSize(640,1386),this.stage.scaleMode=egret.StageScaleMode.NO_BORDER,this.scaleX=this.scaleY=Math.min(.64/(weedon.winSize.width/weedon.winSize.height),1),this.x=640*(1-this.scaleX)/2,this.y=1e3*(1-this.scaleY)/2;var t=this.x?{width:640,height:1e3}:weedon.winSize;this.screenHeight=640*t.height/t.width}this.bg.height=this.screenHeight},e.prototype.refreshCapMc=function(){this.gender1Img.visible=0==this.mCurrentGenderIndex,this.gender2Img.visible=1==this.mCurrentGenderIndex,this.cap1Mc.dqImg.visible=0==this.mCurrentCapIndex,setTexture(this.cap1Mc.bgImg,0==this.mCurrentCapIndex?"ck_wupin_dangqian_png":"ck_wupin_putong_png"),setTexture(this.cap1Mc.iconImg,"zs_maozi_s00_png"),this.cap1Mc.nameTF.text="黑帽子",this.cap1Mc.numTF.text="",this.cap2Mc.dqImg.visible=1==this.mCurrentCapIndex,setTexture(this.cap2Mc.bgImg,1==this.mCurrentCapIndex?"ck_wupin_dangqian_png":"ck_wupin_putong_png"),setTexture(this.cap2Mc.iconImg,"zs_maozi_s01_png"),this.cap2Mc.nameTF.text="白帽子",this.cap2Mc.numTF.text="",this.hatImg_1=createBitmap("zs_maozi_b0"+this.mCurrentCapIndex+"_png",.5,.5,0,0,this.gender_scale,this.gender_scale),this.gender_1.setSlot("hat",this.hatImg_1),this.hatImg_2=createBitmap("zs_maozi_b0"+this.mCurrentCapIndex+"_png",.5,.5,0,0,this.gender_scale,this.gender_scale),this.gender_2.setSlot("hat",this.hatImg_2)},e}(eui.Component);__reflect(SelectDialog.prototype,"SelectDialog");var SettingDialog=function(t){function e(e,i){var s=t.call(this)||this;return s.mScreenHeight=e,s.dispatcher=i,s.skinName=SettingDialogSkin,s}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.mDataJson=RES.getRes("data_json"),this.bg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.parent.removeChild(e)},this),this.nameTF.text=this.dispatcher.get("user","nickname")+"\n游戏ID:"+this.dispatcher.get("user","_id"),this.lvTF.text="Lv."+formula.getULevel(this.dispatcher.get("user","experience")||0),this.versionTF.text="版本号：1.0.0",setAvatar(this.headImg,this.dispatcher.get("user","avatar")||0,this.dispatcher.get("user","avatarUrl")||"");var i=formula.getRankInfo(this.dispatcher.get("user","rankLv"));this.pwTF.text=i.name,this.starTF.text=i.starNum,ActionUtils.refreshDwMc(this.dwMc,MainSceneConfig.rankLv,1),setTexture(this.shareBtn1.tfImg,"new_tf_fuzhi_png"),this.shareBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ActionUtils.runBtnAction(this.shareBtn1);var t=document.createElement("input");t.setAttribute("readonly",""),t.value=this.dispatcher.get("user","_id").toString(),t.style.opacity="0",t.style.position="absolute",t.style.left="-9999px",t.style.top="-9999px",document.body.appendChild(t),t.focus(),t.select(),t.setSelectionRange(0,t.value.length),t.oncopy=function(t){console.log("您的游戏ID已成功复制到剪贴板")}.bind(this),document.execCommand("Copy"),document.body.removeChild(t)},this),setTexture(this.shareBtn2.tfImg,"new_tf_fenxiang_png"),this.shareBtn2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("分享")},this),this.yyMc.nameTF.text="音乐",new Btn(this.yyMc,function(){e.yyMc.okImg.visible=!e.yyMc.okImg.visible}),this.yxMc.nameTF.text="音效",new Btn(this.yxMc,function(){e.yxMc.okImg.visible=!e.yxMc.okImg.visible});var s=this.dispatcher.get("user","qualifyDt"),n=Math.max(s[0],s[1],s[2],s[3]),a=this.dispatcher.get("user","hitHeadNum")||0,r=this.dispatcher.get("user","hitNum")||0,o=this.dispatcher.get("user","shootNum")||0,h=0==o?0:r/o,l=0==o?0:a/o,c=[null,0==h?.05:+h.toFixed(4),0==n?.98:0==s[0]?.05:s[0]/n,0==n?.98:0==s[1]?.05:s[1]/n,0==n?.98:0==s[2]?.05:s[2]/n,0==n?.98:0==s[3]?.05:s[3]/n,0==l?.05:+l.toFixed(4)],d=MatchUtils.getRegularSixSidedPolygonObject(320,730,100,c),u=new egret.Shape,p=["O","A","B","C","D","E","F"];u.graphics.lineStyle(2,11036195),u.graphics.moveTo(d[p[1]].x,d[p[1]].y);for(var g=2;g<p.length;g++)u.graphics.lineTo(d[p[g]].x,d[p[g]].y);u.graphics.lineTo(d[p[1]].x,d[p[1]].y),u.graphics.lineStyle(1,15121785);for(var g=2;g<p.length;g++)u.graphics.lineTo(d[p[0]].x,d[p[0]].y),u.graphics.lineTo(d[p[g]].x,d[p[g]].y);u.graphics.beginFill(13868898),u.graphics.moveTo(d[p[1]+p[1]].x,d[p[1]+p[1]].y);for(var g=2;g<p.length;g++)u.graphics.lineTo(d[p[g]+p[g]].x,d[p[g]+p[g]].y);u.graphics.lineTo(d[p[1]+p[1]].x,d[p[1]+p[1]].y),u.graphics.endFill(),this.addChild(u),this.ATF.textFlow=[{text:"命中率\n[",style:{size:24,textColor:7093780}},{text:(100*h).toFixed(2)+"%",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}},{text:"]",style:{size:24,textColor:7093780}}],this.BTF.textFlow=[{text:"左轮胜场\n",style:{size:24,textColor:7093780}},{text:s[0]+"",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}}],this.CTF.textFlow=[{text:"步枪胜场\n",style:{size:24,textColor:7093780}},{text:s[1]+"",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}}],this.DTF.textFlow=[{text:"散弹胜场\n",style:{size:24,textColor:7093780}},{text:s[2]+"",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}}],this.ETF.textFlow=[{text:"狙击胜场\n",style:{size:24,textColor:7093780}},{text:s[3]+"",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}}],this.FTF.textFlow=[{text:"爆头率\n[",style:{size:24,textColor:7093780}},{text:(100*l).toFixed(2)+"%",style:{size:24,textColor:16777215,stroke:2,strokeColor:12153638}},{text:"]",style:{size:24,textColor:7093780}}],setTexture(this.mzImg,"zs_maozi_s0"+(this.dispatcher.get("user","cap")-1e4)+"_png");var m=this.getExpInfo();m.isMax?(this.lvPrg.value=100,this.expTF.text="满级"):(this.lvPrg.value=m.curExp/m.totalExp*100,this.expTF.text=m.curExp+"/"+m.totalExp)
},e.prototype.getExpInfo=function(){for(var t=this.dispatcher.get("user","experience")||0,e=0,i=0;i<this.mDataJson.lvExpers.length;i++){var s=this.mDataJson.lvExpers[i];if(s>t)return e=i+1,e==this.mDataJson.lvExpers.length?{lv:e,isMax:!0}:{lv:e,isMax:!1,curExp:t-(this.mDataJson.lvExpers[i-1]||0),totalExp:s-(this.mDataJson.lvExpers[i-1]||0)}}},e}(eui.Component);__reflect(SettingDialog.prototype,"SettingDialog");var HouseScene=function(t){function e(e,i,s){var n=t.call(this)||this;return n.typeItems=[],n.target_scale=.6,n.standArray=["handgun_stand","rifle_stand","shutgun_stand","sniper_stand"],n.dispatcher=e,n.skinName=HouseSceneSkin,n.closeCallBack=i,n.screenHeight=s,n.dataJson=RES.getRes("data_json"),n.mMaxShuliandu=RES.getRes("game_config_json").buttleConfig.experGunMax,n.y=-(1386-s)/2,n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.typeNames=["武器","道具"],new Btn(this.btnBack,function(){0==e.currentStatus?e.closeCallBack():1==e.currentStatus?e.refreshUi():2==e.currentStatus?e.showPropList():console.log("error")}),this.groupLeft.x=-310,this.groupRight.visible=!1,egret.Tween.get(this.groupLeft).to({x:40},200).to({x:0},50).wait(100).call(function(){e.groupRight.visible=!0,e.refreshUi(),e.adjustUi(),e.showPerson()}),this.btn_use=new Btn(this.btnUse,function(){this.useProp(this.typeIndex,this.dataBind)}.bind(this)),this.btn_buy0=new Btn(this.btnBuy0,function(){console.log(e.dataBind+"---price="+e.dataDetail[5]);var t=e.dispatcher.get("user","goldAll")-e.dispatcher.get("user","goldCost");return t<e.dataDetail[5]?void console.log("gold not enough"):void e.dispatcher.request("propHs.buyProp",{mode:0,propIndex:e.dataBind},function(t){t&&console.log(t),console.log("success"),this.showPropDetail(this.dataBind),this.updateGold()}.bind(e))}),this.btn_buy1=new Btn(this.btnBuy1,function(){var t=e.dispatcher.get("user","diamondAll")-e.dispatcher.get("user","diamondCost");return t<e.dataDetail[6]?void console.log("diamond not enough"):void e.dispatcher.request("propHs.buyProp",{mode:1,propIndex:e.dataBind},function(t){t&&console.log(t),console.log("success"),this.updateGold()}.bind(e))})},e.prototype.adjustUi=function(){this.btnBack.y=43+(1386-this.screenHeight)/2;var t=(1386-this.screenHeight)/4;this.btnBuy1.y=this.btnBuy0.y=804-t,this.labelBuy.y=738-t,this.line_down.y=850-t,this.btnUse.y=947-t,this.unlockLevel.y=947-t,this.diamondTF.y=1184-t,this.diamondImg.y=1176-t,this.coinTF.y=1140-t,this.coinImg.y=1132-t},e.prototype.refreshUi=function(){var t=this;this.currentStatus=0,this.groupHouse.visible=!0,this.groupHouse.removeChildren(),this.groupDetial.visible=!1,this.ck_title.text="仓 库";var e=["wq_sq_s00_png","dj_zhadan_s00_png"];this.typeItems=[];for(var i=0;i<this.typeNames.length;i++){var s=new TypeItem;this.groupHouse.addChild(s),this.typeItems.push(s),s.y=30+i*s.height+20*i,s.x=5,setTexture(s.img_type,e[i],.5,.5,1,1),s.label_type.text=this.typeNames[i],s.currentI=i,s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.typeIndex=t.target.currentI,this.showPropList()}.bind(this),this),s.visible=!1}this.typeItems[0].visible=!0,egret.Tween.get(this.typeItems[1]).to({},3e3*i,function(){t.typeItems[1].visible=!0}),this.updateGold()},e.prototype.showPropList=function(){console.log("show proplist:"+this.typeIndex),this.currentStatus=1,this.ck_title.text=0==this.typeIndex?"武 器":"道 具",this.groupHouse.visible=!0,this.groupDetial.visible=!1,this.groupHouse.removeChildren();var t=this.dispatcher.get("user");this.list=new eui.Group,this.scroller=new egret.ScrollView(this.list),this.groupHouse.addChild(this.scroller),this.scroller.y=30,this.scroller.x=5,this.scroller.width=this.list.width=320,this.scroller.height=696;for(var e=(t.gunIndex||"",0==this.typeIndex?t.gunHs||[[0,-1],[-1,-1],[-1,-1],[-1,-1]]:t.propHs||[[0,-1,-1],[-1,-1,-1],[-1,-1,-1]]),i=0,s=0;s<e.length;s++)for(var n=e[s],a=0;a<n.length;a++){var r=new PropItem;r.x=a%3*108,r.y=110*(i+Math.floor(a/3)),this.list.addChild(r);var o;if(0==this.typeIndex)o=this.dataJson.gunsBaseNumber[s+"-"+a],setTexture(r.propImg,"weapon_s_"+s+"_"+a+"_png"),r.suoImg.visible=r.suoImgBg.visible=-1==e[s][a],r.iconImg.visible=this.dispatcher.get("user","gunIndex")==s+"-"+a,setTexture(r.bgImg,this.dispatcher.get("user","gunIndex")==s+"-"+a?"ck_wupin_dangqian_png":"ck_wupin_putong_png"),r.propLabel.text=r.suoImg.visible?this.dataJson.gunUnLockLevel[o[0]]+"级解锁":o[0],r.itemNum.visible=!1;else if(1==this.typeIndex){o=this.dataJson.propsBaseNumber[s+"-"+a],setTexture(r.propImg,"prop_s_"+s+"_"+a+"_png"),r.suoImg.visible=r.suoImgBg.visible=e[s][a]<0,r.iconImg.visible=this.dispatcher.get("user","propIndex")==s+"-"+a,setTexture(r.bgImg,this.dispatcher.get("user","propIndex")==s+"-"+a?"ck_wupin_dangqian_png":"ck_wupin_putong_png"),r.propLabel.text=r.suoImg.visible?this.dataJson.propUnLockLevel[o[0]]+"级解锁":o[0],r.itemNum.visible=!0;var h=-1-n[a];r.itemNum.text=n[a]>=0?n[a]:0==h?"":h}r.bgImg.visible=!r.suoImg.visible,r.propImg.alpha=r.suoImg.visible?.7:1;var l=s+"-"+a;r.currentI=l,r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.showPropDetail(t.target.currentI)}.bind(this),this),a==n.length-1&&(i+=Math.ceil(a/3))}},e.prototype.showPropDetail=function(t){if(console.log("---"),this.adjustUi(),this.refreshPreson(5),this.dataBind=t,console.log("show detail :"+t),this.unlockLevel.visible=!1,this.currentStatus=2,this.ck_title.text="详 情",this.groupHouse.visible=!1,this.groupDetial.visible=!0,this.btnUse.visible=!1,this.experTitle.visible=this.experValue.visible=0==this.typeIndex,this.btnBuy0.visible=this.btnBuy1.visible=this.labelBuy.visible=!1,0==this.typeIndex){var e=this.dataJson.gunsBaseNumber[t];this.dataDetail=e,this.propTitle.text=e[0],this.propDes.text=e[7];var i=["伤害","弹夹","精度","射速"];this.attrGroup.removeChildren();for(var s=0;s<i.length;s++){var n=new AttrItem;this.attrGroup.addChild(n),n.y=(20+n.height)*s,n.label_k.text=i[s],n.label_v.text=e[s+2]+""}var a=this.dispatcher.get("user","gunHs")||[[0,-1],[-1,-1],[-1,-1],[-1,-1]],r=e[1].split("-");setTexture(this.propIcon,"weapon_l_"+ +r[0]+"_"+ +r[1]+"_png");var o=a[+r[0]][+r[1]];this.experValue.visible&&(this.experValue.text=(-1==o?0:o)+"/"+this.mMaxShuliandu),this.btnUse.visible=-1!=o,this.unlockLevel.visible=!this.btnUse.visible,this.unlockLevel.visible&&(this.unlockLevel.text=this.dataJson.gunUnLockLevel[e[0]]+"级解锁"),this.btnUse.touchEnabled=this.dispatcher.get("user","gunIndex")!=t,setTexture(this.btnUse.bgImg,this.dispatcher.get("user","gunIndex")!=t?"ck_anniu_zhuangbei_png":"ck_anniu_yizhuangbei_png"),setTexture(this.btnUse.tfImg,this.dispatcher.get("user","gunIndex")!=t?"wz_zb_png":"wz_yzb_png")}else if(1==this.typeIndex){var e=this.dataJson.propsBaseNumber[t];this.dataBind=t,this.dataDetail=e,this.propTitle.text=e[0],this.attrGroup.removeChildren(),this.propDes.text=e[7];var h=this.dispatcher.get("user","propHs")||[[0,-1,-1],[-1,-1,-1],[-1,-1,-1]],l=e[1],r=l.split("-");setTexture(this.propIcon,"prop_l_"+ +r[0]+"_"+ +r[1]+"_png");var c=h[+r[0]][+r[1]];console.log(c),this.btnBuy0.visible=this.btnBuy1.visible=this.labelBuy.visible=h[+r[0]][+r[1]]>=0,this.btnUse.visible=c>0,this.unlockLevel.visible=0>c,this.unlockLevel.visible&&(this.unlockLevel.text=this.dataJson.propUnLockLevel[e[0]]+"级解锁"),this.btnBuy0.visible&&(setTexture(this.btnBuy0.img_left,"sy_jinbi_png"),this.btnBuy0.label_right.text=e[5]+"",setTexture(this.btnBuy1.img_left,"sy_zuanshi_png"),this.btnBuy1.label_right.text=e[6]+""),this.btnUse.touchEnabled=this.dispatcher.get("user","propIndex")!=t,setTexture(this.btnUse.bgImg,this.dispatcher.get("user","propIndex")!=t?"ck_anniu_zhuangbei_png":"ck_anniu_yizhuangbei_png"),setTexture(this.btnUse.tfImg,this.dispatcher.get("user","propIndex")!=t?"wz_zb_png":"wz_yzb_png")}},e.prototype.updateGold=function(){var t=this.dispatcher.get("user","goldAll")||0,e=this.dispatcher.get("user","goldCost")||0,i=this.dispatcher.get("user","diamondAll")||0,s=this.dispatcher.get("user","diamondCost")||0;this.coinTF.text=t-e+"",this.diamondTF.text=i-s+""},e.prototype.useProp=function(t,e){0==this.typeIndex?this.dispatcher.request("propHs.changeGun",{gunIndex:e},function(t){t&&console.log(t);this.dispatcher.get("user");console.log("change gun` success"),this.refreshPreson(4),this.showPropDetail(e)}.bind(this)):1==this.typeIndex&&this.dispatcher.request("propHs.changeProps",{mode:0,propIndex:e},function(t){t&&console.log(t);this.dispatcher.get("user");console.log("change gun success"),this.showPropDetail(e)}.bind(this))},e.prototype.showPerson=function(){var t=this.dispatcher.get("user","gender"),e=this.dispatcher.get("user","cap")-1e4;t=-1==t?1:t;var i=this.target=new Animation("chr"+t);i.setSlot("hat",createBitmap("zs_maozi_b0"+e+"_png",.5,.5,0,0,this.target_scale,this.target_scale)),this.groupLeft.addChild(i),i.x=this.coinImg.x+80,i.y=this.coinImg.y-100,i.scaleX=i.scaleY=this.target_scale,this.refreshPreson(3)},e.prototype.refreshPreson=function(t){console.log("刷新 换枪 一次,当前 logIndex"+t);var e=this.dispatcher.get("user","gunIndex");this.target.x=this.coinImg.x+80,this.target.y=this.coinImg.y-100,this.target.play(this.standArray[e.substr(0,1)],0);var i=this.dispatcher.get("user","gunHs")||[[0,-1],[-1,-1],[-1,-1],[-1,-1]],s=i[+e.substr(0,1)][+e.substr(2,1)],n=new eui.Group;if(n.addChild(createBitmap("weapon_m_"+e.replace("-","_")+"_png",.5,.5,0,0,1,1)),s==RES.getRes("game_config_json").buttleConfig.experGunMax){var a=new Animation("se_maxlevel");a.x=0,a.y=0,a.play("stand",0),n.addChild(a)}this.target.setSlot("gun0",n)},e}(eui.Component);__reflect(HouseScene.prototype,"HouseScene");var TypeItem=function(t){function e(){var e=t.call(this)||this;return e.skinName=CKBtnMulu,e}return __extends(e,t),e}(eui.Button);__reflect(TypeItem.prototype,"TypeItem");var PropItem=function(t){function e(){var e=t.call(this)||this;return e.skinName=HouseItem,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.touchEnabled=!0,this.bgImg.touchEnabled=this.iconImg.touchEnabled=this.propImg.touchEnabled=this.propLabel.touchEnabled=this.suoImg.touchEnabled=this.suoImgBg.touchEnabled=!1},e}(eui.Component);__reflect(PropItem.prototype,"PropItem");var AttrItem=function(t){function e(){var e=t.call(this)||this;return e.skinName=GunAttrItem,e}return __extends(e,t),e}(eui.Component);__reflect(AttrItem.prototype,"AttrItem");